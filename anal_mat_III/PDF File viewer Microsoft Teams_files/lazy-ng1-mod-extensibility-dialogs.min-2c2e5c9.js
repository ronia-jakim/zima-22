webpackJsonp([5],{143:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.AddConnectorInstance=0]="AddConnectorInstance",e[e.ManageConnectorInstance=1]="ManageConnectorInstance"}(t.ConnectorDialogOperationType||(t.ConnectorDialogOperationType={}))},2627:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(2628),n(2630),n(2632),n(2634),n(2636),n(2639),n(2641),n(2643),n(2645),n(2647),n(2649),n(2651),n(2653),n(2655),n(2657),n(2659),n(2661),n(2663),n(2665),n(2672),n(2674),n(2677),n(2679),n(2681),n(2683),n(2685),n(2688),n(2690),n(2692),n(2694)},2628:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2629),o=function(e){function t(t,n){var i=e.call(this,t)||this;return i.errorMessage=t,i.errorCode=n,i}return i(t,e),t}(Error),r="extension_addAppDialogTeamPermission1",l="extension_addAppDialogTeamPermission2",p="extension_addAppDialogIdentityPermission2",c=["bots","staticTabs","galleryTabs","inputExtensions","connectors"],d=function(){function e(e,t,n,i,a,s,r,l,p,c,d,g,u,h,m,v,f,b,y,S,A,D,C,I,T,P){var x=this;this.$q=e,this.$scope=t,this.$timeout=n,this.channelService=i,this.conversationsService=a,this.navigationService=s,this.appsService=r,this.$translate=l,this.resources=p,this.localizationService=c,this.loggingService=d,this.settingsService=g,this.dialogService=h,this.eventingService=m,this.extensionManifestService=v,this.constants=f,this.sxConfig=b,this.filesAsyncMediaService=y,this.inputExtensionService=S,this.analyticsService=A,this.teamMembershipPropertiesService=D,this.teamSettingsService=C,this.userAppsDispatcher=I,this.utilityService=T,this.$window=P,this.appCapabilities=[],this.alreadyAddedToTeam=!1,this.alreadyAddedToGroupChat=!1,this.alreadyAddedToPersonalScope=!1,this.emptySpaceVisible=!1,this.hideContent=!0,this.isAppScreenshotsCollapsed=!1,this.isPersonalCapabilityCollapsed=!1,this.isTeamCapabilityCollapsed=!1,this.isGroupChatCapabilityCollapsed=!1,this.isPrivateAndPermissionsCollapsed=!1,this.isAboutCollapsed=!0,this.isChatSelected=!1,this.isFullDescriptionShowed=!1,this.isTeamAppInstallDisabled=!1,this.isTeamArchived=!1,this.mediaScrollOffset=0,this.mediaSize=0,this.permissions=[],this.requestedPermissions=[],this.selectedTeamIndex=-1,this.showLoadingButton=!1,this.showDialogLoadingSpinner=!1,this.showChatAndTeamSelector=!0,this.showTeamSelector=!0,this.showChannelSelector=!1,this.supportedLanguages=[],this.teams=[],this.wait=!1,this.autoNavigationOnDone=!1,this.installedAppCapabilities=[],this.installOptionFlags=teamspace.components.AddAppDialogInstallOptionFlag.Personal|teamspace.components.AddAppDialogInstallOptionFlag.Team,this.isInstallationTriggered=!1,this.skipInstalledSuccess=!1,this.viewScenario=d.newScenario(f.scenarios.extensibility.apps.addAppDialog.view),this.enableAppUpgradeNotification=g.valueAsBoolean(f.settings.names.enableAppUpgradeNotification),this.enableSideloadedAppsInGroupChat=g.valueAsBoolean(f.settings.names.enableSideloadedAppsInGroupChat),this.enableInstallChatAppsFromStore=g.valueAsBoolean(f.settings.names.enableInstallChatAppsFromStore),this.enableSideloadAppByZip=g.valueAsBoolean(f.settings.names.enableSideloadAppByZip),this.enableAppScreenshots=g.valueAsBoolean(f.settings.names.enableAppScreenshots),this.enableAppDetailDialogV3=g.valueAsBoolean(f.settings.names.enableAppDetailDialogV3),this.appFallbackIcon=f.fallbackImages.appFallbackImage,this.enableBotsInGroupChat=g.valueAsBoolean(f.settings.names.enableBotsInGroupChat),this.isPersonalCapabilityCollapsed=this.enableAppScreenshots,this.isTeamCapabilityCollapsed=this.enableAppScreenshots,this.enableInstallChatAppsFromStore&&(this.installOptionFlags|=teamspace.components.AddAppDialogInstallOptionFlag.GroupChat),this.dialogTitle=l.instant(p.strings.extension_addAppDialogTitle_new);var _=angular.isDefined(t.ngDialogData.action)?t.ngDialogData.action:teamspace.components.AddAppDialogAction.Install;if(this.upgradeFlow=_==teamspace.components.AddAppDialogAction.Consent,_==teamspace.components.AddAppDialogAction.View?this.footerButtons=[{text:l.instant(p.strings.teams_okButtonText),func:function(){return x.back()},disabled:!1,tid:"addAppDialog-ok",clickSilent:!0}]:this.upgradeFlow?this.footerButtons=[{text:l.instant(p.strings.extension_addAppDialog_back),func:function(){return x.back()},disabled:!1,secondaryStyle:!0,outcome:teamspace.components.PanelActionOutcome.closeDialog,scenario:teamspace.components.PanelActionScenario.upgradeAppDialog,type:teamspace.components.PanelModuleType.button,name:teamspace.components.PanelModuleName.cancelAddAppButton,summary:"Cancel upgrading an app",scenarioType:teamspace.components.PanelActionScenarioType.appMgmt,tid:"addAppDialog-back",dataBagFunc:function(){return teamspace.components.AppAnalyticsHelper.getAppAnalyticsData(x.app,x.teamId,x.channelId)}},{text:l.instant(p.strings.extension_addAppDialog_allow),func:function(){return x.upgrade()},disabled:!1,outcome:teamspace.components.PanelActionOutcome.submit,scenario:teamspace.components.PanelActionScenario.upgradeAppDialog,type:teamspace.components.PanelModuleType.button,name:teamspace.components.PanelModuleName.addAppButton,summary:"Consent to upgrade an app",scenarioType:teamspace.components.PanelActionScenarioType.appMgmt,tid:"addAppDialog-upgrade",dataBagFunc:function(){return teamspace.components.AppAnalyticsHelper.getAppAnalyticsData(x.app,x.teamId,x.channelId)}}]:(this.footerButtons=[{text:l.instant(p.strings.extension_addAppDialog_install),func:function(){return x.approve()},disabled:!1,tid:"addAppDialog-approve",clickSilent:!0}],this.enableBotsInGroupChat&&t.ngDialogData&&t.ngDialogData.source===f.extensibility.contextualStoreDialog&&this.getBackButtonForContextualStore()),t.$on("$destroy",function(){x.isInstallationTriggered||x.logViewAppActionForTelemetry(x.app,_),x.isFullDescriptionShowed=!1,x.viewScenario&&x.viewScenario.cancel(x.getScenarioEventData()),x.createScenarioPersonal&&x.createScenarioPersonal.cancel(x.getScenarioEventData()),x.createScenarioTeam&&x.createScenarioTeam.cancel(x.getScenarioEventData()),x.createScenarioGroupChat&&x.createScenarioGroupChat.cancel(x.getScenarioEventData()),x.upgradeScenario&&x.upgradeScenario.cancel()}),!1===u.getSettingValue(SkypeX.Services.TenantSettingsStorageKey.isAppsEnabled))return this.onError(new Error("Add app not allowed!"),p.strings.extension_addAppDialogTenantDisabled),void(this.footerButtons=[{text:l.instant(p.strings.extension_addAppDialog_back),func:function(){return x.back()},disabled:!1,scenarioType:teamspace.components.PanelActionScenarioType.appMgmt,tid:"addAppDialog-back",clickSilent:!0}]);try{if(!t.ngDialogData||!t.ngDialogData.appID&&!t.ngDialogData.appDefinitionSideloaded)throw new Error("Invalid Add App Dialog input");t.ngDialogData.appID&&(this.appID=t.ngDialogData.appID),t.ngDialogData.teamId&&(this.teamId=t.ngDialogData.teamId,g.valueAsBoolean(f.settings.names.enableTeamArchive)&&i.getTeamById(this.teamId).then(function(e){x.isTeamArchived=e.isArchived})),t.ngDialogData.teamName&&(this.teamName=t.ngDialogData.teamName),t.ngDialogData.appDefinitionSideloaded&&(this.app=t.ngDialogData.appDefinitionSideloaded),t.ngDialogData.autoNavigationOnDone&&(this.autoNavigationOnDone=t.ngDialogData.autoNavigationOnDone),t.ngDialogData.skipInstalledSuccess&&(this.skipInstalledSuccess=t.ngDialogData.skipInstalledSuccess),t.ngDialogData.messageId&&(this.messageId=t.ngDialogData.messageId),t.ngDialogData.installOptionFlags&&(this.installOptionFlags=t.ngDialogData.installOptionFlags),t.ngDialogData.channelId&&(this.channelId=t.ngDialogData.channelId),t.ngDialogData.category&&(this.category=t.ngDialogData.category),t.ngDialogData.chatId&&(this.chatId=t.ngDialogData.chatId),this.storeLaunchFromChat=!!t.ngDialogData.storeLaunchFromChat,this.dialogIntent=void 0!=t.ngDialogData.intent?t.ngDialogData.intent:teamspace.components.AddAppDialogIntent.Ambiguous,this.preselectTeam=t.ngDialogData.preselectTeam,this.preselectChannel=t.ngDialogData.preselectChannel,this.preselectChat=t.ngDialogData.preselectChat,this.dialogAction=angular.isDefined(t.ngDialogData.action)?t.ngDialogData.action:teamspace.components.AddAppDialogAction.Install,this.viewOnlyDialog=this.dialogAction===teamspace.components.AddAppDialogAction.View||this.upgradeFlow,this.showDialogLoadingSpinner=!0;var w=void 0;if(w=this.upgradeFlow?this.dialogIntent==teamspace.components.AddAppDialogIntent.Team?r.getInstalledAppForTeam(this.teamId,this.channelId,this.appID,"add-app-dialog::upgradeflow").then(function(e){return e&&e.appDefinition}):this.dialogIntent===teamspace.components.AddAppDialogIntent.GroupChat?r.getInstalledAppForGroupChat(this.chatId,this.appID).then(function(e){return e&&e.appDefinition}):r.getInstalledAppForUser(this.appID).then(function(e){return e&&e.appDefinition}):this.app?e.resolve(this.app.appDefinition):this.dialogIntent==teamspace.components.AddAppDialogIntent.Team?r.getTeamAppDefinition(this.teamId,this.channelId,this.appID,"add-app-dialog-v2"):this.dialogIntent===teamspace.components.AddAppDialogIntent.GroupChat?r.getGroupChatAppDefinition(this.chatId,this.appID,"add-app-dialog-v2"):r.getUserAppDefinition(this.appID,"add-app-dialog-v2"),(this.dialogIntent==teamspace.components.AddAppDialogIntent.Team&&!this.preselectTeam||this.viewOnlyDialog)&&(this.showTeamSelector=!1,this.showChatAndTeamSelector=!1),this.dialogIntent==teamspace.components.AddAppDialogIntent.GroupChat&&(this.isChatSelected=!0,this.preselectChat||(this.showChatAndTeamSelector=!1)),this.dialogIntent==teamspace.components.AddAppDialogIntent.Team&&(this.retrieveTeamId(),i.getTeamById(this.teamId).then(function(e){x.dialogTitle=l.instant(p.strings.extension_addAppDialogTitleTeamIntent_new)})),this.appID){var k=r.getInstalledAppForUser(this.appID);e.all([w,k]).then(function(e){e[1]&&(x.alreadyAddedToPersonalScope=e[1].appDefinition.isInstalledPersonally&&teamspace.services.AppsServiceUtils.isAppInstalled(e[1]),x.userInstalledAppDefinition=x.alreadyAddedToPersonalScope?e[1]:null),e[0]?x.onAppDefinitionRetrieved(e[0],e[1]?e[1].appEntitlement:{id:e[0].id,state:"NotInstalled"}):x.onError(new o(l.instant(p.strings.extension_addAppDialogErrorMessage)))}).catch(function(e){x.onError(e)})}else w.then(function(e){e?x.onAppDefinitionRetrieved(e,{id:e.id,state:"Installed"}):x.onError(new o(l.instant(p.strings.extension_addAppDialogErrorMessage)))}).catch(function(e){x.onError(e)})}catch(e){this.onError(e)}}return e.$inject=["$q","$scope","$timeout","channelService","conversationsService","navigationService","appsService","$translate","resources","localizationService","loggingService","settingsService","tenantSettingsStore","dialogService","eventingService","extensionManifestService","constants","sxConfig","filesAsyncMediaService","inputExtensionService","analyticsService","teamMembershipPropertiesService","teamSettingsService","userAppsDispatcher","utilityService","$window"],Object.defineProperty(e.prototype,"navCtx",{get:function(){return"add-app-dialog-v2"},enumerable:!0,configurable:!0}),e.prototype.back=function(){this.$scope.closeThisDialog()},e.prototype.backToContextualStore=function(){this.$scope.closeThisDialog(),this.$scope.ngDialogData.onBackButtonClicked()},e.prototype.expandCollapseAppScreenshots=function(){this.isAppScreenshotsCollapsed=!this.isAppScreenshotsCollapsed,this.isAppScreenshotsCollapsed||this.handleArrows()},e.prototype.expandCollapsePersonalCapabilities=function(){this.isPersonalCapabilityCollapsed=!this.isPersonalCapabilityCollapsed},e.prototype.expandCollapseTeamCapabilities=function(){this.isTeamCapabilityCollapsed=!this.isTeamCapabilityCollapsed},e.prototype.expandCollapseGroupChatCapabilities=function(){this.isGroupChatCapabilityCollapsed=!this.isGroupChatCapabilityCollapsed},e.prototype.expandCollapseAboutSection=function(){this.isAboutCollapsed=!this.isAboutCollapsed},e.prototype.expandCollapsePrivateAndPermissions=function(){this.isPrivateAndPermissionsCollapsed=!this.isPrivateAndPermissionsCollapsed},Object.defineProperty(e.prototype,"teamToggleSwitchDisabled",{get:function(){return this.alreadyAddedToTeam||this.wait||this.isTeamAppInstallDisabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"chatToggleSwitchDisabled",{get:function(){return this.alreadyAddedToGroupChat||this.wait},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"personalToggleSwitchDisabled",{get:function(){return this.alreadyAddedToPersonalScope||this.wait},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shouldShowTeamInstallOption",{get:function(){return!!(this.installOptionFlags&teamspace.components.AddAppDialogInstallOptionFlag.Team)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shouldShowGroupChatInstallOption",{get:function(){return!!(this.installOptionFlags&teamspace.components.AddAppDialogInstallOptionFlag.GroupChat)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shouldShowPersonalInstallOption",{get:function(){return!!(this.installOptionFlags&teamspace.components.AddAppDialogInstallOptionFlag.Personal)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shouldShowTeamOrChatInstallOption",{get:function(){return this.shouldShowTeamInstallOption&&this.appHasTeamScope||this.shouldShowGroupChatInstallOption&&this.appHasGroupChatScope},enumerable:!0,configurable:!0}),e.prototype.personalToggleChange=function(e){this.togglePersonalInstall=e,this.updateInstallButtonState()},e.prototype.teamToggleChange=function(e){this.toggleTeamInstall=e,this.toggleChatInstall=!1,this.updateInstallButtonState()},e.prototype.chatToggleChange=function(e){this.toggleChatInstall=e,this.toggleTeamInstall=!1,this.updateInstallButtonState()},e.prototype.approve=function(){var e=this;this.wait=!0,this.isInstallationTriggered=!0,this.evaluateApproveButtonEnabled(),this.toggleDisabledForInstallButton();var t=this.appsService.isSideloadedApp(this.app.appDefinition),n=!this.alreadyAddedToTeam&&this.shouldShowTeamInstallOption&&this.toggleTeamInstall&&!!this.teamId,i=!this.alreadyAddedToPersonalScope&&this.shouldShowPersonalInstallOption&&this.togglePersonalInstall,a=!this.alreadyAddedToGroupChat&&this.shouldShowGroupChatInstallOption&&!!this.chatId&&(!this.enableInstallChatAppsFromStore||this.toggleChatInstall);try{var s=[],r=[];n&&(r.push(teamspace.components.PanelAppScope.team),this.createScenarioTeam=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.addAppDialog.createTeam),s.push(t?this.sideloadAppForTeam():this.installAppForTeam())),i&&(r.push(teamspace.components.PanelAppScope.personal),this.createScenarioPersonal=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.addAppDialog.createPersonal),s.push(t?this.sideloadAppForUser():this.installAppForUser())),a&&(r.push(teamspace.components.PanelAppScope.group),this.createScenarioGroupChat=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.addAppDialog.createGroupChat),s.push(t?this.sideloadAppForChat():this.installAppForChat())),this.$q.all(s).then(function(){e.logInstallAppActionForTelemetry(r,e.app),e.completeInstallation(n,i,a)}).catch(function(t){t.data&&t.data.errorCode&&t.data.errorCode===e.constants.extensibility.apps.errorCodes.unableToParseTeamsAppManifest&&t.data.message?e.onError(new o(t.data.message,t.data.errorCode)):e.onError(t)})}catch(e){this.onError(e)}},e.prototype.left=function(){this.isLeftArrowVisible&&this.positionCardStrip(-1)},e.prototype.right=function(){this.isRightArrowVisible&&this.positionCardStrip(1)},e.prototype.focusOnVideo=function(){var e=document.activeElement.getElementsByTagName("iframe"),t=document.activeElement.getElementsByTagName("webview");(e&&e[0]||t&&t[0]).focus()},e.prototype.setPreActive=function(e){document.activeElement.setAttribute("id","media-preview-preactive-element"),this.logViewAppActionForTelemetry(this.app,teamspace.components.AddAppDialogAction.OpenImage,e)},e.prototype.toggleShowFullDescription=function(e){this.isFullDescriptionShowed=e;var t=angular.element(".ts-add-app-dialog-header-text-long-description"),n=angular.element(".scroll-parent");if(t&&n){this.maxContentScrollHeight=this.maxContentScrollHeight||n.height(),this.headerDescriptionHeightDiff=this.headerDescriptionHeightDiff||t[0].scrollHeight-t[0].clientHeight;var i=this.isFullDescriptionShowed?this.maxContentScrollHeight-this.headerDescriptionHeightDiff<0?0:this.maxContentScrollHeight-this.headerDescriptionHeightDiff:this.maxContentScrollHeight;n.height(i)}this.$timeout(function(){(e?angular.element("#add-app-dialog-view-less"):angular.element("#add-app-dialog-view-more")).focus()},0,!1)},e.prototype.getBackButtonForContextualStore=function(){var e=this;this.footerButtons.unshift({text:this.$translate.instant(this.resources.strings.extension_addAppDialog_back),func:function(){return e.backToContextualStore()},disabled:!1,secondaryStyle:!0,outcome:teamspace.components.PanelActionOutcome.closeDialog,scenario:teamspace.components.PanelActionScenario.backToTabGallery,type:teamspace.components.PanelModuleType.nav,typeNew:teamspace.components.PanelModuleType.tabBackButton,name:teamspace.components.PanelModuleName.tabBackButtonClick,nameNew:teamspace.components.PanelModuleName.tabSaveCancel,summary:"Back Button to Tab Gallery",scenarioType:teamspace.components.PanelActionScenarioType.appMgmt,subWorkLoad:teamspace.components.SubWorkLoad.addTab,tid:"addAppDialog-back",dataBagFunc:function(){return teamspace.components.AppAnalyticsHelper.getAppAnalyticsData(e.app,e.teamId,e.channelId)}})},e.prototype.getLanguageForCode=function(e){var t=this.localizationService.getLanguageForCode(e);if(!t)return null;var n=t.nativeName;if(!n)return null;var i=e.contains("-"),a=n.indexOf(" (");return!i&&a>-1?n.substr(0,a):n},e.prototype.positionCardStrip=function(e){this.screenshotArea=this.screenshotArea||$("#ts-add-app-dialog-screenshots-scrollable"),this.screenshotsStripe=this.screenshotsStripe||$(".screenshots-scrollable-wrapper"),this.mediaScrollOffset=this.screenshotArea.scrollLeft()+e*(this.screenshotsStripe.width()/this.mediaSize),this.screenshotArea.animate({scrollLeft:this.mediaScrollOffset},500),this.handleArrows()},e.prototype.onKeydown=function(e){e.keyCode===this.constants.keyCodes.left?this.left():e.keyCode===this.constants.keyCodes.right&&this.right()},e.prototype.handleArrows=function(){this.rightIcon=this.rightIcon||$(".right.carousel-control"),this.leftIcon=this.leftIcon||$(".left.carousel-control"),this.isLeftArrowVisible=this.mediaScrollOffset>0,this.isRightArrowVisible=this.mediaScrollOffset<this.screenshotsStripe.width()-this.screenshotArea.width()},e.prototype.getVideoUrl=function(e){var t=null;if(e.indexOf("youtube.com/")>0){var n=e.indexOf("v=");n>=0?t=e.substring(n+2):e.indexOf("/embed/")>0&&(this.videoUrl=e)}else if(e.indexOf("youtu.be/")>0)(i=e.lastIndexOf("/"))>=0&&(t=e.substring(i+1));else if(e.indexOf("vimeo.com/")>0){var i=e.lastIndexOf("/");if(i>=0){var a=e.substring(i+1);this.videoUrl=this.constants.urls.store.vimeoUrlFormat.replace("{vimeoId}",a)}}t&&!this.videoUrl&&(this.videoUrl=this.constants.urls.store.youtubeUrlFormat.replace("{youtubeId}",t))},e.prototype.installAppForTeam=function(){var e=this;return this.appsService.createTeamAppEntitlement(this.teamId,this.app.appDefinition,this.channelId).then(function(){e.alreadyAddedToTeam=!0,e.teamInstalledAppDefinition={appDefinition:e.app.appDefinition,appEntitlement:{state:e.constants.extensibility.apps.appStates.installed}}})},e.prototype.installAppForUser=function(){var e=this;return(this.app.appDefinition.inputExtensions&&this.app.appDefinition.inputExtensions.length>0?this.inputExtensionService.installAndFavorite(this.app.appDefinition):this.appsService.createUserAppEntitlement(this.app.appDefinition)).then(function(){e.alreadyAddedToPersonalScope=!0,e.userInstalledAppDefinition={appDefinition:a(a({},e.app.appDefinition),{isInstalledPersonally:!0}),appEntitlement:{state:e.constants.extensibility.apps.appStates.installed}},e.userInstalledAppDefinition.appEntitlement.state=e.constants.extensibility.apps.appStates.installed})},e.prototype.installAppForChat=function(){var e=this;return this.appsService.createGroupChatAppEntitlement(this.chatId,this.app.appDefinition).then(function(){e.alreadyAddedToGroupChat=!0,e.groupChatInstalledAppDefinition={appDefinition:e.app.appDefinition,appEntitlement:{state:e.constants.extensibility.apps.appStates.installed}}})},e.prototype.sideloadAppForTeam=function(){var e=this,t=this.appsService.getInstalledAppsForTeam(this.teamId,this.channelId,void 0,"add-app-dialog-v2::sideloadAppForTeam"),n=_.cloneDeep(this.app),i=[];this.enableSideloadAppByZip||(0===n.appDefinition.smallImageUrl.indexOf("data:")&&i.push(this.uploadBase64DataIcon(n.appDefinition.smallImageUrl,"teamScope").then(function(e){return n.appDefinition.smallImageUrl=e})),0===n.appDefinition.largeImageUrl.indexOf("data:")&&i.push(this.uploadBase64DataIcon(n.appDefinition.largeImageUrl,"teamScope").then(function(e){return n.appDefinition.largeImageUrl=e})));var a=this.enableSideloadAppByZip?this.extensionManifestService.getZipStreamPromise(this.$scope.ngDialogData.file):this.$q.resolve();return this.$q.all([t,a].concat(i)).then(function(t){for(var i=n.appDefinition.externalId.toLowerCase(),a=t[0],s=t[1],o=0;o<a.length;o++){var r=a[o];if(teamspace.services.AppsServiceUtils.isAppInstalled(r)&&r.appDefinition.externalId&&i===r.appDefinition.externalId.toLowerCase()&&!r.appDefinition.tenantId)return n.appDefinition.id=r.appDefinition.id,(e.enableSideloadAppByZip?e.appsService.updateTeamAppDefinitionFromZip(e.teamId,r.appDefinition.id,s,e.channelId):e.appsService.updateTeamAppDefinition(e.teamId,n.appDefinition,e.channelId)).then(function(){e.alreadyAddedToTeam=!0,e.teamInstalledAppDefinition={appDefinition:n.appDefinition}})}return(e.enableSideloadAppByZip?e.appsService.createTeamAppDefinitionFromZip(e.teamId,s,e.channelId):e.appsService.createTeamAppDefinition(e.teamId,n.appDefinition,e.channelId)).then(function(t){e.alreadyAddedToTeam=!0,e.teamInstalledAppDefinition={appDefinition:t}})})},e.prototype.sideloadAppForUser=function(){var e=this,t=this.appsService.getAggregatedInstalledAppsForUser(!1),n=_.cloneDeep(this.app),i=[];this.enableSideloadAppByZip||(0===n.appDefinition.smallImageUrl.indexOf("data:")&&i.push(this.uploadBase64DataIcon(n.appDefinition.smallImageUrl,"personalScope").then(function(e){return n.appDefinition.smallImageUrl=e})),0===n.appDefinition.largeImageUrl.indexOf("data:")&&i.push(this.uploadBase64DataIcon(n.appDefinition.largeImageUrl,"personalScope").then(function(e){return n.appDefinition.largeImageUrl=e})));var a=this.enableSideloadAppByZip?this.extensionManifestService.getZipStreamPromise(this.$scope.ngDialogData.file):this.$q.resolve();return this.$q.all([t,a].concat(i)).then(function(t){for(var i=n.appDefinition.externalId.toLowerCase(),a=t[0],s=t[1],o=0;o<a.length;o++){var r=a[o];if(teamspace.services.AppsServiceUtils.isAppInstalled(r)&&r.appDefinition.externalId&&i===r.appDefinition.externalId.toLowerCase()&&!r.appDefinition.tenantId)return n.appDefinition.id=r.appDefinition.id,(e.enableSideloadAppByZip?e.appsService.updateUserAppDefinitionFromZip(n.appDefinition.id,s):e.appsService.updateUserAppDefinition(n.appDefinition)).then(function(){e.alreadyAddedToPersonalScope=!0,e.userInstalledAppDefinition={appDefinition:n.appDefinition}})}return(e.enableSideloadAppByZip?e.appsService.createUserAppDefinitionFromZip(s):e.appsService.createUserAppDefinition(n.appDefinition)).then(function(t){e.alreadyAddedToPersonalScope=!0,e.userInstalledAppDefinition={appDefinition:t}})})},e.prototype.sideloadAppForChat=function(){var e=this,t=this.appsService.getInstalledAppsForGroupChat(this.chatId),n=_.cloneDeep(this.app),i=[];this.enableSideloadAppByZip||(0===n.appDefinition.smallImageUrl.indexOf("data:")&&i.push(this.uploadBase64DataIcon(n.appDefinition.smallImageUrl,"groupchatScope").then(function(e){return n.appDefinition.smallImageUrl=e})),0===n.appDefinition.largeImageUrl.indexOf("data:")&&i.push(this.uploadBase64DataIcon(n.appDefinition.largeImageUrl,"groupchatScope").then(function(e){return n.appDefinition.largeImageUrl=e})));var a=this.enableSideloadAppByZip?this.extensionManifestService.getZipStreamPromise(this.$scope.ngDialogData.file):this.$q.resolve();return this.$q.all([t,a].concat(i)).then(function(t){for(var i=n.appDefinition.externalId.toLowerCase(),a=t[0],s=t[1],o=0;o<a.length;o++){var r=a[o].appDefinition;if(teamspace.services.AppsServiceUtils.isAppInstalled(a[o])&&r.externalId&&i===r.externalId.toLowerCase())return n.appDefinition.id=r.id,(e.enableSideloadAppByZip?e.appsService.updateGroupChatAppDefinitionFromZip(e.chatId,n.appDefinition.id,s):e.appsService.updateGroupChatAppDefinition(e.chatId,n.appDefinition)).then(function(){e.alreadyAddedToGroupChat=!0,e.groupChatInstalledAppDefinition=n})}return(e.enableSideloadAppByZip?e.appsService.createGroupChatAppDefinitionFromZip(e.chatId,s):e.appsService.createGroupChatAppDefinition(e.chatId,n.appDefinition)).then(function(t){e.alreadyAddedToGroupChat=!0,e.groupChatInstalledAppDefinition={appDefinition:t}})})},e.prototype.completeInstallation=function(e,t,n){var i,a,s=this;e?(i=this.teamInstalledAppDefinition,a="teamScope"):t?(i=this.userInstalledAppDefinition,a="personalScope"):n&&(i=this.groupChatInstalledAppDefinition,a="groupchatScope");var o,r=i.appDefinition.bots&&i.appDefinition.bots.length>0&&this.constants.bots.keyPrefix+i.appDefinition.bots[0].id;if(t&&r){var l=this.conversationsService.getChatConversationWith(r);o=this.conversationsService.ensureConversationCreated(l.id)}else o=this.$q.resolve(null);o.then(function(){s.wait=!1,s.createScenarioTeam&&(s.createScenarioTeam.stop(s.getScenarioEventData()),s.createScenarioTeam=void 0),s.createScenarioPersonal&&(s.createScenarioPersonal.stop(s.getScenarioEventData()),s.createScenarioPersonal=void 0),s.createScenarioGroupChat&&(s.createScenarioGroupChat.stop(s.getScenarioEventData()),s.createScenarioGroupChat=void 0);var e={installSucceeded:!0,botMri:r,botDisplayName:i.appDefinition.name,appId:i.appDefinition.id};s.eventingService.$emit(s.constants.events.app.installed,{result:e}),s.skipInstalledSuccess?s.closeDialogAndCallback(e,a):s.goToPostInstallDialog(a)}).catch(function(e){s.onError(e)})},e.prototype.goToPostInstallDialog=function(e){var t,n;switch(e){case"teamScope":t=this.teamInstalledAppDefinition||{appDefinition:this.app.appDefinition},n=teamspace.components.AddAppDialogIntent.Team;break;case"personalScope":t=this.userInstalledAppDefinition||{appDefinition:this.app.appDefinition},n=teamspace.components.AddAppDialogIntent.User,this.dispatchANewAppInstalledAction(this.app);break;case"groupchatScope":t=this.groupChatInstalledAppDefinition||{appDefinition:this.app.appDefinition},n=teamspace.components.AddAppDialogIntent.GroupChat;break;default:t={appDefinition:this.app.appDefinition},n=teamspace.components.AddAppDialogIntent.Ambiguous}this.dialogService.openLazyDialog(this.constants.lazyDialogs.appInstalledV2,this.constants.lazyModules.extensibilityDialogs,{app:t,autoNavigationOnDone:this.autoNavigationOnDone,teamId:this.teamId,chatId:this.chatId,messageId:this.messageId,teamName:this.teamName,channelId:this.channelId,dialogIntent:n,botMri:t.appDefinition.bots&&t.appDefinition.bots.length>0?this.constants.bots.keyPrefix+t.appDefinition.bots[0].id:void 0,preselectChannel:this.preselectChannel,category:this.category,storeLaunchFromChat:this.storeLaunchFromChat}),this.$scope.closeThisDialog()},e.prototype.upgrade=function(){var e=this;if(this.enableAppUpgradeNotification){this.upgradeScenario=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.addAppDialog.consent);var t;if(this.dialogIntent==teamspace.components.AddAppDialogIntent.User)t=this.appsService.upgradeUserAppEntitlement(this.app.appDefinition);else if(this.dialogIntent==teamspace.components.AddAppDialogIntent.Team)t=this.appsService.upgradeTeamAppEntitlement(this.teamId,this.app.appDefinition);else if(this.dialogIntent==teamspace.components.AddAppDialogIntent.TeamAndUser)t=this.$q.all([this.appsService.upgradeUserAppEntitlement(this.app.appDefinition),this.appsService.upgradeTeamAppEntitlement(this.teamId,this.app.appDefinition)]);else{if(this.dialogIntent!=teamspace.components.AddAppDialogIntent.GroupChat)return void this.onError("Add App Dialog intent missing!");t=this.appsService.upgradeChatAppEntitlement(this.chatId,this.app.appDefinition)}this.wait=!0,this.evaluateApproveButtonEnabled(),t.then(function(){e.wait=!1,e.upgradeScenario.stop(a(a({},e.getScenarioEventData()),{teamId:e.teamId,intent:e.dialogIntent})),e.$scope.closeThisDialog({upgradeSucceeded:!0})}).catch(function(t){e.onError(t)})}},e.prototype.dispatchANewAppInstalledAction=function(e){(this.hasPersonalScope(this.app.appDefinition.staticTabs)||this.hasPersonalScope(this.app.appDefinition.bots))&&this.userAppsDispatcher.dispatch({actionType:teamspace.services.userApp.UserAppsActionTypes.NOTIFY_APP,payload:e.appDefinition.id})},e.prototype.toggleDisabledForInstallButton=function(){var e=angular.element($("button[data-tid='addAppDialog-approve']"));e&&(this.showLoadingButton=!this.showLoadingButton,e.attr("disabled")?e.removeAttr("disabled"):e.attr("disabled","disabled"))},e.prototype.uploadBase64DataIcon=function(e,t){for(var n=e.indexOf(","),i=atob(e.substring(n+1)),a=i.length,s=new Uint8Array(new ArrayBuffer(a)),o=0;o<a;o++)s[o]=i.charCodeAt(o);return i?"teamScope"==t?this.uploadIcon(this.teamId,s):"personalScope"==t?this.uploadIcon(this.sxConfig.getCurrentSkypeMri(),s):"groupchatScope"==t?this.uploadIcon(this.chatId,s):this.$q.reject("Can't upload in specified scope"):this.$q.reject("Icon format error")},e.prototype.uploadIcon=function(e,t){var n=this,i={containerId:e};return this.filesAsyncMediaService.uploadItem(i,t).then(function(e){return n.$q.resolve(e.fullsizeUrl)}).catch(function(e){return n.logError("Icon upload error",JSON.stringify(e)),n.$q.reject("Icon upload error:"+JSON.stringify(e))})},e.prototype.teamSelected=function(){-1!=this.selectedTeamIndex&&this.teams[this.selectedTeamIndex]&&this.teams[this.selectedTeamIndex].type==teamspace.components.SelectorItemType.Team&&(this.teamId=this.teams[this.selectedTeamIndex].teamId,this.teamName=this.teams[this.selectedTeamIndex].text,this.isTeamAppInstallDisabled=!this.teams[this.selectedTeamIndex].installAppEnabled),this.updateButtonStateBasedOnSelectedTeam()},e.prototype.updateInstallButtonState=function(){var e,t;if(this.appHasPersonalScope&&this.shouldShowPersonalInstallOption&&(this.appHasTeamScope&&this.shouldShowTeamInstallOption||this.enableInstallChatAppsFromStore&&this.appHasGroupChatScope&&this.shouldShowGroupChatInstallOption))e=this.personalToggleSwitchDisabled&&this.teamToggleSwitchDisabled,this.enableInstallChatAppsFromStore&&this.isChatSelected&&(e=e||this.personalToggleSwitchDisabled&&this.chatToggleSwitchDisabled),t=!this.alreadyAddedToPersonalScope&&(this.appHasTeamScope&&!this.alreadyAddedToTeam||this.enableInstallChatAppsFromStore&&this.appHasGroupChatScope&&!this.alreadyAddedToGroupChat)?this.teamId&&this.appHasTeamScope?!this.togglePersonalInstall&&!this.toggleTeamInstall:this.chatId&&this.appHasGroupChatScope?!this.togglePersonalInstall&&!this.toggleChatInstall:!this.togglePersonalInstall||(this.toggleTeamInstall||this.toggleChatInstall):this.alreadyAddedToPersonalScope?this.teamId&&this.appHasTeamScope?!this.toggleTeamInstall:!this.chatId||!this.appHasGroupChatScope||!this.toggleChatInstall:!this.togglePersonalInstall;else if(this.appHasTeamScope&&this.shouldShowTeamInstallOption||this.enableInstallChatAppsFromStore&&this.appHasGroupChatScope&&this.shouldShowGroupChatInstallOption){var n=this.teamId&&this.appHasTeamScope&&!this.teamToggleSwitchDisabled,i=this.chatId&&this.appHasGroupChatScope&&!this.chatToggleSwitchDisabled;e=!(n||i),t=this.teamId&&this.appHasTeamScope?!this.toggleTeamInstall:!this.chatId||!this.appHasGroupChatScope||!this.toggleChatInstall}else this.appHasPersonalScope&&this.shouldShowPersonalInstallOption?(e=this.personalToggleSwitchDisabled,t=!this.togglePersonalInstall):!this.enableInstallChatAppsFromStore&&this.appHasGroupChatScope&&this.shouldShowGroupChatInstallOption?(e=!1,t=!1):(t=!0,this.loggingService.error("No install option available: "+JSON.stringify({appHasPersonalScope:this.appHasPersonalScope,appHasGroupChatScope:this.appHasGroupChatScope,appHasTeamScope:this.appHasTeamScope,installOptionFlags:this.installOptionFlags})));this.footerButtons[0].disabled=(e||t)&&this.dialogAction!=teamspace.components.AddAppDialogAction.View&&this.dialogAction!=teamspace.components.AddAppDialogAction.Consent},e.prototype.closeDialogAndCallback=function(e,t){var n=this;if(this.skipInstalledSuccess&&this.eventingService.$emit(this.constants.events.app.closeGallery),this.$scope.closeThisDialog(e),this.autoNavigationOnDone)switch(t){case"teamScope":this.teamId&&this.navigationService.navigateToTeam(this.teamId,this.navCtx);break;case"personalScope":if(e.botMri){var i=this.conversationsService.getChatConversationWith(e.botMri);this.conversationsService.ensureConversationCreated(i.id).then(function(e){n.navigateToUserApp()}).catch(function(t){n.navigationService.navigateToChat(i.id,n.navCtx),n.logError("Failed to create real conversation for bot "+e.botMri,t)})}else this.navigateToUserApp();break;case"groupchatScope":this.chatId&&this.navigationService.navigateToChat(this.chatId,this.navCtx)}this.wait=!1},e.prototype.evaluateApproveButtonEnabled=function(){this.dialogAction===teamspace.components.AddAppDialogAction.View||this.appsService.isSideloadedApp(this.app.appDefinition)||(this.alreadyAddedToTeam=this.alreadyAddedToTeam||this.isTeamAppInstallDisabled)},e.prototype.retrieveTeamId=function(){if(!this.teamId){var e=this.channelService.getCurrentTeamAndChannel();if(!e||!e.team)throw new Error("No current team found!");this.teamId=e.team.objectId}},e.prototype.navigateToUserApp=function(){var e=new teamspace.services.userApp.UserApp({appDefinition:this.app.appDefinition},!1);this.navigationService.navigateToUserApp(this.$scope,e)},e.prototype.checkAppDefinition=function(){if(!(this.app&&this.app.appDefinition&&this.app.appDefinition.name))throw new Error("Invalid App Definition Object!")},e.prototype.populateDialogContent=function(){var e=this;if(this.showTeamSelector&&this.areAllTypesPersonalOnly()&&(this.dialogIntent=teamspace.components.AddAppDialogIntent.User),this.appHasTeamScope=this.checkIfAppHasTeamScope(),this.appHasPersonalScope=this.checkIfAppHasPersonalScope(),this.appHasGroupChatScope=this.checkIfAppHasGroupChatScope(),this.appHasOnlyPersonalScope=this.checkIfAppHasOnlyPersonalScope(),this.appHasOnlyTeamOrChatScope=this.checkIfAppHasOnlyTeamOrChatScope(),this.alreadyAddedToTeam=!this.appHasTeamScope&&void 0,this.alreadyAddedToGroupChat=!this.appHasGroupChatScope&&void 0,this.appHasPersonalScope&&(this.togglePersonalInstall=!0,this.updateInstallButtonState()),this.setSectionsToCollapse(),this.enableInstallChatAppsFromStore?(this.populateChatAndTeamSelector(),this.populateAppCapabilities()):this.populateTeamSelector(),this.populatePermissionsInApp(),this.UpdateInstallOptionLabelForTeamOrChat(),this.screenshotUrls=this.app.appDefinition.screenshotUrls,this.app.appDefinition.videoUrl&&this.getVideoUrl(this.app.appDefinition.videoUrl),this.mediaSize=(this.screenshotUrls?this.screenshotUrls.length:0)+(this.videoUrl?1:0),this.isRightArrowVisible=this.mediaSize>1,this.enableAppUpgradeNotification&&this.upgradeFlow){(this.dialogIntent==teamspace.components.AddAppDialogIntent.Team?this.appsService.getTeamAppDefinition(this.teamId,this.channelId,this.appID,"add-app-dialog-v2"):this.dialogIntent===teamspace.components.AddAppDialogIntent.GroupChat?this.appsService.getGroupChatAppDefinition(this.chatId,this.appID,"add-app-dialog-v2"):this.appsService.getUserAppDefinition(this.appID,"add-app-dialog-v2")).then(function(t){e.populateRequestedPermissions(t),e.app.appDefinition=t,e.wait=!1,e.evaluateApproveButtonEnabled(),e.hideContent=!1}).catch(function(t){e.onError(t)})}else this.wait=!1,this.evaluateApproveButtonEnabled(),this.hideContent=!1;this.viewScenario&&(this.viewScenario.stop(this.getScenarioEventData()),this.viewScenario=void 0)},e.prototype.populateTeamSelector=function(){var e=this;this.showTeamSelector?this.areAllTypesPersonalOnly()||(this.channelService.getTeams().then(function(t){var n=e.teams.length;t.sort(e.compare.bind(e)),t.forEach(function(t){if(!e.settingsService.valueAsBoolean(e.constants.settings.names.enableTeamArchive)||!t.isArchived){var i=e.conversationsService.getConversation(t.objectId),a=i?i.threadProperties[SkypeX.Services.ChatServiceUtils.ThreadProp_Picture]:null;a=a?a+e.constants.amsImageTemplate.thumbnail:null;var s=e.teamMembershipPropertiesService.isAdmin(t.objectId),o=e.teamSettingsService.canAddApp(t.objectId),r=void 0===s||void 0===o||(s||o),l={type:teamspace.components.SelectorItemType.Team,index:n,teamId:t.objectId,text:t.displayName,channels:[],installAppEnabled:r,teamPicture:a,groupId:t.siteInfo.groupId,thumbnailUri:t.thumbnailUri,pictureETag:t.pictureETag,smtpAddress:t.smtpAddress};e.preselectTeam===t.objectId&&(e.selectedTeamIndex=n),e.teams.push(l),n++}}),e.teamSelected()}),setTimeout(function(){teamspace.common.SafeJQuery.on(e.$scope,$("#ts-add-app-dialog-dropdown"),e.constants.events.dropdownSelect.show,function(t){e.emptySpaceVisible=!0}),teamspace.common.SafeJQuery.on(e.$scope,$("#ts-add-app-dialog-dropdown"),e.constants.events.dropdownSelect.hide,function(t){e.emptySpaceVisible=!1})})):(this.evaluateAppAlreadyInstalledInTeam().then(function(){e.isTeamAppInstallDisabled||e.evaluateApproveButtonEnabled()}),this.dialogIntent!=teamspace.components.AddAppDialogIntent.Team||this.preselectTeam||(this.toggleTeamInstall=!0),this.updateInstallButtonState())},e.prototype.populateChatAndTeamSelector=function(){var e=this;this.chatId&&this.appHasGroupChatScope?this.evaluateAppAlreadyInstalledInChat().then(function(){e.evaluateApproveButtonEnabled()}):this.teamId&&this.appHasTeamScope?this.evaluateAppAlreadyInstalledInTeam().then(function(){e.isTeamAppInstallDisabled||e.evaluateApproveButtonEnabled()}):this.appHasPersonalScope&&!this.alreadyAddedToPersonalScope?this.toggleTeamInstall=!1:this.toggleTeamInstall=!0,this.dialogIntent!=teamspace.components.AddAppDialogIntent.Team||this.preselectTeam||(this.toggleTeamInstall=!0),this.dialogIntent!=teamspace.components.AddAppDialogIntent.GroupChat||this.preselectChat||(this.toggleChatInstall=!0),this.updateInstallButtonState()},e.prototype.setSectionsToCollapse=function(){this.isPrivateAndPermissionsCollapsed=!0,this.alreadyAddedToPersonalScope&&(this.isPersonalCapabilityCollapsed=!0),this.viewOnlyDialog&&(this.isTeamCapabilityCollapsed=!0)},e.prototype.populatePermissionsInApp=function(){this.permissions.length=0,this.$window.desktopSettings&&this.$window.desktopSettings.devicePermissionsEnabledV2&&this.app.appDefinition.devicePermissions&&this.populateDevicePermissions(),this.populatePermissionStrings("extension_addAppDialogBasicPermission1",teamspace.components.PermissionMapPersonalScope),this.populatePermissionStrings("extension_addAppDialogBasicPermission2",teamspace.components.PermissionMapPersonalScope),this.populatePermissionStrings("extension_addAppDialogIdentityPermission1",teamspace.components.PermissionMapPersonalScope),1==this.installedAppCapabilities.length&&this.installedAppCapabilities.includes("bots")&&this.dialogIntent==teamspace.components.AddAppDialogIntent.User||(this.enableInstallChatAppsFromStore?this.appHasTeamScope&&this.appHasGroupChatScope?(this.populatePermissionStrings("extension_addAppDialogTeamAndChatPermission1",teamspace.components.PermissionMapTeamAndChatScope),this.populatePermissionStrings("extension_addAppDialogTeamAndChatPermission2",teamspace.components.PermissionMapTeamAndChatScope),this.populatePermissionStrings("extension_addAppDialogIdentityTeamAndChatPermission",teamspace.components.PermissionMapTeamAndChatScope)):this.appHasTeamScope?(this.populatePermissionStrings(r,teamspace.components.PermissionMapTeamScope),this.populatePermissionStrings(l,teamspace.components.PermissionMapTeamScope),this.populatePermissionStrings(p,teamspace.components.PermissionMapTeamScope)):this.appHasGroupChatScope&&(this.populatePermissionStrings("extension_addAppDialogChatPermission1",teamspace.components.PermissionMapChatScope),this.populatePermissionStrings("extension_addAppDialogChatPermission2",teamspace.components.PermissionMapChatScope),this.populatePermissionStrings("extension_addAppDialogIdentityChatPermission",teamspace.components.PermissionMapChatScope)):(this.populatePermissionStrings(r,teamspace.components.PermissionMapTeamScope),this.populatePermissionStrings(l,teamspace.components.PermissionMapTeamScope),this.populatePermissionStrings(p,teamspace.components.PermissionMapTeamScope))),this.handleSpecialFlowPermission()},e.prototype.populateRequestedPermissions=function(e){if(this.enableAppUpgradeNotification&&angular.isDefined(e)){var t=this.findAppCapabilities(e);this.requestedPermissions=[],this.populateRequestedPermissionStrings("extension_addAppDialogBasicPermission1",teamspace.components.PermissionMapPersonalScope,t),this.populateRequestedPermissionStrings("extension_addAppDialogBasicPermission2",teamspace.components.PermissionMapPersonalScope,t),this.populateRequestedPermissionStrings("extension_addAppDialogIdentityPermission1",teamspace.components.PermissionMapPersonalScope,t),1==this.installedAppCapabilities.length&&this.installedAppCapabilities.includes("bots")&&this.dialogIntent==teamspace.components.AddAppDialogIntent.User||(this.enableInstallChatAppsFromStore?this.appHasTeamScope&&this.appHasGroupChatScope?(this.populateRequestedPermissionStrings("extension_addAppDialogTeamAndChatPermission1",teamspace.components.PermissionMapTeamAndChatScope,t),this.populateRequestedPermissionStrings("extension_addAppDialogTeamAndChatPermission2",teamspace.components.PermissionMapTeamAndChatScope,t),this.populateRequestedPermissionStrings("extension_addAppDialogIdentityTeamAndChatPermission",teamspace.components.PermissionMapTeamAndChatScope,t)):this.appHasTeamScope?(this.populateRequestedPermissionStrings(r,teamspace.components.PermissionMapTeamScope,t),this.populateRequestedPermissionStrings(l,teamspace.components.PermissionMapTeamScope,t),this.populateRequestedPermissionStrings(p,teamspace.components.PermissionMapTeamScope,t)):this.appHasGroupChatScope&&(this.populateRequestedPermissionStrings("extension_addAppDialogChatPermission1",teamspace.components.PermissionMapChatScope,t),this.populateRequestedPermissionStrings("extension_addAppDialogChatPermission2",teamspace.components.PermissionMapChatScope,t),this.populateRequestedPermissionStrings("extension_addAppDialogIdentityChatPermission",teamspace.components.PermissionMapChatScope,t)):(this.populateRequestedPermissionStrings(r,teamspace.components.PermissionMapTeamScope,t),this.populateRequestedPermissionStrings(l,teamspace.components.PermissionMapTeamScope,t),this.populateRequestedPermissionStrings(p,teamspace.components.PermissionMapTeamScope,t)))}},e.prototype.findAppCapabilities=function(e){if(!angular.isDefined(e))return[];var t=[];return c.forEach(function(n){e[n]&&t.push(n)}),t},e.prototype.populateDevicePermissions=function(){var e=this;(this.installedAppCapabilities.includes("staticTabs")||this.installedAppCapabilities.includes("galleryTabs"))&&this.app.appDefinition.devicePermissions.forEach(function(t){switch(t){case e.constants.deviceTypeForAppPermission.media:e.permissions.push(e.$translate.instant(e.resources.strings.extension_addAppDialogDeviceConsent));break;case e.constants.deviceTypeForAppPermission.geolocation:e.permissions.push(e.$translate.instant(e.resources.strings.extension_addAppDialogLocationConsent));break;case e.constants.deviceTypeForAppPermission.notifications:e.permissions.push(e.$translate.instant(e.resources.strings.extension_addAppDialogNotificationsConsent));break;case e.constants.deviceTypeForAppPermission.openExternal:e.permissions.push(e.$translate.instant(e.resources.strings.extension_addAppDialogExternalLinkContent));break;case e.constants.deviceTypeForAppPermission.midi:e.permissions.push(e.$translate.instant(e.resources.strings.extension_addAppDialogMIDIContent))}})},e.prototype.onAppDefinitionRetrieved=function(e,t){var n=this;try{this.app={appDefinition:e,appEntitlement:t},this.checkAppDefinition(),this.showDialogLoadingSpinner=!1,this.hasBots=this.app.appDefinition.bots&&this.app.appDefinition.bots.length>0,this.hasPersonalStaticTab=this.hasPersonalScope(this.app.appDefinition.staticTabs),this.appIsSideloaded=this.appsService.isSideloadedApp(this.app.appDefinition),this.supportedLanguages=_(this.app.appDefinition.supportedLanguages).map(function(e){return n.getLanguageForCode(e)}).uniq().sort().filter(function(e){return!!e}).value(),this.app.appDefinition.inputExtensions&&this.app.appDefinition.inputExtensions.length>0&&(this.app.appDefinition.inputExtensions[0].scopes=[this.constants.extensibility.apps.appScopes.personal,this.constants.extensibility.apps.appScopes.team]),this.installedAppCapabilities.length=0,this.installedAppCapabilities=this.findAppCapabilities(this.app.appDefinition),this.populateDialogContent()}catch(e){this.onError(e)}},e.prototype.compare=function(e,t){return e.displayName&&t.displayName?e.displayName.toLocaleLowerCase()<t.displayName.toLocaleLowerCase()?-1:1:-1},e.prototype.populatePermissionStrings=function(e,t){for(var n=0;n<t[e].length;n++)if(this.installedAppCapabilities.includes(t[e][n])){this.permissions.push(this.$translate.instant(this.resources.strings[e]));break}},e.prototype.populateRequestedPermissionStrings=function(e,t,n){if(this.enableAppUpgradeNotification){var i=this.$translate.instant(this.resources.strings[e]);if(!this.permissions.includes(i))for(var a=0;a<t[e].length;a++)if(n.includes(t[e][a])&&!this.installedAppCapabilities.includes(t[e][a])){this.requestedPermissions.push(this.$translate.instant(this.resources.strings[e]));break}}},e.prototype.onError=function(e,t){if(this.wait=!1,this.showDialogLoadingSpinner=!1,this.toggleDisabledForInstallButton(),e&&e.data&&"NoPermissionToInstallApp"===e.data.errorCode?this.inlineMessage=this.$translate.instant(this.resources.strings.extension_addAppDialogTeamDisabled):e&&e.data&&e.data.errorCode===this.constants.extensibility.apps.errorCodes.appSideloadingForbidden?this.inlineMessage=this.$translate.instant(this.resources.strings.extension_appSideloadingForbiddenErrorMessage):this.inlineMessage=this.$translate.instant(t||this.resources.strings.extension_addAppDialogErrorMessage),this.footerButtons&&this.footerButtons.length>1&&(this.footerButtons[1].disabled=!0),this.viewScenario&&(this.viewScenario.fail(a(a({},this.getScenarioEventData()),{error:e,error1:e})),this.viewScenario=void 0),this.createScenarioTeam&&(this.createScenarioTeam.fail(a(a({},this.getScenarioEventData()),{error:e,error1:e})),this.createScenarioTeam=void 0),this.createScenarioPersonal&&(this.createScenarioPersonal.fail(a(a({},this.getScenarioEventData()),{error:e,error1:e})),this.createScenarioPersonal=void 0),this.createScenarioGroupChat&&(this.createScenarioGroupChat.fail(a(a({},this.getScenarioEventData()),{error:e,error1:e})),this.createScenarioGroupChat=void 0),this.upgradeScenario&&(this.upgradeScenario.fail(a(a({},this.getScenarioEventData()),{teamId:this.teamId,intent:this.dialogIntent,error:e,error1:e})),this.upgradeScenario=void 0),e&&e.errorMessage){var n=this.$translate.instant(this.resources.strings.extension_addAppDialogErrorMessage),i=null;e.errorCode===this.constants.extensibility.apps.errorCodes.unableToParseTeamsAppManifest&&(n=this.$translate.instant(this.resources.strings.extension_addAppDialogManifestParsingErrorMessage),i=e.errorMessage),this.dialogService.openLazyDialog(this.constants.lazyDialogs.manifestError,this.constants.lazyModules.extensibilityDialogs,{errorMessage:n,errorDetails:i}),this.$scope.closeThisDialog()}this.logError("Something went wrong in add app dialog",e)},e.prototype.shouldShowTruncate=function(){var e=document.getElementsByClassName("ts-add-app-dialog-header-text-long-description")[0];return e.scrollHeight>e.clientHeight},e.prototype.logError=function(e,t){this.logger||(this.logger=this.loggingService.newLogger("AddAppDialog")),this.logger.error("{0}: {1}",e,t)},e.prototype.areAllTypesPersonalOnly=function(){var e=this,t=!0;return c.forEach(function(n){e.app.appDefinition[n]&&(t=t&&e.isPersonalScopeOnly(e.app.appDefinition[n]))}),t},e.prototype.isPersonalScopeOnly=function(e){return!!(e&&e.length>0)&&_.every(e,function(e){return!!(e.scopes&&e.scopes.length>0)&&_.every(e.scopes,function(e){return"Personal"===e})})},e.prototype.hasPersonalScope=function(e){return!!(e&&e.length>0)&&_.some(e,function(e){return!!(e.scopes&&e.scopes.length>0)&&_.some(e.scopes,function(e){return"Personal"===e})})},e.prototype.hasTeamScope=function(e){return!!(e&&e.length>0)&&_.every(e,function(e){return!!(e.scopes&&e.scopes.length>0)&&_.some(e.scopes,function(e){return"Team"===e})})},e.prototype.checkIfAppHasPersonalScope=function(){var e=this,t=!1;return c.forEach(function(n){e.app.appDefinition[n]&&(t=t||e.hasPersonalScope(e.app.appDefinition[n]))}),t},e.prototype.checkIfAppHasTeamScope=function(){var e=this,t=!1;return c.some(function(n){if(e.app.appDefinition[n]&&1==e.hasTeamScope(e.app.appDefinition[n]))return t=!0}),t},e.prototype.checkIfAppHasGroupChatScope=function(){var e=this;return c.some(function(t){return e.app&&e.app.appDefinition[t]&&e.hasGroupChatScope(e.app.appDefinition[t])})},e.prototype.checkIfAppHasOnlyPersonalScope=function(){return this.appHasPersonalScope&&!this.appHasTeamScope&&!this.appHasGroupChatScope},e.prototype.checkIfAppHasOnlyTeamOrChatScope=function(){return!this.appHasPersonalScope&&(this.appHasTeamScope||this.appHasGroupChatScope)},e.prototype.hasGroupChatScope=function(e){return!!(e&&e.length>0)&&_.every(e,function(e){return!!(e.scopes&&e.scopes.length>0)&&_.some(e.scopes,function(e){return"GroupChat"===e})})},e.prototype.onItemSelected=function(e){e?e.type===teamspace.components.SelectorItemType.Team?this.processSelectedTeam(e):e.type===teamspace.components.SelectorItemType.Chat&&this.processSelectedChat(e):this.resetSelectedTeamOrChat()},e.prototype.logInstallAppActionForTelemetry=function(e,t){var n=this;_.defer(function(){var i={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.submit.toString(),teamspace.components.PanelActionOutcome,n.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.addAppDialog.toString(),teamspace.components.PanelActionScenario,n.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,n.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.addAppButton.toString(),teamspace.components.PanelModuleName,n.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.button.toString(),teamspace.components.PanelModuleType,n.loggingService),summary:"Consent to add an app"},app:a(a({},n.getAppInformationForTelemetry(t)),{scope:_.sumBy(e),scenarioCapability:teamspace.components.PanelAppScenarioCapability.na}),team:{id:n.toggleTeamInstall?n.teamId:null}};t&&t.appDefinition&&!_.isEmpty(t.appDefinition.bots)&&(i.bot={id:t.appDefinition.bots[0].id}),n.sendPanelAction(i)})},e.prototype.logViewAppActionForTelemetry=function(e,t,n){var i=this;_.defer(function(){var s={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(void 0!==n?teamspace.components.PanelActionOutcome.show.toString():teamspace.components.PanelActionOutcome.closeDialog.toString(),teamspace.components.PanelActionOutcome,i.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.addAppDialog.toString(),teamspace.components.PanelActionScenario,i.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,i.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(void 0!==n?teamspace.components.PanelModuleName.openAddAppDialogImage.toString():t===teamspace.components.AddAppDialogAction.View?teamspace.components.PanelModuleName.okButton.toString():teamspace.components.PanelModuleName.closeAddAppDialog.toString(),teamspace.components.PanelModuleName,i.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.button.toString(),teamspace.components.PanelModuleType,i.loggingService),summary:void 0!==n?"Click the image in the consent dialog":"Ok and close the consent dialog"},app:a(a({},i.getAppInformationForTelemetry(e,n)),{scope:teamspace.components.PanelAppScope.team,scenarioCapability:teamspace.components.PanelAppScenarioCapability.na})};i.sendPanelAction(s)})},e.prototype.getAppInformationForTelemetry=function(e,t){var n=e?teamspace.components.AppAnalyticsHelper.getAppAnalyticsData(e,this.toggleTeamInstall&&this.teamId,this.channelId):{};return this.$scope.ngDialogData.source&&(n.source=this.$scope.ngDialogData.source),this.$scope.ngDialogData.deepLinkSource&&(n.deepLinkSource=this.$scope.ngDialogData.deepLinkSource),n.hasScreenshots=this.mediaSize>0,void 0!==t&&(n.imageIndex=t),n},e.prototype.sendPanelAction=function(e){var t=this;this.analyticsService.getAnalyticsPanelActionEventData(e).then(function(e){t.analyticsService.sendPanelAction(e)})},e.prototype.getScenarioEventData=function(){return this.app&&this.app.appDefinition?{appId:this.app.appDefinition.id,externalId:this.app.appDefinition.externalId,tenantId:this.app.appDefinition.tenantId}:null},e.prototype.processSelectedTeam=function(e){this.isChatSelected=!1,this.chatId=null,this.teamId=e.teamId,this.teamName=e.text,this.isTeamAppInstallDisabled=!e.installAppEnabled,this.updateButtonStateBasedOnSelectedTeam()},e.prototype.processSelectedChat=function(e){this.isChatSelected=!0,this.teamId=null,this.chatId=e.id,this.updateButtonStateBasedOnSelectedChat()},e.prototype.resetSelectedTeamOrChat=function(){this.isChatSelected=!!this.preselectChat,this.chatId=null,this.teamId=null,this.alreadyAddedToGroupChat=!1,this.alreadyAddedToTeam=!1,this.isTeamAppInstallDisabled=!1,this.updateInstallButtonState(),this.populateAppCapabilities()},e.prototype.updateButtonStateBasedOnSelectedTeam=function(){var e=this;void 0!=this.teamId?this.evaluateAppAlreadyInstalledInTeam().then(function(){e.isTeamAppInstallDisabled||e.evaluateApproveButtonEnabled(),e.isTeamCapabilityCollapsed=!!e.teamToggleSwitchDisabled,e.isTeamAppInstallDisabled?e.toggleTeamInstall=!1:e.toggleTeamInstall=!0,e.updateInstallButtonState(),e.settingsService.valueAsBoolean(e.constants.settings.names.initializeAggEntitlementsPostALT)&&e.$scope.$apply()}):(this.evaluateApproveButtonEnabled(),this.toggleTeamInstall=!0,this.updateInstallButtonState()),this.populatePermissionsInApp(),this.populateAppCapabilities()},e.prototype.updateButtonStateBasedOnSelectedChat=function(){var e=this;void 0!=this.chatId?this.evaluateAppAlreadyInstalledInChat().then(function(){e.toggleChatInstall=!0,e.updateInstallButtonState(),e.settingsService.valueAsBoolean(e.constants.settings.names.initializeAggEntitlementsPostALT)&&e.$scope.$apply()}):(this.toggleChatInstall=!0,this.updateInstallButtonState()),this.populatePermissionsInApp(),this.populateAppCapabilities()},e.prototype.evaluateAppAlreadyInstalledInTeam=function(){var e=this;return this.appsService.isSideloadedApp(this.app.appDefinition)?(this.dialogAction==teamspace.components.AddAppDialogAction.View&&(this.alreadyAddedToTeam=!0,this.teamInstalledAppDefinition=this.app),this.$q.resolve()):this.appsService.getInstalledAppForTeam(this.teamId,this.channelId,this.app.appDefinition.id,"add-app-dialog-v2::evaluateAppAlreadyInstalledInTeam").then(function(t){e.alreadyAddedToTeam=!(!t||!t.isAppInstalled()),e.teamInstalledAppDefinition=e.alreadyAddedToTeam?t:null})},e.prototype.evaluateAppAlreadyInstalledInChat=function(){var e=this;return this.appsService.isSideloadedApp(this.app.appDefinition)?(this.dialogAction==teamspace.components.AddAppDialogAction.View&&(this.alreadyAddedToGroupChat=!0,this.groupChatInstalledAppDefinition=this.app),this.$q.resolve()):this.appsService.getInstalledAppForGroupChat(this.chatId,this.app.appDefinition.id).then(function(t){e.alreadyAddedToGroupChat=!(!t||!teamspace.services.AppsServiceUtils.isAppInstalled(t)),e.groupChatInstalledAppDefinition=e.alreadyAddedToGroupChat?t:null})},e.prototype.populateAppCapabilities=function(){if(this.app.appDefinition){if(this.appCapabilities=[],this.app.appDefinition.bots&&this.app.appDefinition.bots.length>0&&(this.hasTeamScope(this.app.appDefinition.bots)||this.hasGroupChatScope(this.app.appDefinition.bots))){var e=this.createAppCapability("svg/icons-bot.html",this.$translate.instant(this.resources.strings.extension_addAppDialog_bot_capability));this.appCapabilities.push(e)}if((this.app.appDefinition.staticTabs&&this.app.appDefinition.staticTabs.length>0&&this.hasTeamScope(this.app.appDefinition.staticTabs)||this.app.appDefinition.galleryTabs&&this.app.appDefinition.galleryTabs.length>0&&this.hasTeamScope(this.app.appDefinition.galleryTabs))&&(!this.isChatSelected||!this.appHasGroupChatScope)){var t=this.createAppCapability("svg/icons-tab-badge.html",this.$translate.instant(this.resources.strings.extension_addAppDialog_tab_capability));this.appCapabilities.push(t)}if(this.app.appDefinition.galleryTabs&&this.app.appDefinition.galleryTabs.length>0&&this.hasGroupChatScope(this.app.appDefinition.galleryTabs)&&this.isChatSelected){var n=this.createAppCapability("svg/icons-tab-badge.html",this.$translate.instant(this.resources.strings.extension_addAppDialog_tab_capability_for_chat));this.appCapabilities.push(n)}if(this.app.appDefinition.connectors&&this.app.appDefinition.connectors.length>0&&this.hasTeamScope(this.app.appDefinition.connectors)&&(!this.isChatSelected||!this.appHasGroupChatScope)){var i=this.createAppCapability("svg/icons-connector-badge.html",this.$translate.instant(this.resources.strings.extension_addAppDialog_connector_capability));this.appCapabilities.push(i)}if(this.app.appDefinition.inputExtensions&&this.app.appDefinition.inputExtensions.length>0&&this.hasTeamScope(this.app.appDefinition.inputExtensions)&&(!this.isChatSelected||!this.appHasGroupChatScope)){var a=this.createAppCapability("svg/icons-compose-extension-badge.html",this.$translate.instant(this.resources.strings.extension_addAppDialog_compose_extension_capability));this.appCapabilities.push(a)}}},e.prototype.createAppCapability=function(e,t){return{icon:e,description:t}},e.prototype.UpdateInstallOptionLabelForTeamOrChat=function(){this.appHasTeamScope&&this.appHasGroupChatScope&&this.dialogIntent!=teamspace.components.AddAppDialogIntent.Team&&this.dialogIntent!=teamspace.components.AddAppDialogIntent.GroupChat?this.installOptionLabelForTeamOrChat=this.$translate.instant(this.resources.strings.extension_addAppDialog_add_to_a_team_or_chat):this.appHasGroupChatScope&&this.dialogIntent!=teamspace.components.AddAppDialogIntent.Team?this.installOptionLabelForTeamOrChat=this.$translate.instant(this.resources.strings.extension_addAppDialog_add_to_a_chat):this.installOptionLabelForTeamOrChat=this.$translate.instant(this.resources.strings.extension_addAppDialog_add_to_a_team)},e.prototype.handleSpecialFlowPermission=function(){this.userInstalledAppDefinition&&this.userInstalledAppDefinition.appDefinition&&this.userInstalledAppDefinition.appDefinition.id&&this.userInstalledAppDefinition.appDefinition.id.toLowerCase()===this.constants.extensibility.apps.appIds.flow&&this.permissions.push(this.$translate.instant(this.resources.strings.extension_addAppDialogPermissionMessageSendOrganization))},e}();t.AddAppNewDialogController=d,angular.module("teamspace.addAppDialogV2",["skypeX.sxConfig","skypeX.tenantSettingsStore","teamspace.appsService","teamspace.analyticsService","teamspace.channelService","teamspace.conversationsService","teamspace.dialogService","teamspace.services.dispatcher","teamspace.eventingService","teamspace.filesAsyncMediaService","teamspace.inputExtensionService","teamspace.loggingService","teamspace.navigationService","teamspace.settingsService","teamspace.teamMembershipPropertiesService","teamspace.teamSettingsService","teamspace.utilityService"]).run(["constants","dialogService","settingsService","$templateCache",function(e,t,n,i){var a=n.valueAsBoolean(e.settings.names.enableNewAppInstallFlowV3),o=n.valueAsBoolean(e.settings.names.enableBotsInGroupChat);a&&o||(i.put("components/extensibility/add-app-new-dialog/add-app-dialog-v2.html",s),t.register(e.lazyDialogs.addAppNew,{template:"components/extensibility/add-app-new-dialog/add-app-dialog-v2.html",className:"ts-modal-dialog custom-width ts-add-app-dialog-v2 new-dialog",closeByEscape:!0,closeByDocument:!0,preCloseCallback:function(e){var n=document.getElementsByClassName("ts-media-preview");if(n&&n.length)return!1;var i=t.optionsByDialogNames&&t.optionsByDialogNames.AddAppNew&&t.optionsByDialogNames.AddAppNew.registeredCallback;return!i||i(e)},ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"modalDialog-title"}))}]).controller("AddAppNewDialogController",d)},2629:function(e,t){e.exports='<div class="ts-add-app-dialog-container" ng-controller="AddAppNewDialogController as aadc" aria-modal="true" acc-role="dialog">\n  <modal-dialog ng-attr-hide-dialog-title="{{::aadc.viewOnlyDialog || undefined}}" footer-buttons="aadc.footerButtons" right-align-buttons="true" add-close-icon="::!aadc.viewOnlyDialog" suppress-default-button="true" data-tid="addAppDialog" dialog-title="{{::aadc && aadc.app && aadc.app.appDefinition ? aadc.app.appDefinition.name : \'\'}}" track-panel-type="{{$root.trackConstants.panelType.addAppDialogV2}}" skip-auto-focus="false">\n    <section class="ts-add-app-dialog-left-rail">\n      <section ng-if="!aadc.hideContent" class="ts-add-app-section-spacing-small">\n        <div class="ts-add-app-dialog-header">\n          <div class="image-container">\n            <div class="image" ng-style="{ \'background\': aadc.app.appDefinition.accentColor }">\n              <ng-include src="aadc.app.appDefinition.largeImageUrl" ng-if="::aadc.utilityService.useNgIncludeForIcon(aadc.app.appDefinition.largeImageUrl)"></ng-include>\n              <img role="img" alt="{{::($root.resources.strings.extensibility_app_icon_alt|translate:{appName:aadc.app.appDefinition.name})}}" aria-label="{{::($root.resources.strings.extensibility_app_icon_alt|translate:{appName:aadc.app.appDefinition.name})}}" ng-src="{{::aadc.app.appDefinition.largeImageUrl}}" fallback-src="{{::aadc.appFallbackIcon}}" ng-if="::!aadc.utilityService.useNgIncludeForIcon(aadc.app.appDefinition.largeImageUrl)"/>\n            </div>\n          </div>\n          <div class="ts-add-app-dialog-header-text" dir="auto">\n            <div class="ts-add-app-dialog-header-text-big">\n              <h1 ng-bind="::aadc.app.appDefinition.name"></h1>\n            </div>\n            \x3c!-- old description without see more--\x3e\n            <div ng-if="!aadc.enableAppDetailDialogV3 && !aadc.hideContent" class="ts-add-app-dialog-header-text-long-description">\n              <span ng-bind="::aadc.app.appDefinition.longDescription" title="{{::aadc.app.appDefinition.longDescription}}"></span>\n            </div>\n            \x3c!-- new description with see more--\x3e\n            <div ng-if="aadc.enableAppDetailDialogV3 && !aadc.hideContent" class="expandable ts-add-app-dialog-header-text-long-description" ng-class="{\'fullDescriptionShowed\': aadc.isFullDescriptionShowed}">\n              \x3c!-- Show full description --\x3e\n              <div class="description-scroll-wrapper" simple-scrollbar ng-if="aadc.isFullDescriptionShowed" scrollbar-ignore-firefox-adjust="true">\n                <div class="description-scroll-child">\n                  <span id="ts-add-app-dialog-app-full-description" class="truncate-description" title="{{::aadc.app.appDefinition.longDescription}}">\n                    {{::aadc.app.appDefinition.longDescription}}\n                  </span>\n                  <div class="view-less" ng-if="aadc.isFullDescriptionShowed">\n                    <a target="_blank" tabindex="0" id="add-app-dialog-view-less" acc-role="focus-default" aria-label="{{::$root.resources.strings.extension_addAppDialog_view_less_description_aria_label|translate}}" aria-describedby="ts-add-app-dialog-app-full-description" ng-click="aadc.toggleShowFullDescription(false)">\n                      {{::$root.resources.strings.extension_addAppDialog_view_less_description|translate}}\n                    </a>\n                  </div>\n                </div>\n\n              </div>\n              \x3c!-- Show truncated description --\x3e\n              <span ng-if="!aadc.isFullDescriptionShowed" id="ts-add-app-dialog-app-truncate-description" class="truncate-description" title="{{::aadc.app.appDefinition.longDescription}}">\n                {{::aadc.app.appDefinition.longDescription}}\n              </span>\n              <div class="view-more" ng-if="!aadc.isFullDescriptionShowed && aadc.shouldShowTruncate()">\n                <span aria-label="{{::$root.resources.strings.extension_addAppDialog_view_more_description_aria_label|translate}}" ng-click="aadc.toggleShowFullDescription(true)" translate-with-html-params translate-id="extension_addAppDialog_view_more_description"></span>\n                <span id="view-more-aria-label">{{::$root.resources.strings.extension_addAppDialog_view_more_description_aria_label|translate}}</span>\n              </div>\n            </div>\n\n          </div>\n        </div>\n      </section>\n      <div class="ts-add-app-dialog-container scroll-parent">\n        <div class="scroll-wrapper" simple-scrollbar scrollbar-ignore-firefox-adjust="true">\n          <div class="scroll-child">\n            <div class="personal-scope" ng-if="aadc.shouldShowPersonalInstallOption && aadc.appHasPersonalScope && !aadc.viewOnlyDialog">\n              <div class="ts-add-app-dialog-install-personal">\n                <div class="ts-add-app-dialog-install-left">\n                  <div class="expand-collapse inset-border inset-border-themed" role="button" name="{{::$root.resources.strings.extension_addAppDialog_add_for_you|translate}}" aria-expanded="{{!aadc.isPersonalCapabilityCollapsed}}" aria-labelledby="{{::$root.resources.strings.extension_addAppDialog_add_for_you|translate}}" tabindex="0" ng-click="aadc.expandCollapsePersonalCapabilities()">\n                    <div class="expand-collapse-icon icons-gray-06-triangle-fill">\n                      <ng-include ng-if="aadc.isPersonalCapabilityCollapsed" src="\'svg/icons-triangle-right-small.html\'"></ng-include>\n                      <ng-include ng-if="!aadc.isPersonalCapabilityCollapsed" src="\'svg/icons-triangle-down-small.html\'"></ng-include>\n                    </div>\n                    <span id="ts-add-app-dialog-expand-collapse-personal" translate-once="{{::$root.resources.strings.extension_addAppDialog_add_for_you}}"></span>\n                  </div>\n                </div>\n                <div class="ts-add-app-new-dialog-install-personal-button">\n                  <toggle-switch aria-label="{{::$root.resources.strings.extension_addAppDialog_add_for_you|translate}}" ng-if="!aadc.appHasOnlyPersonalScope && !aadc.alreadyAddedToPersonalScope" is-checked="aadc.togglePersonalInstall" on-toggle="aadc.personalToggleChange(isChecked)" is-disabled="aadc.personalToggleSwitchDisabled">\n                    <div class="toggle-text" ng-if="aadc.togglePersonalInstall&&!aadc.personalToggleSwitchDisabled" translate-once="{{::$root.resources.strings.extension_addAppDialog_button_yes}}"></div>\n                    <div class="toggle-text" ng-if="!aadc.togglePersonalInstall&&!aadc.personalToggleSwitchDisabled" translate-once="{{::$root.resources.strings.extension_addAppDialog_button_no}}"></div>\n                  </toggle-switch>\n                  <a class="setup-text" ng-if="!aadc.enableAppDetailDialogV3 && aadc.alreadyAddedToPersonalScope" ng-click="aadc.goToPostInstallDialog(\'personalScope\')" ng-attr-title="{{::$root.resources.strings.extension_addAppDialog_button_set_up_tooltip|translate}}" href="javascript:void(0)">\n                    <span class="text" data-tid="setUp-App-Personal" translate-once="{{::$root.resources.strings.extension_addAppDialog_button_set_up}}"></span>\n                  </a>\n                  <button class="setup-text ts-btn ts-btn-secondary insert-border" data-tid="setUp-App-Personal" ng-if="aadc.enableAppDetailDialogV3 && aadc.alreadyAddedToPersonalScope" aria-label="{{::$root.resources.strings.extension_addAppDialog_button_open_tooltip|translate}}" ng-click="aadc.goToPostInstallDialog(\'personalScope\')">\n                     {{::$root.resources.strings.extension_addAppDialog_button_open|translate}}\n                  </button>\n                </div>\n              </div>\n              <div ng-if="!aadc.isPersonalCapabilityCollapsed" class="personal-capabilities">\n                <div ng-if="aadc.app.appDefinition.bots && aadc.app.appDefinition.bots.length > 0 && aadc.hasPersonalScope(aadc.app.appDefinition.bots)" class="ts-add-app-section-spacing-medium">\n                  <div class="badge-icon">\n                    <ng-include class="icon" src="\'svg/icons-bot.html\'"></ng-include>\n                  </div>\n                  <div class="app-info">\n                    <div class="ts-add-app-dialog-capability-decsription" translate-once="{{::$root.resources.strings.extension_addAppDialog_personal_bot_use}}"></div>\n                  </div>\n                </div>\n                <div ng-if="aadc.app.appDefinition.staticTabs && aadc.app.appDefinition.staticTabs.length > 0  && aadc.hasPersonalScope(aadc.app.appDefinition.staticTabs)" class="ts-add-app-section-spacing-medium">\n                  <div class="badge-icon">\n                    <ng-include class="icon" src="\'svg/icons-tab-badge.html\'"></ng-include>\n                  </div>\n                  <div class="app-info">\n                    <div class="ts-add-app-dialog-capability-decsription" translate-once="{{::$root.resources.strings.extension_addAppDialog_personal_tab_use}}"></div>\n                  </div>\n                </div>\n                <div ng-if="aadc.app.appDefinition.inputExtensions && aadc.app.appDefinition.inputExtensions.length > 0 && aadc.hasPersonalScope(aadc.app.appDefinition.inputExtensions)" class="ts-add-app-section-spacing-medium">\n                  <div class="badge-icon">\n                    <ng-include class="icon" src="\'svg/icons-compose-extension-badge.html\'"></ng-include>\n                  </div>\n                  <div class="app-info">\n                    <div class="ts-add-app-dialog-capability-decsription" translate-once="{{::$root.resources.strings.extension_addAppDialog_personal_compose_extension_use}}"></div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div ng-if="::!aadc.enableInstallChatAppsFromStore">\n              <div class="team-scope" ng-if="aadc.shouldShowTeamInstallOption && aadc.appHasTeamScope">\n                <div ng-if="aadc.isTeamAppInstallDisabled" class="permission-error" translate-once="{{::$root.resources.strings.extension_addAppDialogTeamDisabled_message}}"></div>\n                <div class="ts-add-app-dialog-install-team">\n                  <div class="ts-add-app-dialog-install-left" aria-label="{{::$root.resources.strings.extension_addAppDialog_add_to_a_team|translate}}">\n                    <div class="expand-collapse inset-border inset-border-themed" role="button" aria-expanded="{{!aadc.isTeamCapabilityCollapsed}}" name="{{::$root.resources.strings.extension_addAppDialog_add_to_a_team|translate}}" aria-labelledby="{{::$root.resources.strings.extension_addAppDialog_add_to_a_team|translate}}" tabindex="0" ng-click="aadc.expandCollapseTeamCapabilities()">\n                      <div class="expand-collapse-icon icons-gray-06-triangle-fill">\n                        <ng-include ng-if="aadc.isTeamCapabilityCollapsed" src="\'svg/icons-triangle-right-small.html\'"></ng-include>\n                        <ng-include ng-if="!aadc.isTeamCapabilityCollapsed" src="\'svg/icons-triangle-down-small.html\'"></ng-include>\n                      </div>\n                      <span id="ts-add-app-dialog-expand-collapse-team" translate-once="{{::$root.resources.strings.extension_addAppDialog_add_to_a_team}}"> </span>\n                    </div>\n                    <div id="ts-add-app-dialog-dropdown">\n                      <dropdown-select ng-if="aadc.showTeamSelector" class="dropdown-select" data-tid="choose-teams" ds-placeholder="{{::$root.resources.strings.extension_addAppDialog_select_a_team|translate}}" ds-options="::aadc.teams" ds-text-field="text" ds-value-field="index" ds-selected-value="aadc.selectedTeamIndex" ds-highlight-selected-option="true" ds-always-show-in-bottom="true" ds-on-change="aadc.teamSelected()" ds-max-viewable-items="6">\n                      </dropdown-select>\n                    </div>\n                  </div>\n                  <div class="ts-add-app-dialog-install-team-button" ng-if="!aadc.upgradeFlow">\n                    <toggle-switch data-tid="toggle-Team" aria-label="{{::$root.resources.strings.extension_addAppDialog_add_to_a_team|translate}}" ng-if="!aadc.appHasOnlyTeamOrChatScope && !aadc.alreadyAddedToTeam" is-checked="aadc.toggleTeamInstall" on-toggle="aadc.teamToggleChange(isChecked)" is-disabled="aadc.teamToggleSwitchDisabled || aadc.isTeamAppInstallDisabled">\n                      <div class="toggle-text" ng-if="aadc.toggleTeamInstall || aadc.teamToggleSwitchDisabled || aadc.isTeamAppInstallDisabled" translate-once="{{::$root.resources.strings.extension_addAppDialog_button_yes}}"></div>\n                      <div class="toggle-text" ng-if="!aadc.toggleTeamInstall&&!aadc.teamToggleSwitchDisabled && !aadc.isTeamAppInstallDisabled" translate-once="{{::$root.resources.strings.extension_addAppDialog_button_no}}"></div>\n                    </toggle-switch>\n                    <a class="setup-text" ng-if="!aadc.enableAppDetailDialogV3 && aadc.alreadyAddedToTeam && !aadc.isTeamArchived" ng-click="aadc.goToPostInstallDialog(\'teamScope\')" ng-attr-title="{{::$root.resources.strings.extension_addAppDialog_button_set_up_tooltip|translate}}" href="javascript:void(0)">\n                      <span class="text" data-tid="setUp-App-Team" translate-once="{{::$root.resources.strings.extension_addAppDialog_button_set_up}}"></span>\n                    </a>\n                    <button class="setup-text ts-btn ts-btn-secondary insert-border" data-tid="setUp-App-Team" ng-if="aadc.enableAppDetailDialogV3 && aadc.alreadyAddedToTeam && !aadc.isTeamArchived" aria-label="{{::$root.resources.strings.extension_addAppDialog_button_open_tooltip|translate}}" ng-click="aadc.goToPostInstallDialog(\'teamScope\')">\n                      {{::$root.resources.strings.extension_addAppDialog_button_open|translate}}\n                    </button>\n                  </div>\n                </div>\n                <div class="ts-add-app-dialog-install-team-capabilities" ng-if="!aadc.isTeamCapabilityCollapsed">\n                  <div ng-if="aadc.app.appDefinition.bots && aadc.app.appDefinition.bots.length > 0 && aadc.hasTeamScope(aadc.app.appDefinition.bots)" class="ts-add-app-section-spacing-medium">\n                    <div class="badge-icon">\n                      <ng-include class="icon" src="\'svg/icons-bot.html\'"></ng-include>\n                    </div>\n                    <div class="app-info">\n                      <div class="ts-add-app-dialog-capability-decsription" translate-once="{{::$root.resources.strings.extension_addAppDialog_bot_capability}}"></div>\n                    </div>\n                  </div>\n                  <div ng-if="(aadc.app.appDefinition.staticTabs && aadc.app.appDefinition.staticTabs.length > 0 && aadc.hasTeamScope(aadc.app.appDefinition.staticTabs)) || (aadc.app.appDefinition.galleryTabs && aadc.app.appDefinition.galleryTabs.length > 0 && aadc.hasTeamScope(aadc.app.appDefinition.galleryTabs))" class="ts-add-app-section-spacing-medium">\n                    <div class="badge-icon">\n                      <ng-include class="icon" src="\'svg/icons-tab-badge.html\'"></ng-include>\n                    </div>\n                    <div class="app-info">\n                      <div class="ts-add-app-dialog-capability-decsription" translate-once="{{::$root.resources.strings.extension_addAppDialog_tab_capability}}"></div>\n                    </div>\n                  </div>\n                  <div ng-if="aadc.app.appDefinition.connectors && aadc.app.appDefinition.connectors.length > 0 && aadc.hasTeamScope(aadc.app.appDefinition.connectors)" class="ts-add-app-section-spacing-medium">\n                    <div class="badge-icon">\n                      <ng-include class="icon" src="\'svg/icons-connector-badge.html\'"></ng-include>\n                    </div>\n                    <div class="app-info">\n                      <div class="ts-add-app-dialog-capability-decsription" translate-once="{{::$root.resources.strings.extension_addAppDialog_connector_capability}}"></div>\n                    </div>\n                  </div>\n                  <div ng-if="aadc.app.appDefinition.inputExtensions && aadc.app.appDefinition.inputExtensions.length > 0 && aadc.hasTeamScope(aadc.app.appDefinition.inputExtensions)" class="ts-add-app-section-spacing-medium">\n                    <div class="badge-icon">\n                      <ng-include class="icon" src="\'svg/icons-compose-extension-badge.html\'"></ng-include>\n                    </div>\n                    <div class="app-info">\n                      <div class="ts-add-app-dialog-capability-decsription" translate-once="{{::$root.resources.strings.extension_addAppDialog_compose_extension_capability}}"></div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              <div class="chat-scope" ng-if="aadc.enableSideloadedAppsInGroupChat && aadc.shouldShowGroupChatInstallOption && aadc.checkIfAppHasGroupChatScope()">\n                <div class="ts-add-app-dialog-install-team">\n                  <div class="ts-add-app-dialog-install-left" aria-label="{{::$root.resources.strings.extension_addAppDialog_add_to_a_chat|translate}}">\n                    <div class="expand-collapse inset-border inset-border-themed" role="button" name="{{::$root.resources.strings.extension_addAppDialog_add_to_a_chat|translate}}" aria-expanded="{{!aadc.isGroupChatCapabilityCollapsed}}" aria-labelledby="{{::$root.resources.strings.extension_addAppDialog_add_to_a_chat|translate}}" tabindex="0" ng-click="aadc.expandCollapseGroupChatCapabilities()">\n                      <div class="expand-collapse-icon icons-gray-06-triangle-fill">\n                        <ng-include ng-if="aadc.isGroupChatCapabilityCollapsed" src="\'svg/icons-triangle-right-small.html\'"></ng-include>\n                        <ng-include ng-if="!aadc.isGroupChatCapabilityCollapsed" src="\'svg/icons-triangle-down-small.html\'"></ng-include>\n                      </div>\n                      <span id="ts-add-app-dialog-expand-collapse-chat" translate-once="{{::$root.resources.strings.extension_addAppDialog_add_to_a_chat}}"> </span>\n                    </div>\n                  </div>\n                </div>\n                <div class="ts-add-app-dialog-install-chat-capabilities" ng-if="!aadc.isGroupChatCapabilityCollapsed">\n                  <div ng-if="(aadc.app.appDefinition.galleryTabs && aadc.app.appDefinition.galleryTabs.length > 0 && aadc.hasGroupChatScope(aadc.app.appDefinition.galleryTabs))" class="ts-add-app-section-spacing-medium">\n                    <div class="badge-icon">\n                      <ng-include class="icon" src="\'svg/icons-tab-badge.html\'"></ng-include>\n                    </div>\n                    <div class="app-info">\n                      <div class="ts-add-app-dialog-capability-decsription" translate-once="{{::$root.resources.strings.extension_addAppDialog_tab_capability}}"></div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            \x3c!--New install option for a team or chat--\x3e\n            <div ng-if="::aadc.enableInstallChatAppsFromStore">\n              <div class="team-or-chat-scope" ng-if="aadc.shouldShowTeamOrChatInstallOption">\n                <div ng-if="aadc.isTeamAppInstallDisabled" class="permission-error" translate-once="{{::$root.resources.strings.extension_addAppDialogTeamDisabled_message}}"></div>\n                <div class="ts-add-app-dialog-install-team-or-chat">\n                  <div class="ts-add-app-dialog-install-left" aria-label="{{::aadc.installOptionLabelForTeamOrChat}}">\n                    <div class="expand-collapse inset-border inset-border-themed" role="button" aria-expanded="{{!aadc.isTeamCapabilityCollapsed}}" name="{{::aadc.installOptionLabelForTeamOrChat}}" aria-labelledby="{{::aadc.installOptionLabelForTeamOrChat}}" tabindex="0" ng-click="aadc.expandCollapseTeamCapabilities()">\n                      <div class="expand-collapse-icon icons-gray-06-triangle-fill">\n                        <ng-include ng-if="aadc.isTeamCapabilityCollapsed" src="\'svg/icons-triangle-right-small.html\'"></ng-include>\n                        <ng-include ng-if="!aadc.isTeamCapabilityCollapsed" src="\'svg/icons-triangle-down-small.html\'"></ng-include>\n                      </div>\n                      <span id="ts-add-app-dialog-expand-collapse-team">{{::aadc.installOptionLabelForTeamOrChat}}</span>\n                    </div>\n                    <div class="team-or-chat-search">\n                      <chat-and-team-selector ng-if="aadc.showChatAndTeamSelector" data-tid="choose-chats-and-teams" app-has-team-scope="aadc.appHasTeamScope" app-has-group-chat-scope="aadc.appHasGroupChatScope" app-is-sideloaded="aadc.appIsSideloaded" on-item-selected="aadc.onItemSelected(selectedItem)" preselect-team="aadc.preselectTeam" preselect-chat="aadc.preselectChat">\n                      </chat-and-team-selector>\n                    </div>\n                  </div>\n                  \x3c!-- Toggle button for team --\x3e\n                  <div class="ts-add-app-dialog-install-team-button" ng-if="!aadc.isChatSelected || !aadc.appHasGroupChatScope">\n                    <toggle-switch data-tid="toggle-Team" aria-label="{{::aadc.installOptionLabelForTeamOrChat}}" ng-if="!aadc.appHasOnlyTeamOrChatScope && aadc.shouldShowPersonalInstallOption && !aadc.alreadyAddedToTeam" is-checked="aadc.toggleTeamInstall" on-toggle="aadc.teamToggleChange(isChecked)" is-disabled="aadc.teamToggleSwitchDisabled || aadc.isTeamAppInstallDisabled">\n                      <div class="toggle-text" ng-if="aadc.toggleTeamInstall || aadc.teamToggleSwitchDisabled || aadc.isTeamAppInstallDisabled" translate-once="{{::$root.resources.strings.extension_addAppDialog_button_yes}}"></div>\n                      <div class="toggle-text" ng-if="!aadc.toggleTeamInstall&&!aadc.teamToggleSwitchDisabled && !aadc.isTeamAppInstallDisabled" translate-once="{{::$root.resources.strings.extension_addAppDialog_button_no}}"></div>\n                    </toggle-switch>\n                    <a class="setup-text" ng-if="!aadc.enableAppDetailDialogV3 && aadc.alreadyAddedToTeam && !aadc.isTeamArchived" ng-click="aadc.goToPostInstallDialog(\'teamScope\')" ng-attr-title="{{::$root.resources.strings.extension_addAppDialog_button_set_up_tooltip|translate}}" href="javascript:void(0)">\n                      <span class="text" data-tid="setUp-App-Team" translate-once="{{::$root.resources.strings.extension_addAppDialog_button_set_up}}"></span>\n                    </a>\n                    <button class="setup-text ts-btn ts-btn-secondary insert-border" data-tid="setUp-App-Team" ng-if="aadc.enableAppDetailDialogV3 && aadc.alreadyAddedToTeam && !aadc.isTeamArchived" aria-label="{{::$root.resources.strings.extension_addAppDialog_button_open_tooltip|translate}}" ng-click="aadc.goToPostInstallDialog(\'teamScope\')">\n                      {{::$root.resources.strings.extension_addAppDialog_button_open|translate}}\n                    </button>\n                  </div>\n                  \x3c!-- Toggle button for chat --\x3e\n                  <div class="ts-add-app-dialog-install-chat-button" ng-if="aadc.isChatSelected && aadc.appHasGroupChatScope">\n                    <toggle-switch data-tid="toggle-chat" aria-label="{{::aadc.installOptionLabelForTeamOrChat}}" ng-if="!aadc.appHasOnlyTeamOrChatScope && aadc.shouldShowPersonalInstallOption && !aadc.alreadyAddedToGroupChat" is-checked="aadc.toggleChatInstall" on-toggle="aadc.chatToggleChange(isChecked)" is-disabled="aadc.chatToggleSwitchDisabled">\n                      <div class="toggle-text" ng-if="aadc.toggleChatInstall || aadc.chatToggleSwitchDisabled" translate-once="{{::$root.resources.strings.extension_addAppDialog_button_yes}}"></div>\n                      <div class="toggle-text" ng-if="!aadc.toggleChatInstall&&!aadc.chatToggleSwitchDisabled" translate-once="{{::$root.resources.strings.extension_addAppDialog_button_no}}"></div>\n                    </toggle-switch>\n                    <a class="setup-text" ng-if="!aadc.enableAppDetailDialogV3 && aadc.alreadyAddedToGroupChat" ng-click="aadc.goToPostInstallDialog(\'groupchatScope\')" ng-attr-title="{{::$root.resources.strings.extension_addAppDialog_button_set_up_tooltip|translate}}" href="javascript:void(0)">\n                      <span class="text" data-tid="setUp-App-Chat" translate-once="{{::$root.resources.strings.extension_addAppDialog_button_set_up}}"></span>\n                    </a>\n                    <button class="setup-text ts-btn ts-btn-secondary insert-border" data-tid="setUp-App-Chat" ng-if="aadc.enableAppDetailDialogV3 && aadc.alreadyAddedToGroupChat" aria-label="{{::$root.resources.strings.extension_addAppDialog_button_open_tooltip|translate}}" ng-click="aadc.goToPostInstallDialog(\'groupchatScope\')">\n                      {{::$root.resources.strings.extension_addAppDialog_button_open|translate}}\n                    </button>\n                  </div>\n                </div>\n                <div class="ts-add-app-dialog-install-team-capabilities" ng-if="!aadc.isTeamCapabilityCollapsed">\n                  <div ng-repeat="capability in aadc.appCapabilities track by capability.description" class="ts-add-app-section-spacing-medium">\n                    <div class="badge-icon">\n                      <ng-include class="icon" src="capability.icon"></ng-include>\n                    </div>\n                    <div class="app-info">\n                      <div class="ts-add-app-dialog-capability-decsription">{{capability.description}}</div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <section ng-if="!aadc.hideContent && aadc.mediaSize > 0" class="screenshots">\n              <div class="expand-collapse inset-border inset-border-themed" role="button" aria-expanded="{{!aadc.isAppScreenshotsCollapsed}}" name="{{::$root.resources.strings.extension_addAppDialog_screenshots|translate}}" aria-labelledby="{{::$root.resources.strings.extension_addAppDialog_screenshots|translate}}" tabindex="0" ng-click="aadc.expandCollapseAppScreenshots()">\n                <div class="expand-collapse-icon icons-gray-06-triangle-fill">\n                  <ng-include ng-if="aadc.isAppScreenshotsCollapsed" src="\'svg/icons-triangle-right-small.html\'"></ng-include>\n                  <ng-include ng-if="!aadc.isAppScreenshotsCollapsed" src="\'svg/icons-triangle-down-small.html\'"></ng-include>\n                </div>\n                <span class="ts-add-app-dialog-screenshots-viewmore" translate-once="{{::$root.resources.strings.extension_addAppDialog_screenshots}}"></span>\n              </div>\n              <div class="ts-add-app-dialog-screenshots" ng-class="{\'screenshotCollapsed\': aadc.isAppScreenshotsCollapsed}">\n                <a class="left carousel-control" tabindex="-1" role="button" ng-click="aadc.left()" ng-class="{\'visible\': aadc.isLeftArrowVisible}">\n                  <span class="sr-only" translate-once="{{::$root.resources.strings.botcards_carousel_prev}}"></span>\n                  <ng-include class="card-arrow-icon" src="\'svg/icons-chevron-left.html\'"></ng-include>\n                </a>\n                <a class="right carousel-control" tabindex="-1" role="button" ng-click="aadc.right()" ng-class="{\'visible\': aadc.isRightArrowVisible}">\n                  <span class="sr-only" translate-once="{{::$root.resources.strings.botcards_carousel_next}}"></span>\n                  <ng-include class="card-arrow-icon" src="\'svg/icons-chevron-right.html\'"></ng-include>\n                </a>\n                <div acc-role="listgrid-horizontal" class="ts-add-app-dialog-screenshots-scrollable" id="ts-add-app-dialog-screenshots-scrollable" aria-label="{{::$root.resources.strings.extension_addAppDialog_video_and_screenshots_aria|translate}}">\n                  <div class="screenshots-scrollable-wrapper">\n                    <div class="screenshots-and-video inset-border inset-border-themed" tabindex="-1" acc-tabbable="false" acc-role="listgrid-item" role="application" aria-label="{{::$root.resources.strings.extension_addAppDialog_video_aria|translate}}" on-enter="aadc.focusOnVideo()" ng-keydown="aadc.onKeydown($event)" ng-if="aadc.videoUrl">\n                      <embedded-page-container enable-message-passing="true" disable-tabbable="true" url="{{::aadc.videoUrl}}">\n                      </embedded-page-container>\n                    </div>\n                    <div class="screenshots-and-video" ng-repeat="screenshotImageUrl in aadc.screenshotUrls">\n                      <a acc-role="listgrid-item" role="application" target="_blank" tabindex="-1" ng-keydown="aadc.onKeydown($event)" aria-label="{{::$root.resources.strings.extension_addAppDialog_screenshots_aria|translate}}" acc-tabbable="false" href="{{::screenshotImageUrl}}" ng-click="aadc.setPreActive($index)" media-preview-enabler>\n                        <img ng-src="{{::screenshotImageUrl}}"/>\n                      </a>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </section>\n            <section class="ts-add-app-dialog-about-section">\n              <div class="expand-collapse inset-border inset-border-themed" role="button" name="{{::$root.resources.strings.extension_addAppDialog_about|translate}}" aria-expanded="{{!aadc.isAboutCollapsed}}" aria-labelledby="{{::$root.resources.strings.extension_addAppDialog_about|translate}}" tabindex="0" ng-click="aadc.expandCollapseAboutSection()">\n                <div class="expand-collapse-icon icons-gray-06-triangle-fill">\n                  <ng-include ng-if="aadc.isAboutCollapsed" src="\'svg/icons-triangle-right-small.html\'"></ng-include>\n                  <ng-include ng-if="!aadc.isAboutCollapsed" src="\'svg/icons-triangle-down-small.html\'"></ng-include>\n                </div>\n                <span id="ts-add-app-dialog-expand-collapse-about" translate-once="{{::$root.resources.strings.extension_addAppDialog_about}}"> </span>\n              </div>\n              <div class="ts-add-app-dialog-developer-name" ng-if="!aadc.isAboutCollapsed">\n                <span ng-if="!aadc.app.appDefinition.developerUrl && aadc.app.appDefinition.developerName" class="ts-add-app-dialog-privacyAndToU-text" translate-with-html-params translate-id="extension_addAppDialogDeveloper" translate-values=\'{"developerName": "{{::aadc.app.appDefinition.developerName}}"}\'></span>\n                <span ng-if="aadc.app.appDefinition.developerUrl && aadc.app.appDefinition.developerName" class="ts-add-app-dialog-privacyAndToU-text" translate-with-html-params translate-id="extension_addAppDialogDeveloper" translate-values=\'{"developerName": "<a ng-href=\\"{{::aadc.app.appDefinition.developerUrl}}\\" rel=\\"noopener noreferrer\\" ng-bind=\\"::aadc.app.appDefinition.developerName\\" target=\\"_blank\\"></a>"}\'></span>\n              </div>\n              <div class="ts-add-app-dialog-version" ng-if="!aadc.isAboutCollapsed">\n                <span ng-if="aadc.app.appDefinition.version" class="version" translate-with-html-params translate-id="extension_addAppDialog_version" translate-values=\'{"version": "{{::aadc.app.appDefinition.version}}"}\'></span>\n              </div>\n              <div class="ts-add-app-dialog-supported-languages" ng-if="!aadc.isAboutCollapsed">\n                <span ng-if="aadc.app.appDefinition.supportedLanguages && aadc.app.appDefinition.supportedLanguages.length > 1" class="supported-languages" translate-with-html-params translate-id="extension_addAppDialog_supported_languages"></span>\n                <ul class="languages">\n                  <li class="language" ng-repeat="language in aadc.supportedLanguages">{{language}}</li>\n                </ul>\n              </div>\n            </section>\n\n            <section ng-if="!aadc.hideContent" class="privacy-and-permissions">\n\n              <div class="ts-add-app-dialog-permissions">\n                <div class="expand-collapse inset-border inset-border-themed" role="button" name="{{::$root.resources.strings.extension_addAppDialog_privacy_and_permissions|translate}}" aria-expanded="{{!aadc.isPrivateAndPermissionsCollapsed}}" aria-labelledby="{{::$root.resources.strings.extension_addAppDialog_privacy_and_permissions|translate}}" ng-click="aadc.expandCollapsePrivateAndPermissions()" tabindex="0">\n                  <div class="expand-collapse-icon icons-gray-06-triangle-fill">\n                    <ng-include ng-if="aadc.isPrivateAndPermissionsCollapsed" src="\'svg/icons-triangle-right-small.html\'"></ng-include>\n                    <ng-include ng-if="!aadc.isPrivateAndPermissionsCollapsed" src="\'svg/icons-triangle-down-small.html\'"></ng-include>\n                  </div>\n                  <span id="ts-add-app-dialog-privacy-and-permissions" translate-once="{{::$root.resources.strings.extension_addAppDialog_privacy_and_permissions}}"> </span>\n                </div>\n                <div>\n                  <span id="ts-add-app-dialog-permissions-header" ng-if="!aadc.hideContent && aadc.app.appDefinition.privacyUrl && aadc.app.appDefinition.termsOfUseUrl" class="accept-text ts-add-app-dialog-small-caption-text" translate-with-html-params translate-id="extension_addAppDialogAppNamePrivacyAndToU" translate-values=\'{"appName": "{{::aadc.app.appDefinition.name}}", "privacyPolicy": "<a ng-href=\\"{{::aadc.app.appDefinition.privacyUrl}}\\" title=\\"{{::aadc.app.appDefinition.privacyUrl}}\\" rel=\\"noopener noreferrer\\" target=\\"_blank\\"><span translate-once=\\"{{::$root.resources.strings.extension_addAppDialogPrivacy}}\\"></span></a>", "termsOfUse": "<a ng-href=\\"{{::aadc.app.appDefinition.termsOfUseUrl}}\\" title=\\"{{::aadc.app.appDefinition.termsOfUseUrl}}\\" rel=\\"noopener noreferrer\\" target=\\"_blank\\"><span translate-once=\\"{{::$root.resources.strings.extension_addAppDialogToU}}\\"></span></a>"}\'></span>\n                </div>\n                <div class="ts-add-app-dialog-permissions-scrollable" ng-if="!aadc.isPrivateAndPermissionsCollapsed">\n                  <ul class="ts-add-app-dialog-permissions-header">\n                    <li ng-repeat="permission in aadc.permissions">{{permission}}</li>\n                  </ul>\n                </div>\n                <div class="ts-add-app-dialog-permissions-scrollable" ng-if="aadc.requestedPermissions && aadc.requestedPermissions.length > 0 && !aadc.isPrivateAndPermissionsCollapsed">\n                  <span ng-bind="::$root.resources.strings.extension_addAppDialogAppRequestPermissionTitle | translate"></span>\n                  <ul class="ts-add-app-dialog-permissions-header">\n                    <li ng-repeat="permission in aadc.requestedPermissions">{{permission}}</li>\n                  </ul>\n                </div>\n              </div>\n              <div class="empty" ng-class="{\'is-visible\': (aadc.emptySpaceVisible && aadc.isPrivateAndPermissionsCollapsed && (aadc.mediaSize > 0 && aadc. aadc.isAppScreenshotsCollapsed))}"></div>\n            </section>\n            <div class="ts-add-app-dialog-scroll-shadow more-indicator-bottom" ng-class="{\'is-visible\': aadc.emptySpaceVisible, \'permission-expanded\': !aadc.isPrivateAndPermissionsCollapsed}"></div>\n          </div>\n        </div>\n      </div>\n      <div class="footer-message">\n        <busy-animation class="loading" ng-if="aadc.showLoadingButton" size="small"></busy-animation>\n        <div class="description ts-add-app-dialog-error-message" ng-if="aadc.inlineMessage" ng-bind="aadc.inlineMessage" role="alert" aria-live="assertive"></div>\n      </div>\n      <div ng-if="aadc.showDialogLoadingSpinner" class="ts-add-app-dialog-wait-message">\n        <busy-animation size="small" context="td-apps-add-app"></busy-animation>\n        <span role="alert" aria-live="assertive" translate-once="{{::$root.resources.strings.extension_addAppDialogWait}}"></span>\n      </div>\n    </section>\n  </modal-dialog>\n</div>'},2630:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2631),a=n(31),s=n(55),o="components/extensibility/add-app-new-dialog/carousel.html",r=["youtube.com/","youtu.be/","vimeo.com/"],l=function(){function e(e,t,n){this.$scope=e,this.constants=t,this.$timeout=n,this.medias=[],this.mediaWidth=0,this.mediaPlateWidth=0,this.mediaPlateLeftOffset=0,this.cssTransitionDuration=0,e.$watchGroup(["imageUrlsAttr","videoUrlsAttr"],this.onMediasAttrUpdate.bind(this))}return e.$inject=["$scope","constants","$timeout"],e.prototype.previous=function(){this.selectMedia(this.selectedIndex-1)},e.prototype.next=function(){this.selectMedia(this.selectedIndex+1)},e.prototype.shouldMediaBeLoaded=function(e){return e>=this.selectedIndex-1&&e<=this.selectedIndex+1},e.prototype.shouldShowLeftArrow=function(){return this.selectedIndex>0},e.prototype.shouldShowRightArrow=function(){return this.selectedIndex<this.medias.length-1},e.prototype.mediaItemKeyboard=function(e){var t=e.keyCode;return t===this.constants.keyCodes.tab?(e.preventDefault(),e.stopPropagation(),void(this.$scope.onTabbingOut&&this.$scope.onTabbingOut({shiftKey:e.shiftKey}))):t===this.constants.keyCodes.left?(this.selectMedia(this.selectedIndex-1),void this.$timeout(this.cssTransitionDuration).then(function(){s.focusPreviousInTheList(".ts-carousel-media-plate",".ts-carousel-media")})):t===this.constants.keyCodes.right?(this.selectMedia(this.selectedIndex+1),void this.$timeout(this.cssTransitionDuration).then(function(){s.focusNextInTheList(".ts-carousel-media-plate",".ts-carousel-media")})):void(t!==this.constants.keyCodes.enter||this.$scope.zoomIn&&this.$scope.zoomIn())},e.prototype.selectMedia=function(e){e<0&&(e=0),e>this.medias.length-1&&(e=this.medias.length-1),this.selectedIndex=e,this.$scope.savedState={selectedIndex:e},this.mediaPlateLeftOffset=-1*this.mediaWidth*e},e.prototype.onMediasAttrUpdate=function(){var e=this;this.medias.length=0,this.mediaWidth=0,this.mediaPlateWidth=0,this.selectedIndex=0;var t=_.map(this.$scope.imageUrlsAttr?this.$scope.imageUrlsAttr:[],function(e){return{url:e,type:"image"}}),n=_.map(this.$scope.videoUrlsAttr?this.$scope.videoUrlsAttr:[],function(e){return{url:e,type:"video"}});n=_.filter(n,function(e){return _.some(r,function(t){return e.url&&e.url.indexOf(t)>=0})}),this.medias=n.concat(t),this.medias.length<=0||a.element(".ts-carousel").ready(function(t){var n=t.find(".ts-carousel-media-container");n&&n.length?(e.mediaWidth=n[0].clientWidth,e.mediaPlateWidth=e.mediaWidth*e.medias.length):e.mediaWidth=0;var i=t.find(".ts-carousel-media-plate");if(i&&i.length){var o=parseFloat(a.element(i[0]).css("transition-duration"));NaN!==o&&(e.cssTransitionDuration=1e3*o)}e.$scope.savedState&&void 0!==e.$scope.savedState.selectedIndex&&e.$scope.savedState.selectedIndex<e.medias.length?(e.selectMedia(e.$scope.savedState.selectedIndex),e.$timeout(function(){return s.focusNthInTheList(".ts-carousel-media-container",".ts-carousel-media",e.selectedIndex)},e.cssTransitionDuration)):e.medias.length&&e.selectMedia(0)})},e}();a.module("teamspace.addAppDialogV3.carousel",[]).directive("tsCarousel",function(){return{restrict:"A",templateUrl:o,scope:{imageUrlsAttr:"<imageUrls",videoUrlsAttr:"<videoUrls",savedState:"=?",zoomIn:"&?",onTabbingOut:"&?",definitionId:"<"},controller:l,controllerAs:"ctrl"}}).run(["$templateCache",function(e){e.put(o,i)}])},2631:function(e,t){e.exports='<div class="ts-carousel" ng-if="ctrl.medias && ctrl.medias.length">\n  <div class="ts-carousel-media-container">\n    <div class="ts-carousel-media-plate" ng-style="{width: ctrl.mediaPlateWidth, marginLeft: ctrl.mediaPlateLeftOffset}" ng-keydown="ctrl.mediaItemKeyboard($event)" role="list">\n      <div ng-repeat="media in ctrl.medias track by $index" ng-switch="media.type" class="ts-carousel-media" ng-style="{width: ctrl.mediaWidth}" role="listitem" ng-attr-tabindex="{{$index === ctrl.selectedIndex ? \'0\' : \'-1\'}}" aria-label="{{::$root.resources.strings.extension_addAppDialog_screenshots_aria|translate}}">\n        <img ng-switch-when="image" ng-if="ctrl.shouldMediaBeLoaded($index)" class="ts-carousel-image" ng-src="{{media.url}}" ng-style="{cursor: ctrl.$scope.zoomIn ? \'zoom-in\' : \'default\'}" ng-click="ctrl.$scope.zoomIn()" role="image" alt="{{::$root.resources.strings.extension_addAppDialog_screenshots_aria|translate}}"/>\n        <embedded-page-container ng-switch-when="video" ng-if="ctrl.shouldMediaBeLoaded($index)" class="ts-carousel-video" enable-message-passing="true" disable-tabbable="true" definition-id="{{ctrl.$scope.definitionId}}" url="{{::media.url}}"/>\n      </div>\n    </div>\n\n\n    <a ng-if="ctrl.shouldShowLeftArrow()" ng-click="ctrl.previous()" href="javascript:void(0)" class="ts-carousel-left-arrow" aria-label="{{::$root.resources.strings.extension_addAppDialog_leftArrow_aria|translate}}" tabindex="-1">\n      <ng-include src="\'svg/icons-chevron-left.html\'"></ng-include>\n    </a>\n    <a ng-if="ctrl.shouldShowRightArrow()" ng-click="ctrl.next()" href="javascript:void(0)" class="ts-carousel-right-arrow" aria-label="{{::$root.resources.strings.extension_addAppDialog_rightArrow_aria|translate}}" tabindex="-1">\n      <ng-include src="\'svg/icons-chevron-right.html\'"></ng-include>\n    </a>\n  </div>\n\n  <div class="ts-carousel-dots-container">\n    <div ng-repeat="i in ctrl.medias" ng-class="{ active: $index === ctrl.selectedIndex }" class="ts-carousel-dot"></div>\n  </div>\n\n</div>'},2632:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2633),a=n(55),s=n(52),o=n(123),r=teamspace.middletier.ConfigurableTabContext,l="components/extensibility/add-app-new-dialog/add-button.html",p=".ts-add-app-dialog-add-button-menu-item",c=function(){function e(e,t,n,i,a,s,o,r,l,p,c,d,g,u,h,m,v,f,b,y,S,A,D){var C=this;this.$q=e,this.$scope=t,this.$translate=n,this.analyticsService=i,this.appsService=a,this.templatedAppsService=s,this.constants=o,this.conversationsService=r,this.conversationsStore=l,this.dialogService=p,this.eventingService=c,this.extensionManifestService=d,this.inputExtensionService=g,this.loggingService=u,this.navigationService=h,this.resources=m,this.settingsService=v,this.userAppsDispatcher=f,this.$timeout=b,this.mruServiceV2=y,this.peopleSlugService=S,this.utilityService=A,this.buttonMenuItems=[],this.isInstallingOrUpgrading=!1,this.shouldShowDropdown=!1,this.enableAppsInstalledByCurrentUser=!1,this.closeDropdown=function(){C.$scope.$apply(function(){return C.shouldShowDropdown=!1})},this.logger=u.newLogger("add-app-dialog-v3-add-button"),this.dontCreateConversationOnBotInstallation=v.valueAsBoolean(o.settings.names.dontCreateConversationOnBotInstallation),this.enableAppsInstalledByCurrentUser=v.valueAsBoolean(o.settings.names.enableAppsInstalledByCurrentUser),this.appIsTenantAdminBlocked=o.extensibility.apps.errorCodes.appIsTenantAdminBlocked,this.enableContainerApps=v.valueAsBoolean(o.settings.names.enableContainerApps),this.enableTrustedSideloading=v.valueAsBoolean(o.settings.names.enableTrustedSideloading),this.enablePartnerAppCatalogBrowse=v.valueAsBoolean(o.settings.names.enablePartnerAppCatalogBrowse),this.enablePartnerAppsBrowseInstallDialogUIFix=v.valueAsBoolean(o.settings.names.enablePartnerAppsBrowseInstallDialogUIFix),this.enableAppsMRU=v.valueAsBoolean(o.settings.names.enableAppsMRU),this.enableAddToMeeting=v.valueAsBoolean(o.settings.names.enableAddToMeeting),this.stateParams=D.getRootRouteParams(),this.enableAddAppInManageTeamsApp=v.valueAsBoolean(o.settings.names.enableAddAppInManageTeamsApp),this.enableDefaultFieldsInAppDefinition=v.valueAsBoolean(o.settings.names.enableDefaultFieldsInAppDefinition),this.enableInstallAppTutorial=v.valueAsBoolean(o.settings.names.enableInstallAppTutorial),this.enableSceneAppsInStore=v.valueAsBoolean(o.settings.names.enableSceneAppsInStore),t.$watch("addButtonAttrs",this.onAddButtonAttrsUpdated.bind(this))}return e.$inject=["$q","$scope","$translate","analyticsService","appsService","templatedAppsService","constants","conversationsService","conversationsStore","dialogService","eventingService","extensionManifestService","inputExtensionService","loggingService","navigationService","resources","settingsService","userAppsDispatcher","$timeout","mruServiceV2","peopleSlugService","utilityService","routeUtilityService"],e.prototype.onKeyboard=function(e){var t=e.keyCode;if(t!==this.constants.keyCodes.escape){if(this.shouldShowDropdown){if(t===this.constants.keyCodes.tab)return event.stopPropagation(),void event.preventDefault();if(t===this.constants.keyCodes.up)return void a.focusPreviousInTheList(".ts-add-app-dialog-add-button-dropdown",p);if(t===this.constants.keyCodes.down)return void a.focusNextInTheList(".ts-add-app-dialog-add-button-dropdown",p)}}else{e.preventDefault(),e.stopPropagation(),this.toggleDropdown();var n=angular.element(document).find(".ts-add-app-dialog-add-button-arrow");n&&n.length&&n[0].focus()}},e.prototype.toggleDropdown=function(e){e&&e.stopPropagation&&e.stopPropagation(),this.shouldShowDropdown=!this.shouldShowDropdown,this.$scope.dropdownStateChanged&&this.$scope.dropdownStateChanged({$isDropdownOpen:this.shouldShowDropdown}),this.shouldShowDropdown?(angular.element(document).one("click",this.closeDropdown),!e||e.detail&&1!==e.detail||a.focusNthInTheList(".ts-add-app-dialog-add-button-dropdown",p)):angular.element(document).off("click",this.closeDropdown)},e.prototype.onAddButtonAttrsUpdated=function(){var e=this,t=this.$scope.addButtonAttrs;if(t)if("not-sideload"===t.flow){var n=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.addAppDialogAddButton.populateNotSideload);this.populateButton(t.appDefinition,t),n.stop()}else if("sideload"===t.flow){var i=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.addAppDialogAddButton.populateSideload);if(!t.appDefinition&&!t.manifestZipFile){a="failed to init sideloading flow as no appDefinition nor manifestZipFile found";return this.logger.error(a),void i.fail({error2:a})}if((this.enableTrustedSideloading||this.enablePartnerAppCatalogBrowse)&&t.appDefinition&&t.appDefinition.templatedAppId){if(!(this.enableTrustedSideloading&&t.appDefinition.templatedAppId===t.addAppDialogData.appId||this.enablePartnerAppCatalogBrowse&&t.appDefinition.templatedAppId===t.addAppDialogData.templatedAppId)){var a="TemplatedAppId from AppDefinition does not match with appId from the Trusted Sideloading deepLink";return this.logger.error(a),void i.fail({error2:a})}this.populateButton(t.appDefinition,t),i.stop()}else this.extensionManifestService.extractAppDefinition(t.manifestZipFile,!0).then(function(n){e.populateButton(n,t),i.stop()}).catch(function(t){e.logger.error("failed to init sideload flow "+t),i.fail({error:t,error1:t})})}else this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.addAppDialogAddButton.unknownFlow).fail()},Object.defineProperty(e.prototype,"isMeeting",{get:function(){var e=this.peopleSlugService.resolve(this.stateParams.peopleSlug||this.stateParams.conversationId);return e&&e.conversation&&e.conversation.isMeeting},enumerable:!0,configurable:!0}),e.prototype.populateButton=function(e,t){this.enableDefaultFieldsInAppDefinition&&(this.defaultInstallScope=e.defaultInstallScope),"not-sideload"===t.flow?(this.populateMenuItemUpgrade(e,t),this.populateMenuItemInContext(e,t),this.populateMenuItemTeamNotSideload(e,t),this.populateMenuItemGroupChatNotSideload(e,t),this.enableAddToMeeting&&this.populateMenuItemMeetingNotSideload(e,t),this.populateMenuItemPersonalNotSideload(e,t).then(this.populateMenuItemList.bind(this))):(this.enableTrustedSideloading||this.enablePartnerAppCatalogBrowse)&&this.enablePartnerAppsBrowseInstallDialogUIFix&&e.templatedAppId?(this.populateMenuItemTeamSideload(e,t),this.populateMenuItemGroupChatSideload(e,t),this.populateMenuItemInContext(e,t),this.enableAddToMeeting&&this.populateMenuItemMeetingSideload(e,t),this.populateMenuItemPersonalSideload(e,t).then(this.populateMenuItemList.bind(this))):(this.populateMenuItemTeamSideload(e,t),this.populateMenuItemGroupChatSideload(e,t),this.populateMenuItemPersonalSideload(e,t),this.populateMenuItemInContext(e,t),this.enableAddToMeeting&&this.populateMenuItemMeetingSideload(e,t),this.populateMenuItemList())},e.prototype.updateMru=function(e){this.enableAppsMRU&&this.mruServiceV2.recordUsage(e)},e.prototype.openTeamOrChannelPicker=function(e,t,n){var i,a=null,s=null,o=null,r=null,l=!1;"not-sideload"===t.flow?(a=t.teamId,s=t.channelId,o=t.chatId,r=t.messageId):(l=!0,i=t.manifestZipFile,a=t.teamId,s=t.channelId);var p={installSucceeded:!0};this.$scope.$parent.closeThisDialog(p);var c={appId:e,teamId:a,channelId:s,chatId:o,messageId:r,pickerType:n,isSideloadApp:l,manifestZipFile:i,addAppDialogData:t.addAppDialogData};this.dialogService.openLazyDialog(this.constants.lazyDialogs.teamOrChannelPicker,this.constants.lazyModules.extensibilityDialogs,c)},e.prototype.populateMenuItemUpgrade=function(e,t){var n=this;if(!t.isInContextMode&&t.isUpgrading){this.menuItemUpgrade={onClick:function(){n.updateMru(e.id);var i=n.loggingService.newScenario(n.constants.scenarios.extensibility.apps.addAppDialogAddButton.menuItemUpgrade);i.appendEventData({appId:e.id}),n.isInstallingOrUpgrading=!0;var s=[];a.checkIfAppHasScopeForCapability("personal",e)&&(i.mark("upgrade for personal"),s.push(n.isAppInstalledForPersonal(e.id).then(function(t){return t?n.appsService.upgradeUserAppEntitlement(e):(i.mark("app is not installed for user. no need to upgrade"),n.$q.resolve())}))),t.teamId&&a.checkIfAppHasScopeForCapability("team",e)&&(i.mark("upgrade for team"),s.push(n.appsService.upgradeTeamAppEntitlement(t.teamId,e))),t.chatId&&a.checkIfAppHasScopeForCapability("groupchat",e)&&(i.mark("upgrade for chat"),s.push(n.appsService.upgradeChatAppEntitlement(t.chatId,e))),n.$q.all(s).then(function(){n.menuItemUpgrade.text=n.$translate.instant(n.resources.strings.extension_addAppDialogV3_button_open),t.onInstallTriggered(),i.stop();var e={upgradeSucceeded:!0};n.$scope.$parent.closeThisDialog(e)}).catch(function(a){t.onInstallTriggered(a),n.logger.error("upgrade failed "+a);var s=teamspace.services.AppsServiceUtils.getSafeError(a);i.fail({errorCode:s.errorCode,statusCode:s.status,error:s.message,error2:s.message});var o={upgradeSucceeded:!1};n.$scope.$parent.closeThisDialog(o),a&&a.data&&a.data.errorCode?n.openV3ErrorDialog(a.data.errorCode,!0,"upgrade",e.name):n.openV3ErrorDialog("something-wrong",!0)}).finally(function(){n.isInstallingOrUpgrading=!1})},text:this.$translate.instant(this.resources.strings.extension_addAppDialogV3_button_upgrade),trackSummary:"upgrade"}}else this.menuItemUpgrade=void 0},e.prototype.populateMenuItemPersonalNotSideload=function(e,t){var n=this;if(t.isInContextMode||t.isUpgrading||!a.checkIfAppHasScope("personal",e))return this.menuItemPersonal=void 0,this.$q.resolve();var i=function(i){return function(){n.updateMru(e.id);var a=n.loggingService.newScenario(n.constants.scenarios.extensibility.apps.addAppDialogAddButton.menuItemPersonalNotSideload);n.isAppInstalledForPersonal(e.id).then(function(o){var r=n.$q.resolve();return o?a.mark("app is installed for personal. start to navigate to personal app"):(a.mark("app is not installed for personal"),r=n.ensureAppIsInstalledForPersonal(e,n.enableContainerApps,!0).then(function(){a.mark("successfully installed app for personal")})),r.then(function(){var a=new s.InstalledApp(e);return n.navigateToAppInPersonalScope(a,{attrs:t,isFirstInstallation:i})}).then(function(){a.stop();var e={installSucceeded:!0};o||t.onInstallTriggered(),n.$scope.$parent.closeThisDialog(e)}).catch(function(i){t.onInstallTriggered(i),n.logger.error("install or open for personal failed "+i),i&&i.data&&i.data.errorCode===n.appIsTenantAdminBlocked?a.stop():a.fail({error:i,error1:i}),i&&i.data&&i.data.errorCode?n.openV3ErrorDialog(i.data.errorCode,void 0,"install",e.name):n.openV3ErrorDialog("something-wrong")})})}};return this.isAppInstalledForPersonal(e.id).then(function(e){n.menuItemPersonal=e?{onClick:i(!1),text:n.$translate.instant(n.resources.strings.extension_addAppDialogV3_button_open),iconUrl:"svg/icons-person.html",trackSummary:"addPersonal"}:{onClick:i(!0),text:n.$translate.instant(n.resources.strings.extension_addAppDialogV3_button_add),iconUrl:"svg/icons-person.html",trackSummary:"addPersonal"}})},e.prototype.navigateToAppInPersonalScope=function(e,t){var n,i=this,s=t.attrs,o=t.isFirstInstallation;if(s&&s.addAppDialogData&&s.addAppDialogData.entryPoint===teamspace.components.AddAppDialogEntryPoint.Store&&s.addAppDialogData.postInstallCbForWorkflows)return this.$q.resolve(s.addAppDialogData.postInstallCbForWorkflows());if(s&&s.addAppDialogData&&s.addAppDialogData.entryPoint===teamspace.components.AddAppDialogEntryPoint.MessagingExtensionFeaturedItem)return this.$q.resolve(null);if(s&&s.addAppDialogData&&s.addAppDialogData.entryPoint===teamspace.components.AddAppDialogEntryPoint.MessagingExtensionFlyoutFromChat)return this.navigationService.navigateToLastChatState("add-button",{platformAppInstalled:{appId:e.appDefinition.id,displayName:e.appDefinition.name,capability:teamspace.services.commanding.PlatformAppCapability.MessagingExtension}}),this.$q.resolve(this.eventingService.$once(this.$scope.$root,this.constants.events.messages.focusInEditor,function(){}));if(s&&s.addAppDialogData&&s.addAppDialogData.entryPoint===teamspace.components.AddAppDialogEntryPoint.MessagingExtensionFlyoutFromChannel)return this.navigationService.navigateToChannel(s.addAppDialogData.channelId,"add-button"),this.$q.resolve(this.eventingService.$once(this.$scope.$root,this.constants.events.messages.focusInEditor,function(){i.eventingService.$emit(i.constants.events.app.installed,{appId:e.appDefinition.id,type:i.constants.events.funStuff.type.inputExtension})}));if(teamspace.services.AppsServiceUtils.isPersonalApp(e,!1)){var r={appId:e.appDefinition.id,displayName:e.appDefinition.name};return(null===(n=e.appDefinition.bots)||void 0===n?void 0:n.length)&&(r.botId=e.appDefinition.bots[0].id),this.navigateToPersonalAppHelper(e,r)}if(e.appDefinition.inputExtensions&&a.hasScope("personal",e.appDefinition.inputExtensions)){if("autosuggest"===this.$scope.addButtonAttrs.source)return this.navigateToPowerbarMessagingExtension(e);var l=function(t){if(t&&t.shouldNavigate)return i.navigationService.navigateToLastChatState("add-button",{platformAppInstalled:{appId:e.appDefinition.id,displayName:e.appDefinition.name,capability:teamspace.services.commanding.PlatformAppCapability.MessagingExtension}}),i.$q.resolve(i.eventingService.$once(i.$scope.$root,i.constants.events.messages.focusInEditor,function(){i.eventingService.$emit(i.constants.events.app.installed,{appId:e.appDefinition.id,type:i.constants.events.funStuff.type.inputExtension})}))};this.enableInstallAppTutorial?this.dialogService.openLazyDialog(this.constants.lazyDialogs.addAppTutorialDialog,this.constants.lazyModules.extensibilityDialogs,{hasCommandBoxCapability:a.checkIfAppHasInputExtensionContext(e.appDefinition,"commandBox"),hasComposeCapability:a.checkIfAppHasInputExtensionContext(e.appDefinition,"compose"),appName:e.appDefinition.name,appId:e.appDefinition.id,tenantId:e.appDefinition.tenantId,isFirstInstallation:o},l):l({shouldNavigate:!0})}return this.$q.resolve()},e.prototype.navigateToPersonalAppHelper=function(e,t){var n=this;this.logNavigateToPersonalAppTelemetry(e);var i=new teamspace.services.userApp.UserApp(e,!1);return this.navigationService.navigateToUserApp(this.$scope,i,{platformAppInstalled:t}).then(function(){return n.$q.resolve()})},e.prototype.logNavigateToPersonalAppTelemetry=function(e){var t,n=this,i={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.nav.toString(),teamspace.components.PanelActionOutcome,this.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.openApp.toString(),teamspace.components.PanelActionScenario,this.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.nav.toString(),teamspace.components.PanelActionScenarioType,this.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.appFlyoutItem.toString(),teamspace.components.PanelModuleName,this.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.nav.toString(),teamspace.components.PanelModuleType,this.loggingService),summary:e.appDefinition.name},app:{id:e.appDefinition.id,scope:teamspace.components.PanelAppScope.personal,scenarioCapability:teamspace.components.PanelAppScenarioCapability.na}};(null===(t=this.$scope.addButtonAttrs)||void 0===t?void 0:t.source)===teamspace.components.AddAppDialogEntryPoint.MoreAppsUsedTogether&&(i.module.name=teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.complementaryApps.toString(),teamspace.components.PanelModuleName,this.loggingService)),this.analyticsService.getAnalyticsPanelActionEventData(i).then(function(e){return n.analyticsService.sendPanelAction(e)}).catch(function(e){n.logger.error("failed to log navigate to personal app action "+e)})},e.prototype.navigateToPowerbarMessagingExtension=function(e){var t=this,n=e.appDefinition.inputExtensions[0];return this.$timeout(function(){t.eventingService.$emit(t.constants.events.powerBar.atCommandBox,{appId:e.appDefinition.id,botId:n.botId,name:e.appDefinition.name,description:e.appDefinition.shortDescription,imageUrl:e.appDefinition.largeImageUrl,imageUrlSmall:e.appDefinition.smallImageUrl,accentColor:e.appDefinition.accentColor,commands:n.commands,canUpdateConfiguration:n.canUpdateConfiguration,isFavorite:n.isFavorited,isFeatured:teamspace.services.AppsServiceUtils.isAppFeatured(e),isInstalledPersonally:e.appDefinition.isInstalledPersonally,favoriteRank:n.order})},0,!1),this.$q.resolve()},e.prototype.populateMenuItemPersonalSideload=function(e,t){var n=this;{if(!t.isInContextMode&&a.checkIfAppHasScope("personal",e)){var i=function(i){return function(){n.updateMru(e.id),n.isInstallingOrUpgrading=!0;var a,s=n.loggingService.newScenario(n.constants.scenarios.extensibility.apps.addAppDialogAddButton.menuItemPersonalSideload);a=(n.enableTrustedSideloading||n.enablePartnerAppCatalogBrowse)&&e&&e.templatedAppId?n.ensureAppIsSideloadedForPersonal(e,t.manifestZipFile,n.enableContainerApps,t.addAppDialogData):n.ensureAppIsSideloadedForPersonal(e,t.manifestZipFile,n.enableContainerApps),n.enableSceneAppsInStore&&n.appsService.isSceneOnlyAppDefinition(e)&&s.mark("sideload for personal scene only app"),a.then(function(e){if(!e)return n.$q.reject("no sideloaded app");t.onSideloadTriggered(),s.mark("sideloaded for personal. start to navigate to personal app");var a={installSucceeded:!0};return n.$scope.$parent.closeThisDialog(a),n.navigateToAppInPersonalScope(e,{isFirstInstallation:i}).then(function(){s.stop()})}).catch(function(e){t.onSideloadTriggered(e),n.logger.error("sideload for personal failed "+e),s.fail({error:e,error1:e})}).finally(function(){return n.isInstallingOrUpgrading=!1})}};if((this.enableTrustedSideloading||this.enablePartnerAppCatalogBrowse)&&this.enablePartnerAppsBrowseInstallDialogUIFix&&e&&e.templatedAppId){var s=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.addAppDialogAddButton.menuItemPersonalSideloadPartnerApps);return this.appsService.getAggregatedInstalledAppsForUser(!1).then(function(t){for(var a=!1,o=0;o<t.length;o++){var r=t[o];if(teamspace.services.AppsServiceUtils.checkIfPartnerAppAlreadyInstalled(r,e.templatedAppId,e.externalId)&&!r.appDefinition.tenantId){a=!0,r.appDefinition.version===e.version?(s.mark("App already installed, show open button"),s.stop(),n.menuItemPersonal={onClick:i(!1),text:n.$translate.instant(n.resources.strings.extension_addAppDialogV3_button_open),iconUrl:"svg/icons-person.html",trackSummary:"addPersonal"}):(s.mark("App installed but upgrade available, show upgrade button"),s.stop(),n.menuItemPersonal={onClick:i(!1),text:n.$translate.instant(n.resources.strings.extension_addAppDialogV3_button_upgrade),iconUrl:"svg/icons-person.html",trackSummary:"upgrade"});break}}a||(s.mark("App not installed, show Add for me button"),s.stop(),n.menuItemPersonal={onClick:i(!0),text:n.$translate.instant(n.resources.strings.extension_addAppDialogV3_button_add),iconUrl:"svg/icons-person.html",trackSummary:"addPersonal"})}).catch(function(e){s.mark("Error in searching installed apps for users"),s.fail({error2:e}),n.menuItemPersonal={onClick:i(!0),text:n.$translate.instant(n.resources.strings.extension_addAppDialogV3_button_add),iconUrl:"svg/icons-person.html",trackSummary:"addPersonal"}})}return this.menuItemPersonal={onClick:i(!0),text:this.$translate.instant(this.resources.strings.extension_addAppDialogV3_button_add),iconUrl:"svg/icons-person.html",trackSummary:"addPersonal"},this.$q.resolve()}this.menuItemPersonal=void 0}},e.prototype.populateMenuItemTeamNotSideload=function(e,t){var n=this;if(t.isInContextMode||t.isUpgrading||!a.checkIfAppHasScope("team",e))this.menuItemTeam=void 0;else if(this.shouldShowChannelItem(e))if(a.checkIfAppHasOnlyOneCapability(e,"inputExtensions"))this.menuItemTeam=void 0;else{var i=this.resources.strings.extension_addAppDialogV3_button_add_to_team;this.enableAddAppInManageTeamsApp&&t.shouldShowAddToAnotherTeam&&(i=this.resources.strings.extension_addAppDialogV3_button_add_to_another_team),this.menuItemTeam={onClick:function(){n.loggingService.newScenario(n.constants.scenarios.extensibility.apps.addAppDialogAddButton.menuItemTeamNotSideload).stop(),n.openTeamOrChannelPicker(e.id,t,teamspace.components.AppInstallScope.Team)},text:this.$translate.instant(i),iconUrl:"svg/icons-teams.html",trackSummary:"addTeam"}}},e.prototype.shouldShowChannelItem=function(e){return!!a.hasScope("team",e.bots)||(!!a.hasScope("team",e.connectors)||!(!a.hasScopeWithNoContextTab("team",e.galleryTabs)&&!a.hasScopeWithContextTab("team",r.ChannelTab,e.galleryTabs)))},e.prototype.shouldShowMeetingItem=function(e){return!!a.hasScope("groupchat",e.bots)||!!a.isMeetingOptimized(e)},e.prototype.shouldShowGroupChatItem=function(e){return!!a.hasScope("groupchat",e.bots)||!(!a.hasScopeWithNoContextTab("groupchat",e.galleryTabs)&&!a.hasScopeWithContextTab("groupchat",r.PrivateChatTab,e.galleryTabs))},e.prototype.populateMenuItemTeamSideload=function(e,t){var n=this;if(!t.isInContextMode&&a.checkIfAppHasScope("team",e)){if(this.shouldShowChannelItem(e))if(a.checkIfAppHasOnlyOneCapability(e,"inputExtensions"))this.menuItemTeam=void 0;else{this.menuItemTeam={onClick:function(){n.loggingService.newScenario(n.constants.scenarios.extensibility.apps.addAppDialogAddButton.menuItemTeamSideload).stop(),n.openTeamOrChannelPicker(e.id,t,teamspace.components.AppInstallScope.Team)},text:this.$translate.instant(this.resources.strings.extension_addAppDialogV3_button_add_to_team),iconUrl:"svg/icons-teams.html",trackSummary:"addTeam"}}}else this.menuItemTeam=void 0},e.prototype.populateMenuItemGroupChatNotSideload=function(e,t){var n=this;if(t.isInContextMode||t.isUpgrading||!a.checkIfAppHasScope("groupchat",e))this.menuItemGroupChat=void 0;else if(this.shouldShowGroupChatItem(e)){this.menuItemGroupChat={onClick:function(){n.loggingService.newScenario(n.constants.scenarios.extensibility.apps.addAppDialogAddButton.menuItemGroupChatNotSideload).stop(),n.openTeamOrChannelPicker(e.id,t,teamspace.components.AppInstallScope.GroupChat)},text:this.$translate.instant(this.resources.strings.extension_addAppDialogV3_button_add_to_chat),iconUrl:"svg/icons-chat.html",trackSummary:"addGroupChat"}}},e.prototype.populateMenuItemGroupChatSideload=function(e,t){var n=this;if(!t.isInContextMode&&a.checkIfAppHasScope("groupchat",e)){if(this.shouldShowGroupChatItem(e)){this.menuItemGroupChat={onClick:function(){n.loggingService.newScenario(n.constants.scenarios.extensibility.apps.addAppDialogAddButton.menuItemGroupChatSideload).stop(),n.openTeamOrChannelPicker(e.id,t,teamspace.components.AppInstallScope.GroupChat)},text:this.$translate.instant(this.resources.strings.extension_addAppDialogV3_button_add_to_chat),iconUrl:"svg/icons-chat.html",trackSummary:"addGroupChat"}}}else this.menuItemGroupChat=void 0},e.prototype.populateMenuItemMeetingNotSideload=function(e,t){var n=this;if(!t.isInContextMode&&this.shouldShowMeetingItem(e)){this.menuItemMeeting={onClick:function(){n.loggingService.newScenario(n.constants.scenarios.extensibility.apps.addAppDialogAddButton.menuItemMeetingNotSideload).stop(),n.openTeamOrChannelPicker(e.id,t,teamspace.components.AppInstallScope.Meeting)},text:this.$translate.instant(this.resources.strings.extension_addAppDialogV3_button_add_to_meeting),iconUrl:"svg/icons-calendar.html",trackSummary:"addMeeting"}}else this.menuItemMeeting=void 0},e.prototype.populateMenuItemMeetingSideload=function(e,t){var n=this;if(!t.isInContextMode&&this.shouldShowMeetingItem(e)){this.menuItemMeeting={onClick:function(){n.loggingService.newScenario(n.constants.scenarios.extensibility.apps.addAppDialogAddButton.menuItemMeetingSideload).stop(),n.openTeamOrChannelPicker(e.id,t,teamspace.components.AppInstallScope.Meeting)},text:this.$translate.instant(this.resources.strings.extension_addAppDialogV3_button_add_to_meeting),iconUrl:"svg/icons-calendar.html",trackSummary:"addMeeting"}}else this.menuItemMeeting=void 0},e.prototype.populateMenuItemInContext=function(e,t){var n=this;if(t.isInContextMode){this.menuItemInContext={onClick:function(){t.teamId&&!t.channelId&&n.settingsService.valueAsBoolean(n.constants.settings.names.enableChannelIdSupportAppInstallation)?n.openTeamOrChannelPicker(e.id,t,teamspace.components.AppInstallScope.Team):(n.updateMru(e.id),"not-sideload"===t.flow?n.onClickInContextNotSideload(e,t):n.onClickInContextSideload(e,t))},text:this.$translate.instant(this.resources.strings.extension_addAppDialogV3_button_add),trackSummary:"inContext"}}else this.menuItemInContext=void 0},e.prototype.onClickInContextSideload=function(e,t){var n=this,i=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.addAppDialogAddButton.menuItemInContextSideload);this.isInstallingOrUpgrading=!0;var a=this.$q.resolve(!1);this.enableAppsInstalledByCurrentUser&&(i.mark("simple app model enabled"),a=a.then(function(){return n.ensureAppIsSideloadedForPersonal(e,t.manifestZipFile,n.enableContainerApps)}).then(function(e){return!!e})),a.then(function(a){var s=[];a&&s.push(teamspace.components.PanelAppScope.personal);var r;if(t.teamId)i.mark("sideload to team"),s.push(teamspace.components.PanelAppScope.team),r=o.sideloadAppToTeam({$q:n.$q,appsService:n.appsService,extensionManifestService:n.extensionManifestService},e,t.manifestZipFile,t.teamId,t.channelId);else{if(!t.chatId)return n.$q.reject("should not happen");i.mark("sideload to chat"),s.push(teamspace.components.PanelAppScope.group),r=o.sideloadAppToChat({$q:n.$q,appsService:n.appsService,extensionManifestService:n.extensionManifestService},e,t.manifestZipFile,t.chatId)}return r.then(function(){return s})}).then(function(e){var a={installSucceeded:!0};n.$scope.$parent.closeThisDialog(a),t.onSideloadTriggered(null,e),i.stop()}).catch(function(e){t.onSideloadTriggered(e),n.logger.error("sideload for personal failed "+e),i.fail({error:e,error1:e})}).finally(function(){return n.isInstallingOrUpgrading=!1})},e.prototype.onClickInContextNotSideload=function(e,t){var n=this,i=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.addAppDialogAddButton.menuItemInContextNotSideload);this.isInstallingOrUpgrading=!0;var a,s=this.$q.resolve(!1);this.enableAppsInstalledByCurrentUser&&(i.mark("simple app model enabled"),s=s.then(function(){return n.ensureAppIsInstalledForPersonal(e,n.enableContainerApps)})),t.teamId?(i.mark("has teamId. start to create team app entitlement"),a=s.then(function(a){return n.appsService.createTeamAppEntitlement(t.teamId,e,t.channelId).then(function(){if(t.onInstallTriggered(null,a?[teamspace.components.PanelAppScope.personal,teamspace.components.PanelAppScope.team]:[teamspace.components.PanelAppScope.team]),i.mark("created team entitlement"),t.channelId){i.mark("start to open in context gallery");s={installSucceeded:!0,appId:e.id};n.$scope.$parent.closeThisDialog(s)}else{i.mark("start to open connector settings page");var s={installSucceeded:!0,appId:e.id};n.$scope.$parent.closeThisDialog(s)}})})):t.chatId?(i.mark("has chatId. start to create group chat app entitlement"),a=s.then(function(a){return n.appsService.createGroupChatAppEntitlement(t.chatId,e).then(function(){t.onInstallTriggered(null,a?[teamspace.components.PanelAppScope.personal,teamspace.components.PanelAppScope.group]:[teamspace.components.PanelAppScope.group]),i.mark("group chat entitlement created. start to open configurable tab");var s={installSucceeded:!0,appId:e.id};n.$scope.$parent.closeThisDialog(s)})})):(i.mark("has no team or chat id. this should come from messaging extension flyout, including search and featured items"),a=s.then(function(t){return n.enableAppsInstalledByCurrentUser?t:n.ensureAppIsInstalledForPersonal(e,n.enableContainerApps)}).then(function(){t.onInstallTriggered(null),i.mark("in-context installed messaging extension");var a={installSucceeded:!0,appId:e.id};n.$scope.$parent.closeThisDialog(a)})),a.then(function(){return i.stop()}).catch(function(a){t.onInstallTriggered(a),n.logger.error("in-context failed "+a),a&&a.data&&a.data.errorCode===n.appIsTenantAdminBlocked?i.stop():i.fail({error:a,error1:a}),a&&a.data&&a.data.errorCode?n.openV3ErrorDialog(a.data.errorCode,void 0,"install",e.name):n.openV3ErrorDialog("something-wrong")}).finally(function(){return n.isInstallingOrUpgrading=!1})},e.prototype.populateMenuItemList=function(){this.buttonMenuItems=_.filter([this.menuItemUpgrade,this.menuItemPersonal,this.menuItemTeam,this.menuItemGroupChat,this.menuItemInContext,this.menuItemMeeting],function(e){return!!e}),this.enableDefaultFieldsInAppDefinition&&this.defaultInstallScope&&this.defaultInstallScope.toString()&&this.updateDefaultInstallScope(this.defaultInstallScope.toString().toLowerCase())},e.prototype.updateDefaultInstallScope=function(e){var t,n=[],i=(t={},t["Team".toString().toLowerCase()]=this.menuItemTeam,t["GroupChat".toString().toLowerCase()]=this.menuItemGroupChat,t["Personal".toString().toLowerCase()]=this.menuItemPersonal,t["Meetings".toString().toLowerCase()]=this.menuItemMeeting,t);if(this.buttonMenuItems&&this.buttonMenuItems.length>1){var a=i[e];a&&(n.push(a),n=n.concat(this.buttonMenuItems.filter(function(e){return e.trackSummary!==a.trackSummary})),this.buttonMenuItems=n,e!=="Personal".toString().toLowerCase()&&this.updatePersonalMenuItemTextInDropdown())}},e.prototype.updatePersonalMenuItemTextInDropdown=function(){var e=this,t=this.buttonMenuItems.find(function(t){return t.text===e.$translate.instant(e.resources.strings.extension_addAppDialogV3_button_add)});t&&(t.text=this.$translate.instant(this.resources.strings.extension_addAppDialogV3_button_add_for_me))},e.prototype.ensureAppIsInstalledForPersonal=function(e,t,n){var i=this;return this.isInstallingOrUpgrading=!0,o.ensureAppIsInstalledForPersonal({$q:this.$q,$timeout:this.$timeout,appsService:this.appsService,settingsService:this.settingsService,constants:this.constants,conversationsService:this.conversationsService,conversationsStore:this.conversationsStore,inputExtensionService:this.inputExtensionService,logger:this.logger,userAppsDispatcher:this.userAppsDispatcher,loggingService:this.loggingService,utilityService:this.utilityService},e,t,n,this.dontCreateConversationOnBotInstallation).finally(function(){return i.isInstallingOrUpgrading=!1})},e.prototype.isAppInstalledForPersonal=function(e){return o.isAppInstalledForPersonal(this.appsService,e)},e.prototype.ensureAppIsSideloadedForPersonal=function(e,t,n,i){if(this.enableTrustedSideloading&&i&&i.templateInstanceId&&i.appId||this.enablePartnerAppCatalogBrowse&&i&&i.templatedAppId){var a=i.templateInstanceId?i.appId:i.templatedAppId;return o.ensureAppIsSideloadedForPersonal({$q:this.$q,appsService:this.appsService,templatedAppsService:this.templatedAppsService,extensionManifestService:this.extensionManifestService,logger:this.logger,userAppsDispatcher:this.userAppsDispatcher},e,t,n,a,this.enablePartnerAppsBrowseInstallDialogUIFix)}return o.ensureAppIsSideloadedForPersonal({$q:this.$q,appsService:this.appsService,templatedAppsService:this.templatedAppsService,extensionManifestService:this.extensionManifestService,logger:this.logger,userAppsDispatcher:this.userAppsDispatcher},e,t,n)},e.prototype.openV3ErrorDialog=function(e,t,n,i){if(!t)if(this.$scope.closeThisDialog){var a={installSucceeded:!1};this.$scope.closeThisDialog(a)}else this.dialogService.close(this.constants.lazyDialogs.addAppNew);this.dialogService.openLazyDialog(this.constants.lazyDialogs.addAppNewError,this.constants.lazyModules.extensibilityDialogs,{errorType:e,operation:n,appName:i,isMeeting:this.isMeeting})},e}();t.AddButtonController=c;angular.module("teamspace.addAppDialogV3.addButton",[]).directive("tsAddAppDialogAddButton",function(){return{restrict:"E",templateUrl:l,controller:c,controllerAs:"ctrl",scope:{addButtonAttrs:"<?",dropdownStateChanged:"&?"}}}).run(["$templateCache",function(e){e.put(l,i)}])},2633:function(e,t){e.exports='<div ng-if="ctrl.buttonMenuItems && ctrl.buttonMenuItems.length" class="ts-add-app-dialog-add-button-container">\n  <div class="ts-add-app-dialog-add-button">\n    <button role="button" ng-init="mainItem = ctrl.buttonMenuItems[0]" ng-click="mainItem.onClick()" ng-class="{\'ts-add-app-dialog-add-button-hasdropdown\': ctrl.buttonMenuItems.length > 1}" ng-disabled="ctrl.isInstallingOrUpgrading || ctrl.$scope.addButtonAttrs.isAppDisabled" data-tid="add-app-dialog-v3-add-button" class="ts-btn ts-btn-fluent ts-btn-fluent-primary ts-add-app-dialog-add-button-main" track-scenario="{{::$root.trackConstants.trackScenario.addAppDialogV3AddButton}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.appMgmt}}" track-summary="{{mainItem.trackSummary}}">\n      {{mainItem.text}}\n      <busy-animation size="small" ng-if="ctrl.isInstallingOrUpgrading"></busy-animation>\n    </button>\n    \x3c!-- we probably don\'t want to track arrow button click --\x3e\n    <button ng-if="ctrl.buttonMenuItems.length > 1" ng-click="ctrl.toggleDropdown($event)" ng-disabled="ctrl.isInstallingOrUpgrading || ctrl.$scope.addButtonAttrs.isAppDisabled" ng-keydown="ctrl.onKeyboard($event)" class="ts-btn ts-btn-fluent ts-btn-fluent-primary ts-add-app-dialog-add-button-arrow" aria-label="{{::$root.resources.strings.icons_more | translate}}" data-tid="add-app-dialog-v3-add-button-dropdown-arrow" track-scenario="{{::$root.trackConstants.trackScenario.addAppDialogV3SelectDropdownButton}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.appMgmt}}" track-summary="{{mainItem.trackSummary}}">\n      <svg-include src="\'svg/icons-triangle-down-small.html\'"></svg-include>\n    </button>\n  </div>\n\n  <div ng-if="ctrl.shouldShowDropdown" ng-keydown="ctrl.onKeyboard($event)" data-tid="add-app-dialog-v3-add-button-dropdown" class="ts-add-app-dialog-add-button-dropdown">\n    <ul role="menu">\n      <li role="none" tabindex="-1" ng-repeat="item in ctrl.buttonMenuItems.slice(1)">\n        <button role="menuitem" class="ts-add-app-dialog-add-button-menu-item" data-tid="add-app-dialog-v3-add-button-dropdown-menu-item" aria-label="{{item.text}}" ng-click="item.onClick($event)" track-scenario="{{::$root.trackConstants.trackScenario.addAppDialogV3AddButton}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.appMgmt}}" track-summary="{{item.trackSummary}}">\n          <ng-include src="item.iconUrl"></ng-include>\n          <span>{{item.text}}</span>\n        </button>\n      </li>\n    </ul>\n  </div>\n</div>'},2634:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2635),a=n(31),s=function(){function e(e,t,n,i){this.suppressDefaultButton=!1;var a=e.ngDialogData;"app-not-found"===a.errorType?this.strTitle=t.instant(i.strings.extension_addAppDialogV3_error_appNotFound):a.errorType===n.extensibility.apps.errorCodes.appBlockedByTenantAdmin?this.strTitle=t.instant(i.strings.extension_tenantAppBlockedMessage):a.errorType===n.extensibility.apps.errorCodes.resourceSpecificPermissionsMismatch?this.strTitle=t.instant(i.strings.extension_resourceSpecificPermissionsMismatch):a.errorType===n.extensibility.apps.errorCodes.webApplicationInfoIdModificationNotAllowedForAppSideloadedInTeam?this.strTitle=t.instant(i.strings.extension_webApplicationInfoIdModificationNotAllowedForAppSideloadedInTeam):a.errorType===n.extensibility.apps.errorCodes.webApplicationInfoIdConflictOnSideloadingIntoTeam?this.strTitle=t.instant(i.strings.extension_webApplicationInfoIdConflictOnSideloadingIntoTeam):a.errorType===n.extensibility.apps.errorCodes.grantOfResourceSpecificPermissionsFailed?this.strTitle=t.instant(i.strings.extension_grantOfResourceSpecificPermissionsFailed):a.errorType===n.extensibility.apps.errorCodes.userNotAuthorizedToRevokeResourceSpecificPermissions?this.strTitle=t.instant(i.strings.extension_userNotAuthorizedToRevokeResourceSpecificPermissions):a.errorType===n.extensibility.apps.errorCodes.webApplicationInfoIdOfSideloadedAppMustBeInTheSameTenantAsUser?this.strTitle=t.instant(i.strings.extension_webApplicationInfoIdOfSideloadedAppMustBeInTheSameTenantAsUser):a.errorType===n.extensibility.apps.errorCodes.invalidGrantResourceSpecificPermissionsRequest?this.strTitle=t.instant(i.strings.extension_invalidGrantResourceSpecificPermissionsRequest):a.errorType===n.extensibility.apps.errorCodes.invalidResourceSpecificPermission?this.strTitle=t.instant(i.strings.extension_invalidResourceSpecificPermission):a.errorType!==n.extensibility.apps.errorCodes.userNotAuthorizedToGrantResourceSpecificPermissions&&a.errorType!==n.extensibility.apps.errorCodes.appInstalledButRscGrantFailed&&a.errorType!==n.extensibility.apps.errorCodes.userNotAuthorizedToModifyResourceSpecificPermissions&&a.errorType!==n.extensibility.apps.errorCodes.RscPermissionsWriteFailed||"install"!==a.operation&&"upgrade"!==a.operation?"something-wrong"==a.errorType?(this.strTitle=t.instant(i.strings.extension_addAppDialogTitleErrorMessage),this.subTitle=t.instant(i.strings.extension_addAppDialogSubtitleErrorMessage)):a.errorType==n.extensibility.apps.errorCodes.appEntitlementAlreadyExists?this.strTitle=t.instant(i.strings.extension_addAppDialog_appEntitlementAlreadyExists):(a.isMeeting||a.isGroupChat)&&a.errorType==n.extensibility.apps.errorCodes.noPermissionToInstallApp||a.errorType==n.extensibility.apps.errorCodes.noPermissionToUpgradeApp?(this.strTitle=t.instant(i.strings.extension_noPermissionToManageAppInMeetingInfo),this.subTitle=t.instant(i.strings.extension_noPermissionToManageAppInMeetingErrorMessage)):"no-error"===a.errorType&&"add-notification-only-bot"===a.operation?(this.strTitle=t.instant(i.strings.extensibility_addedOneWayBotToTeamOrChat),this.subTitle=t.instant(i.strings.extensibility_addedOneWayBotToTeamOrChatMessage),this.secondaryButtonText=t.instant(i.strings.extensibility_app_notification_only_bot_dialog_button),this.suppressDefaultButton=!0):a.errorType===n.extensibility.apps.errorCodes.noPermissionToManageTabInMeeting?(this.strTitle=t.instant(i.strings.extension_noPermissionToManageAppInMeetingInfo),this.subTitle=t.instant(i.strings.extension_noPermissionToManageAppTabInMeetingErrorMessage)):a.errorType===n.extensibility.apps.errorCodes.tabManagementPermissionsApiFailure?(this.strTitle=t.instant(i.strings.extension_tabManagementPermissionAPIFailureMessage),this.secondaryButtonText=t.instant(i.strings.extensibility_tab_managementPermissionsApiFailure_dialog_button),this.suppressDefaultButton=!0):a.errorType===n.extensibility.apps.errorCodes.participantMeetingExpired?(this.subTitle=t.instant(i.strings.extension_meetingExpiredErrorMessage),this.secondaryButtonText=t.instant(i.strings.extensibility_tab_managementPermissionsApiFailure_dialog_button),this.suppressDefaultButton=!0):(a.isMeeting||a.isGroupChat)&&a.errorType==n.extensibility.apps.errorCodes.failedToCheckPermissionToManageApp?this.strTitle=t.instant(i.strings.extension_meetingDefaultPermissionErrorMessage):this.strTitle=t.instant(i.strings.extension_addAppDialogErrorMessage):this.strTitle="install"===a.operation?t.instant(i.strings.extension_addAppDialog_Permission_RSC_Error_Add_App,{appName:a.appName}):t.instant(i.strings.extension_addAppDialog_Permission_RSC_Error_Upgrade_App_Team,{appName:a.appName})}return e.$inject=["$scope","$translate","constants","resources"],e}();t.AddAppDialogV3ErrorController=s;a.module("teamspace.addAppDialogV3.errorDialog",[]).directive("tsErrorDialogs",function(){return{restrict:"E",controller:s,controllerAs:"ctrl",scope:{ErrorDialogData:"<?"}}}).run(["constants","dialogService","$templateCache","settingsService",function(e,t,n,a){a.valueAsBoolean(e.settings.names.enableNewAppInstallFlowV3)&&(n.put("components/extensibility/add-app-new-dialog/error-dialog.html",i),t.register(e.lazyDialogs.addAppNewError,{template:"components/extensibility/add-app-new-dialog/error-dialog.html",className:"ts-modal-dialog custom-width ts-add-app-dialog-error",closeByEscape:!0,closeByDocument:!0,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"modalDialog-title"}))}]).controller("AddAppDialogV3ErrorController",s)},2635:function(e,t){e.exports='<div class="ts-add-app-dialog-error" ng-controller="AddAppDialogV3ErrorController as ctrl" aria-modal="true" acc-role="dialog">\n  <modal-dialog dialog-title="{{ctrl.strTitle}}" suppress-default-button="ctrl.suppressDefaultButton" secondary-button-text="{{ctrl.secondaryButtonText}}">\n    <div ng-if="ctrl.subTitle">\n      <p>\n        {{ctrl.subTitle}}\n      </p>\n    </div>\n  </modal-dialog>\n</div>'},2636:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,n,i){function a(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function r(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?n(e.value):a(e.value).then(o,r)}l((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,s&&(o=2&n[0]?s.return:n[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,s=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],s=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,s,o,r,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r};Object.defineProperty(t,"__esModule",{value:!0});var o=n(2637),r=n(55),l=n(31),p=n(55),c=n(260),d=n(2638),g="ts-add-app-details-v3-scrolled",u=".ts-add-app-dialog-v3-about",h=".ts-add-app-dialog-v3-more-from-developer",m=".ts-add-app-dialog-v3-privacy",v=["TeamSettings","ChannelSettings","Channel","ChannelMessage","TeamsTab","Member","Owner","TeamMember","TeamsAppInstallation","File","ChatMember","ChatMessage","ChatSettings","Chat","OnlineMeeting","CameraStream","OutgoingVideoStream","InAppPurchase","TeamsActivity","OnlineMeetingParticipant","ChannelMeeting","Calls","MeetingStage","ChannelMeetingStage","MicrophoneStream","OnlineMeetingIncomingAudio","ChannelMeetingIncomingAudio","OnlineMeetingActiveSpeaker","ChannelMeetingActiveSpeaker","ChannelMeetingAudioVideo","LiveShareSession","MeetingParticipantReaction","OnlineMeetingNotification","ChannelMeetingNotification","ChatMessageReadReceipt"],f=["Read","Create","ReadWrite","Delete","Manage","ReadBasic","ToggleIncomingAudio","Write","Allow","Send","AccessMedia","JoinGroupCalls","Detect","Stream"],b=["Group","Chat","User"],y="Did not find app entitlement or app definition",S=function(){function e(e,t,n,i,a,s,o,r,l,p,c,d,u,h,m,v,f,b,y,S,A,D,C,I,T,P,x,w,k,M){var $=this;this.$injector=e,this.$ocLazyLoad=t,this.$q=n,this.$scope=i,this.$timeout=a,this.$translate=s,this.$window=o,this.appDebugService=r,this.analyticsService=l,this.appsService=p,this.templatedAppsService=c,this.authenticationService=d,this.constants=u,this.dialogService=h,this.extensionTabHelperService=m,this.htmlSanitizer=v,this.extensionManifestService=b,this.localizationService=y,this.loggingService=S,this.resources=A,this.settingsService=D,this.teamMembershipPropertiesService=C,this.tenantService=I,this.utilityService=T,this.peopleSlugService=P,this.experienceContainerFeatureService=x,this.appsRatingReviewService=k,this.tooltipService=M,this.appHasTeamScope=!1,this.appHasGroupChatScope=!1,this.enableContainerAppDetailsView=!1,this.isDropdownOpen=!1,this.isInstallationEventLogged=!1,this.currentTenantId="",this.enableComplementaryAppSuggestions=!1,this.complementaryAppList=[],this.onScrollEventName=g,this.hasConfigurableTab=!1,this.hasBot=!1,this.hasMessagingExtension=!1,this.hasConnector=!1,this.hasStaticTab=!1,this.containerAppNames=[],this.hasMeeting=!1,this.shouldShowCarousel=!1,this.isLargeMediaView=!1,this.isMediaPotential=!0,this.isAboutActive=!0,this.isMoreFromDeveloperActive=!1,this.isPrivacyActive=!1,this.isScrolledToTop=!0,this.isScrolledToBottom=!0,this.largeImageUrl="",this.largeImageUrlUseNgInclude=!1,this.moreAppsFromDeveloper=[],this.moreComplementaryApps=[],this.navigationMenuItems=[],this.screenshotUrls=[],this.videoUrls=[],this.carouselState={},this.strAccentColor="",this.strAppTagline="",this.strAppDetail="",this.strCategoriesOrTenant="",this.strCertificationStatus="",this.certificationIcon="",this.strCreatedBy="",this.strAbout="",this.strMoreFromDeveloper="",this.strComplementaryApps="",this.strPrivacyTitle="",this.strPrivacyDescription="",this.strExistingPermissionList=[],this.strAdditionalPermissionList=[],this.strName="",this.strNavAbout="",this.strNavMoreFromDeveloper="",this.strNavComplementaryApps="",this.strNavPrivacy="",this.strVersion="",this.strHeaderMessage="",this.strMessageIcon="",this.supportedLanguages=[],this.showSubscriptionPlans=!1,this.showLoadingSpinner=!1,this.showManageSubscription=!1,this.hasPermissionList=!1,this.strPreviewOfferErrorMessage="",this.strPreviewOfferErrorMessageIcon="",this.hasFreeTrials=!1,this.hasPrivatePlans=!1,this.isMultihubApp=!1,this.offer=null,this.setScrollActive=_.throttle(function(e){switch($.isAboutActive=!1,$.isMoreFromDeveloperActive=!1,$.isPrivacyActive=!1,e){case"about":$.isAboutActive=!0;break;case"more":$.isMoreFromDeveloperActive=!0;break;case"privacy":$.isPrivacyActive=!0}},1e3),this.fallbackIcon=u.fallbackImages.appFallbackImage;var E=i.ngDialogData;this.enableContainerAppDetailsView=D.valueAsBoolean(u.settings.names.enableContainerAppDetailsView),this.enableRSCPermissions=D.valueAsBoolean(u.settings.names.enableRSCPermissions),this.enableTenantOwnedApps=D.valueAsBoolean(u.settings.names.enableTenantOwnedApps),this.enablePartnerAppCatalogBrowse=D.valueAsBoolean(u.settings.names.enablePartnerAppCatalogBrowse),this.enableTrustedSideloading=D.valueAsBoolean(u.settings.names.enableTrustedSideloading),this.enableMonetization=D.valueAsBoolean(u.settings.names.enableMonetization),this.enableAddToMeeting=D.valueAsBoolean(u.settings.names.enableAddToMeeting),this.enableAddAppInManageTeamsApp=D.valueAsBoolean(u.settings.names.enableAddAppInManageTeamsApp),this.enableSceneAppsInStore=D.valueAsBoolean(u.settings.names.enableSceneAppsInStore),this.enableViewAppRating=D.valueAsBoolean(u.settings.names.enableViewAppRating),this.logger=S.newLogger("add-app-dialog-v3"),this.enableComplementaryAppSuggestions=D.valueAsBoolean(u.settings.names.enableComplementaryAppSuggestions),this.strNavComplementaryApps=s.instant(A.strings.extension_addAppDialogV3_navigation_complementaryApps),this.strComplementaryApps=s.instant(A.strings.extension_addAppDialogV3_complementaryApps),f.$on(i,g,this.onScrolled.bind(this)),this.stateParams=w.getRootRouteParams(),this.dialogData=E,this.tooltipId=T.generateUUID(),this.tooltipText=s.instant(A.strings.extension_addAppDialogV3_specialOfferToolTipText);var F=S.newScenario(u.scenarios.extensibility.apps.addAppDialog.v3Populate);F.appendEventData({caller:teamspace.components.AddAppDialogEntryPoint[E.entryPoint]});var B;E.entryPoint===teamspace.components.AddAppDialogEntryPoint.Store?B=this.handleStoreFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.StoreWorkflows?B=this.handleStoreWorkflowFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.InContextGalleryDialogFromChannel?B=this.handleInContextGalleryDialogFromChannelFlow(E,F):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.InContextGalleryDialogFromGroupChat?B=this.handleInContextGalleryDialogFromGroupChatFlow(E,F):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.InContextGalleryDialogMoreAppsFromChannel?B=this.handleInContextGalleryDialogMoreAppsFromChannelFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.InContextGalleryDialogMoreAppsFromGroupChat?B=this.handleInContextGalleryDialogMoreAppsFromGroupChatFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.Flyout?B=this.handleFlyoutFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.AppsManagementTabView?B=this.handleAppsManagementTabViewFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.ChannelInfoPaneAppWidgetView?B=this.handleAppsManagementTabViewFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.GroupChatAppsManagementView?B=this.handleGroupChatAppsManagementViewFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.MoreAppFromSameDeveloper||E.entryPoint===teamspace.components.AddAppDialogEntryPoint.MoreAppsUsedTogether?B=this.handleMoreAppFromSameDeveloperFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.MessagingExtensionFlyoutFromChannel?B=this.handleMessagingExtensionFlyoutFromChannelFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.MessagingExtensionFlyoutFromChat?B=this.handleMessagingExtensionFlyoutFromChatFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.StoreSideload?B=this.handleStoreSideloadFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.DeepLink?B=this.handleDeepLinkFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.StageDeepLink?B=this.handleStageDeepLinkFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.ConnectorManagementDialog?B=this.handleConnectorManagementFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.AppsManagementTabUpgrade?B=this.handleAppsManagementTabUpgradeFlow(E,F):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.ChannelInfoPaneAppWidgetUpgrade?B=this.handleChannelInfoPaneAppWidgetUpgradeFlow(E,F):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.GroupChatAppsManagementUpgrade?B=this.handleGroupChatAppsManagementUpgradeFlow(E,F):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.JITInstallFromPersonalFlyout?B=this.handleJITAppsListFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.AppsList?B=this.handleAppsListFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.TabSdkSideload?B=this.handleTabSdkSideloadFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.AppsManagementTabFromTeam?B=this.handleAppsManagementTabFromTeamFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.AppsManagementTabFromGroupChat?B=this.handleAppsManagementTabFromGroupChatFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.AppSuggestionInEmptyChannel?B=this.handleAppSuggestionInEmptyChannel(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.MeetingFromGroupchat?B=this.handleMeetingFlowFromGroupchat(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.MeetingFromTeam?B=this.handleMeetingFlowFromTeam(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.MessagingExtensionFeaturedItem?B=this.handleMessagingExtensionFeaturedItemFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.NewMessageUpgrade?B=this.handleNewMessageUpgradeFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.AtMentionDirectInstallationFromTeam?B=this.handleAtMentionDirectInstallationFromTeamFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.AtMentionDirectInstallationFromGroupChat?B=this.handleAtMentionDirectInstallationFromGroupChatFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.PersonalAppBannerUpgrade?B=this.handlePersonalAppBannerUpgradeFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.PersonalFlyoutAppSearch||E.entryPoint===teamspace.components.AddAppDialogEntryPoint.PersonalFlyoutAppSuggestions?B=this.handleAppsListAndBarFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.MessagingExtensionFlyoutV2?B=this.handleMessagingExtensionFlyoutV2Flow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.AppsManagementTabFromTeamSideload?B=this.handleAppsManagementTabFromTeamSideload(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.AppsManagementTabFromGroupChatSideload?B=this.handleAppsManagementTabFromGroupChatSideload(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.PersonalAppAbout?B=this.handlePersonalAppAboutFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.PowerBar?B=this.handlePowerBar(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.ManageAppsInstalledApp?B=this.handleManageAppsInstalledApp(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.ManageAppsInstalledAppUpgrade?B=this.handleManageAppsUpgradeFlow(E,F):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.LobNotifications?B=this.handleLobNotificationsFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.OnboardingNotifications?B=this.handleOnboardingNotificationsFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.ConsentPromptFooter?B=this.handleConsentPromptFooterFlow(E):E.entryPoint===teamspace.components.AddAppDialogEntryPoint.StoreEditorialArticles?B=this.handleStoreEditorialArticlesFlow(E):(F.mark("legacy flow",{action:E.action,appId:E.appID,teamId:E.teamId,source:E.source,messageId:E.messageId,channelId:E.channelId,chatId:E.chatId,category:E.category,intent:E.intent,preselectTeam:E.preselectTeam,preselectChat:E.preselectChat,preselectChannel:E.preselectChannel,installOptionFlags:E.installOptionFlags,viewOnly:E.viewOnly}),B=this.handleLegacyFlow(E)),B.then(function(){$.hasSubscriptionOffer()&&I.getCurrentTenantId().then(function(e){if($.currentTenantId=e,D.valueFor(u.settings.names.monetizationConstants).tenantIdsAllowedForSideloadPurchase.includes($.currentTenantId))$.loadSubscriptionPlans($.appDefinition);else{var t=teamspace.services.AppsServiceUtils.getAppType($.appDefinition);t===teamspace.services.AppDefinitionType.GlobalApp?$.loadSubscriptionPlans($.appDefinition):t===teamspace.services.AppDefinitionType.CustomApp&&$.loadPreviewOfferPlans($.appDefinition)}}).catch(function(e){$.logger.error("Error in fetching tenantId for currently active tenant: {0}",e)})}).then(function(){F.stop()}).catch(function(e){e&&e.data&&e.data.errorCode===u.extensibility.apps.errorCodes.templatedAppNotAllowedByTenantSettings?$.openErrorDialog(u.extensibility.apps.errorCodes.appBlockedByTenantAdmin):$.openErrorDialog("something-wrong"),F.fail({error:e})});var N=this.onKeydown.bind(this);o.addEventListener("keydown",N,!0),i.$on("$destroy",function(){$.isInstallationEventLogged||($.logViewFuncHandle=_.defer($.logViewAppActionForTelemetry.bind($))),o.removeEventListener("keydown",N,!0),$.getOfferPromise&&(teamspace.services.QCancelable.cancel($.getOfferPromise),$.getOfferPromise=null),$.getSubscriptionPromise&&(teamspace.services.QCancelable.cancel($.getSubscriptionPromise),$.getSubscriptionPromise=null)})}return e.$inject=["$injector","$ocLazyLoad","$q","$scope","$timeout","$translate","$window","appDebugService","analyticsService","appsService","templatedAppsService","authenticationService","constants","dialogService","extensionTabHelperService","htmlSanitizer","eventingService","extensionManifestService","localizationService","loggingService","resources","settingsService","teamMembershipPropertiesService","tenantService","utilityService","peopleSlugService","experienceContainerFeatureService","routeUtilityService","appsRatingReviewService","tooltipService"],Object.defineProperty(e.prototype,"navCtx",{get:function(){return"add-app-dialog-v3"},enumerable:!0,configurable:!0}),e.prototype.zoomInCarousel=function(){this.isLargeMediaView=!0,this.logOpenAppImageActionForTelemetry(this.carouselState.selectedIndex)},e.prototype.zoomOutCarousel=function(){this.isLargeMediaView=!1},e.prototype.dropdownStateChanged=function(e){this.isDropdownOpen=e},e.prototype.openSubscriptionPlansDialog=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){return this.enableMonetization&&(event.preventDefault(),this.logOpenSubscriptionDialogTelemetry(teamspace.components.PanelActionScenario.subscriptionPlansClicked.toString()),e={appdefinition:this.appDefinition,addAppDialogData:this.dialogData,sourceDialog:this.constants.lazyDialogs.addAppNew,offer:this.offer},this.dialogService.close(this.constants.lazyDialogs.addAppNew),this.dialogService.openLazyDialog(this.constants.lazyDialogs.subscriptionPlansDialog,this.constants.lazyModules.extensibilityDialogs,e)),[2]})})},e.prototype.openManageSubscriptionDialog=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){return this.enableMonetization&&this.activeSubscription&&this.activeSubscription.assetId&&(event.preventDefault(),this.dialogService.close(this.constants.lazyDialogs.addAppNew),e={appdefinition:this.appDefinition,addAppDialogData:this.dialogData,sourceDialog:this.constants.lazyDialogs.addAppNew,assetId:this.activeSubscription.assetId},this.dialogService.openLazyDialog(this.constants.lazyDialogs.manageSubscriptionDialog,this.constants.lazyModules.extensibilityDialogs,e)),[2]})})},e.prototype.navigateToManageSubscriptionsPage=function(){this.enableMonetization&&this.showManageSubscription&&(this.logOpenSubscriptionDialogTelemetry(teamspace.components.PanelActionScenario.manageSubscriptionsClicked.toString()),this.settingsService.valueAsBoolean(this.constants.settings.names.manageSubscriptionsInAdminCenter)&&this.activeSubscription.managePurchaseUrl?window.open(this.activeSubscription.managePurchaseUrl,"_blank"):this.openManageSubscriptionDialog())},e.prototype.openAnotherAppFromComplementaryAppSuggestion=function(e,t){t.preventDefault(),this.dialogService.close(this.constants.lazyDialogs.addAppNew);var n={appId:e,entryPoint:teamspace.components.AddAppDialogEntryPoint.MoreAppsUsedTogether,previousDialogData:this.dialogData};this.dialogService.openLazyDialog(this.constants.lazyDialogs.addAppNew,this.constants.lazyModules.extensibilityDialogs,n)},e.prototype.openAnotherAppFromDeveloper=function(e,t){t.preventDefault(),this.dialogService.close(this.constants.lazyDialogs.addAppNew);var n={appId:e,entryPoint:teamspace.components.AddAppDialogEntryPoint.MoreAppFromSameDeveloper,previousDialogData:this.dialogData};this.dialogService.openLazyDialog(this.constants.lazyDialogs.addAppNew,this.constants.lazyModules.extensibilityDialogs,n)},e.prototype.onMoreFromDeveloperKeyboard=function(e){var t=e.keyCode;if(t===this.constants.keyCodes.tab)return e.preventDefault(),e.stopPropagation(),void(e.shiftKey?r.focusLastFocusable(u):r.focusFirstFocusable(".ts-modal-dialog-header"));t!==this.constants.keyCodes.left?t!==this.constants.keyCodes.right||r.focusNextInTheList(".ts-add-app-dialog-v3-more-apps-list",".ts-add-app-dialog-v3-more-apps-item"):r.focusPreviousInTheList(".ts-add-app-dialog-v3-more-apps-list",".ts-add-app-dialog-v3-more-apps-item")},e.prototype.onImageTabOut=function(e){e?r.focusLastFocusable(".ts-add-app-dialog-v3-left-rail"):r.focusFirstFocusable(".ts-add-app-dialog-v3-created-by")},e.prototype.focusBackButton=function(){r.focusFirstFocusable(".ts-add-app-dialog-v3-footer")},e.prototype.navBtnKeyboard=function(e){var t=e.keyCode;if(t===this.constants.keyCodes.tab)return event.stopPropagation(),event.preventDefault(),void(e.shiftKey?this.showSubscriptionPlans&&!this.strPreviewOfferErrorMessage?r.focusFirstFocusable(".ts-subscription-plans-button-container"):r.focusFirstFocusable(".ts-add-app-dialog-v3-left-rail-container"):r.focusFirstFocusable(".ts-add-app-dialog-v2-left-rail-footer"));t!==this.constants.keyCodes.up?t!==this.constants.keyCodes.down||r.focusNextInTheList(".ts-add-app-dialog-v3-left-rail-navigation",".ts-add-app-dialog-v3-left-rail-navigation-item"):r.focusPreviousInTheList(".ts-add-app-dialog-v3-left-rail-navigation",".ts-add-app-dialog-v3-left-rail-navigation-item")},e.prototype.scrollToAbout=function(e){if(e){if(e.keyCode!==this.constants.keyCodes.enter)return;r.focusFirstFocusable(u)}this.scroll(u),this.setScrollActive("about")},e.prototype.scrollToMoreFromDeveloper=function(e){if(e){if(e.keyCode!==this.constants.keyCodes.enter)return;r.focusFirstFocusable(h)}this.scroll(h),this.setScrollActive("more")},e.prototype.scrollToComplementaryApps=function(e){if(e){if(e.keyCode!==this.constants.keyCodes.enter)return;r.focusFirstFocusable(h)}this.scroll(h),this.setScrollActive("more");var t={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.nav.toString(),teamspace.components.PanelActionOutcome,this.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.navigateToComplementaryAppSuggestion.toString(),teamspace.components.PanelActionScenario,this.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.complementaryApps.toString(),teamspace.components.PanelActionScenarioType,this.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.complementaryApps.toString(),teamspace.components.PanelModuleName,this.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.complementaryApps.toString(),teamspace.components.PanelModuleType,this.loggingService),summary:"clicked on more often used together link"}};this.analyticsService.onPanelAction(this.$scope,t)},e.prototype.scrollToPrivacy=function(e){if(e){if(e.keyCode!==this.constants.keyCodes.enter)return;r.focusFirstFocusable(m)}this.scroll(m),this.setScrollActive("privacy")},e.prototype.scroll=function(e){var t=l.element(".scroll-region-container");t.ready(function(n){var i=n.find(e);t&&t.length&&i&&i.length&&(t[0].scrollTop=i[0].offsetTop)})},e.prototype.onScrolled=function(e,t){var n=this,i=t.scrollTop,a=t.scrollBottom;l.element(".ts-add-app-dialog-v3-scrolling-plate").ready(function(e){n.$scope.$apply(function(){if(n.isScrolledToTop=0===i,n.isScrolledToBottom=0===a,!n.isScrolledToTop||!n.isScrolledToBottom)if(n.isScrolledToTop)n.setScrollActive("about");else{var t=e.find(m);if(t&&t.length&&i>=t[0].offsetTop||n.isScrolledToBottom)n.setScrollActive("privacy");else{var s=e.find(h);s&&s.length&&i>=s[0].offsetTop&&n.setScrollActive("more")}}})})},e.prototype.onKeydown=function(e){e.keyCode===this.constants.keyCodes.escape&&(this.isLargeMediaView?(this.zoomOutCarousel(),this.$scope.$digest()):this.backToInContextGalleryBtn?this.backToInContextGalleryBtn.onClick():this.isDropdownOpen||this.dialogService.close(this.constants.lazyDialogs.addAppNew,"$escKey"))},e.prototype.handleLegacyFlow=function(e){var t=_.cloneDeep(e);return t.teamName=e.teamName?"has team name":"no team name",this.logger.error("Unknown legacy flow",t),e.appID?this.handleStoreFlow({appId:e.appID,entryPoint:teamspace.components.AddAppDialogEntryPoint.Legacy}):this.$q.reject('No "appID" found in dialogData')},e.prototype.handleAppsListFlow=function(e){var t=this;return this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleJITAppsListFlow=function(e){var t=this;return this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleAppsManagementTabUpgradeFlow=function(e,t){return this.upgradeAppFromChannelFlow(e,e.teamId,e.appId,t)},e.prototype.handleChannelInfoPaneAppWidgetUpgradeFlow=function(e,t){return this.upgradeAppFromChannelFlow(e,e.teamId,e.appId,t)},e.prototype.handleGroupChatAppsManagementUpgradeFlow=function(e,t){return this.upgradeAppFromGroupChatFlow(e,e.chatId,e.appId,t)},e.prototype.handleManageAppsInstalledApp=function(e){var t=this;return this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleManageAppsUpgradeFlow=function(e,t){return this.upgradeAppFromChannelFlow(e,e.teamId,e.appId,t)},e.prototype.handleConnectorManagementFlow=function(e){var t=this;return this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i,teamId:e.teamId,isInContextMode:!0}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i}),t.populateBackButton(e.onBackButtonClicked)})},e.prototype.handleStoreSideloadFlow=function(e){var t=this;return this.extensionManifestService.extractAppDefinition(e.manifestZipFile,!0).then(function(e){return t.ensureAppDef(e)}).then(function(n){t.populateMessage(e),t.populateAddButtonAttrsSideload(n,e,{manifestZipFile:e.manifestZipFile}),t.populateDialogFromAppDefinition(n),t.populatePermissionList({latestAppDef:n})})},e.prototype.handleTabSdkSideloadFlow=function(e){var t=this;return this.extensionManifestService.extractAppDefinition(e.manifestZipFile,!0).then(function(e){return t.ensureAppDef(e)}).then(function(n){t.populateAddButtonAttrsSideload(n,e,{manifestZipFile:e.manifestZipFile}),t.populateDialogFromAppDefinition(n),t.populatePermissionList({latestAppDef:n})})},e.prototype.handleMeetingFlowFromGroupchat=function(e){var t=this;return this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i,chatId:e.chatId,isInContextMode:!0}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleMeetingFlowFromTeam=function(e){var t=this;return this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i,teamId:e.teamId,isInContextMode:!0}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleDeepLinkFlow=function(e){var t=this;return this.enableTrustedSideloading&&e.appId&&e.templateInstanceId?this.templatedAppsService.getTemplatedInstanceAppDefinition(e.appId,e.templateInstanceId,"Add-app-dialog: TrustSideLoading",e.environment).then(function(e){return t.ensureAppDef(e)}).then(function(n){t.populateAddButtonAttrsSideload(n,e,{appDefinition:n}),t.populateDialogFromAppDefinition(n),t.populatePermissionList({latestAppDef:n})}):e.installAppPackage?this.appDebugService.installAppPackageById(e.appId,e.appTenantId,e.deepLinkSource):this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleStageDeepLinkFlow=function(e){var t=this;return this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i,isInContextMode:!0,teamId:e.teamId,chatId:e.chatId}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.setTemplatedInstanceFallbackIcon=function(e){var t=this;this.templatedAppsService.getTemplatedAppDefinitions("add-app dialog").then(function(n){var i=_.find(n,function(t){return t.id==e});i&&i.largeImageURL&&(t.fallbackIcon=i.largeImageURL)}).catch(function(){t.loggingService.error("Error setting fallback icon: Failed to fetch templated app definitions.")})},e.prototype.handleInContextGalleryDialogFromChannelFlow=function(e,t){var n=this;return this.upgradeAppFromChannelFlow(e,e.teamId,e.appId,t).catch(function(t){if(t===y||"App is not installed or has latest version"===t)return n.getUserApp(e.appId).then(function(t){var i=t[0],a=t[1];n.populateAppRating(a),n.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i,channelId:e.channelId,teamId:e.teamId,isInContextMode:!0}),n.populateDialogFromAppDefinition(i),n.populatePermissionList({latestAppDef:i}),n.populateBackButton(e.onBackButtonClicked)});throw t})},e.prototype.handleInContextGalleryDialogFromGroupChatFlow=function(e,t){var n=this;return this.upgradeAppFromGroupChatFlow(e,e.chatId,e.appId,t).catch(function(t){if(t===y||"App is not installed or has latest version"===t)return n.getUserApp(e.appId).then(function(t){var i=t[0],a=t[1];n.populateAppRating(a),n.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i,chatId:e.chatId,isInContextMode:!0}),n.populateDialogFromAppDefinition(i),n.populatePermissionList({latestAppDef:i}),n.populateBackButton(e.onBackButtonClicked)});throw t})},e.prototype.handleInContextGalleryDialogMoreAppsFromChannelFlow=function(e){var t=this;return this.enablePartnerAppCatalogBrowse&&e.isPartnerApp?this.getTemplatedAppDefinitionAndPopulateAddButton(e,"AddAppDialog-StoreBrowseExp",void 0,e.teamId):this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i,teamId:e.teamId,channelId:e.channelId}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleInContextGalleryDialogMoreAppsFromGroupChatFlow=function(e){var t=this;return this.enablePartnerAppCatalogBrowse&&e.isPartnerApp?this.getTemplatedAppDefinitionAndPopulateAddButton(e,"AddAppDialog-StoreBrowseExp",e.chatId):this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i,chatId:e.chatId}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleStoreFlow=function(e){var t=this,n=void 0,i=void 0;return this.experienceContainerFeatureService.isStoreHybridAppExperienceContainerEnabled()&&(n=e.chatId,i=e.teamId),this.enablePartnerAppCatalogBrowse&&e.isPartnerApp?this.getTemplatedAppDefinitionAndPopulateAddButton(e,"AddAppDialog-StoreBrowseExp",n,i):this.getUserApp(e.appId).then(function(a){var s=a[0],o=a[1];t.populateAppRating(o),t.populateAddButtonAttrsNotSideload(s,e,{appDefinition:s,chatId:n,teamId:i}),t.populateDialogFromAppDefinition(s),t.populatePermissionList({latestAppDef:s})})},e.prototype.handleStoreWorkflowFlow=function(e){var t=this;return this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleLobNotificationsFlow=function(e){var t=this;return this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleOnboardingNotificationsFlow=function(e){var t=this;return this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleStoreEditorialArticlesFlow=function(e){var t=this;return this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.getTemplatedAppDefinitionAndPopulateAddButton=function(e,t,n,i,a){var s=this;return this.templatedAppsService.getTemplatedInstanceAppDefinition(e.templatedAppId,e.appId,t,e.environment).then(function(e){return s.ensureAppDef(e)}).then(function(t){s.populateAddButtonAttrsSideload(t,e,{appDefinition:t,chatId:n,teamId:i,isInContextMode:a}),s.populateDialogFromAppDefinition(t),s.populatePermissionList({latestAppDef:t})})},e.prototype.handleFlyoutFlow=function(e){var t=this;return this.enablePartnerAppCatalogBrowse&&e.isPartnerApp?this.getTemplatedAppDefinitionAndPopulateAddButton(e,"AddAppDialog-StoreBrowseExp"):this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handlePersonalAppAboutFlow=function(e){var t=this;return this.getUserApp(e.appId).then(function(e){var n=e[0],i=e[1];t.populateAppRating(i),t.populateDialogFromAppDefinition(n),t.populatePermissionList({installedAppDef:n})})},e.prototype.handleConsentPromptFooterFlow=function(e){var t=this;return this.handlePersonalAppAboutFlow(e).then(function(){t.$timeout(function(){return t.scrollToPrivacy()},0)})},e.prototype.handlePowerBar=function(e){var t=this;return this.appsService.getUserAppDefinition(e.appId,"add-app-dialog-v3").then(function(e){return t.ensureAppDef(e)}).then(function(n){t.populateAddButtonAttrsNotSideload(n,e,{appDefinition:n}),t.populateDialogFromAppDefinition(n),t.populatePermissionList({latestAppDef:n})})},e.prototype.handleAppsManagementTabViewFlow=function(e){var t=this;return this.enablePartnerAppCatalogBrowse&&e.isPartnerApp?this.getTemplatedAppDefinitionAndPopulateAddButton(e,"AddAppDialog-StoreBrowseExp"):this.appsService.getInstalledAppForTeam(e.teamId,void 0,e.appId,"add-app-dialog-v3::handleAppsManagementTabViewFlow").then(function(e){return t.ensureInstalledApp(e)}).then(function(n){t.enableAddAppInManageTeamsApp&&!t.appsService.isSideloadedApp(n.appDefinition)&&t.populateAddButtonAttrsNotSideload(n.appDefinition,e,{appDefinition:n.appDefinition,shouldShowAddToAnotherTeam:!0}),t.populateDialogFromAppDefinition(n.appDefinition),t.populatePermissionList({installedAppDef:n.appDefinition})})},e.prototype.handleGroupChatAppsManagementViewFlow=function(e){var t=this;return this.appsService.getInstalledAppForGroupChat(e.chatId,e.appId).then(function(e){return t.ensureInstalledApp(e)}).then(function(e){t.populateDialogFromAppDefinition(e.appDefinition),t.populatePermissionList({installedAppDef:e.appDefinition})})},e.prototype.handleMoreAppFromSameDeveloperFlow=function(e){var t=this;return this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleMessagingExtensionFlyoutFromChannelFlow=function(e){var t=this;return this.enablePartnerAppCatalogBrowse&&e.isPartnerApp?this.getTemplatedAppDefinitionAndPopulateAddButton(e,"AddAppDialog-StoreBrowseExp",void 0,e.teamId):this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i,teamId:e.teamId,channelId:e.channelId}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleMessagingExtensionFlyoutFromChatFlow=function(e){var t=this;return this.enablePartnerAppCatalogBrowse&&e.isPartnerApp?this.getTemplatedAppDefinitionAndPopulateAddButton(e,"AddAppDialog-StoreBrowseExp"):this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleAppsManagementTabFromTeamFlow=function(e){var t=this;return this.enablePartnerAppCatalogBrowse&&e.isPartnerApp?this.getTemplatedAppDefinitionAndPopulateAddButton(e,"AddAppDialog-StoreBrowseExp",void 0,e.teamId):this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i,teamId:e.teamId}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleAppsManagementTabFromGroupChatFlow=function(e){var t=this;return this.enablePartnerAppCatalogBrowse&&e.isPartnerApp?this.getTemplatedAppDefinitionAndPopulateAddButton(e,"AddAppDialog-StoreBrowseExp",e.chatId):this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i,chatId:e.chatId}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleMessagingExtensionFlyoutV2Flow=function(e){var t=this;return this.enablePartnerAppCatalogBrowse&&e.isPartnerApp?this.getTemplatedAppDefinitionAndPopulateAddButton(e,"AddAppDialog-StoreBrowseExp",void 0,void 0,!0):this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i,isInContextMode:!0}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleAppSuggestionInEmptyChannel=function(e){var t=this;return this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i,teamId:e.teamId,isInContextMode:!0,channelId:e.channelId}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleMessagingExtensionFeaturedItemFlow=function(e){var t=this;return this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i,isInContextMode:!1}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleNewMessageUpgradeFlow=function(e){var t=this;return this.$q.all([e.teamId?this.appsService.getInstalledAppForTeam(e.teamId,void 0,e.appId,"add-app-dialog-v3::handleNewMessageUpgradeFlow"):this.appsService.getInstalledAppForUser(e.appId),this.getUserApp(e.appId)]).then(function(e){var n=e[0],i=e[1];return t.$q.all([t.ensureInstalledApp(n),t.$q.resolve(i)])}).then(function(n){var i=n[0],a=n[1],s=a[0],o=a[1];t.populateAppRating(o),t.populateAddButtonAttrsNotSideload(s,e,{isUpgrading:!0,appDefinition:s,teamId:e.teamId}),t.populateDialogFromAppDefinition(s),t.populatePermissionList({installedAppDef:i.appDefinition,latestAppDef:s})})},e.prototype.handleAtMentionDirectInstallationFromTeamFlow=function(e){var t=this;return this.$q.all([this.appsService.getInstalledAppForTeam(e.teamId,void 0,e.appId,"add-app-dialog::handleAtMentionDirectInstallationFromTeamFlow"),this.getTeamAppDefinition(e.teamId,e.appId)]).then(function(n){var i=n[0],a=n[1],s=a[0],o=a[1];t.populateAppRating(o);var r=!!i&&i.isAppInstalled();t.populateAddButtonAttrsNotSideload(s,e,{isUpgrading:r,isInContextMode:!r,appDefinition:s,teamId:e.teamId}),t.populateDialogFromAppDefinition(s),t.populatePermissionList({installedAppDef:r?i.appDefinition:void 0,latestAppDef:s})})},e.prototype.handleAtMentionDirectInstallationFromGroupChatFlow=function(e){var t=this;return this.$q.all([this.appsService.getInstalledAppForGroupChat(e.chatId,e.appId),this.getGroupChatAppDefinition(e.chatId,e.appId)]).then(function(n){var i=n[0],a=n[1],s=a[0],o=a[1];t.populateAppRating(o);var r=!!i&&i.isAppInstalled();t.populateAddButtonAttrsNotSideload(s,e,{isUpgrading:r,isInContextMode:!r,appDefinition:s,chatId:e.chatId}),t.populateDialogFromAppDefinition(s),t.populatePermissionList({installedAppDef:r?i.appDefinition:void 0,latestAppDef:s})})},e.prototype.handlePersonalAppBannerUpgradeFlow=function(e){var t=this;return this.$q.all([this.appsService.getInstalledAppForUser(e.appId),this.getUserApp(e.appId)]).then(function(e){var n=e[0],i=e[1];return t.$q.all([t.ensureInstalledApp(n),t.$q.resolve(i)])}).then(function(n){var i=n[0],a=n[1],s=a[0],o=a[1];t.populateAppRating(o),t.populateAddButtonAttrsNotSideload(s,e,{isUpgrading:!0,appDefinition:s},i&&i.appEntitlement&&i.appEntitlement.installedVersion),t.populateDialogFromAppDefinition(s),t.populatePermissionList({installedAppDef:i.appDefinition,latestAppDef:s})})},e.prototype.handleAppsListAndBarFlow=function(e){var t=this;return this.getUserApp(e.appId).then(function(n){var i=n[0],a=n[1];t.populateAppRating(a),t.populateAddButtonAttrsNotSideload(i,e,{appDefinition:i}),t.populateDialogFromAppDefinition(i),t.populatePermissionList({latestAppDef:i})})},e.prototype.handleAppsManagementTabFromTeamSideload=function(e){var t=this;return this.extensionManifestService.extractAppDefinition(e.manifestZipFile,!0).then(function(e){return t.ensureAppDef(e)}).then(function(n){r.checkIfAppHasScope("team",n)?t.populateAddButtonAttrsSideload(n,e,{manifestZipFile:e.manifestZipFile,teamId:e.teamId,isInContextMode:!0}):(t.strErrorMessage=t.$translate.instant(t.resources.strings.extension_addAppDialog_no_team_scope),t.populateAddButtonAttrsSideload(n,e,{manifestZipFile:e.manifestZipFile,teamId:e.teamId,isInContextMode:!0,isAppDisabled:!0})),t.populateDialogFromAppDefinition(n),t.populatePermissionList({latestAppDef:n})})},e.prototype.handleAppsManagementTabFromGroupChatSideload=function(e){var t=this;return this.extensionManifestService.extractAppDefinition(e.manifestZipFile,!0).then(function(e){return t.ensureAppDef(e)}).then(function(n){r.checkIfAppHasScope("groupchat",n)?t.populateAddButtonAttrsSideload(n,e,{manifestZipFile:e.manifestZipFile,chatId:e.chatId,isInContextMode:!0}):(t.strErrorMessage=t.$translate.instant(t.resources.strings.extension_addAppDialog_no_chat_scope),t.populateAddButtonAttrsSideload(n,e,{manifestZipFile:e.manifestZipFile,chatId:e.chatId,isInContextMode:!0,isAppDisabled:!0})),t.populateDialogFromAppDefinition(n),t.populatePermissionList({latestAppDef:n})})},e.prototype.populateBackButton=function(e){var t=this;this.backToInContextGalleryBtn={onClick:function(){t.dialogService.close(t.constants.lazyDialogs.addAppNew),e()}}},e.prototype.populateAddButtonAttrsNotSideload=function(e,t,n,a){var s,o,r,l,p=this,c=this.enableRSCPermissions&&(!_.isEmpty(null===(s=e.webApplicationInfo)||void 0===s?void 0:s.applicationPermissions)||!_.isEmpty(null===(r=null===(o=e.authorization)||void 0===o?void 0:o.permissions)||void 0===r?void 0:r.resourceSpecific))&&t.teamId&&!this.teamMembershipPropertiesService.isAdmin(t.teamId);this.addButtonAttrs=i({isAppDisabled:c,flow:"not-sideload",onInstallTriggered:function(i,s){i||(n.isUpgrading?p.logUpgradeAppActionForTelemetry(e,t,a,s):p.logInstallAppActionForTelemetry(e,t,s))},addAppDialogData:t,source:null!==(l=this.dialogData.source)&&void 0!==l?l:this.dialogData.entryPoint},n),c&&(this.strErrorMessage=this.$translate.instant(this.resources.strings.extension_addAppDialog_Permission_RSC_Error_Add_App,{appName:e.name}))},e.prototype.populateAddButtonAttrsSideload=function(e,t,n){var a,s,o,r=this,l=this.enableRSCPermissions&&(!_.isEmpty(null===(a=e.webApplicationInfo)||void 0===a?void 0:a.applicationPermissions)||!_.isEmpty(null===(o=null===(s=e.authorization)||void 0===s?void 0:s.permissions)||void 0===o?void 0:o.resourceSpecific))&&t.teamId&&!this.teamMembershipPropertiesService.isAdmin(t.teamId),p=this.enableSceneAppsInStore&&this.appsService.isSceneOnlyAppDefinition(e),c=function(a){r.addButtonAttrs=i({isAppDisabled:(a||l)&&!p,flow:"sideload",onSideloadTriggered:function(n,i){if(n){var a=n&&n.errorCode||"";a===r.constants.extensibility.apps.errorCodes.appSideloadingForbidden?r.strErrorMessage=r.isMeeting?r.$translate.instant(r.resources.strings.extension_noPermissionToManageAppInMeetingErrorMessage):r.$translate.instant(r.resources.strings.extension_appSideloadingForbiddenErrorMessage):a===r.constants.extensibility.apps.errorCodes.noPermissionToInstallApp?r.strErrorMessage=r.$translate.instant(r.resources.strings.extension_addAppDialogTeamDisabled):a===r.constants.extensibility.apps.errorCodes.participantMeetingExpired?r.strErrorMessage=r.$translate.instant(r.resources.strings.extension_meetingExpiredErrorMessage):a==r.constants.extensibility.apps.errorCodes.failedToCheckPermissionToManageApp?r.strErrorMessage=r.$translate.instant(r.resources.strings.extension_meetingDefaultPermissionErrorMessage):a===r.constants.extensibility.apps.errorCodes.webApplicationInfoIdConflictOnSideloadingIntoTeam?r.strErrorMessage=r.$translate.instant(r.resources.strings.extension_webApplicationInfoIdConflictOnSideloadingIntoTeam):a===r.constants.extensibility.apps.errorCodes.webApplicationInfoIdModificationNotAllowedForAppSideloadedInTeam?r.strErrorMessage=r.$translate.instant(r.resources.strings.extension_webApplicationInfoIdModificationNotAllowedForAppSideloadedInTeam):a===r.constants.extensibility.apps.errorCodes.resourceSpecificPermissionsMismatch?r.strErrorMessage=r.$translate.instant(r.resources.strings.extension_resourceSpecificPermissionsMismatch):a===r.constants.extensibility.apps.errorCodes.grantOfResourceSpecificPermissionsFailed?r.strErrorMessage=r.$translate.instant(r.resources.strings.extension_grantOfResourceSpecificPermissionsFailed):a===r.constants.extensibility.apps.errorCodes.userNotAuthorizedToRevokeResourceSpecificPermissions?r.strErrorMessage=r.$translate.instant(r.resources.strings.extension_userNotAuthorizedToRevokeResourceSpecificPermissions):a===r.constants.extensibility.apps.errorCodes.webApplicationInfoIdOfSideloadedAppMustBeInTheSameTenantAsUser?r.strErrorMessage=r.$translate.instant(r.resources.strings.extension_webApplicationInfoIdOfSideloadedAppMustBeInTheSameTenantAsUser):a===r.constants.extensibility.apps.errorCodes.invalidGrantResourceSpecificPermissionsRequest?r.strErrorMessage=r.$translate.instant(r.resources.strings.extension_invalidGrantResourceSpecificPermissionsRequest):a===r.constants.extensibility.apps.errorCodes.invalidResourceSpecificPermission?r.strErrorMessage=r.$translate.instant(r.resources.strings.extension_invalidResourceSpecificPermission):a===r.constants.extensibility.apps.errorCodes.userNotAuthorizedToGrantResourceSpecificPermissions?r.strErrorMessage=r.$translate.instant(r.resources.strings.extension_addAppDialog_Permission_RSC_Error_Add_App,{appName:e.name}):r.openSchemaErrorDialog(n)}else r.logInstallAppActionForTelemetry(e,t,i)},addAppDialogData:t},n),!a&&!l||p||(r.strErrorMessage=r.$translate.instant(r.resources.strings.extension_addAppDialog_Permission_RSC_Error_Add_App,{appName:e.name}))};this.enableTrustedSideloading&&t.templateInstanceId||this.enablePartnerAppCatalogBrowse&&t.isPartnerApp?c(!1):this.appsService.getUserAppPolicy("add-app-dialog-v3").then(function(e){return c(!e.isSideloadingAllowed)}).catch(function(){return c(!0)})},e.prototype.upgradeAppFromChannelFlow=function(e,t,n,i){var a=this;i&&i.appendEventData({flow:"upgradeAppFromChannelFlow"});var s=this.appsService.getInstalledAppForTeam(t,void 0,n,"add-app-dialog-v3::upgradeAppFromChannelFlow").then(function(e){return teamspace.services.AppsServiceUtils.isAppInstalled(e)?e:null});return this.$q.all([s,this.getTeamAppDefinition(t,n)]).then(function(e){var t=e[0],n=e[1],s=n[0],o=n[1];return i&&i.mark("get installed and latest apps"),a.$q.all([a.ensureInstalledApp(t),a.compareLatestVersion(t,s),a.$q.resolve(o)])}).then(function(n){var s=n[0],o=n[1],r=n[2];i&&i.mark("ensure installed app and definition"),a.populateAppRating(r),i&&i.appendEventData({appId:s&&s.appEntitlement&&s.appEntitlement.id,installedVersion:s&&s.appEntitlement&&s.appEntitlement.installedVersion,currentVersion:o&&o.version}),a.populateAddButtonAttrsNotSideload(o,e,{isUpgrading:!0,appDefinition:o,teamId:t},s&&s.appEntitlement&&s.appEntitlement.installedVersion),a.populateDialogFromAppDefinition(o),a.populatePermissionList({installedAppDef:s.appDefinition,latestAppDef:o})})},e.prototype.upgradeAppFromGroupChatFlow=function(e,t,n,i){var a=this;i&&i.appendEventData({flow:"upgradeAppFromGroupChatFlow"});var s=this.appsService.getInstalledAppForGroupChat(t,n).then(function(e){return teamspace.services.AppsServiceUtils.isAppInstalled(e)?e:null});return this.$q.all([s,this.getGroupChatAppDefinition(t,n)]).then(function(e){var t=e[0],n=e[1],s=n[0],o=n[1];return i&&i.mark("get installed and latest apps"),a.$q.all([a.ensureInstalledApp(t),a.compareLatestVersion(t,s),a.$q.resolve(o)])}).then(function(n){var s=n[0],o=n[1],r=n[2];i&&i.mark("ensure installed app and definition"),a.populateAppRating(r),i&&i.appendEventData({appId:s&&s.appEntitlement&&s.appEntitlement.id,installedVersion:s&&s.appEntitlement&&s.appEntitlement.installedVersion,currentVersion:o&&o.version}),a.populateAddButtonAttrsNotSideload(o,e,{isUpgrading:!0,appDefinition:o,chatId:t},s&&s.appEntitlement&&s.appEntitlement.installedVersion),a.populateDialogFromAppDefinition(o),a.populatePermissionList({installedAppDef:s.appDefinition,latestAppDef:o})})},e.prototype.getContainersForStaticTabs=function(e){return a(this,void 0,void 0,function(){var t,n,i,a,o,r,l=this;return s(this,function(s){switch(s.label){case 0:if(!e.staticTabs)return[2,null];for(t=new Set,n=[],i=[],a=function(a){var s=e.staticTabs[a];if(s.containerAppIds)for(var r=0;r<s.containerAppIds.length;++r)!function(a){var r=s.containerAppIds[a].toLowerCase();if(t.has(r))return"continue";t.add(r);var p=o.appsService.getUserAppDefinition(r,"add-app-dialog-v3-containerForStaticTab").then(function(t){t?n.push(t):l.logger.warn("app definition "+e.id+" has static tab "+s.entityId+" with containerAppId "+r+", which was not found")});i.push(p)}(r)},o=this,r=0;r<e.staticTabs.length;++r)a(r);return[4,Promise.all(i)];case 1:return s.sent(),[2,n.length?n:null]}})})},e.prototype.loadPreviewOfferPlans=function(e){var t=this;this.settingsService.valueAsBoolean(this.constants.settings.names.enablePreviewOfferTestCapability)&&(this.showLoadingSpinnerWithTimeOut(),this.loadPlans(e.subscriptionOffer.offerId).then(function(n){n?n.isPreview?t.loadSubscriptionPlans(e):(t.showSubscriptionPlans=!0,t.showLoadingSpinner=!1,t.showManageSubscription=!1,t.strPreviewOfferErrorMessage=t.$translate.instant(t.resources.strings.extension_addAppDialogV3_nonpreview_offer_error_message),t.strPreviewOfferErrorMessageIcon="[[staticsPath]]/hashed/svg/icons-warning-triangle-96c7e88.html"):(t.showSubscriptionPlans=!0,t.showLoadingSpinner=!1,t.showManageSubscription=!1,t.strPreviewOfferErrorMessage=t.$translate.instant(t.resources.strings.extension_addAppDialogV3_preview_offer_error_message),t.strPreviewOfferErrorMessageIcon="[[staticsPath]]/hashed/svg/icons-warning-triangle-96c7e88.html")}))},e.prototype.loadSubscriptionPlans=function(e){var t=this,n=this.loggingService.newScenario(this.constants.scenarios.extensibility.monetization.perf.displayPurchaseButton);this.showLoadingSpinnerWithTimeOut();var i=this.settingsService.valueFor(this.constants.settings.names.monetizationConstants);this.offer||this.loadPlans(e.subscriptionOffer.offerId),this.appsService.getUserAppDefinition(i.monetizationSpaAppId,"add-app-dialog-v3").then(function(i){t.settingsService.valueAsBoolean(t.constants.settings.names.showManageSubscriptionInAppInstallDialog)?t.getSubscriptionPromise=teamspace.services.QCancelable.toCancelablePromise(t.$q,t.$ocLazyLoad.load("extensibility-services")).then(function(){return t.$injector.get("monetizationService").getActiveSubscriptions(e.subscriptionOffer.offerId)}).then(function(e){(e&&e[0]||i||t.showLoadingSpinner)&&(t.showSubscriptionPlans=!0,t.showLoadingSpinner=!1,t.activeSubscription=e?e[0]:null,t.showManageSubscription=t.hasActiveSubscription()),n.stop()}):(t.showSubscriptionPlans=i&&t.hasSubscriptionOffer(),t.showLoadingSpinner=!1,t.activeSubscription=null,t.showManageSubscription=!1,n.stop())}).catch(function(e){t.showSubscriptionPlans=!1,n.fail({error:e})})},e.prototype.loadPlans=function(e){var t=this;return this.getOfferPromise=teamspace.services.QCancelable.toCancelablePromise(this.$q,this.$ocLazyLoad.load("extensibility-services")).then(function(){return t.$injector.get("monetizationService").getOffer(e)}).then(function(e){return e&&(t.hasFreeTrials=e.hasFreeTrials,t.offer=e,e.plans.forEach(function(e){e.isPrivate&&(t.hasPrivatePlans=!0)})),e})},e.prototype.showInfoTooltip=function(e,t){if(t){var n={template:d,trigger:"manual",container:"body",placement:"top",content:this.tooltipText,autoClose:!0,scope:this.$scope},i={sourceElement:l.element(e.currentTarget),tooltipType:teamspace.services.TooltipType.Popover,options:n,tooltipId:this.tooltipId};this.tooltipService.showTooltip(i)}else this.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,this.tooltipId)},e.prototype.showLoadingSpinnerWithTimeOut=function(){var e=this;this.$timeout(function(){e.showSubscriptionPlans||(e.showSubscriptionPlans=!0,e.showLoadingSpinner=!0)},this.constants.monetization.subscriptionSpinnerBtnLoadingTimeout)},e.prototype.hasSubscriptionOffer=function(){return this.settingsService.valueAsBoolean(this.constants.settings.names.enableMonetization)&&this.appDefinition&&null!=this.appDefinition.subscriptionOffer&&null!=this.appDefinition.subscriptionOffer.offerId},e.prototype.hasActiveSubscription=function(){return this.settingsService.valueAsBoolean(this.constants.settings.names.enableManageSubscriptions)&&null!=this.activeSubscription},e.prototype.populateDialogFromAppDefinition=function(e){var t=this;e||this.openErrorDialog("app-not-found"),this.enableAddToMeeting&&(this.hasMeeting=p.isMeetingOptimized(e)),this.enableTrustedSideloading&&e.templatedAppId&&this.setTemplatedInstanceFallbackIcon(e.templatedAppId),this.appDefinition=e,this.hasConfigurableTab=e.galleryTabs&&e.galleryTabs.length>0,this.hasBot=e.bots&&e.bots.length>0,this.hasMessagingExtension=e.inputExtensions&&e.inputExtensions.length>0,this.enableContainerAppDetailsView?(this.hasStaticTab=teamspace.services.AppsServiceUtils.isPersonalScopeTab(e.staticTabs,!0),this.getContainersForStaticTabs(e).then(function(e){if(e)for(var n=0;n<e.length;++n){var i=e[n];t.containerAppNames.push(i.name)}})):this.hasStaticTab=e.staticTabs&&e.staticTabs.length>0,this.hasConnector=e.connectors&&e.connectors.length>0,this.appHasTeamScope=r.checkIfAppHasScope("team",e),this.appHasGroupChatScope=r.checkIfAppHasScope("groupchat",e),this.isMediaPotential=e.screenshotUrls&&e.screenshotUrls.length>0||!!e.videoUrl,this.shouldShowCarousel=this.isMediaPotential,this.largeImageUrl=e.largeImageUrl,this.largeImageUrlUseNgInclude=this.utilityService.useNgIncludeForIcon(e.largeImageUrl),this.strName=e.name,this.strAccentColor=e.accentColor,this.strAppTagline=e.shortDescription,this.strAppDetail=c.processAppDetailsMarkdown(this.htmlSanitizer,e.longDescription),this.strCreatedBy=this.$translate.instant(this.resources.strings.extension_addAppDialogV3_createdBy,{developerName:e.developerName,developerUrl:e.developerUrl}),this.strPrivacyTitle=this.$translate.instant(this.resources.strings.extension_addAppDialogV3_permissions),this.strPrivacyDescription=this.$translate.instant(this.resources.strings.extension_addAppDialogV3_privacyDescription,{appName:e.name,privacyUrl:e.privacyUrl,termsOfUseUrl:e.termsOfUseUrl}),this.strNavAbout=this.$translate.instant(this.resources.strings.extension_addAppDialogV3_navigation_about),this.strNavPrivacy=this.$translate.instant(this.resources.strings.extension_addAppDialogV3_navigation_permissions),this.strAbout=this.strNavAbout,this.strVersion=this.$translate.instant(this.resources.strings.extension_addAppDialogV3_version,{version:e.version}),this.supportedLanguages=_(e.supportedLanguages).map(function(e){return t.getLanguageForCode(e)}).uniq().sort().filter(function(e){return!!e}).value(),(!this.enableComplementaryAppSuggestions||this.enableComplementaryAppSuggestions&&!this.tryPopulateComplementaryApps(e))&&this.populateMoreAppsFromSameDeveloper(e),this.populateScreenshotsAndVideos(e),this.populateTenantNameAsNeeded(e),this.settingsService.valueAsBoolean(this.constants.settings.names.enableAppCertificationData)&&this.populateCertificationInfo(e),this.settingsService.valueAsBoolean(this.constants.settings.names.enableAppMultihubPill)&&this.populateMultihubPill(e),this.populateNavigationItems()},e.prototype.populatePermissionList=function(e){var t,n,i,a,s,o,r,l,c,d,g=e.installedAppDef?this.findAppCapabilities(e.installedAppDef):[],u=e.latestAppDef?this.findAppCapabilities(e.latestAppDef):[],h=_.difference(u,g),m=this.enableAddToMeeting&&e.latestAppDef&&p.isMeetingOptimized(e.latestAppDef),v=[],f=[];this.enableRSCPermissions&&(_.isEmpty(null===(n=null===(t=e.installedAppDef)||void 0===t?void 0:t.webApplicationInfo)||void 0===n?void 0:n.applicationPermissions)||(v=v.concat(e.installedAppDef.webApplicationInfo.applicationPermissions)),_.isEmpty(null===(s=null===(a=null===(i=e.installedAppDef)||void 0===i?void 0:i.authorization)||void 0===a?void 0:a.permissions)||void 0===s?void 0:s.resourceSpecific)||(v=v.concat(_.map(e.installedAppDef.authorization.permissions.resourceSpecific,function(e){return e.name}))),_.isEmpty(null===(r=null===(o=e.latestAppDef)||void 0===o?void 0:o.webApplicationInfo)||void 0===r?void 0:r.applicationPermissions)||(f=f.concat(e.latestAppDef.webApplicationInfo.applicationPermissions)),_.isEmpty(null===(d=null===(c=null===(l=e.latestAppDef)||void 0===l?void 0:l.authorization)||void 0===c?void 0:c.permissions)||void 0===d?void 0:d.resourceSpecific)||(f=f.concat(_.map(e.latestAppDef.authorization.permissions.resourceSpecific,function(e){return e.name}))));var b=_.difference(f,v),y=this.getStrPermissionListHelper(g,h,v,b,m);e.latestAppDef&&(this.handleSpecialFlowPermission(e.latestAppDef,y.additionalPermissions),this.translateAndPopulateDevicePermissions(e.latestAppDef,u,y.additionalPermissions),this.addHardcodedMeetingsPermissionsIfNeeded(e.latestAppDef,y.additionalPermissions),this.translateAndPopulateMeetingStreamingPermission(e.latestAppDef,u,y.additionalPermissions)),e.installedAppDef&&(this.translateAndPopulateDevicePermissions(e.installedAppDef,g,y.existingPermissions),this.addHardcodedMeetingsPermissionsIfNeeded(e.installedAppDef,y.existingPermissions),this.translateAndPopulateMeetingStreamingPermission(e.installedAppDef,g,y.existingPermissions)),this.strExistingPermissionList=Array.from(new Set(y.existingPermissions)),this.strAdditionalPermissionList=Array.from(new Set(_.difference(y.additionalPermissions,y.existingPermissions))),this.hasPermissionList=this.strExistingPermissionList&&this.strExistingPermissionList.length>0||this.strAdditionalPermissionList&&this.strAdditionalPermissionList.length>0},e.prototype.populateMessage=function(e){e.isDebugging&&(this.strHeaderMessage=this.$translate.instant(this.resources.strings.extension_addAppDialogInstallAppPackageWarningMessage),this.strMessageIcon="svg/icons-circle-warning.html")},e.prototype.addHardcodedMeetingsPermissionsIfNeeded=function(e,t){this.extensionTabHelperService.isAppAllowedToAccessMeetingApis(e)&&(t.push(this.$translate.instant(this.resources.strings.extension_addAppDialog_meetings_info_permissions)),t.push(this.$translate.instant(this.resources.strings.extension_addAppDialog_meetings_mute_unmute_permissions)))},e.prototype.getStrPermissionListHelper=function(e,t,n,i,a){for(var s=[],o=[],r=0,l=[this.translateAndPopulatePermissionStrings(e,s),this.translateAndPopulatePermissionStrings(t,o)];r<l.length;r++){var p=l[r];p(teamspace.components.PermissionMapPersonalScope),this.appHasTeamScope&&this.appHasGroupChatScope?p(a?teamspace.components.PermissionMapTeamAndChatAndMeetingScope:teamspace.components.PermissionMapTeamAndChatScope):this.appHasTeamScope?p(teamspace.components.PermissionMapTeamScope):this.appHasGroupChatScope&&p(a?teamspace.components.PermissionMapChatAndMeetingScope:teamspace.components.PermissionMapChatScope)}return s.push.apply(s,this.getRSCPermissions(n)),o.push.apply(o,this.getRSCPermissions(i)),{existingPermissions:s,additionalPermissions:o}},e.prototype.findAppCapabilities=function(e){return _.filter(_.concat(r.Supported,r.SupportedExtendedCapabilities),function(t){return!!e[t]})},e.prototype.translateAndPopulatePermissionStrings=function(e,t){var n=this;return function(i){_.forEach(i,function(i,a){_.some(i,function(t){return _.includes(e,t)})&&t.push(n.$translate.instant(n.resources.strings[a]))})}},e.prototype.getRSCPermissions=function(e){var t=this;if(_.isEmpty(e))return[];var n=new Set;_.forEach(e,function(e){return n.add(e.toLowerCase())});var i=[];return _.forEach(v,function(e){_.forEach(b,function(a){var s=[];_.forEach(f,function(t){var i=(e+"."+t+"."+a).toLowerCase();n.has(i)&&(s.push(t),n.delete(i))});var o=s.join("_"),r="extension_addAppDialog_Permission_"+e+"_"+o+"_"+a,l=t.$translate.instant(r);l!==r?i.push(l):s.forEach(function(n){var s="extension_addAppDialog_Permission_"+e+"_"+n+"_"+a,o=t.$translate.instant(s);i.push(o)})})}),n.forEach(function(e){return i.push(e)}),e&&!_.isEmpty(e)&&i.push(this.$translate.instant(this.resources.strings.extension_addAppDialog_Permission_Teams_Access)),i},e.prototype.translateAndPopulateDevicePermissions=function(e,t,n){var i=this;this.$window.desktopSettings&&this.$window.desktopSettings.devicePermissionsEnabledV2&&e.devicePermissions&&(_.includes(t,"staticTabs")||_.includes(t,"galleryTabs"))&&_.forEach(e.devicePermissions,function(e){switch(e){case i.constants.deviceTypeForAppPermission.media:n.push(i.$translate.instant(i.resources.strings.extension_addAppDialogDeviceConsent));break;case i.constants.deviceTypeForAppPermission.geolocation:n.push(i.$translate.instant(i.resources.strings.extension_addAppDialogLocationConsent));break;case i.constants.deviceTypeForAppPermission.notifications:n.push(i.$translate.instant(i.resources.strings.extension_addAppDialogNotificationsConsent));break;case i.constants.deviceTypeForAppPermission.openExternal:n.push(i.$translate.instant(i.resources.strings.extension_addAppDialogExternalLinkContent));break;case i.constants.deviceTypeForAppPermission.midi:n.push(i.$translate.instant(i.resources.strings.extension_addAppDialogMIDIContent))}})},e.prototype.translateAndPopulateMeetingStreamingPermission=function(e,t,n){e.meetingExtensionDefinition&&e.meetingExtensionDefinition.supportsStreaming&&(_.includes(t,"staticTabs")||_.includes(t,"galleryTabs"))&&n.push(this.$translate.instant(this.resources.strings.extension_addAppDialog_Permission_Meeting_Streaming_Access))},e.prototype.populateTenantNameAsNeeded=function(e){var t=this;if(this.enableTenantOwnedApps&&e.tenantId){var n=this.tenantService.shouldIgnoreCache("add-app-dialog-v3");this.$q.all([this.tenantService.getTenants(void 0,void 0,n),this.authenticationService.getUserInformation()]).then(function(e){var n=_.find(e[0],function(t){return t.tenantId===e[1].profile.tid});t.strMoreFromDeveloper=t.$translate.instant(t.resources.strings.extension_addAppDialogV3_moreFromOrg),t.strNavMoreFromDeveloper=t.$translate.instant(t.resources.strings.extension_addAppDialogV3_navigation_moreFromOrg),t.strCategoriesOrTenant=n.tenantName})}else this.strMoreFromDeveloper=this.$translate.instant(this.resources.strings.extension_addAppDialogV3_moreFromDeveloper,{developerName:e.developerName}),this.strNavMoreFromDeveloper=this.$translate.instant(this.resources.strings.extension_addAppDialogV3_navigation_moreFromDeveloper,{developerName:e.developerName}),this.strCategoriesOrTenant=_(e.categories).map(function(e){return t.$translate.instant(t.resources.strings[t.constants.extensibility.store.AppStoreCategoryStringMapping[e]])}).filter(function(e){return e}).take(3).join(this.$translate.instant(this.resources.strings.extension_addAppDialog_category_separator))},e.prototype.populateCertificationInfo=function(e){e.securityComplianceInfo&&e.securityComplianceInfo.status&&("attested"===e.securityComplianceInfo.status.toLowerCase()?this.strCertificationStatus=this.$translate.instant(this.resources.strings.extension_addAppDialog_certification_attested):"m365certified"===e.securityComplianceInfo.status.toLowerCase()&&(this.strCertificationStatus=this.$translate.instant(this.resources.strings.extension_addAppDialog_certification_m365Certified),this.certificationIcon="svg/icons-m365certified.html"))},e.prototype.populateMultihubPill=function(e){e.manifestVersion&&"m365devpreview"===e.manifestVersion.toLowerCase()&&(this.isMultihubApp=!0)},e.prototype.populateMoreAppsFromSameDeveloper=function(e){var t=this;if(e.tenantId||!e.externalId){var n=e.tenantId?function(t){return e.tenantId===t.tenantId&&e.id!==t.id}:function(t){return e.developerName===t.developerName&&e.id!==t.id&&!t.externalId},i={category:teamspace.services.AppsServiceCategoryFilter.All},a=this.appsService.getInstalledAppsForUser(i),s=this.appsService.getUserAppDefinitions("add-app-dialog-v3",i);this.$q.all([a,s]).then(function(e){var t=e[0],i=e[1];return teamspace.services.AppsServiceUtils.filterToStoreFrontApps(t,i).filter(function(e){return n(e)})}).then(function(e){t.moreAppsFromDeveloper=_(e).map(function(e){return{id:e.id,largeImageUrl:e.largeImageUrl,largeImageUrlUseNgInclude:t.utilityService.useNgIncludeForIcon(e.largeImageUrl),strAccentColor:e.accentColor,strName:e.name}}).value()})}},e.prototype.tryPopulateComplementaryApps=function(e){var t=this;try{this.complementaryAppList=this.settingsService.valueFor(this.constants.settings.names.complementaryApps)||[];var n=this.complementaryAppList.find(function(t){return t.includes(e.id)});if(n){var i=function(t){return n.includes(t.id)&&e.id!==t.id},a={category:teamspace.services.AppsServiceCategoryFilter.All},s=this.appsService.getInstalledAppsForUser(a),o=this.appsService.getUserAppDefinitions("add-app-dialog-v3",a);return this.$q.all([s,o]).then(function(e){var t=e[0],n=e[1];return teamspace.services.AppsServiceUtils.filterToStoreFrontApps(t,n).filter(function(e){return i(e)})}).then(function(e){t.moreComplementaryApps=_(e).map(function(e){return{id:e.id,largeImageUrl:e.largeImageUrl,largeImageUrlUseNgInclude:t.utilityService.useNgIncludeForIcon(e.largeImageUrl),strAccentColor:e.accentColor,strName:e.name}}).value()}),!0}return!1}catch(t){return this.loggingService.info("Failed to populate complementary app suggestions for app id: {0}",e.id),!1}},e.prototype.populateScreenshotsAndVideos=function(e){this.screenshotUrls=e.screenshotUrls||[],this.videoUrls=e.videoUrl?[r.convertVideoUrl(e.videoUrl,this.constants)]:[]},e.prototype.populateAppRating=function(e){this.appRating=e},e.prototype.handleSpecialFlowPermission=function(e,t){e&&e.id&&e.id.toLowerCase()===this.constants.extensibility.apps.appIds.flow&&t.push(this.$translate.instant(this.resources.strings.extension_addAppDialogPermissionMessageSendOrganization))},e.prototype.populateNavigationItems=function(){this.navigationMenuItems=[],this.navigationMenuItems.push({text:this.strNavAbout,onClick:this.scrollToAbout.bind(this)})},e.prototype.logOpenSubscriptionDialogTelemetry=function(e){var t={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.nav.toString(),teamspace.components.PanelActionOutcome,this.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(e,teamspace.components.PanelActionScenario,this.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.nav.toString(),teamspace.components.PanelActionScenarioType,this.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.appAppDialogV3.toString(),teamspace.components.PanelModuleName,this.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.monetDialog.toString(),teamspace.components.PanelModuleType,this.loggingService),summary:this.appDefinition.name},app:{id:this.appDefinition.id}};this.sendPanelAction(t)},e.prototype.logOpenAppImageActionForTelemetry=function(e){var t=this.appDefinition,n=this.dialogData,a={action:i({outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.show.toString(),teamspace.components.PanelActionOutcome,this.loggingService)},this.getTelemetryCommonAction()),module:i({name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.openAddAppDialogImage.toString(),teamspace.components.PanelModuleName,this.loggingService),summary:"Open the image"},this.getTelemetryCommonModule()),app:this.getAppInformationForTelemetry(t,n,e)};this.sendPanelAction(a)},e.prototype.logViewAppActionForTelemetry=function(){var e=this.appDefinition,t=this.dialogData,n={action:i({outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.closeDialog.toString(),teamspace.components.PanelActionOutcome,this.loggingService)},this.getTelemetryCommonAction()),module:i({name:teamspace.shared.AttributeHelper.tryGetEnum(t.entryPoint===teamspace.components.AddAppDialogEntryPoint.AppsManagementTabView||t.entryPoint===teamspace.components.AddAppDialogEntryPoint.GroupChatAppsManagementView?teamspace.components.PanelModuleName.okButton.toString():teamspace.components.PanelModuleName.closeAddAppDialog.toString(),teamspace.components.PanelModuleName,this.loggingService),summary:"Ok and close the consent dialog"},this.getTelemetryCommonModule()),app:this.getAppInformationForTelemetry(e,t)};this.sendPanelAction(n)},e.prototype.logInstallAppActionForTelemetry=function(e,t,n){var a=this;clearTimeout(this.logViewFuncHandle),this.isInstallationEventLogged=!0,_.defer(function(){var s={action:i({outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.submit.toString(),teamspace.components.PanelActionOutcome,a.loggingService)},a.getTelemetryCommonAction()),module:i({name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.addAppButton.toString(),teamspace.components.PanelModuleName,a.loggingService),summary:"Consent to add an app"},a.getTelemetryCommonModule()),app:i(i({},a.getAppInformationForTelemetry(e,t)),{scope:n?_.sum(n):teamspace.components.PanelAppScope.personal,fromSectionName:!!t.fromSectionName})};a.sendPanelAction(s)})},e.prototype.logUpgradeAppActionForTelemetry=function(e,t,n,a){var s=this;clearTimeout(this.logViewFuncHandle),this.isInstallationEventLogged=!0,_.defer(function(){var o={action:i({outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.submit.toString(),teamspace.components.PanelActionOutcome,s.loggingService)},s.getTelemetryCommonAction(!0)),module:i({name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.upgradeAppButton.toString(),teamspace.components.PanelModuleName,s.loggingService),summary:"Consent to upgrade an app"},s.getTelemetryCommonModule()),app:i(i({},s.getAppInformationForTelemetry(e,t)),{scope:a?_.sum(a):teamspace.components.PanelAppScope.personal,fromSectionName:!!t.fromSectionName,installedVersion:n})};s.sendPanelAction(o)})},e.prototype.getAppInformationForTelemetry=function(e,t,n){var i;return i=t.templatedAppName?teamspace.components.AppAnalyticsHelper.getAppAnalyticsData({appDefinition:e},null,null,t.templatedAppName):teamspace.components.AppAnalyticsHelper.getAppAnalyticsData({appDefinition:e}),i.source=teamspace.shared.AttributeHelper.tryGetEnum(t.entryPoint.toString(),teamspace.components.AddAppDialogEntryPoint,this.loggingService),i.scenarioCapability=teamspace.components.PanelAppScenarioCapability.na,(t.entryPoint===teamspace.components.AddAppDialogEntryPoint.DeepLink||t.entryPoint===teamspace.components.AddAppDialogEntryPoint.StoreSideload&&null!==t.deepLinkSource)&&(i.deepLinkSource=t.deepLinkSource),i.hasScreenshots=this.isMediaPotential,void 0!==n&&(i.imageIndex=n),i.isSurfacedApp=!!this.dialogData.isSurfacedApp,i.storeCategoryInfo=t.category,i.entryPoint=t.entryPoint,i},e.prototype.getTelemetryCommonAction=function(e){return{gesture:teamspace.components.PanelActionGesture.click,scenario:teamspace.shared.AttributeHelper.tryGetEnum(e?teamspace.components.PanelActionScenario.upgradeAppDialog.toString():teamspace.components.PanelActionScenario.addAppDialog.toString(),teamspace.components.PanelActionScenario,this.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,this.loggingService)}},e.prototype.getTelemetryCommonModule=function(){return{type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.button.toString(),teamspace.components.PanelModuleType,this.loggingService)}},e.prototype.sendPanelAction=function(e){var t=this;e.app&&e.app.botId&&(e.bot?e.bot.id=e.app.botId:e.bot={id:e.app.botId}),this.analyticsService.getAnalyticsPanelActionEventData(e).then(function(e){return t.analyticsService.sendPanelAction(e)}).catch(function(e){t.logger.error("failed to log action "+e)})},e.prototype.getLanguageForCode=function(e){var t=this.localizationService.getLanguageForCode(e);if(!t)return null;var n=t.nativeName;if(!n)return null;var i=e.contains("-"),a=n.indexOf(" (");return!i&&a>-1?n.substr(0,a):n},Object.defineProperty(e.prototype,"isMeeting",{get:function(){if(this.stateParams&&this.stateParams.peopleSlug&&this.stateParams.ctx===this.constants.navigation.context.chat){var e=this.peopleSlugService.resolve(this.stateParams.peopleSlug);return e&&e.conversation&&e.conversation.isMeeting}return!1},enumerable:!0,configurable:!0}),e.prototype.openSchemaErrorDialog=function(e){var t,n=this.$translate.instant(this.resources.strings.extension_addAppDialogErrorMessage);(e&&e.errorCode||"")===this.constants.extensibility.apps.errorCodes.unableToParseTeamsAppManifest&&(n=this.$translate.instant(this.resources.strings.extension_addAppDialogManifestParsingErrorMessage),t=e.message),this.dialogService.close(this.constants.lazyDialogs.addAppNew),this.dialogService.openLazyDialog(this.constants.lazyDialogs.manifestError,this.constants.lazyModules.extensibilityDialogs,{errorMessage:n,errorDetails:t})},e.prototype.openErrorDialog=function(e){var t=this;_.defer(function(){t.dialogService.close(t.constants.lazyDialogs.addAppNew);var n={errorType:e};t.dialogService.openLazyDialog(t.constants.lazyDialogs.addAppNewError,t.constants.lazyModules.extensibilityDialogs,n)})},e.prototype.getUserApp=function(e){var t=this,n=this.appsService.getUserAppDefinition(e,"add-app-dialog-v3").then(function(e){return t.ensureAppDef(e)}),i=this.enableViewAppRating?this.appsRatingReviewService.getAppStoreRatingMap().then(function(t){return t[e]||null}).catch(function(e){return null}):this.$q.resolve({});return this.$q.all([n,i])},e.prototype.getTeamAppDefinition=function(e,t){var n=this,i=this.appsService.getTeamAppDefinition(e,void 0,t,"add-app-dialog-v3").then(function(e){return n.ensureAppDef(e)}),a=this.enableViewAppRating?this.appsRatingReviewService.getAppStoreRatingMap().then(function(e){return e[t]||null}).catch(function(e){return null}):this.$q.resolve({});return this.$q.all([i,a])},e.prototype.getGroupChatAppDefinition=function(e,t){var n=this,i=this.appsService.getGroupChatAppDefinition(e,t,"add-app-dialog-v3").then(function(e){return n.ensureAppDef(e)}),a=this.enableViewAppRating?this.appsRatingReviewService.getAppStoreRatingMap().then(function(e){return e[t]||null}).catch(function(e){return null}):this.$q.resolve({});return this.$q.all([i,a])},e.prototype.ensureAppDef=function(e){return e?this.$q.resolve(e):this.$q.reject("Did not find app definition")},e.prototype.ensureInstalledApp=function(e){return e&&e.appDefinition?this.$q.resolve(e):this.$q.reject(y)},e.prototype.compareLatestVersion=function(e,t){return e&&e.appEntitlement&&t&&e.appEntitlement.installedVersion!==t.version?this.$q.resolve(t):this.$q.reject("App is not installed or has latest version")},e}();t.AddAppDialogV3Controller=S,l.module("teamspace.addAppDialogV3",["skypeX.tenantSettingsStore","teamspace.addAppDialogV3.addButton","teamspace.htmlSanitizer","teamspace.addAppDialogV3.carousel","teamspace.addAppDialogV3.errorDialog"]).run(["constants","dialogService","$templateCache","settingsService",function(e,t,n,i){var a=i.valueAsBoolean(e.settings.names.enableNewAppInstallFlowV3),s=i.valueAsBoolean(e.settings.names.enableBotsInGroupChat);a&&s&&(n.put("components/extensibility/add-app-new-dialog/add-app-dialog-v3.html",o),t.register(e.lazyDialogs.addAppNew,{template:"components/extensibility/add-app-new-dialog/add-app-dialog-v3.html",className:"ts-modal-dialog custom-width ts-add-app-dialog-v3",closeByEscape:!1,closeByDocument:!0,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"ts-add-app-dialog-v3-app-name"}))}]).controller("AddAppDialogV3Controller",S)},2637:function(e,t){e.exports='<div class="ts-add-app-dialog-v3-container" ng-controller="AddAppDialogV3Controller as aadc" aria-modal="true" acc-role="dialog">\n  <modal-dialog ng-if="aadc.appDefinition" add-close-icon="true" suppress-default-button="true" suppress-default-footer="true" data-tid="addAppDialogV3" track-panel-type="{{$root.trackConstants.panelType.addAppDialogV3}}">\n    <section class="ts-add-app-dialog-v3-header">\n      <div class="ts-add-app-dialog-v3-image-container">\n        <div ng-style="{ \'background\': aadc.strAccentColor }">\n          <ng-include ng-if="aadc.largeImageUrlUseNgInclude" src="aadc.largeImageUrl"></ng-include>\n          <img ng-if="!aadc.largeImageUrlUseNgInclude" role="img" alt="{{($root.resources.strings.extensibility_app_icon_alt|translate:{appName:aadc.strName})}}" aria-label="{{($root.resources.strings.extensibility_app_icon_alt|translate:{appName:aadc.strName})}}" ng-src="{{aadc.largeImageUrl}}" fallback-src="{{aadc.fallbackIcon}}"/>\n        </div>\n      </div>\n      <div class="ts-add-app-dialog-v3-header-text" dir="auto">\n        <h1 class="ts-add-app-dialog-v3-header-text-big" id="ts-add-app-dialog-v3-app-name" ng-bind="aadc.strName"></h1>\n        <div class="ts-add-app-dialog-v3-categories" ng-bind="aadc.strCategoriesOrTenant"></div>\n        <div class="ts-add-app-dialog-v3-info-line">\n          <span class="ts-add-app-dialog-v3-stars-and-count" ng-if="::(aadc.appRating && aadc.appRating.averageRating > 0)">\n            <span class="ts-add-app-dialog-v3-star-rating-holder" ng-if="aadc.appRating">\n              <star-rating display-text-on-hover="true" class="use-brand-color" is-app-rating="true" is-read-only="true" rating="aadc.appRating.averageRating"></star-rating>\n            </span>\n            <span class="ts-add-app-dialog-v3-rating">{{::aadc.appRating.averageRating}}</span>\n            <span>({{::aadc.appRating.ratingsCount}})</span>\n          </span>\n          <div class="ts-add-app-dialog-v3-certification td-add-app-dialog-v3-pillbox" ng-if="::aadc.strCertificationStatus" title="{{aadc.strCertificationStatus}}" aria-label="{{aadc.strCertificationStatus}}">\n            <div class="ts-add-app-dialog-v3-certification-image app-icons-fill-hover" ng-if="::aadc.certificationIcon">\n                <ng-include src="::aadc.certificationIcon"></ng-include>\n            </div>\n            <span class="ts-add-app-dialog-v3-certification-status" ng-bind="aadc.strCertificationStatus"></span>\n          </div>\n          <div class="ts-add-app-dialog-v3-certification td-add-app-dialog-v3-pillbox" ng-if="aadc.isMultihubApp">\n            <span class="ts-add-app-dialog-v3-certification-status">\n              {{::$root.resources.strings.extension_addAppDialog_multihub_pill|translate}}\n            </span>\n          </div>\n          <div class="ts-add-app-dialog-v3-certification td-add-app-dialog-v3-pillbox" ng-if="aadc.hasFreeTrials">\n            <span class="ts-add-app-dialog-v3-certification-status">\n              {{::$root.resources.strings.extension_addAppDialogV3_badge_free_trial|translate}}\n            </span>\n          </div>\n          <div class="ts-add-app-dialog-v3-certification td-add-app-dialog-v3-pillbox" ng-if="aadc.hasPrivatePlans" ng-click="aadc.showInfoTooltip($event, true)" ng-focus="aadc.showInfoTooltip($event, true)" ng-blur="aadc.showInfoTooltip($event, false)" ng-mouseenter="aadc.showInfoTooltip($event, true)" ng-mouseleave="aadc.showInfoTooltip($event, false)">\n            <span class="ts-add-app-dialog-v3-certification-status">\n              {{::$root.resources.strings.extension_addAppDialogV3_badge_special_offer|translate}}\n            </span>\n          </div>\n        </div>\n      </div>\n      <div ng-if="!!aadc.strHeaderMessage  && !!aadc.strMessageIcon" class="ts-add-app-dialog-v3-header-message" dir="auto">\n        <ng-include class="ts-add-app-dialog-v3-header-message-icon" src="::aadc.strMessageIcon"></ng-include>\n        <div class="ts-add-app-dialog-v3-header-text-message" ng-bind="aadc.strHeaderMessage"></div>\n      </div>\n    </section>\n    <div ng-if="!aadc.isLargeMediaView" class="ts-add-app-dialog-v3-main-content">\n      <section class="ts-add-app-dialog-v3-left-rail">\n        <div class="ts-add-app-dialog-v3-privacy-narrow">\n          <p ng-bind-html="aadc.strPrivacyDescription"></p>\n        </div>\n        <div class="ts-add-app-dialog-v3-left-rail-container">\n          <div ng-if="aadc.addButtonAttrs" class="ts-add-app-dialog-v3-left-rail-add-btn-container">\n            <ts-add-app-dialog-add-button add-button-attrs="aadc.addButtonAttrs" dropdown-state-changed="aadc.dropdownStateChanged($isDropdownOpen)"></ts-add-app-dialog-add-button>\n          </div>\n\n          <div ng-if="aadc.strErrorMessage" class="ts-add-app-dialog-v3-left-rail-error-message app-font-caption-regular">\n            {{aadc.strErrorMessage}}\n          </div>\n\n          <div ng-if="aadc.showSubscriptionPlans && !aadc.strPreviewOfferErrorMessage" class="ts-subscription-plans-button-container">\n              <div class="ts-subscription-plans-button">\n                <button ng-if="aadc.showLoadingSpinner" class="ts-btn ts-btn-fluent ts-btn-fluent-secondary ts-subscription-plans-button-main">\n                  <busy-animation size="small">\n                  </busy-animation>\n                  <span>{{::$root.resources.strings.extension_addAppDialogV3_button_subscription_loading_plans|translate}}</span>\n                </button>\n\n                <button ng-if="!aadc.showLoadingSpinner && !aadc.showManageSubscription && aadc.openSubscriptionPlansDialog" ng-click="aadc.openSubscriptionPlansDialog()" class="ts-btn ts-btn-fluent ts-btn-fluent-secondary ts-subscription-plans-button-main">\n                  {{::$root.resources.strings.extension_addAppDialogV3_button_subscription_plans|translate}}\n                </button>\n\n                <button ng-if="!aadc.showLoadingSpinner && aadc.showManageSubscription && aadc.activeSubscription.managePurchaseUrl && aadc.navigateToManageSubscriptionsPage" ng-click="aadc.navigateToManageSubscriptionsPage()" class="ts-btn ts-btn-fluent ts-btn-fluent-secondary ts-subscription-plans-button-main">\n                  {{::$root.resources.strings.extension_addAppDialogV3_button_manage_subscriptions|translate}}\n                </button>\n              </div>\n          </div>\n\n          <div ng-if="!!aadc.strPreviewOfferErrorMessage" class="ts-preview-offer-error-message" dir="auto">\n            <div><ng-include src="::aadc.strPreviewOfferErrorMessageIcon" class="ts-preview-offer-error-message-icon icons-default-fill"></ng-include></div>\n            <div ng-bind="aadc.strPreviewOfferErrorMessage" class="ts-preview-offer-error-message-text"></div>\n          </div>\n\n          <ul ng-keydown="aadc.navBtnKeyboard($event)" role="menu" class="ts-add-app-dialog-v3-left-rail-navigation">\n            <li role="none">\n              <a role="menuitem" aria-current="{{aadc.isAboutActive}}" class="ts-add-app-dialog-v3-left-rail-navigation-item" href="javascript:void(0)" ng-keydown="aadc.scrollToAbout($event)" ng-mousedown="aadc.scrollToAbout()" ng-class="{ \'ts-add-app-dialog-v3-active\': aadc.isAboutActive }">\n                {{aadc.strNavAbout}}\n              </a>\n            </li>\n            <li role="none" ng-if="aadc.moreAppsFromDeveloper && aadc.moreAppsFromDeveloper.length" id="more-from-same-developer-apps-navigation-link">\n              <a role="menuitem" aria-current="{{aadc.isMoreFromDeveloperActive}}" class="ts-add-app-dialog-v3-left-rail-navigation-item" href="javascript:void(0)" ng-keydown="aadc.scrollToMoreFromDeveloper($event)" ng-mousedown="aadc.scrollToMoreFromDeveloper()" ng-class="{ \'ts-add-app-dialog-v3-active\': aadc.isMoreFromDeveloperActive }">\n                {{aadc.strNavMoreFromDeveloper}}\n              </a>\n            </li>\n            <li role="none" ng-if="aadc.moreComplementaryApps && aadc.moreComplementaryApps.length" id="complementary-apps-navigation-link">\n              <a role="menuitem" aria-current="{{aadc.isMoreFromDeveloperActive}}" class="ts-add-app-dialog-v3-left-rail-navigation-item" href="javascript:void(0)" ng-keydown="aadc.scrollToComplementaryApps($event)" ng-mousedown="aadc.scrollToComplementaryApps()" ng-class="{ \'ts-add-app-dialog-v3-active\': aadc.isMoreFromDeveloperActive }">\n                {{aadc.strNavComplementaryApps}}\n              </a>\n            </li>\n            <li role="none" ng-if="aadc.hasPermissionList">\n              <a role="menuitem" aria-current="{{aadc.isPrivacyActive}}" class="ts-add-app-dialog-v3-left-rail-navigation-item" href="javascript:void(0)" ng-keydown="aadc.scrollToPrivacy($event)" ng-mousedown="aadc.scrollToPrivacy()" ng-class="{ \'ts-add-app-dialog-v3-active\': aadc.isPrivacyActive }">\n                {{aadc.strNavPrivacy}}\n              </a>\n            </li>\n          </ul>\n          <div class="ts-add-app-dialog-v2-left-rail-footer">\n            <div class="ts-add-app-dialog-v3-privacy-normal">\n              <p ng-bind-html="aadc.strPrivacyDescription"></p>\n            </div>\n            <button ng-if="aadc.backToInContextGalleryBtn" ng-click="aadc.backToInContextGalleryBtn.onClick()" class="ts-add-app-dialog-v3-back-button" track-scenario="{{::$root.trackConstants.trackScenario.addAppDialogV3BackButton}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.appMgmt}}" track-outcome="{{::$root.trackConstants.trackOutcome.nav}}">\n              <ng-include src="\'svg/icons-chevron-left.html\'"></ng-include>\n              {{::$root.resources.strings.extension_addAppDialog_back|translate}}\n            </button>\n          </div>\n        </div>\n      </section>\n      <section class="ts-add-app-dialog-v3-right-rail">\n        <div class="ts-add-app-dialog-v3-right-rail-header" ng-if="!aadc.isScrolledToTop"></div>\n        <div class="scroll-region-container" ng-class="{ \'ts-add-app-dialog-v3-with-button\': aadc.backToInContextGalleryBtn }" simple-scrollbar customscrolleventonroot="{{::aadc.onScrollEventName}}">\n          <div class="ts-add-app-dialog-v3-scrolling-plate">\n\n            <div class="ts-add-app-dialog-v3-about">\n              <div ts-carousel class="ts-add-app-dialog-v3-carousel-holder" image-urls="aadc.screenshotUrls" video-urls="aadc.videoUrls" saved-state="aadc.carouselState" zoom-in="aadc.zoomInCarousel()" definition-id="aadc.appDefinition.id" on-tabbing-out="aadc.onImageTabOut(shiftKey)" ng-if="aadc.shouldShowCarousel"></div>\n\n              <h2 class="ts-add-app-dialog-v3-section-name ts-add-app-dialog-v3-about-section-name">\n                {{aadc.strAppTagline}}\n              </h2>\n              <div class="ts-add-app-dialog-v3-description-markdown" ng-bind-html="aadc.strAppDetail"></div>\n\n              <div ng-if="aadc.hasConfigurableTab">\n                <h3 class="ts-add-app-dialog-v3-capability-name">\n                  {{::$root.resources.strings.extension_capabilities_tabs|translate}}\n                </h3>\n                {{::$root.resources.strings.extension_addAppDialogV3_capability_tab_desc|translate}}\n              </div>\n              <div ng-if="aadc.hasBot">\n                <h3 class="ts-add-app-dialog-v3-capability-name">\n                  {{::$root.resources.strings.extension_capabilities_bots|translate}}\n                </h3>\n                {{::$root.resources.strings.extension_addAppDialogV3_capability_bot_desc|translate}}\n              </div>\n              <div ng-if="aadc.hasMessagingExtension">\n                <h3 class="ts-add-app-dialog-v3-capability-name">\n                  {{::$root.resources.strings.extension_addAppDialogV3_capability_messaging_extension_title|translate}}\n                </h3>\n                {{::$root.resources.strings.extension_addAppDialogV3_capability_messaging_extension_desc|translate}}\n              </div>\n              <div ng-if="aadc.hasConnector">\n                <h3 class="ts-add-app-dialog-v3-capability-name">\n                  {{::$root.resources.strings.extension_addAppDialogV3_capability_connector_title|translate}}\n                </h3>\n                {{::$root.resources.strings.extension_addAppDialogV3_capability_connector_desc|translate}}\n              </div>\n              <div ng-if="aadc.hasStaticTab">\n                <h3 class="ts-add-app-dialog-v3-capability-name">\n                  {{::$root.resources.strings.extension_addAppDialogV3_personalApp|translate}}\n                </h3>\n                {{::$root.resources.strings.extension_addAppDialog_personal_tab_use|translate}}\n              </div>\n              <div ng-if="aadc.hasMeeting">\n                <h3 class="ts-add-app-dialog-v3-capability-name">\n                  {{::$root.resources.strings.extension_addAppDialogV3_capability_meeting_title|translate}}\n                </h3>\n                {{::$root.resources.strings.extension_addAppDialogV3_capability_meeting_desc|translate}}\n              </div>\n              <div ng-if="aadc.containerAppNames && aadc.containerAppNames.length" ng-repeat="containerAppName in aadc.containerAppNames">\n                <h3 class="ts-add-app-dialog-v3-capability-name">\n                  {{containerAppName}}\n                </h3>\n                <span translate-with-html-params translate-id="extension_addAppDialog_container_app_use" translate-values=\'{"containerAppName": "{{containerAppName}}"}\'>\n                </span>\n              </div>\n              <p class="ts-add-app-dialog-v3-created-by" ng-bind-html="aadc.strCreatedBy"></p>\n              <div class="ts-add-app-dialog-v3-version">\n                <span ng-if="aadc.strVersion" class="version" ng-bind="aadc.strVersion">\n                </span>\n              </div>\n            </div>\n\n            <div class="ts-add-app-dialog-v3-supported-languages" ng-if="aadc.supportedLanguages && aadc.supportedLanguages.length">\n              <span class="supported-languages" translate-with-html-params translate-id="extension_addAppDialog_supported_languages"></span>\n              <ul class="languages">\n                <li class="language" ng-repeat="language in aadc.supportedLanguages">{{language}}</li>\n              </ul>\n            </div>\n\n            <div class="ts-add-app-dialog-v3-more-from-developer" ng-if="aadc.moreAppsFromDeveloper && aadc.moreAppsFromDeveloper.length > 0">\n              <h2 class="ts-add-app-dialog-v3-section-name">{{aadc.strMoreFromDeveloper}}</h2>\n              <div class="ts-add-app-dialog-v3-more-apps-list" ng-keydown="aadc.onMoreFromDeveloperKeyboard($event)" role="list">\n                <button class="ts-add-app-dialog-v3-more-apps-item" ng-repeat="moreAppsViewModel in aadc.moreAppsFromDeveloper" ng-click="aadc.openAnotherAppFromDeveloper(moreAppsViewModel.id, $event)" role="listitem">\n                  <div class="ts-add-app-dialog-v3-more-apps-image" ng-style="{ \'background\': moreAppsViewModel.strAccentColor }">\n                    <ng-include ng-if="moreAppsViewModel.largeImageUrlUseNgInclude" src="moreAppsViewModel.largeImageUrl"></ng-include>\n                    <img ng-if="!moreAppsViewModel.largeImageUrlUseNgInclude" role="img" ng-src="{{moreAppsViewModel.largeImageUrl}}" alt="{{($root.resources.strings.extensibility_app_icon_alt|translate:{appName:moreAppsViewModel.strName})}}" aria-label="{{($root.resources.strings.extensibility_app_icon_alt|translate:{appName:moreAppsViewModel.strName})}}" fallback-src="{{::aadc.fallbackIcon}}"/>\n                  </div>\n                  <div class="ts-add-app-dialog-v3-more-apps-label" ng-bind="moreAppsViewModel.strName"></div>\n                </button>\n              </div>\n            </div>\n\n            <div class="ts-add-app-dialog-v3-more-from-developer" ng-if="aadc.moreComplementaryApps && aadc.moreComplementaryApps.length > 0">\n              <h2 class="ts-add-app-dialog-v3-section-name">{{aadc.strComplementaryApps}}</h2>\n              <div class="ts-add-app-dialog-v3-more-apps-list" ng-keydown="aadc.onMoreFromDeveloperKeyboard($event)" role="list">\n                <button class="ts-add-app-dialog-v3-more-apps-item" ng-repeat="moreAppsViewModel in aadc.moreComplementaryApps" ng-click="aadc.openAnotherAppFromComplementaryAppSuggestion(moreAppsViewModel.id, $event)" role="listitem" track-gesture="{{::$root.trackConstants.trackGesture.click}}" track-outcome="{{::$root.trackConstants.trackOutcome.openDialog}}" track-scenario="{{::$root.trackConstants.trackScenario.openAddAppDialog}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.complementaryApps}}" track-name="{{::$root.trackConstants.trackModuleName.complementaryApps}}" track-type="{{::$root.trackConstants.trackType.complementaryApps}}" track-summary="complementary apps section - open app details dialog">\n                  <div class="ts-add-app-dialog-v3-more-apps-image" ng-style="{ \'background\': moreAppsViewModel.strAccentColor }">\n                    <ng-include ng-if="moreAppsViewModel.largeImageUrlUseNgInclude" src="moreAppsViewModel.largeImageUrl"></ng-include>\n                    <img ng-if="!moreAppsViewModel.largeImageUrlUseNgInclude" role="img" ng-src="{{moreAppsViewModel.largeImageUrl}}" alt="{{($root.resources.strings.extensibility_app_icon_alt|translate:{appName:moreAppsViewModel.strName})}}" aria-label="{{($root.resources.strings.extensibility_app_icon_alt|translate:{appName:moreAppsViewModel.strName})}}" fallback-src="{{::aadc.fallbackIcon}}"/>\n                  </div>\n                  <div class="ts-add-app-dialog-v3-more-apps-label" ng-bind="moreAppsViewModel.strName"></div>\n                </button>\n              </div>\n            </div>\n\n            <div class="ts-add-app-dialog-v3-privacy" ng-if="aadc.hasPermissionList">\n              <h2 class="ts-add-app-dialog-v3-section-name">{{aadc.strPrivacyTitle}}</h2>\n              <div ng-if="aadc.strExistingPermissionList && aadc.strExistingPermissionList.length > 0">\n                <div>{{::$root.resources.strings.extension_addAppDialogAppPermissionTitle_new|translate}}</div>\n                <ul>\n                  <li ng-repeat="permission in aadc.strExistingPermissionList">{{permission}}</li>\n                </ul>\n              </div>\n              <div ng-if="aadc.strAdditionalPermissionList && aadc.strAdditionalPermissionList.length > 0">\n                <div ng-if="aadc.strExistingPermissionList && aadc.strExistingPermissionList.length > 0">\n                  \x3c!-- text to show for upgrade flow --\x3e\n                  {{::$root.resources.strings.extension_addAppDialogAppRequestPermissionTitle|translate}}\n                </div>\n                <div ng-if="!(aadc.strExistingPermissionList && aadc.strExistingPermissionList.length > 0)">\n                  \x3c!-- text to show for normal (non-upgrade) flow --\x3e\n                  {{::$root.resources.strings.extension_addAppDialogV3_appHasPermission|translate}}\n                </div>\n                <ul>\n                  <li ng-repeat="permission in aadc.strAdditionalPermissionList">{{permission}}</li>\n                </ul>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="ts-add-app-dialog-v3-right-rail-footer" ng-class="{ \'show\': !aadc.isScrolledToBottom, \'ts-add-app-dialog-v3-with-button\': aadc.backToInContextGalleryBtn }"></div>\n      </section>\n    </div>\n    <div ng-if="aadc.isLargeMediaView" class="ts-add-app-dialog-large-media-view">\n      <div class="ts-add-app-dialog-large-media-container">\n        <div ts-carousel class="ts-add-app-dialog-v3-carousel-holder" image-urls="aadc.screenshotUrls" video-urls="aadc.videoUrls" saved-state="aadc.carouselState" definition-id="aadc.appDefinition.id" on-tabbing-out="aadc.focusBackButton()"></div>\n      </div>\n      <div class="ts-add-app-dialog-v3-footer">\n        <button class="ts-add-app-dialog-v3-back-to-detail" ng-click="aadc.zoomOutCarousel()" track-scenario="{{::$root.trackConstants.trackScenario.addAppDialogV3ImageViewBackButton}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.appMgmt}}" track-outcome="{{::$root.trackConstants.trackOutcome.nav}}">\n          <ng-include src="\'svg/icons-chevron-left.html\'"></ng-include>\n          {{::$root.resources.strings.extension_addAppDialog_back|translate}}\n        </button>\n      </div>\n    </div>\n  </modal-dialog>\n</div>'},2638:function(e,t){e.exports='<div class="tooltip-container private-offer-plan-tooltip">\n  <div class="content-container">\n    <span class="tooltip-content" ng-bind-html="content"></span>\n    <div class="tooltip-arrow-down"></div>\n  </div>\n</div>\n'},2639:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2640),a=n(31),s=function(){function e(e,t,n,i,a,s,o){var r=this;this.$scope=e,this.$translate=t,this.constants=n,this.resources=i,this.loggingService=a,this.analyticsService=s,this.hasComposeCapability=!1,this.hasCommandBoxCapability=!1,this.isFirstInstallation=!1,this.imageUrl="",this.strComposeInstructions="",this.strCommandBoxInstructions="",this.strGotItButton="",this.strTryItButton="",this.appId="",this.strTitle="";var l=e.ngDialogData;this.logger=a.newLogger("add-app-tutorial-dialog"),this.viewScenario=a.newScenario(n.scenarios.extensibility.apps.addAppTutorialDialog.view),this.populateDialog(l),this.viewScenario.stop({appId:l.appId,tenantId:l.tenantId});var p=this.onKeydown.bind(this);o.addEventListener("keydown",p,!0),e.$on("$destroy",function(){r.viewScenario&&r.viewScenario.cancel(),o.removeEventListener("keydown",p,!0)}),this.logViewAppActionForTelemetry()}return e.$inject=["$scope","$translate","constants","resources","loggingService","analyticsService","$window"],e.prototype.onKeydown=function(e){if(e.keyCode===this.constants.keyCodes.escape){var t={shouldNavigate:!1};this.$scope.$parent.closeThisDialog(t)}},e.prototype.close=function(e){e&&e.stopPropagation&&e.stopPropagation();var t={shouldNavigate:!1};this.$scope.$parent.closeThisDialog(t)},e.prototype.nevigateToAppContext=function(e){e&&e.stopPropagation&&e.stopPropagation();var t={shouldNavigate:!0};this.$scope.$parent.closeThisDialog(t)},Object.defineProperty(e.prototype,"navCtx",{get:function(){return"add-app-tutorial-dialog"},enumerable:!0,configurable:!0}),e.prototype.populateDialog=function(e){this.hasCommandBoxCapability=e.hasCommandBoxCapability,this.hasComposeCapability=e.hasComposeCapability,this.isFirstInstallation=e.isFirstInstallation,this.strTitle=this.$translate.instant(this.isFirstInstallation?this.resources.strings.extensibility_apps_added_successfully_tutorial_title:this.resources.strings.extensibility_apps_open_app_tutorial_title,{appName:e.appName}),this.strComposeInstructions=this.$translate.instant(this.resources.strings.extensibility_apps_added_successfully_tutorial_compose_instructions,{appName:e.appName}),this.strCommandBoxInstructions=this.$translate.instant(this.resources.strings.extensibility_apps_added_successfully_tutorial_commandbox_instructions,{appName:e.appName}),this.imageUrl=this.constants.dialogs.images.appInstallTutorialDialog,this.strGotItButton=this.$translate.instant(this.resources.strings.extensibility_apps_added_successfully_tutorial_dismiss),this.strTryItButton=this.$translate.instant(this.resources.strings.extensibility_apps_added_successfully_tutorial_try),this.appId=e.appId},e.prototype.logViewAppActionForTelemetry=function(){var e={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.openDialog.toString(),teamspace.components.PanelActionOutcome,this.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.addAppTutorialDialogView.toString(),teamspace.components.PanelActionScenario,this.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,this.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.addAppTutorialDialog.toString(),teamspace.components.PanelModuleName,this.loggingService),summary:"View ME Post install tutorial",type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.button.toString(),teamspace.components.PanelModuleType,this.loggingService)}};this.sendPanelAction(e)},e.prototype.sendPanelAction=function(e){var t=this;this.analyticsService.getAnalyticsPanelActionEventData(e).then(function(e){return t.analyticsService.sendPanelAction(e)}).catch(function(e){var n=e.errorCode;t.logger.error("Unable to log telemetry for ME Post Install flow dialog. Failed with code: "+n)})},e}();t.AddAppTutorialDialogController=s,a.module("teamspace.addAppTutorialDialog",[]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put("components/extensibility/add-app-tutorial-dialog/add-app-tutorial-dialog.html",i),t.register(e.lazyDialogs.addAppTutorialDialog,{template:"components/extensibility/add-app-tutorial-dialog/add-app-tutorial-dialog.html",className:"ts-modal-dialog custom-width ts-add-app-tutorial-dialog",closeByEscape:!1,closeByDocument:!0,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"ts-add-app-tutorial-dialog-tochange"})}]).controller("AddAppTutorialDialogController",s)},2640:function(e,t){e.exports='<div class="ts-add-app-tutorial-dialog-container" ng-controller="AddAppTutorialDialogController as ctrl" aria-modal="true" acc-role="tab-handler-me-tutorial-dialog">\n  <modal-dialog suppress-default-button="true" suppress-default-footer="true" data-tid="addAppTutorialDialog" track-panel-type="{{$root.trackConstants.panelType.addAppTutorialDialog}}" hide-header="true">\n    <section>\n      <div>\n        <img class="tutorial-image" title="{{::$root.resources.strings.extensibility_apps_added_successfully_tutorial_image|translate}}" alt="{{::$root.resources.strings.extensibility_apps_added_successfully_tutorial_image|translate}}" ng-src="{{ctrl.imageUrl}}"/>\n      </div>\n      <div class="close-container app-icons-fill-hover">\n        <button class="btn btn-default icons-close ngdialog-close inset-border inset-border-round inset-border-themed app-icons-fill-hover" id="me-tutorial-cross-close" role="button" data-tid="add-app-tutorial-dialog-close-button" title="{{::$root.resources.strings.extensibility_apps_added_successfully_tutorial_close|translate}}" ng-click="ctrl.close($event)" ng-attr-aria-label="{{::closeAriaLabel}}" track-scenario="{{::$root.trackConstants.trackScenario.addAppTutorialDialogCloseButton}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.appMgmt}}" track-outcome="{{::$root.trackConstants.trackOutcome.dismiss}}" track-summary="Dismiss" track-name="{{::$root.trackConstants.trackModuleName.addAppTutorialDialog}}"></button>\n        <ng-include role="presentation" class="icon icons-close modal-dialog-close" src="\'svg/icons-close.html\'"></ng-include>\n      </div>\n    </section>\n    <section class="ts-add-app-tutorial-dialog-text">\n      <div class="app-font-title2-bold" ng-if="ctrl.hasComposeCapability">{{ctrl.strTitle}}</div>\n      <div ng-if="ctrl.hasComposeCapability">{{ctrl.strComposeInstructions}}</div>\n      <div class="instruction" ng-if="ctrl.hasCommandBoxCapability">{{ctrl.strCommandBoxInstructions}}</div>\n    </section>\n    <section class="ts-add-app-tutorial-dialog-buttons">\n      <button id="me-tutorial-close" role="button" ng-click="ctrl.close($event)" class="ts-btn ts-btn-fluent ts-btn-fluent-secondary" data-tid="add-app-tutorial-dialog-got-it-button" track-scenario="{{::$root.trackConstants.trackScenario.addAppTutorialDialogGotIButton}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.appMgmt}}" track-outcome="{{::$root.trackConstants.trackOutcome.closeDialog}}" track-summary="Close" track-name="{{::$root.trackConstants.trackModuleName.addAppTutorialDialog}}">\n        <span>{{ctrl.strGotItButton}}</span>\n      </button>\n      <button id="me-tutorial-try-it" role="button" ng-click="ctrl.nevigateToAppContext($event)" class="ts-btn ts-btn-fluent ts-btn-fluent-primary" ng-disabled="ctrl.isInstallingOrUpgrading || ctrl.$scope.addButtonAttrs.isAppDisabled" data-tid="add-app-tutorial-dialog-try-it-button" track-scenario="{{::$root.trackConstants.trackScenario.addAppTutorialDialogTryItButton}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.appMgmt}}" track-outcome="{{::$root.trackConstants.trackOutcome.nav}}" track-summary="TryIt" track-data="{appId: ctrl.appId}" track-name="{{::$root.trackConstants.trackScenario.addAppTutorialDialog}}">\n        <span>{{ctrl.strTryItButton}}</span>\n      </button>\n    </section>\n  </modal-dialog>\n</div>'},2641:function(e,t,n){"use strict";"user strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2642),a=function(){function e(e,t,n,i,a){var s=this;this.utilityService=e,this.$scope=t;var o=t.ngDialogData.appDefinition;this.appId=o.id,this.appIcon=o.largeImageUrl,this.appAccentColor=o.accentColor,this.appFallbackIcon=i.fallbackImages.appFallbackImage,this.dialogMessage=n.instant(a.strings.extensibility_additional_auth_dialog_message,{appName:o.name}),this.footerButtons=[{text:n.instant(a.strings.extensibility_additional_auth_dialog_continue),isFocusDefault:!0,func:function(){return s.continue()},tid:"appAuth-continueBtn",disabled:!1,secondaryStyle:!1,outcome:teamspace.components.PanelActionOutcome.submit,scenario:teamspace.components.PanelActionScenario.appAuthDialog,scenarioType:teamspace.components.PanelActionScenarioType.appAuth,type:teamspace.components.PanelModuleType.button,name:teamspace.components.PanelModuleName.additionalAuthButton,summary:"Continue Button to Grant Consent",dataBag:{id:o.id}}]}return e.$inject=["utilityService","$scope","$translate","constants","resources"],e.prototype.continue=function(){this.$scope.closeThisDialog(!0)},e}();t.AppAuthDialogController=a,angular.module("teamspace.appAuthDialog",[]).controller("AppAuthDialogController",a).run(["constants","dialogService","$templateCache",function(e,t,n){n.put(e.files.templates.appAuthDialog,i),t.register(e.lazyDialogs.appAuth,{template:e.files.templates.appAuthDialog,className:"ts-modal-dialog custom-width app-auth-dialog",isPersistent:!0})}])},2642:function(e,t){e.exports='<div acc-role="dialog" ng-controller="AppAuthDialogController as ctrl" data-tid="app-auth-dialog">\n  <modal-dialog footer-buttons="::ctrl.footerButtons" right-align-buttons="true" track-panel-type="{{$root.trackConstants.panelType.appAuthDialog}}" track-app-id="{{::ctrl.appId}}">\n    <div>\n      <div class="ts-dialog-auth-flow">\n        <div class="ts-dialog-auth-flow-icon" aria-hidden="true" ng-style="{ \'background\': app.accentColor }">\n          <ng-include src="ctrl.appIcon" ng-if="::ctrl.utilityService.useNgIncludeForIcon(ctrl.appIcon)"></ng-include>\n          <img ng-src="{{::ctrl.appIcon}}" fallback-src="{{::ctrl.appFallbackIcon}}" ng-if="::!ctrl.utilityService.useNgIncludeForIcon(ctrl.appIcon)"/>\n        </div>\n        <div class="ts-dialog-auth-flow-icon ts-dialog-auth-flow-switch-icon">\n          <ng-include src="\'svg/icons-switch.html\'"></ng-include>\n        </div>\n        <div class="ts-dialog-auth-flow-icon">\n          <ng-include src="\'svg/icons-create-team-org-wide.html\'"></ng-include>\n        </div>\n      </div>\n      <div class="ts-dialog-auth-message">\n        <div class="app-font-title2-bold" translate-once="{{::$root.resources.strings.extensibility_additional_auth_dialog_title}}"></div>\n        <div class="ts-dialog-auth-message-body" ng-bind="::ctrl.dialogMessage"></div>\n      </div>\n    </div>\n  </modal-dialog>\n</div>'},2643:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2644),a=function(){function e(e,t,n,i,a){this.botCardService=e,this.utilityService=t,this.$translate=n,this.resources=i,this.$scope=a;var s=a.ngDialogData,o=s.appDefinition,r=s.card,l=s.selectedButton;this.privacyUrl=o.privacyUrl,this.termsOfUseUrl=o.termsOfUseUrl,this.largeImageUrl=o.largeImageUrl,this.dialogTitle=n.instant(i.strings.extensibility_app_install_consent_dialog_title,{appName:o.name}),this.errorMessage=n.instant(i.strings.extensibility_app_install_consent_dialog_error_message),this.footerButtons=[{text:n.instant(i.strings.extensibility_app_install_consent_dialog_continue),func:function(){a.closeThisDialog(s),e.installAppForUserInContext(o,l,r,a)},disabled:!1}]}return e.$inject=["botCardService","utilityService","$translate","resources","$scope"],e}();t.AppInstallConsentDialogController=a,angular.module("teamspace.appInstallConsentDialog",["teamspace.constants","teamspace.botCardService"]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put("components/extensibility/app-install-consent-dialog/app-install-consent-dialog.html",i),t.register(e.lazyDialogs.appInstallConsentDialog,{template:"components/extensibility/app-install-consent-dialog/app-install-consent-dialog.html",className:"ts-modal-dialog custom-width ts-app-install-consent-dialog",isPersistent:!0,closeByEscape:!0,closeByDocument:!0})}]).controller("AppInstallConsentDialogController",a)},2644:function(e,t){e.exports='<div class="app-install-consent-dialog ts-dialog" suppress-default-footer="true" ng-controller="AppInstallConsentDialogController as aicdc" data-tid="app-install-consent-dialog" acc-role="dialog">\n  <modal-dialog add-close-icon="true" right-align-buttons="true" footer-buttons="::aicdc.footerButtons" suppress-default-button="true">\n    <div class="ts-app-install-consent-dialog-header">\n      <div class="image-container">\n        <div class="image" ng-style="{ \'background\': aicdc.appDefinition.accentColor }">\n          <ng-include src="::aicdc.largeImageUrl" ng-if="::aicdc.utilityService.useNgIncludeForIcon(aicdc.largeImageUrl)"></ng-include>\n          <img role="img" alt="{{::($root.resources.strings.extensibility_app_icon_alt|translate:{appName:aicdc.appDefinition.name})}}" aria-label="{{::($root.resources.strings.extensibility_app_icon_alt|translate:{appName:aicdc.dialogTitle})}}" ng-src="{{::aicdc.largeImageUrl}}" ng-if="::!aicdc.utilityService.useNgIncludeForIcon(aicdc.largeImageUrl)"/>\n        </div>\n      </div>\n      <div class="ts-app-install-consent-dialog-header-title">\n        <h1 ng-bind="::aicdc.dialogTitle"></h1>\n      </div>\n    </div>\n    <div class="ts-app-install-consent-dialog-accept-message">\n      <span id="ts-add-app-dialog-permissions-header" translate-with-html-params translate-id="extensibility_app_install_consent_dialog_message" translate-values=\'{"privacyPolicy": "<a ng-href=\\"{{::aicdc.privacyUrl}}\\"\n                              title=\\"{{::aicdc.privacyUrl}}\\"\n                              rel=\\"noopener\n                              noreferrer\\"\n                              target=\\"_blank\\"><span translate-once=\\"{{::$root.resources.strings.inputExtension_task_module_preview_screen_consent_privacy}}\\"></span></a>",\n                              "termsOfUse": "<a ng-href=\\"{{::aicdc.termsOfUseUrl}}\\"\n                              title=\\"{{::aicdc.termsOfUseUrl}}\\"\n                              rel=\\"noopener\n                              noreferrer\\"\n                              target=\\"_blank\\"><span translate-once=\\"{{::$root.resources.strings.inputExtension_task_module_preview_screen_consent_termsOfUse}}\\"></span></a>"}\'></span>\n    </div>\n  </modal-dialog>\n</div>'},2645:function(e,t,n){"use strict";"user strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2646),a=function(){function e(e,t){var n=this;this.$scope=e,this.utilityService=t,this.isChecked=!1,this.cancel=function(){n.$scope.closeThisDialog({confirm:!1})},this.isChecked=!1}return e.$inject=["$scope","utilityService"],e.prototype.confirm=function(){this.$scope.closeThisDialog({confirm:!0})},e}();t.AppUploadConsentDialogController=a,angular.module("teamspace.appUploadConsentDialog",["teamspace.dialogService","teamspace.utilityService","teamspace.tooltipService","teamspace.constants"]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put(e.files.templates.appUploadConsentDialog,i),t.register(e.lazyDialogs.appUploadConsent,{template:e.files.templates.appUploadConsentDialog,className:"ts-modal-dialog custom-width manifest-error-dialog new-dialog",showClose:!1,isPersistent:!0})}]).controller("AppUploadConsentDialogController",a)},2646:function(e,t){e.exports='<div class="app-upload-compliance-dialog-container" ng-controller="AppUploadConsentDialogController as aucdc" aria-modal="true" acc-role="dialog">\n\n  <modal-dialog left-align-buttons="true" add-close-icon="true" suppress-default-button="true" skip-auto-focus="true">\n    <div class="ts-modal-dialog-header">\n      <h1 class="app-font-family-base ts-modal-dialog-title">{{::$root.resources.strings.extensibility_apps_gallery_lob_apps_botcompliance_title|translate}}\n      </h1>\n    </div>\n    <div class="ts-modal-dialog-content">{{::$root.resources.strings.extensibility_apps_gallery_lob_apps_botcompliance_message|translate}}\n      <div class="section-child">\n        <label class="app-checkbox--label flush-left" acc-role="clickable">\n          <input type="checkbox" class="app-checkbox--input" ng-model="aucdc.isChecked"/>\n          <ng-include class="icons-checkbox-common icons-checkbox--unselected" aria-hidden="true" src="\'svg/icons-checkbox-unselected.html\'"></ng-include>\n          <ng-include class="icons-checkbox-common icons-checkbox--selected" aria-hidden="true" src="\'svg/icons-checkbox-selected.html\'"></ng-include>\n          <span class="app-checkbox--labelText">{{::$root.resources.strings.extensibility_apps_gallery_lob_apps_botcompliance_check_title|translate}}</span>\n        </label>\n      </div>\n    </div>\n\n    <div class="ts-modal-dialog-footer" left-align-buttons="true">\n      <div class="ts-modal-dialog-footer-buttons" left-align-buttons="true">\n        <div class="ts-modal-button-div">\n          <button ng-click="aucdc.confirm();" id="confirmButton" ng-disabled="!aucdc.isChecked" class="ts-btn ts-btn-fluent ts-btn-fluent-primary" data-tid="tidConfirmButton" acc-role="focus-default">{{::$root.resources.strings.extensibility_apps_gallery_lob_apps_botcompliance_confirm_button_title|translate}}\n        </button>\n        </div>\n        <div class="ts-modal-button-div">\n          <button class="ts-btn ts-btn-fluent ts-btn-fluent-secondary ngdialog-close" data-tid="closeButton" ng-click="aucdc.cancel();">{{::$root.resources.strings.extensibility_apps_gallery_lob_apps_botcompliance_cancel_button_title|translate}}</button>\n        </div>\n      </div>\n    </div>\n  </modal-dialog>\n</div>\n'},2647:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2648),s=function(){function e(e,t,n,i,a,s,o,r,l,p,c,d,g,u,h,m,v,f,b,y,S){this.$scope=e,this.$rootScope=t,this.$state=n,this.$timeout=i,this.appsService=a,this.appsExtensionDefinitionService=s,this.channelService=o,this.channelTeamSortHelper=r,this.constants=l,this.dialogService=p,this.extensionDefinitionService=c,this.eventingService=d,this.navigationService=g,this.loggingService=u,this.routeUtilityService=h,this.uiOrchestrator=m,this.analyticsService=v,this.settingsService=f,this.teamMembershipPropertiesService=b,this.teamSettingsService=y,this.utilityService=S,this.userNavHandlers={},this.teamNavHandlers={},this.chatNavHandlers={},this.navCtx="app-installed-2",this.app=e.ngDialogData.app,this.appIcon=this.app.appDefinition.largeImageUrl,this.appIconIfNotSvg=S.useNgIncludeForIcon(this.app.appDefinition.largeImageUrl)?"":this.app.appDefinition.largeImageUrl,this.iconAccentColor=this.app.appDefinition.accentColor,this.autoNavigationOnDone=e.ngDialogData.autoNavigationOnDone,this.teamId=e.ngDialogData.teamId,this.teamName=e.ngDialogData.teamName,this.channelId=e.ngDialogData.teamId,this.chatId=e.ngDialogData.chatId,this.preselectChannel=e.ngDialogData.preselectChannel,this.messageId=e.ngDialogData.messageId,this.dialogIntent=e.ngDialogData.dialogIntent,this.isUserIntent=e.ngDialogData.dialogIntent===teamspace.components.AddAppDialogIntent.User,this.isChatIntent=f.valueAsBoolean(l.settings.names.enableInstallChatAppsFromStore)&&e.ngDialogData.dialogIntent===teamspace.components.AddAppDialogIntent.GroupChat,this.category=(this.isUserIntent?"user_":"")+e.ngDialogData.category,this.storeLaunchFromChat=e.ngDialogData.storeLaunchFromChat,this.instantiateChannelData(),this.botMri=this.app.appDefinition.bots&&this.app.appDefinition.bots.length>0?l.bots.keyPrefix+this.app.appDefinition.bots[0].id:void 0,this.isSvg=S.useNgIncludeForIcon(this.app.appDefinition.largeImageUrl),this.instantiateNavHandlers(),this.dialogIntent!==teamspace.components.AddAppDialogIntent.Team&&this.evaluateDisabledCapabilitiesWarning()}return e.$inject=["$scope","$rootScope","$state","$timeout","appsService","appsExtensionDefinitionService","channelService","channelTeamSortHelper","constants","dialogService","extensionDefinitionService","eventingService","navigationService","loggingService","routeUtilityService","uiOrchestrator","analyticsService","settingsService","teamMembershipPropertiesService","teamSettingsService","utilityService"],e.prototype.channelSelected=function(){this.channels.length>0&&(this.channelId=this.channels[this.selectedChannelIndex].channelId)},e.prototype.navigate=function(e){if(this.eventingService.$emit(this.constants.events.app.closeGallery),this.$scope.closeThisDialog(),this.autoNavigationOnDone&&(this.dialogIntent===teamspace.components.AddAppDialogIntent.Team||this.dialogIntent===teamspace.components.AddAppDialogIntent.User||this.dialogIntent===teamspace.components.AddAppDialogIntent.GroupChat)){var t=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.appInstalledDialog.navigation);if(this.dialogIntent!==teamspace.components.AddAppDialogIntent.Team||this.channelId){var n=this.isUserIntent?this.userNavHandlers[e]:this.isChatIntent?this.chatNavHandlers[e]:this.teamNavHandlers[e];n?n.call(this,t):t.stop(this.getScenarioEventData())}else this.teamId&&(this.navigationService.navigateToTeam(this.teamId,this.navCtx),t.stop(this.getScenarioEventData()))}},e.prototype.instantiateNavHandlers=function(){this.userNavHandlers.bot=this.navigateToUserBot,this.userNavHandlers.tab=this.navigateToUserTab,this.userNavHandlers.composeExtension=this.navigateToUserComposeExtension,this.teamNavHandlers.bot=this.navigateToTeamBot,this.teamNavHandlers.tab=this.navigateToTeamTab,this.teamNavHandlers.connector=this.navigateToTeamConnector,this.teamNavHandlers.composeExtension=this.navigateToTeamComposeExtension,this.chatNavHandlers.bot=this.navigateToChatBot,this.chatNavHandlers.tab=this.navigateToChatTab},e.prototype.instantiateChannelData=function(){var e=this;this.selectedChannelIndex=0,this.teamId&&this.channelService.getTeamById(this.teamId).then(function(t){e.team=t;var n=0,i=[],a=e.channelTeamSortHelper.getVisibleAndOverflowChannels(e.team.channels);a.visibleChannels.concat(a.overflowChannels).forEach(function(t){if(t.objectId){e.preselectChannel===t.objectId&&(e.selectedChannelIndex=n,e.channelId=t.objectId);var a={type:teamspace.components.SelectorItemType.Channel,index:n++,channelId:t.objectId,text:t.displayName};i.push(a)}}),e.channels=i,e.evaluateDisabledCapabilitiesWarning()})},e.prototype.navigateToUserBot=function(e){var t=new teamspace.services.userApp.UserApp(this.app,!1);this.navigationService.navigateToUserApp(this.$scope,t),e.stop(this.getScenarioEventData()),this.logTelemetryForNavigation(teamspace.components.PanelActionScenario.navBot,this.app)},e.prototype.navigateToUserTab=function(e){var t=new teamspace.services.userApp.UserApp(this.app,!1);try{this.navigationService.navigateToUserApp(this.$scope,t),e.stop(this.getScenarioEventData()),this.logTelemetryForNavigation(teamspace.components.PanelActionScenario.navTab,this.app)}catch(t){e.fail(i(i({},this.getScenarioEventData()),{error:"Navigation to personal tab failed. "+t,error1:"Navigation to personal tab failed. "+t}))}},e.prototype.navigateToUserComposeExtension=function(e){var t=this;if(!this.storeLaunchFromChat&&this.settingsService.valueAsBoolean(this.constants.settings.names.enablePowerBarAtCommands)&&this.existPowerbarContext(this.app))try{var n=this.app.appDefinition.inputExtensions[0];this.$timeout(function(){t.eventingService.$emit(t.constants.events.powerBar.atCommandBox,{appId:t.app.appDefinition.id,botId:n.botId,name:t.app.appDefinition.name,description:t.app.appDefinition.shortDescription,imageUrl:t.app.appDefinition.largeImageUrl,imageUrlSmall:t.app.appDefinition.smallImageUrl,accentColor:t.app.appDefinition.accentColor,commands:n.commands,canUpdateConfiguration:n.canUpdateConfiguration,isFavorite:n.isFavorited,isFeatured:teamspace.services.AppsServiceUtils.isAppFeatured(t.app),isInstalledPersonally:t.app.appDefinition.isInstalledPersonally,favoriteRank:n.order})},0,!1),e.stop(this.getScenarioEventData()),this.logTelemetryForNavigation(teamspace.components.PanelActionScenario.navComposeExtension,this.app)}catch(t){e.fail(i(i({},this.getScenarioEventData()),{error:"Navigation to power bar for personal compose extension failed. "+t,error1:"Navigation to power bar for personal compose extension failed. "+t}))}else try{this.navigationService.navigateToLastChatState(this.navCtx);this.executeOnEditorSync(this.channelId,function(e){var n={appId:e,type:t.constants.events.funStuff.type.inputExtension};t.eventingService.$emit(t.constants.events.app.installed,n)}.bind(this,this.app.appDefinition.id)),e.stop(this.getScenarioEventData()),this.logTelemetryForNavigation(teamspace.components.PanelActionScenario.navComposeExtension,this.app)}catch(t){e.fail(i(i({},this.getScenarioEventData()),{error:"Navigation to personal compose extension failed. "+t,error1:"Navigation to personal compose extension failed. "+t}))}},e.prototype.existPowerbarContext=function(e){return!(e&&e.appDefinition&&e.appDefinition.inputExtensions&&e.appDefinition.inputExtensions[0].commands&&e.appDefinition.inputExtensions[0].commands.length>0)||!!_.find(e.appDefinition.inputExtensions[0].commands,function(e){return!e.context||e.context&&e.context.includes("Commandbox")})},e.prototype.navigateToTeamBot=function(e){var t=this;try{this.navigateToChannelMessage();var n=this.preselectChannel===this.channelId?this.messageId:void 0;this.executeOnEditorSync(this.channelId,function(e){var i={botProfile:{memberCount:0,accountEnabled:!0,displayName:t.app.appDefinition.name,mri:t.botMri,type:t.constants.atMentions.type.bot},messageId:n,type:t.constants.atMentions.type.bot};t.eventingService.$emit(t.constants.events.app.installed,i)}.bind(this),n),e.stop(this.getScenarioEventData()),this.logTelemetryForNavigation(teamspace.components.PanelActionScenario.navBot,this.app,this.teamId,this.channelId)}catch(t){e.fail(i(i({},this.getScenarioEventData()),{error:"Navigation to a team's channel to add a bot failed. "+t,error1:"Navigation to a team's channel to add a bot failed. "+t}))}},e.prototype.navigateToTeamComposeExtension=function(e){var t=this;try{this.navigateToChannelMessage();var n=this.preselectChannel===this.channelId?this.messageId:void 0;this.executeOnEditorSync(this.channelId,function(e){var i={appId:e,messageId:n,type:t.constants.events.funStuff.type.inputExtension};t.eventingService.$emit(t.constants.events.app.installed,i)}.bind(this,this.app.appDefinition.id),n),e.stop(this.getScenarioEventData()),this.logTelemetryForNavigation(teamspace.components.PanelActionScenario.navComposeExtension,this.app,this.teamId,this.channelId)}catch(t){e.fail(i(i({},this.getScenarioEventData()),{error:"Navigation to a team's channel to add a compose extension failed. "+t,error1:"Navigation to a team's channel to add a compose extension failed. "+t}))}},e.prototype.navigateToTeamTab=function(e){var t=this;try{this.navigationService.navigateToChannel(this.channelId,this.navCtx),this.extensionDefinitionService.getExtensionDefinition(this.app.appDefinition.id).then(function(e){var n=new teamspace.services.ExtensionInstanceViewModel(e,t.constants);t.dialogService.openLazyDialog(t.constants.lazyDialogs.tabInstanceConfiguration,t.constants.lazyModules.extensibilityTabs,{tabDefinition:e,tabInstance:n,threadId:t.channelId,operationType:teamspace.components.DialogTabMenuOperationType.AddTabSettings})}).catch(function(n){e.fail(i(i({},t.getScenarioEventData()),{error:"Navigation to a team's channel to add a tab failed. "+n,error1:"Navigation to a team's channel to add a tab failed. "+n}))}),e.stop(this.getScenarioEventData()),this.logTelemetryForNavigation(teamspace.components.PanelActionScenario.navTab,this.app,this.teamId,this.channelId)}catch(t){e.fail(i(i({},this.getScenarioEventData()),{error:"Navigation to a team's channel to add a tab failed. "+t,error1:"Navigation to a team's channel to add a tab failed. "+t}))}},e.prototype.navigateToTeamConnector=function(e){var t=this;try{this.navigationService.navigateToChannel(this.channelId,this.navCtx),this.channelService.getChannelById(this.channelId).then(function(e){t.channel=e,t.dialogService.openLazyDialog(t.constants.lazyDialogs.connectorsManager,t.constants.lazyModules.extensibilityDialogs,{team:t.team,channel:t.channel,connectorId:t.app.appDefinition.connectors[0].connectorId})}),e.stop(this.getScenarioEventData()),this.logTelemetryForNavigation(teamspace.components.PanelActionScenario.navConnector,this.app,this.teamId,this.channelId)}catch(t){e.fail(i(i({},this.getScenarioEventData()),{error:"Navigation to a team's channel to add a connector failed. "+t,error1:"Navigation to a team's channel to add a connector failed. "+t}))}},e.prototype.navigateToChatBot=function(e){var t=this;try{this.navigationService.navigateToChat(this.chatId,this.navCtx);this.executeOnEditorSyncForChat(this.chatId,function(e){var n={botProfile:{memberCount:0,accountEnabled:!0,displayName:t.app.appDefinition.name,mri:t.botMri,type:t.constants.atMentions.type.bot},messageId:null,type:t.constants.atMentions.type.bot};t.eventingService.$emit(t.constants.events.app.installed,n)}.bind(this)),e.stop(this.getScenarioEventData())}catch(t){e.fail(i(i({},this.getScenarioEventData()),{error:"Navigation to a chat to add a bot failed. "+t,error1:"Navigation to a chat to add a bot failed. "+t}))}},e.prototype.navigateToChatTab=function(e){var t=this;try{this.navigationService.navigateToChat(this.chatId,this.navCtx),this.appsService.getInstalledAppForGroupChat(this.chatId,this.app.appDefinition.id).then(function(e){var n=new teamspace.services.ExtensionDefinitionViewModel(t.appsExtensionDefinitionService.createTabExtensionDefinition(e.appDefinition),t.settingsService),i=new teamspace.services.ExtensionInstanceViewModel(n,t.constants);t.dialogService.openLazyDialog(t.constants.lazyDialogs.tabInstanceConfiguration,t.constants.lazyModules.extensibilityTabs,{tabDefinition:n,tabInstance:i,threadId:t.chatId,operationType:teamspace.components.DialogTabMenuOperationType.AddTabSettings})}),e.stop(this.getScenarioEventData())}catch(t){e.fail(i(i({},this.getScenarioEventData()),{error:"Navigation to a chat to add a tab failed. "+t,error1:"Navigation to a chat to add a tab failed. "+t}))}},e.prototype.executeOnEditorSync=function(e,t,n){var i=this,a=this.$rootScope.$on(this.constants.events.messages.focusInEditor,function(s,o){var r=o&&o.replyChainId;if(n&&n==r||!r&&!n){var l=i.routeUtilityService.getRootRouteParams();(!e||l&&l.threadId===e)&&i.uiOrchestrator.nextFrame(teamspace.services.UiOrchestratorPriority.Low,function(){t()}),a&&a()}})},e.prototype.executeOnEditorSyncForChat=function(e,t){var n=this,i=this.$rootScope.$on(this.constants.events.messages.focusInEditor,function(){var a=n.routeUtilityService.getRootRouteParams();(!e||a&&a.peopleSlug===e)&&n.uiOrchestrator.nextFrame(teamspace.services.UiOrchestratorPriority.Low,function(){t()}),i&&i()})},e.prototype.navigateToChannelMessage=function(){this.messageId&&this.preselectChannel===this.channelId?this.$state.go(this.constants.states.appConversation,{middlePane:this.constants.messages.panes.conversations,notify:!1,reload:!1,slug:"unknown",groupName:"unknown",threadId:this.channelId,messageId:this.messageId,openReply:!0,ctx:this.constants.navigation.context.channel,navCtx:this.constants.navContext.deepLink,deepLinkContext:this.constants.deepLinkTypes.channel}):this.navigationService.navigateToChannel(this.channelId,this.navCtx)},e.prototype.hasTeamScope=function(e){return!!(e&&e.length>0)&&_.every(e,function(e){return!!(e.scopes&&e.scopes.length>0)&&_.some(e.scopes,function(e){return"Team"===e})})},e.prototype.hasPersonalScope=function(e){return!!(e&&e.length>0)&&_.some(e,function(e){return!!(e.scopes&&e.scopes.length>0)&&_.some(e.scopes,function(e){return"Personal"===e})})},e.prototype.hasGroupChatScope=function(e){return!!(e&&e.length>0)&&_.some(e,function(e){return!!(e.scopes&&e.scopes.length>0)&&_.some(e.scopes,function(e){return"GroupChat"===e})})},e.prototype.logTelemetryForNavigation=function(e,t,n,i){var a=this,s={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.nav.toString(),teamspace.components.PanelActionOutcome,this.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(e.toString(),teamspace.components.PanelActionScenario,this.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.nav.toString(),teamspace.components.PanelActionScenarioType,this.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.navigationButton.toString(),teamspace.components.PanelModuleName,this.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.nav.toString(),teamspace.components.PanelModuleType,this.loggingService),summary:"Post app installation navigation"},app:teamspace.components.AppAnalyticsHelper.getAppAnalyticsData(t,n,i),dataBag:{teamId:n,channelId:i}};this.analyticsService.getAnalyticsPanelActionEventData(s).then(function(e){a.analyticsService.sendPanelAction(e)})},e.prototype.isAddingTabEnabled=function(){return this.dialogIntent!==teamspace.components.AddAppDialogIntent.Team||!this.teamId||(this.teamMembershipPropertiesService.isAdmin(this.team.objectId)||this.teamSettingsService.canAddTab(this.team.objectId))},e.prototype.isAddingConnectorEnabled=function(){return this.dialogIntent!==teamspace.components.AddAppDialogIntent.Team||!this.teamId||(this.teamMembershipPropertiesService.isAdmin(this.team.objectId)||this.teamSettingsService.canAddConnector(this.team.objectId))},e.prototype.evaluateDisabledCapabilitiesWarning=function(){this.showDisabledCapabilitiesWarning=this.app.appDefinition.galleryTabs&&this.app.appDefinition.galleryTabs.length>0&&!this.isAddingTabEnabled()||this.app.appDefinition.connectors&&this.app.appDefinition.connectors.length>0&&!this.isAddingConnectorEnabled()},e.prototype.getScenarioEventData=function(){return this.app?{appId:this.app.appDefinition.id,externalId:this.app.appDefinition.externalId,tenantId:this.app.appDefinition.tenantId}:null},e}();t.AppInstalledDialogV2Controller=s,angular.module("teamspace.appInstalledDialogV2",[]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put("components/extensibility/app-installed-dialog-v2/app-installed-dialog-v2.html",a),t.register(e.lazyDialogs.appInstalledV2,{template:"components/extensibility/app-installed-dialog-v2/app-installed-dialog-v2.html",className:"ts-modal-dialog custom-width ts-app-installed-dialog-v2",closeByEscape:!0,closeByDocument:!0,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"modalDialog-title"})}]).controller("AppInstalledDialogV2Controller",s)},2648:function(e,t){e.exports='<div class="ts-app-installed-dialog-v2 ts-modal-dialog-container" ng-controller="AppInstalledDialogV2Controller as aidc" acc-role="dialog">\n  <modal-dialog suppress-default-button="true" data-tid="appInstalledDialogV2" add-close-icon="true" skip-auto-focus="true">\n    <section class="app-installed-dialog-text">\n      <div class="image-container">\n          <ng-include src="aidc.app.appDefinition.largeImageUrl" ng-if="::aidc.useNgIncludeForIcon"></ng-include>\n          <img ng-src="{{::aidc.app.appDefinition.largeImageUrl}}" ng-if="::!aidc.useNgIncludeForIcon"/>\n      </div>\n      <h1 ng-if="::aidc.isUserIntent" class="installed-title">\n        <span class="app-font-title2-semibold" dir="auto" translate-with-html-params translate-id="extensibility_installed_dialog_title_for_you" translate-values=\'{"appName":"{{aidc.app.appDefinition.name}}"}\'>\n        </span>\n      </h1>\n      <h1 ng-if="::(!aidc.isUserIntent && !aidc.isChatIntent)" class="installed-title">\n        <div class="app-font-title2-semibold installed-title-text" translate-with-html-params translate-id="extensibility_installed_dialog_install_app" translate-values=\'{"appName":"{{aidc.app.appDefinition.name}}", "teamName": "{{aidc.teamName}}"}\'></div>\n      </h1>\n      <h1 ng-if="::aidc.isChatIntent" class="installed-title">\n        <div class="app-font-title2-semibold installed-title-text" translate-with-html-params translate-id="extensibility_installed_dialog_title_for_chat" translate-values=\'{"appName":"{{aidc.app.appDefinition.name}}"}\'></div>\n      </h1>\n    </section>\n    <section ng-if="::(!aidc.isUserIntent && !aidc.isChatIntent)" class="channel-selector">\n      <span class="text app-font-base app-gray-02" translate-once="{{::$root.resources.strings.extensibility_installed_dialog_select_channel}}"></span>\n      <dropdown-select class="app-installed-dialog-channel-selector" ds-options="::aidc.channels" ds-text-field="text" ds-value-field="index" ds-selected-value="aidc.selectedChannelIndex" ds-on-change="aidc.channelSelected()">\n      </dropdown-select>\n    </section>\n    <section class="app-installed-dialog-user-guides">\n      <span class="text-features app-font-base app-gray-02" translate-once="{{::$root.resources.strings.extensibility_installed_dialog_set_up_feature}}"></span>\n      <div class="user-guide" ng-if="::(aidc.app.appDefinition.bots && aidc.app.appDefinition.bots.length > 0 && aidc.hasTeamScope(aidc.app.appDefinition.bots) && !aidc.isUserIntent && !aidc.isChatIntent)" aria-label="{{::$root.resources.strings.extensibility_consent_badge_bot|translate}} {{::$root.resources.strings.extension_addAppDialog_bot_capability|translate}}">\n        <div class="badge-icon"><ng-include class="icon" src="\'svg/icons-bot.html\'"></ng-include></div>\n        <div class="context">\n          <span class="type" translate-once="{{::$root.resources.strings.extensibility_consent_badge_bot}}"></span>\n          <div class="capability">\n            <span class="use-case app-gray-02" title="{{::$root.resources.strings.extension_addAppDialog_bot_capability|translate}}" translate-once="{{::$root.resources.strings.extension_addAppDialog_bot_capability}}"></span>\n          </div>\n        </div>\n        <button class="ts-btn ts-btn-secondary inset-border" data-tid="navigate-team-bot" ng-click="aidc.navigate(\'bot\')" track-click-silent="true"><span translate-once="{{::$root.resources.strings.extensibility_installed_dialog_go}}"></span></button>\n      </div>\n      <div class="user-guide" ng-if="::(((aidc.app.appDefinition.staticTabs && aidc.app.appDefinition.staticTabs.length > 0 && aidc.hasTeamScope(aidc.app.appDefinition.staticTabs)) || (aidc.app.appDefinition.galleryTabs && aidc.app.appDefinition.galleryTabs.length > 0 && aidc.hasTeamScope(aidc.app.appDefinition.galleryTabs))) && !aidc.isUserIntent && !aidc.isChatIntent)" aria-label="{{::$root.resources.strings.extensibility_consent_badge_tab|translate}} {{::$root.resources.strings.extension_addAppDialog_tab_capability|translate}}">\n        <div class="badge-icon"><ng-include class="icon" src="\'svg/icons-tab-badge.html\'"></ng-include></div>\n        <div class="context">\n          <span class="type" translate-once="{{::$root.resources.strings.extensibility_consent_badge_tab}}"></span>\n          <div class="capability">\n            <span class="use-case app-gray-02" title="{{::$root.resources.strings.extension_addAppDialog_tab_capability|translate}}" translate-once="{{::$root.resources.strings.extension_addAppDialog_tab_capability}}"></span>\n          </div>\n        </div>\n        <button class="ts-btn ts-btn-secondary inset-border" data-tid="navigate-team-tab" ng-disabled="aidc.app.appDefinition.galleryTabs && aidc.app.appDefinition.galleryTabs.length > 0 && !aidc.isAddingTabEnabled()" ng-click="aidc.navigate(\'tab\')" track-click-silent="true">\n          <span translate-once="{{::$root.resources.strings.extensibility_installed_dialog_go}}"></span>\n        </button>\n      </div>\n      <div class="user-guide" ng-if="::(aidc.app.appDefinition.connectors && aidc.app.appDefinition.connectors.length > 0 && aidc.hasTeamScope(aidc.app.appDefinition.connectors) && !aidc.isUserIntent && !aidc.isChatIntent)" aria-label="{{::$root.resources.strings.extensibility_consent_badge_connector|translate}} {{::$root.resources.strings.extension_addAppDialog_connector_capability|translate}}">\n        <div class="badge-icon"><ng-include class="icon" src="\'svg/icons-connector-badge.html\'"></ng-include></div>\n        <div class="context">\n          <span class="type" translate-once="{{::$root.resources.strings.extensibility_consent_badge_connector}}"></span>\n          <div class="capability">\n            <span class="use-case app-gray-02" title="{{::$root.resources.strings.extension_addAppDialog_connector_capability|translate}}" translate-once="{{::$root.resources.strings.extension_addAppDialog_connector_capability}}"></span>\n          </div>\n        </div>\n        <button class="ts-btn ts-btn-secondary inset-border" data-tid="navigate-team-connector" ng-disabled="aidc.app.appDefinition.connectors && aidc.app.appDefinition.connectors.length > 0 && !aidc.isAddingConnectorEnabled()" ng-click="aidc.navigate(\'connector\')" track-click-silent="true">\n          <span translate-once="{{::$root.resources.strings.extensibility_installed_dialog_go}}"></span>\n        </button>\n      </div>\n      <div class="user-guide" ng-if="::(aidc.app.appDefinition.inputExtensions && aidc.app.appDefinition.inputExtensions.length > 0 && aidc.hasTeamScope(aidc.app.appDefinition.inputExtensions) && !aidc.isUserIntent && !aidc.isChatIntent)" aria-label="{{::$root.resources.strings.extensibility_apps_messaging_option|translate}} {{::$root.resources.strings.extension_addAppDialog_compose_extension_capability|translate}}">\n        <div class="badge-icon"><ng-include class="icon" src="\'svg/icons-compose-extension-badge.html\'"></ng-include></div>\n        <div class="context">\n          <span class="type" translate-once="{{::$root.resources.strings.extensibility_apps_messaging_option}}"></span>\n          <div class="capability">\n            <span class="use-case app-gray-02" title="{{::$root.resources.strings.extension_addAppDialog_compose_extension_capability|translate}}" translate-once="{{::$root.resources.strings.extension_addAppDialog_compose_extension_capability}}"></span>\n          </div>\n        </div>\n        <button class="ts-btn ts-btn-secondary inset-border" data-tid="navigate-team-messaging" ng-click="aidc.navigate(\'composeExtension\')" track-click-silent="true"><span translate-once="{{::$root.resources.strings.extensibility_installed_dialog_go}}"></span></button>\n      </div>\n      <div class="user-guide" aria-label="{{::$root.resources.strings.extensibility_consent_badge_bot|translate}} {{::$root.resources.strings.extension_addAppDialog_personal_bot_use|translate}}" ng-if="::(aidc.app.appDefinition.bots && aidc.app.appDefinition.bots.length > 0 && aidc.hasPersonalScope(aidc.app.appDefinition.bots) && aidc.isUserIntent)">\n        <div class="badge-icon"><ng-include class="icon" src="\'svg/icons-bot.html\'"></ng-include></div>\n        <div class="context" id="ts-app-installed-dialog-v2-bot-label">\n          <span class="type" translate-once="{{::$root.resources.strings.extensibility_consent_badge_bot}}"></span>\n          <div class="capability">\n            <span class="use-case app-gray-02" title="{{::$root.resources.strings.extension_addAppDialog_personal_bot_use|translate}}" translate-once="{{::$root.resources.strings.extension_addAppDialog_personal_bot_use}}"></span>\n          </div>\n        </div>\n        <button class="ts-btn ts-btn-secondary inset-border" data-tid="navigate-personal-bot" ng-click="aidc.navigate(\'bot\')" track-click-silent="true" aria-describedby="ts-app-installed-dialog-v2-bot-label">\n          <span translate-once="{{::$root.resources.strings.extensibility_installed_dialog_open}}"></span>\n        </button>\n      </div>\n      <div class="user-guide" aria-label="{{::$root.resources.strings.extensibility_installed_dialog_app|translate}} {{::$root.resources.strings.extension_addAppDialog_personal_app_use|translate}}" ng-if="::(aidc.app.appDefinition.staticTabs && aidc.app.appDefinition.staticTabs.length > 0 && aidc.hasPersonalScope(aidc.app.appDefinition.staticTabs) && aidc.isUserIntent)">\n        <div class="badge-icon"><ng-include class="icon" src="\'svg/icons-person.html\'"></ng-include></div>\n        <div class="context" id="ts-app-installed-dialog-v2-app-label">\n          <span class="type" translate-once="{{::$root.resources.strings.extensibility_installed_dialog_app}}"></span>\n          <div class="capability">\n            <span class="use-case app-gray-02" title="{{::$root.resources.strings.extension_addAppDialog_personal_app_use|translate}}" translate-once="{{::$root.resources.strings.extension_addAppDialog_personal_app_use}}"></span>\n          </div>\n        </div>\n        <button class="ts-btn ts-btn-secondary inset-border" data-tid="navigate-personal-tab" ng-click="aidc.navigate(\'tab\')" track-click-silent="true" aria-describedby="ts-app-installed-dialog-v2-app-label">\n          <span translate-once="{{::$root.resources.strings.extensibility_installed_dialog_open}}"></span>\n        </button>\n      </div>\n      <div class="user-guide" ng-if="::(aidc.app.appDefinition.inputExtensions && aidc.app.appDefinition.inputExtensions.length > 0 && aidc.hasPersonalScope(aidc.app.appDefinition.inputExtensions) && aidc.isUserIntent)" aria-label="{{::$root.resources.strings.extensibility_apps_messaging_option|translate}} {{::$root.resources.strings.extension_addAppDialog_personal_compose_extension_use|translate}}">\n        <div class="badge-icon"><ng-include class="icon" src="\'svg/icons-compose-extension-badge.html\'"></ng-include></div>\n        <div class="context" id="ts-app-installed-dialog-v2-compose-extension-label">\n          <span class="type" translate-once="{{::$root.resources.strings.extensibility_apps_messaging_option}}"></span>\n          <div class="capability">\n            <span class="use-case app-gray-02" title="{{::$root.resources.strings.extension_addAppDialog_personal_compose_extension_use|translate}}" translate-once="{{::$root.resources.strings.extension_addAppDialog_personal_compose_extension_use}}"></span>\n          </div>\n        </div>\n        <button class="ts-btn ts-btn-secondary inset-border" data-tid="navigate-personal-messaging" ng-click="aidc.navigate(\'composeExtension\')" track-click-silent="true" aria-describedby="ts-app-installed-dialog-v2-compose-extension-label">\n          <span translate-once="{{::$root.resources.strings.extensibility_installed_dialog_open}}"></span>\n        </button>\n      </div>\n      <div class="user-guide" ng-if="aidc.app.appDefinition.bots && aidc.app.appDefinition.bots.length > 0 && aidc.hasGroupChatScope(aidc.app.appDefinition.bots) && aidc.isChatIntent" aria-label="{{::$root.resources.strings.extensibility_consent_badge_bot|translate}} {{::$root.resources.strings.extension_addAppDialog_bot_capability|translate}}">\n        <div class="badge-icon"><ng-include class="icon" src="\'svg/icons-bot.html\'"></ng-include></div>\n        <div class="context">\n          <span class="type" translate-once="{{::$root.resources.strings.extensibility_consent_badge_bot}}"></span>\n          <div class="capability">\n            <span class="use-case app-gray-02" title="{{::$root.resources.strings.extension_addAppDialog_bot_capability|translate}}" translate-once="{{::$root.resources.strings.extension_addAppDialog_bot_capability}}"></span>\n          </div>\n        </div>\n        <button class="ts-btn ts-btn-secondary inset-border" data-tid="navigate-chat-bot" ng-click="aidc.navigate(\'bot\')" track-click-silent="true"><span translate-once="{{::$root.resources.strings.extensibility_installed_dialog_go}}"></span></button>\n      </div>\n      <div class="user-guide" ng-if="aidc.app.appDefinition.galleryTabs && aidc.app.appDefinition.galleryTabs.length > 0 && aidc.hasGroupChatScope(aidc.app.appDefinition.galleryTabs) && aidc.isChatIntent" aria-label="{{::$root.resources.strings.extensibility_consent_badge_tab|translate}} {{::$root.resources.strings.extension_addAppDialog_tab_capability_for_chat|translate}}">\n        <div class="badge-icon"><ng-include class="icon" src="\'svg/icons-tab-badge.html\'"></ng-include></div>\n        <div class="context">\n          <span class="type" translate-once="{{::$root.resources.strings.extensibility_consent_badge_tab}}"></span>\n          <div class="capability">\n            <span class="use-case app-gray-02" title="{{::$root.resources.strings.extension_addAppDialog_tab_capability_for_chat|translate}}" translate-once="{{::$root.resources.strings.extension_addAppDialog_tab_capability_for_chat}}"></span>\n          </div>\n        </div>\n        <button class="ts-btn ts-btn-secondary inset-border" data-tid="navigate-chat-tab" ng-click="aidc.navigate(\'tab\')" track-click-silent="true">\n          <span translate-once="{{::$root.resources.strings.extensibility_installed_dialog_go}}"></span>\n        </button>\n      </div>\n    </section>\n    <section ng-if="::aidc.showDisabledCapabilitiesWarning" class="permission-error caption" translate-once="{{::$root.resources.strings.extension_installed_dialog_tabDisabled}}">\n    </section>\n  </modal-dialog>\n</div>'},2649:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2650),a=n(124),s=function(){function e(t,n,i,a,s,o,r,l,p,c,d,g,u,h,m,v,f,b){this.$q=t,this.$document=n,this.$timeout=i,this.constants=a,this.ariaLiveService=s,this.channelService=o,this.channelTeamSortHelper=r,this.chatListService=l,this.chatSearchService=p,this.chatTitlesService=c,this.conversationsService=d,this.peopleService=g,this.teamMembershipPropertiesService=u,this.teamSettingsService=h,this.settingsService=m,this.loggingService=v,this.$translate=f,this.resources=b,this.searchString="",this.chats=[],this.teams=[],this.teamAndChannelConcatenatedList=[],this.showSuggestion=!0,this.showDropDown=!1,this.currentIndex=0;var y=this.initializeAllTeams();this.preselectChat&&this.appHasGroupChatScope&&this.initializeChat(this.preselectChat),this.appHasTeamScope&&this.initializeDefaultTeams(e.DEFAULT_TEAM_SIZE),this.appHasGroupChatScope&&this.initializeDefaultChats(e.DEFAULT_CHAT_SIZE,!1),this.isAddAppDialogV3&&(this.appInstallScope===teamspace.components.AppInstallScope.GroupChat?this.initializeDefaultChats(e.DEFAULT_CHAT_SIZE,!1):this.appInstallScope===teamspace.components.AppInstallScope.Meeting?this.initializeDefaultChats(e.DEFAULT_CHAT_SIZE,!0):this.initializeDefaultTeamAndChannels(y,e.DEFAULT_TEAM_SIZE))}return e.$inject=["$q","$document","$timeout","constants","ariaLiveService","channelService","channelTeamSortHelper","chatListService","chatSearchService","chatTitlesService","conversationsService","peopleService","teamMembershipPropertiesService","teamSettingsService","settingsService","loggingService","$translate","resources"],e.prototype.showSelectorDropdown=function(){this.currentIndex=0,this.showDropDown=!0},e.prototype.closeSelectorDropdown=function(e){var t=e&&e.target;this.isChatAndTeamSelectorElement(t)||(this.showDropDown=!1)},e.prototype.filterBySearch=function(){var t=this,n=this.searchString&&this.searchString.toLowerCase();this.currentIndex=0,this.isAddAppDialogV3?this.appInstallScope===teamspace.components.AppInstallScope.Team?(this.searchTeamsAndChannels(n),this.announceSearchResultsChanged(this.getSearchResultsLength())):this.appInstallScope===teamspace.components.AppInstallScope.GroupChat?this.searchChats(n,!1).then(function(){return t.announceSearchResultsChanged(t.getSearchResultsLength())}):this.appInstallScope===teamspace.components.AppInstallScope.Meeting&&this.searchChats(n,!0).then(function(){return t.announceSearchResultsChanged(t.getSearchResultsLength())}):(_.isEmpty(n)?(this.showSuggestion=!0,this.appHasTeamScope&&this.initializeDefaultTeams(e.DEFAULT_TEAM_SIZE),this.appHasGroupChatScope&&this.initializeDefaultChats(e.DEFAULT_CHAT_SIZE,!1),this.appInstallScope==teamspace.components.AppInstallScope.Meeting&&this.initializeDefaultChats(e.DEFAULT_CHAT_SIZE,!0)):(this.showSuggestion=!1,this.appHasTeamScope&&this.searchTeams(n),this.appHasGroupChatScope&&this.searchChats(n,!1)),this.announceSearchResultsChanged(this.getSearchResultsLength())),this.isDropdownVisible()||this.showSelectorDropdown()},e.prototype.selectItem=function(e){this.searchString=e.text,this.selectedItem=e,this.setSelectedItem()},e.prototype.selectedItemAriaLabel=function(){return this.selectedItem?this.selectedItem.type===teamspace.components.SelectorItemType.Chat?this.$translate.instant(this.resources.strings.aria_chat_remove,{chatName:this.selectedItem.text.replace(">","")}):this.$translate.instant(this.resources.strings.aria_team_remove,{teamName:this.selectedItem.text.replace(">","")}):""},e.prototype.resetSelectedItem=function(){var e=this;this.selectedItem&&(this.selectedItem=null,this.searchString="",this.$timeout(function(){var t=angular.element("#"+e.inputId);t&&t.focus()}),this.setSelectedItem())},e.prototype.hoverRow=function(e){this.currentIndex=e},e.prototype.handleKeyDown=function(e){if(this.showDropDown)if(e.which===this.constants.keyCodes.down)e.preventDefault(),this.currentIndex=this.currentIndex>=this.getSearchResultsLength()-1?0:this.currentIndex+1,this.narrateCurrentItem(this.currentIndex);else if(e.which===this.constants.keyCodes.up)e.preventDefault(),this.currentIndex=this.currentIndex>0?this.currentIndex-1:this.getSearchResultsLength()-1,this.narrateCurrentItem(this.currentIndex);else if(e.which===this.constants.keyCodes.enter){e.preventDefault();var t=this.getCurrentItem(this.currentIndex);this.selectItem(t),this.closeSelectorDropdown(),this.$timeout(function(){var e=angular.element("#chat-and-team-selector-close-button");e&&e.focus()})}else e.which===this.constants.keyCodes.tab?this.closeSelectorDropdown():e.which===this.constants.keyCodes.escape&&(this.closeSelectorDropdown(),e.preventDefault(),e.stopPropagation())},e.prototype.announceSearchResultsChanged=function(e){var t="";t=e<=0?this.$translate.instant(this.resources.strings.extension_chatPicker_search_result_update_no_match):1==e?this.$translate.instant(this.resources.strings.extension_chatPicker_search_result_update_1_match):this.$translate.instant(this.resources.strings.extension_chatPicker_search_result_update_multiple_matches,{num:e}),this.ariaLiveService.update(t)},e.prototype.setSelectedItem=function(){this.onItemSelected&&this.onItemSelected({selectedItem:this.selectedItem})},e.prototype.initializeAllTeams=function(){var e=this;return this.allTeams=[],this.enableChannelFilter&&this.settingsService.valueAsBoolean(this.constants.settings.names.enableChannelIdSupportAppInstallation)?this.channelService.getTeams().then(function(t){(t=_.filter(t,function(t){return t.objectId===e.preselectTeam})).forEach(function(t){var n=e.convertTeamSelector(t);e.allTeams.push(n)})}):this.channelService.getTeams().then(function(t){t=_.filter(t,function(e){return!e.isArchived}),(t=e.filterTeamsBySideloadingPermission(t)).sort(),t.forEach(function(t){var n=e.convertTeamSelector(t);e.preselectTeam===t.objectId&&e.selectItem(n),e.allTeams.push(n)})})},e.prototype.searchTeams=function(e){var t=this;this.teams=[],this.allTeams.forEach(function(n){n.text&&n.text.toLowerCase().contains(e)&&t.teams.push(n)})},e.prototype.searchTeamsAndChannels=function(e){this.teamAndChannelConcatenatedList=[];var t=e.split(" ");this.teamAndChannelConcatenatedList=this.teamAndChannelSearchInstance.search(t).getResults(5)},e.prototype.isGeneralChannel=function(e){var t=this.channelService.getParentTeamAndChannelByChannelId(e.channelId);return t&&t.channel&&t.channel.isGeneral},e.prototype.createGeneralChannel=function(e){return{name:this.$translate.instant(this.resources.strings.channel_general),channelId:e,type:teamspace.components.SelectorItemType.Channel,index:-1}},e.prototype.searchChats=function(t,n){var i=this;this.chats=[];var a={groupOnly:!1,ignoreCase:!0};return this.chatSearchService.retrieveChats(t,a).then(function(t){var a;return a=n?_.filter(t,function(e){return!i.shouldFilterChat(e,!1)}):_.filter(t,function(e){return!i.shouldFilterChat(e,!0)}),a=a.slice(0,e.MAX_CHAT_SIZE),i.convertChatsToSelectors(a)})},e.prototype.initializeDefaultChats=function(e,t){var n=this;if(!this.preselectChat||!this.initializeChat(this.preselectChat)){this.chats=[];var i=this.chatListService.getChatConversations(teamspace.services.ChatListType.RECENTS),a=[];a=t?_.filter(i,function(e){return!n.shouldFilterChat(e,!1)}).slice(0,e):_.filter(i,function(e){return!n.shouldFilterChat(e,!0)}).slice(0,e),this.convertChatsToSelectors(a)}},e.prototype.getTeamlist=function(e){var t=this;return this.channelService.getTeams().then(function(n){n=_.filter(n,function(e){return!e.isArchived}),n=t.filterTeamsBySideloadingPermission(n);var i=t.channelTeamSortHelper.createOrderedTeamLists(n),a=_.union(i.favoriteTeamsByOrder,i.moreTeamsByName).slice(0,e);return t.$q.resolve(a)})},e.prototype.initializeDefaultTeams=function(e){var t=this;this.teams=[],this.getTeamlist(e).then(function(e){e.forEach(function(e){t.teams.push(t.convertTeamSelector(e))})})},e.prototype.initializeDefaultTeamAndChannels=function(e,t){var n=this;this.teamAndChannelConcatenatedList=[],this.getTeamlist().then(function(e){if(n.preselectTeam)for(var i=0,a=e;i<a.length;i++)if((p=a[i]).objectId===n.preselectTeam){var s=n.convertTeamSelector(p);return void n.selectItem(n.convertTeamAndChannelSelector(s,n.createGeneralChannel(s.teamId)))}for(var o=0,r=0,l=e;r<l.length;r++){var p=l[r];if(o>t)break;(s=n.convertTeamSelector(p)).installAppEnabled&&(n.teamAndChannelConcatenatedList.push(n.convertTeamAndChannelSelector(s,n.createGeneralChannel(s.teamId))),o++)}});var i=this.$translate.instant(this.resources.strings.channel_general);e.then(function(){var e=[];n.allTeams.forEach(function(t){if(t.text&&t.installAppEnabled){var i=n.convertTeamAndChannelSelector(t,n.createGeneralChannel(t.teamId));e.push(i),t.channels&&t.channels.length&&t.channels.forEach(function(i){if(!n.isGeneralChannel(i)){var a=n.convertTeamAndChannelSelector(t,i);e.push(a)}})}}),n.teamAndChannelSearchInstance=new a.Search(e,[new a.LevenshteinDistanceStrategy("teamname",{tokenizer:new a.SplitAndLeadingSubStrsTokenizer,getTargetText:function(e){return e.teamName.toLocaleLowerCase()},getThreshold:function(e){return e/2}}),new a.LevenshteinDistanceStrategy("channelname",{tokenizer:new a.SplitAndLeadingSubStrsTokenizer,getThreshold:function(e){return e/2},getTargetText:function(e){return e.channelName===i?e.teamName.toLocaleLowerCase():e.channelName.toLocaleLowerCase()}})])})},e.prototype.filterTeamsBySideloadingPermission=function(e){var t=this;return this.settingsService.valueAsBoolean(this.constants.settings.names.enableSideloadingEnforcement)&&this.appIsSideloaded?_.filter(e,function(e){return t.teamSettingsService.canUploadCustomApp(e.objectId)||t.teamMembershipPropertiesService.isAdmin(e.objectId)}):e},e.prototype.convertGroupChatSelector=function(e){var t=this;return this.chatTitlesService.buildChatTitles(e.id).then(function(n){var i=n?n.title:"",a=n?n.pictureMembers:[],s=t.peopleService.getPlGroupKeyFromPictureGroup(a);return{type:teamspace.components.SelectorItemType.Chat,id:e.id,text:i,pictureGroup:a,plGroupKey:s,isGroupChat:!0}})},e.prototype.convertOneOnOneChatSelector=function(e){return this.chatTitlesService.buildChatTitles(e.id).then(function(t){var n=t?t.title:"";return{type:teamspace.components.SelectorItemType.Chat,id:e.id,text:n,upn:e.otherMembers[0].upn||e.otherMembers[0].nameHint&&e.otherMembers[0].nameHint.upn||e.otherMembers[0].mri,displayName:e.otherMembers[0].nameHint&&e.otherMembers[0].nameHint.displayName||e.title,isGroupChat:!1}})},e.prototype.convertTeamAndChannelSelector=function(e,t){return{type:teamspace.components.SelectorItemType.Channel,index:null,teamId:e.teamId,teamName:e.text,channelName:t.name,channelId:t.channelId,text:e.text+" > "+t.name,installAppEnabled:e.installAppEnabled,teamPicture:e.teamPicture,groupId:e.groupId,thumbnailUri:e.thumbnailUri,pictureETag:e.pictureETag,smtpAddress:e.smtpAddress}},e.prototype.convertTeamSelector=function(e){var t=this.conversationsService.getConversation(e.objectId),n=t?t.threadProperties[SkypeX.Services.ChatServiceUtils.ThreadProp_Picture]:null;n=n?n+this.constants.amsImageTemplate.thumbnail:null;var i,a=this.teamMembershipPropertiesService.isAdmin(e.objectId);i=this.settingsService.valueAsBoolean(this.constants.settings.names.enableSideloadingEnforcement)&&this.appIsSideloaded?this.teamSettingsService.canUploadCustomApp(e.objectId)||a:this.teamSettingsService.canAddApp(e.objectId);var s=void 0===a||void 0===i||(a||i);return{type:teamspace.components.SelectorItemType.Team,index:null,teamId:e.objectId,text:e.displayName,channels:this.convertChannelSelector(e.channels),installAppEnabled:s,teamPicture:n,groupId:e.siteInfo.groupId,thumbnailUri:e.thumbnailUri,pictureETag:e.pictureETag,smtpAddress:e.smtpAddress}},e.prototype.isChatAndTeamSelectorElement=function(e){return angular.element(e).closest("input.chat-and-team-selector-search").length>0},e.prototype.isDropdownVisible=function(){return!!this.$document.find("div.chat-and-team-dropdown")[0]},e.prototype.shouldFilterChat=function(e,t){var n=e.isHidden||e.isOneOnOneBotChat||!e.isUserMember||e.isSfB||e.isFederated||e.isThreadDisabled||SkypeX.Services.SkypeConversationLocal.isLie(e.id);return t?n||e.isMeeting:n||!e.isMeeting},e.prototype.convertChatsToSelectors=function(e){var t=this,n=[],i=this.loggingService.newScenario(this.constants.scenarios.extensibility.chatAndTeamSelector.buildChatTitles);return e.forEach(function(e){var i=e.isOneOnOne?t.convertOneOnOneChatSelector(e):t.convertGroupChatSelector(e);n.push(i),i.then(function(e){t.chats.push(e)})}),this.$q.all(n).then(function(){i.stop()}).catch(function(e){i.fail({error:e})})},e.prototype.convertChannelSelector=function(e){var t=[];return e.forEach(function(e){t.push({channelId:e.objectId,name:e.displayName})}),t},e.prototype.getSearchResultsLength=function(){return this.teams.length+this.chats.length+this.teamAndChannelConcatenatedList.length},e.prototype.getCurrentItem=function(e){return this.isAddAppDialogV3&&this.appInstallScope===teamspace.components.AppInstallScope.Team?this.teamAndChannelConcatenatedList[e]:e>this.teams.length-1?this.chats[e-this.teams.length]:this.teams[e]},e.prototype.narrateCurrentItem=function(e){var t=this.getCurrentItem(e).text+" "+this.$translate.instant(this.resources.strings.aria_chatandteamselector_position_count,{position:this.currentIndex+1,count:this.getSearchResultsLength()});this.ariaLiveService.update(t,!0)},e.prototype.initializeChat=function(e){var t=this,n=this.chatListService.getChatConversation(teamspace.services.ChatListType.PINNED,e),i=this.chatListService.getChatConversation(teamspace.services.ChatListType.RECENTS,e),a=n||i;if(!a){var s=this.chats.find(function(t){return t.id===e});return!!s&&(this.selectItem(s),!0)}return(a.isOneOnOne?this.convertOneOnOneChatSelector(a):this.convertGroupChatSelector(a)).then(function(e){t.selectItem(e)}),!0},e.DEFAULT_CHAT_SIZE=4,e.DEFAULT_TEAM_SIZE=4,e.MAX_CHAT_SIZE=20,e}();t.ChatAndTeamSelectorController=s,angular.module("teamspace.chatAndTeamSelector",[]).directive("chatAndTeamSelector",function(){return{restrict:"E",scope:{},bindToController:{isAddAppDialogV3:"<",appInstallScope:"<",appHasTeamScope:"<",appHasGroupChatScope:"<",appIsSideloaded:"<",onItemSelected:"&",inputId:"@",preselectTeam:"<",preselectChat:"<",enableChannelFilter:"<"},templateUrl:"components/extensibility/chat-and-team-selector/chat-and-team-selector.html",controllerAs:"chatAndTeamSelector",controller:s}}).run(["$templateCache",function(e){e.put("components/extensibility/chat-and-team-selector/chat-and-team-selector.html",i)}])},2650:function(e,t){e.exports='<div class="ts-chat-and-team-selector ts-div" role="search">\n  <div outside-click="chatAndTeamSelector.closeSelectorDropdown()" class="ts-div">\n    <input sanitized class="ts-header-search ts-heading-font ng-valid-maxlength chat-and-team-selector-search single-line-truncation" ng-model="chatAndTeamSelector.searchString" placeholder="{{::$root.resources.strings.search_placeholderText|translate}}" id="{{chatAndTeamSelector.inputId}}" autocapitalize="off" autocorrect="off" autocomplete="off" acc-focus-default maxlength="150" ng-click="chatAndTeamSelector.showSelectorDropdown($event)" ng-change="chatAndTeamSelector.filterBySearch()" ng-disabled="chatAndTeamSelector.selectedItem" ng-keydown="chatAndTeamSelector.handleKeyDown($event)" title="{{::$root.resources.strings.extension_teamOrChannelPicker_inputBoxTitle|translate}}">\n    <div class="input-group-btn ts-div">\n      <button class="ts-sym icons-search" ng-if="!chatAndTeamSelector.selectedItem" ng-click="chatAndTeamSelector.filterBySearch()" data-tid="searchBtn" aria-label="{{::$root.resources.strings.search_placeholderText|translate}}" tabindex="-1">\n        <ng-include src="\'svg/icons-search.html\'"></ng-include>\n      </button>\n      <button class="ts-sym icons-search app-icons-fill-hover" ng-if="chatAndTeamSelector.selectedItem" ng-click="chatAndTeamSelector.resetSelectedItem(); chatAndTeamSelector.filterBySearch()" data-tid="closeBtn" aria-label="{{chatAndTeamSelector.selectedItemAriaLabel()}}" id="chat-and-team-selector-close-button" tabindex="0">\n        <ng-include src="\'svg/icons-close.html\'"></ng-include>\n      </button>\n    </div>\n  </div>\n</div>\n<div class="chat-and-team-dropdown" ng-if="chatAndTeamSelector.showDropDown">\n  <div class="dropdown-menu" acc-role="menu">\n    <div class="dropdown-menu-area">\n      <div class="dropdown-menu-content" simple-scrollbar scroll-helper scroll-current-index="chatAndTeamSelector.currentIndex" scroll-list-item-selector=".dropdown-item" scroll-list-element=".dropdown-menu-content">\n        <div class="dropdown-menu-items">\n          \x3c!-- Team Selector --\x3e\n          <div ng-if="chatAndTeamSelector.appHasTeamScope && chatAndTeamSelector.teams.length > 0" class="chat-and-team-dropdown-label">\n            <span ng-if="chatAndTeamSelector.showSuggestion" class="results-label app-small-font">\n              {{::$root.resources.strings.extension_addAppDialog_suggestions_team_label|translate}}\n            </span>\n            <span ng-if="!chatAndTeamSelector.showSuggestion" class="results-label app-small-font">\n              {{::$root.resources.strings.extension_addAppDialog_search_team_results_label|translate}}\n            </span>\n          </div>\n          <div ng-repeat="item in chatAndTeamSelector.teams track by $index" acc-role="menu-item" ng-mouseenter="chatAndTeamSelector.hoverRow($index)">\n            <button class="ts-sym dropdown-item" type="button" aria-hidden="true" ng-click="chatAndTeamSelector.selectItem(item)" ng-class="{ \'ts-selectedRow\': $index == chatAndTeamSelector.currentIndex}">\n              \x3c!-- Picture Load for Teams --\x3e\n              <div class="profile-img-parent">\n                <profile-picture css-class="profile-img team-icon" display-name="item.text" team-id="item.groupId" etag="item.pictureETag" source="chat-and-teams-selector-dropdown"></profile-picture>\n              </div>\n\n              <div class="result-data">\n                <div class="result-title single-line-truncation" title="{{item.text}}">\n                  {{item.text}}\n                </div>\n              </div>\n            </button>\n          </div>\n\n          \x3c!-- Chat Selector --\x3e\n          <div ng-if="chatAndTeamSelector.appHasGroupChatScope && chatAndTeamSelector.chats.length > 0" class="chat-and-team-dropdown-label">\n            <span ng-if="chatAndTeamSelector.showSuggestion" class="results-label app-small-font">\n              {{::$root.resources.strings.extension_addAppDialog_suggestions_chat_label|translate}}\n            </span>\n            <span ng-if="!chatAndTeamSelector.showSuggestion" class="results-label app-small-font">\n              {{::$root.resources.strings.extension_addAppDialog_search_chat_results_label|translate}}\n            </span>\n          </div>\n          <div ng-repeat="item in chatAndTeamSelector.chats track by $index" acc-role="menu-item" ng-mouseenter="chatAndTeamSelector.hoverRow($index + chatAndTeamSelector.teams.length)">\n            <button class="ts-sym dropdown-item" type="button" aria-hidden="true" ng-click="chatAndTeamSelector.selectItem(item)" ng-class="{ \'ts-selectedRow\': ($index + chatAndTeamSelector.teams.length) == chatAndTeamSelector.currentIndex}">\n              \x3c!-- Picture Load for Groups --\x3e\n              <div class="profile-img-parent" ng-if="item.isGroupChat">\n                <profile-picture css-class="ts-contact-image" group-id="item.plGroupKey" group-users="item.pictureGroup" source="chat-and-team-selector-dropdown"></profile-picture>\n              </div>\n\n              \x3c!-- Picture Load for Persons --\x3e\n              <div class="profile-img-parent" ng-if="!item.isGroupChat">\n                <profile-picture css-class="ts-contact-image" principal-name="item.upn" display-name="item.displayName" source="chat-and-team-selector-dropdown"></profile-picture>\n              </div>\n\n              <div class="result-data">\n                <div class="result-title single-line-truncation" title="{{item.text}}">\n                  {{item.text}}\n                </div>\n              </div>\n            </button>\n          </div>\n\n\n          \x3c!-- Team and Channel Selector --\x3e\n          <div ng-repeat="item in chatAndTeamSelector.teamAndChannelConcatenatedList track by $index" acc-role="menu-item" ng-mouseenter="chatAndTeamSelector.hoverRow($index)">\n            <button class="ts-sym dropdown-item" type="button" aria-hidden="true" ng-click="chatAndTeamSelector.selectItem(item)" ng-class="{ \'ts-selectedRow\': ($index + chatAndTeamSelector.teams.length + chatAndTeamSelector.chats.length) == chatAndTeamSelector.currentIndex}">\n              <div class="team-and-channel-picture">\n                <div class="profile-img-parent">\n                  <profile-picture css-class="profile-img team-icon" display-name="item.text" team-id="item.groupId" etag="item.pictureETag" source=""></profile-picture>\n                </div>\n              </div>\n              <div class="team-and-channel-names">\n                <div ng-class="{ \'app-font-base-semibold\': $index == chatAndTeamSelector.currentIndex }">\n                  {{item.channelName}}\n                </div>\n                <div class="app-font-caption-regular">{{item.teamName}}</div>\n              </div>\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'},2651:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(2652),o=n(143),r=n(33);!function(e){e[e.Cancel=0]="Cancel",e[e.Save=1]="Save",e[e.Remove=2]="Remove"}(a||(a={}));var l=function(e){function t(t,n,i,a,s,o,r,l,p,c,d,g,u,h,m,v,f,b,y){var S=e.call(this,t,n,i,a,s,o,l,c,d,g,u,h,m,f,y)||this;return S.$q=t,S.$sce=n,S.$scope=i,S.$element=a,S.$interval=s,S.$timeout=o,S.$translate=r,S.$window=l,S.resources=p,S.constants=c,S.loggingService=d,S.extensionTabService=g,S.utilityService=u,S.sdkHelperService=h,S.settingsService=m,S.uiOrchestrator=v,S.htmlSanitizer=f,S.desktopUtilityService=b,S.navigationService=y,S.buttonIndex=0,S.removeTimer=null,S.saveTimer=null,S.saveFooterButtonText=r.instant(p.strings.extensibility_connectorInstanceConfigurationDialog_save),S.removeFooterButtonText=r.instant(p.strings.extensibility_connectorInstanceConfigurationDialog_remove),S.logger=d.newLogger("ConnectorInstanceConfiguration"),S.updateDialogConext(),i.$on("$destroy",function(){S.stopLoadTimer(),S.loadScenario&&(S.cancelScenario(S.loadScenario,"connectorConfigurationDestroyed"),S.loadScenario=null),S.saveTimer&&(o.cancel(S.saveTimer),S.saveTimer=null),S.removeTimer&&(o.cancel(S.removeTimer),S.removeTimer=null),S.frame=null}),S.iFrameTitle=r.instant(p.strings.extension_iFrame_ConnectorConfigurationTitle,{appName:u.stripHtml(u.escapeHtml(S.context.appDefinition.name))}),S}return i(t,e),t.$inject=["$q","$sce","$scope","$element","$interval","$timeout","$translate","$window","resources","constants","loggingService","extensionTabService","utilityService","sdkHelperService","settingsService","uiOrchestrator","htmlSanitizer","desktopUtilityService","navigationService"],t.prototype.createMessageHandler=function(t){var n=e.prototype.createMessageHandler.call(this,t);return n.addMessageHandler(this.constants.SdkMessageTypes.settings.setValidityState,this.handleSetValidityState.bind(this)),n.addMessageHandler(this.constants.SdkMessageTypes.settings.getSettings,this.handleGetSettings.bind(this)),n.addMessageHandler(this.constants.SdkMessageTypes.settings.setSettings,this.handleSetSettings.bind(this)),n.addMessageHandler(this.constants.SdkMessageTypes.settings.save.success,this.handleSaveSuccess.bind(this)),n.addMessageHandler(this.constants.SdkMessageTypes.settings.save.failure,this.handleSaveFailure.bind(this)),n},t.prototype.beginLoad=function(e){var t=this;return this.extensionTabService.formatTabUrl(e,{entityId:this.context.entityId}).then(function(e){return t.extensionTabService.isValidTabUrl(e,t.definitionId,!1).then(function(n){if(!n)return t.$q.reject("Attempted to load an invalid "+t.context.appDefinition.connectors[0].connectorId+" connector url ");t.loadScenario&&(t.cancelScenario(t.loadScenario,"connectorConfigurationReloaded"),t.loadScenario=null);var i="";i=t.context.appDefinition.externalId?"ext_view_connector_configuration_"+t.frameContext+"_sideloaded":"ext_view_connector_configuration_"+t.frameContext+"_"+(t.definitionId||"extension"),t.loadScenario=t.startScenario(i),t.setContainerUrl(e),t.startLoadTimer()})})},t.prototype.onLoadHandler=function(){this.stopLoadTimer(),this.loadScenario&&(this.stopScenario(this.loadScenario),this.loadScenario=null)},t.prototype.updateDialogConext=function(){switch(this.definitionId=this.context.appDefinition.id,this.frameContext="settings",this.context.operationType){case o.ConnectorDialogOperationType.AddConnectorInstance:this.footerButtons=[this.createDefaultButton(a.Cancel),this.createDefaultButton(a.Save)],this.buttonIndex=1,this.biScenarioName=teamspace.components.PanelActionScenario.addConnector,this.beginLoad(this.context.appDefinition.connectors[0].configurationUrl);break;case o.ConnectorDialogOperationType.ManageConnectorInstance:this.footerButtons=[this.createDefaultButton(a.Cancel),this.createDefaultButton(a.Remove),this.createDefaultButton(a.Save)],this.context.displayWebhookB2Message&&(this.context.footerMessage=this.$translate.instant(this.resources.strings.extensibility_connectorInstanceConfigurationDialog_recreateConnectorWebhookB2URLFooterMessage)),this.buttonIndex=2,this.biScenarioName=teamspace.components.PanelActionScenario.updateConnector,this.beginLoad(this.context.contentUrl)}this.context.footerButtons=this.footerButtons},t.prototype.createDefaultButton=function(e){var t=this;switch(e){case a.Cancel:return{text:this.$translate.instant(this.resources.strings.extensibility_connectorInstanceConfigurationDialog_cancel),func:function(){return t.cancelButtonClicked()},tid:"connectorInstanceConfiguration-backBtn",disabled:this.context.isBusy,secondaryStyle:!0,outcome:teamspace.components.PanelActionOutcome.nav,scenario:teamspace.components.PanelActionScenario.backToConnectorGallery,scenarioType:teamspace.components.PanelActionScenarioType.connectorMgmt,type:teamspace.components.PanelModuleType.nav,name:teamspace.components.PanelModuleName.connectorBackButtonClick,summary:"Back Button to Connector Gallery"};case a.Save:return{text:this.saveFooterButtonText,func:function(){return t.saveButtonClicked()},tid:"connectorInstanceConfiguration-saveBtn",disabled:!0,outcome:teamspace.components.PanelActionOutcome.submit,scenario:this.biScenarioName,scenarioType:teamspace.components.PanelActionScenarioType.connectorMgmt,type:teamspace.components.PanelModuleType.submit,name:teamspace.components.PanelModuleName.connectorSaveClick,summary:"Save Connector Configuration Button"};case a.Remove:return{text:this.removeFooterButtonText,func:function(){return t.removeButtonClicked()},tid:"connectorInstanceConfiguration-removeBtn",disabled:this.context.isBusy,secondaryStyle:!0,outcome:teamspace.components.PanelActionOutcome.submit,scenario:teamspace.components.PanelActionScenario.removeConnector,scenarioType:teamspace.components.PanelActionScenarioType.connectorMgmt,type:teamspace.components.PanelModuleType.submit,name:teamspace.components.PanelModuleName.connectorRemoveClick,summary:"Remove Connector Configuration Button"};default:return null}},t.prototype.setContainerUrl=function(e){var t=this,n=this.utilityService.parseUrl(e);this.sdkWindowMessageHandler&&(this.sdkWindowMessageHandler.destroy(),this.sdkWindowMessageHandler=null),this.frameSrc?(this.frameSrc="",this.$timeout(function(){t.frameSrc=n.href},0,!1)):this.frameSrc=n.href},t.prototype.handleSetValidityState=function(e,t){t=Boolean(t),this.context.footerButtons[this.buttonIndex].disabled=!t},t.prototype.handleGetSettings=function(e){return this.context?{entityId:this.context.entityId,webhookUrl:this.context.webhookUrl,contentUrl:this.context.contentUrl,configName:this.context.configName,userObjectId:this.context.userObjectId,appType:this.context.appType}:(this.logger.error("Connectors: Connector context is not available for get settings."),null)},t.prototype.handleSetSettings=function(e,t){this.context?(this.context.configName=t.configName?String(t.configName):null,this.context.entityId=t.entityId?String(t.entityId):null,this.context.contentUrl=t.contentUrl?String(t.contentUrl):null):this.logger.error("Connectors: Connector context is not available for set settings.")},t.prototype.handleSaveSuccess=function(e){if(!this.context)return this.logger.error("Connectors: Connector context is not available for handleSaveSuccess."),null;this.context.onSave(this.context)},t.prototype.handleSaveFailure=function(e,t){if(!this.context)return this.logger.error("Connectors: Connector context is not available for handleSaveFailure."),null;this.changeSaveButtonState(!0,this.$translate.instant(this.resources.strings.extensibility_connectorInstanceConfigurationDialog_save),this.$translate.instantWithoutEncoding(this.resources.strings.extensibility_connectorInstanceConfigurationDialog_savingConfiguration_failed,{appName:this.context.appDefinition.name})),this.context.operationType===o.ConnectorDialogOperationType.ManageConnectorInstance&&this.changeRemoveButtonState(!0),this.saveTimer&&(this.$timeout.cancel(this.saveTimer),this.saveTimer=null),this.context.onFailure(_.assign(this.context,{errorMessage:t}))},t.prototype.cancelButtonClicked=function(){this.context.onCancel(this.context)},t.prototype.saveButtonClicked=function(){var e=this;this.changeSaveButtonState(!1,this.$translate.instant(this.resources.strings.extensibility_connectorInstanceConfigurationDialog_saving),this.$translate.instantWithoutEncoding(this.resources.strings.extensibility_connectorInstanceConfigurationDialog_savingConfigurationFooterMessage,{appName:this.context.appDefinition.name})),this.context.operationType===o.ConnectorDialogOperationType.ManageConnectorInstance&&this.changeRemoveButtonState(!1),this.saveTimer&&(this.$timeout.cancel(this.saveTimer),this.saveTimer=null),this.saveTimer=this.$timeout(function(){e.changeSaveButtonState(!0,e.$translate.instant(e.resources.strings.extensibility_connectorInstanceConfigurationDialog_save),e.$translate.instantWithoutEncoding(e.resources.strings.extensibility_connectorInstanceConfigurationDialog_savingConfiguration_failed,{appName:e.context.appDefinition.name})),e.context.operationType===o.ConnectorDialogOperationType.ManageConnectorInstance&&e.changeRemoveButtonState(!0),e.context.onFailure(_.assign(e.context,{errorMessage:"Timeout"}))},t.saveTimeout),this.sdkWindowMessageHandler.sendRequestMessage(this.frame,"settings.save")},t.prototype.removeButtonClicked=function(){var e=this;this.changeRemoveButtonState(!1,this.$translate.instant(this.resources.strings.extensibility_connectorInstanceConfigurationDialog_removing),this.$translate.instantWithoutEncoding(this.resources.strings.extensibility_connectorInstanceConfigurationDialog_removingConfigurationFooterMessage,{appName:this.context.appDefinition.name})),this.changeSaveButtonState(!1),this.removeTimer&&(this.$timeout.cancel(this.removeTimer),this.removeTimer=null),this.removeTimer=this.$timeout(function(){e.changeRemoveButtonState(!0,e.$translate.instant(e.resources.strings.extensibility_connectorInstanceConfigurationDialog_remove),e.$translate.instantWithoutEncoding(e.resources.strings.extensibility_connectorInstanceConfigurationDialog_removingConfiguration_failed,{appName:e.context.appDefinition.name})),e.changeSaveButtonState(!0)},t.removeTimeout),this.sdkWindowMessageHandler.sendRequestMessage(this.frame,"settings.remove"),this.context.onRemove(this.context)},t.prototype.changeSaveButtonState=function(e,t,n){this.context.isBusy=!e,this.context.footerButtons[this.buttonIndex].disabled=!e,t&&(this.context.footerButtons[this.buttonIndex].text=t),n&&(this.context.footerMessage="",this.context.footerMessage=n)},t.prototype.changeRemoveButtonState=function(e,t,n){this.context.isBusy=!e,this.context.footerButtons[1].disabled=!e,t&&(this.context.footerButtons[1].text=t),n&&(this.context.footerMessage="",this.context.footerMessage=n)},t.prototype.startLoadTimer=function(){var e=this;this.stopLoadTimer(),this.loadTimer=this.$timeout(function(){e.loadScenario&&(e.failScenario(e.loadScenario,"connectorConfigurationTimedOut"),e.loadScenario=null),e.loadTimer=null},t.loadTimeout,!1)},t.prototype.stopLoadTimer=function(){this.loadTimer&&(this.$timeout.cancel(this.loadTimer),this.loadTimer=null)},t.prototype.startScenario=function(e){return this.loggingService.newScenario(e)},t.prototype.stopScenario=function(e){this.context&&this.context.appDefinition&&this.context.appDefinition.externalId&&(e.eventData.externalId=this.context.appDefinition.externalId),e.stop()},t.prototype.failScenario=function(e,t){e.fail({errorInfo:e.name+"_failed_"+t})},t.prototype.cancelScenario=function(e,t){e.cancel({errorInfo:e.name+"_cancelled_"+t})},t.loadTimeout=15e3,t.removeTimeout=3e4,t.saveTimeout=3e4,t}(r.ExtensionFrameBase);t.ConnectorInstanceConfigurationController=l,angular.module("teamspace.connectorInstanceConfiguration",[]).run(["$templateCache",function(e){e.put("components/extensibility/connector-instance-configuration/connector-instance-configuration.html",s)}]).directive("connectorInstanceConfiguration",[function(){return{restrict:"E",replace:!0,bindToController:{context:"=?"},controllerAs:"connectorInstanceConfiguration",templateUrl:"components/extensibility/connector-instance-configuration/connector-instance-configuration.html",controller:l}}])},2652:function(e,t){e.exports='  <embedded-page-container ng-if="connectorInstanceConfiguration.frameSrc" class="extension-connector-configuration-container" url="{{connectorInstanceConfiguration.frameSrc}}" enable-message-passing="true" on-content-loaded="connectorInstanceConfiguration.onContentLoaded(isSuccessful, frameInfo)" on-message-received="connectorInstanceConfiguration.onMessageReceived(source, data, origin)" iframe-title="{{::connectorInstanceConfiguration.iFrameTitle}}" page-identifier="{{connectorInstanceConfiguration.frameContext + \'_\' + connectorInstanceConfiguration.context.appDefinition.id}}">\n  </embedded-page-container>'},2653:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2654),a=n(143),s=function(){function e(e){this.definition=e.ngDialogData.appDefinition,e.ngDialogData.action===a.ConnectorDialogOperationType.AddConnectorInstance?this.instanceConfigurationContext={operationType:a.ConnectorDialogOperationType.AddConnectorInstance,appDefinition:this.definition,webhookUrl:e.ngDialogData.webhookUrl,userObjectId:e.ngDialogData.userObjectId,appType:e.ngDialogData.appType,targetOrigin:e.ngDialogData.targetOrigin,onSave:e.ngDialogData.onSave,onFailure:e.ngDialogData.onFailure,onCancel:e.ngDialogData.onCancel}:e.ngDialogData.action===a.ConnectorDialogOperationType.ManageConnectorInstance&&(this.instanceConfigurationContext={operationType:a.ConnectorDialogOperationType.ManageConnectorInstance,appDefinition:this.definition,webhookUrl:e.ngDialogData.webhookUrl,contentUrl:e.ngDialogData.contentUrl,entityId:e.ngDialogData.entityId,configName:e.ngDialogData.configName,userObjectId:e.ngDialogData.userObjectId,appType:e.ngDialogData.appType,targetOrigin:e.ngDialogData.targetOrigin,displayWebhookB2Message:e.ngDialogData.displayWebhookB2Message,onSave:e.ngDialogData.onSave,onFailure:e.ngDialogData.onFailure,onCancel:e.ngDialogData.onCancel,onRemove:e.ngDialogData.onRemove}),this.isSvg=!_.startsWith(this.definition.largeImageUrl,"data:")&&!_.startsWith(this.definition.largeImageUrl,"https:")}return e.$inject=["$scope"],e}();t.ConnectorInstanceConfigurationDialogController=s,angular.module("teamspace.connectorInstanceConfigurationDialog",[]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put("components/extensibility/connector-instance-configuration-dialog/connector-instance-configuration-dialog.html",i),t.register(e.lazyDialogs.connectorInstanceConfigurationDialog,{template:"components/extensibility/connector-instance-configuration-dialog/connector-instance-configuration-dialog.html",className:"ts-modal-dialog custom-width ts-connector-instance-configuration-dialog",closeByEscape:!0,closeByDocument:!0,disableAnimation:!1,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"modalDialog-title",ariaDescribedById:"connector-configuration-definition-summary"})}]).controller("ConnectorInstanceConfigurationDialogController",s)},2654:function(e,t){e.exports='<div class="ts-connector-instance-config" ng-controller="ConnectorInstanceConfigurationDialogController as cicdc" data-tid="connector-instance-config-dialog">\n  <modal-dialog dialog-title="{{cicdc.definition.name}}" footer-buttons="cicdc.instanceConfigurationContext.footerButtons" footer-message="cicdc.instanceConfigurationContext.footerMessage" is-footer-message-important="cicdc.instanceConfigurationContext.displayWebhookB2Message" suppress-default-button="true" dialog-busy="cicdc.instanceConfigurationContext.isBusy" add-close-icon="true">\n    <section>\n      <div class="ts-connector-configuration-definition">\n        <div class="ts-connector-configuration-definition-icon">\n          <ng-include src="::cicdc.definition.largeImageUrl" ng-if="::cicdc.isSvg"></ng-include>\n          <img class="image-icon" ng-src="{{cicdc.definition.largeImageUrl}}" ng-style="{ \'background\': cicdc.definition.accentColor }" ng-if="::!cicc.isSvg"/>\n        </div>\n        <div class="ts-connector-configuration-definition-info">\n          <div class="ts-connector-configuration-definition-summary" id="connector-configuration-definition-summary">{{::cicdc.definition.longDescription}}</div>\n          <div class="ts-connector-configuration-definition-summary">\n            <a ng-if="::cicdc.definition.developerUrl" ng-href="{{::cicdc.definition.developerUrl}}" rel="noopener noreferrer" target="_blank" translate-once="{{::$root.resources.strings.extension_tabLearnMoreLabel}}">\n            </a>\n          </div>\n        </div>\n      </div>\n    </section>\n\n    <section class="flex-fill ts-connector-configuration-custom-settings">\n      <connector-instance-configuration directive-flex-fill="true" context="::cicdc.instanceConfigurationContext"></connector-instance-configuration>\n    </section>\n  </modal-dialog>\n</div>'},2655:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2656),a=n(143),s=function(){function e(e,t,n,i,a,s,o,r,l,p,c,d,g,u,h,m,v,f,b,y,S,A,D,C){var I=this;if(this.$location=e,this.$q=t,this.$element=i,this.$scope=a,this.$timeout=s,this.appStateService=o,this.eventingService=r,this.$window=p,this.appsService=c,this.authenticationService=d,this.channelMembershipPropertiesService=g,this.teamSettingsService=u,this.constants=h,this.dialogService=m,this.appDetailsDialogService=v,this.loggingService=f,this.settingsService=y,this.localizationService=S,this.utilityService=A,this.isOffline=!1,this.isClarificationShown=!1,this.enableConnectorApps=y.valueAsBoolean(h.settings.names.enableConnectorApps),this.gccH=this.isGccH(),this.isClarificationShown=y.valueAsBoolean(h.settings.names.enableConnectorClarificationShown)&&!this.isOffline,this.enableInlineConnectorConfiguration=y.valueAsBoolean(h.settings.names.enableInlineConnectorConfiguration),this.team=a.ngDialogData.team,this.channel=a.ngDialogData.channel,this.connectorId=a.ngDialogData.connectorId,this.dialogTitle=l.instantWithoutEncoding(b.strings.connectorsManager_dialogTitle,{teamName:this.team.displayName,channelName:this.channel.displayName}),this.isDesktopApp=y.valueAsBoolean(h.settings.names.isDesktopApp),this.loadingScenario=f.newScenario(h.scenarios.extensibility.connectors.viewConnectorsManager),this.loadingScenario.appendEventData({connectorChannelType:teamspace.services.ChannelType[this.channel.channelType]}),this.handleOfflineAppState(),this.registerOfflineEventHandler(a),!this.isOffline){this.enableConnectorApps&&(this.getApps=c.getTeamAppDefinitions(this.channel.parentTeamId,void 0,"connectors-manager-dialog",{category:teamspace.services.AppsServiceCategoryFilter.Connectors},!0));var T=[];T.push(d.getSkypeTokens().then(function(e){I.skypeToken=e.skypeToken})),T.push(C.getServiceEndpoint(D.serviceHost).then(function(e){I.chatServiceHost=e}));var P=this.gccH?h.connectors.resourceUriGccH:h.connectors.resourceUri;T.push(d.getAuthTokens([P]).then(function(e){I.accessToken=e})),t.all(T).then(function(){I.initConnectorsSiteUrl(),s(function(){I.frame=p.document.getElementById("connectorsTileFrame"),I.frame.onload=function(){I.loadingScenario&&I.loadingScenario.mark("frame_load_or_redirect_complete")},I.frame.onerror=function(){I.loadingScenario&&(I.loadingScenario.fail(),I.loadingScenario=null)};var e=function(e){return I.processMessage(e)};p.addEventListener("message",e),a.$on("$destroy",function(){p.removeEventListener("message",e),I.loadingScenario&&(f.warn("Connectors - closed before loading finished"),I.loadingScenario.cancel(),I.loadingScenario=null)}),I.frame.src=n.trustAsResourceUrl(I.url),I.registerDialogCloseKeyDownHandler()}).catch(function(e){I.loadingScenario&&(I.loadingScenario.fail(e),I.loadingScenario=null)})})}}return e.$inject=["$location","$q","$sce","$element","$scope","$timeout","appStateService","eventingService","$translate","$window","appsService","authenticationService","channelMembershipPropertiesService","teamSettingsService","constants","dialogService","appDetailsDialogService","loggingService","resources","settingsService","localizationService","utilityService","chatServiceClient","geoRoutingService"],e.prototype.handleOfflineAppState=function(){this.appStateService.isOnline&&this.appStateService.isConnected||(this.loggingService.error("Connectors: Client Offline detection on initial load, Showing offline page."),this.failLoadingScenarioWithMarker("dialog_offline_or_disconnected_on_load"),this.isOffline=!0)},e.prototype.registerOfflineEventHandler=function(e){var t=this;this.eventingService.$on(e,this.constants.events.appState.changed,function(e,n){n.newState!==teamspace.services.ApplicationState.Offline&&n.newState!==teamspace.services.ApplicationState.Disconnected||(t.loggingService.error("Connectors: Client Offline detection on app state transition, Showing offline page."),t.failLoadingScenarioWithMarker("dialog_offline_or_disconnected_on_transition"),t.isOffline=!0)})},e.prototype.registerDialogCloseKeyDownHandler=function(){var t=this,n=this.$element.find(e.dialogCloseElementClass);n.length>0&&n.keydown(function(e){e.keyCode===t.constants.keyCodes.tab&&e.shiftKey&&(e.stopImmediatePropagation(),e.preventDefault())})},e.prototype.failLoadingScenarioWithMarker=function(e){this.loadingScenario&&(this.loadingScenario.mark(e),this.loadingScenario.fail(),this.loadingScenario=null)},e.prototype.processMessage=function(t){var n=this;this.$timeout(function(){if(t){var i=t.origin||t.originalEvent.origin;if(n.constants.connectors.management.eventDomainsAllowList.indexOf(i)<0)return void n.loggingService.info("Connectors: Ignoring event from domain not in allow-list - "+i);var a;try{a=JSON.parse(t.data)}catch(e){return void n.loggingService.error("Connectors: Did not receive valid JSON in event")}if(n.loggingService.info("Connectors: Received event - "+a.action),a.hasOwnProperty("keyEvent")){if("OnCancelMainEvent"===a.keyEvent)return void n.$scope.closeThisDialog();if("TabOnLastSection"===a.keyEvent){var s=n.$element.find(e.dialogCloseElementClass);if(s.length>0)return void s.focus()}}if(a.action&&a.action.endsWith("Error")){n.loadingScenario&&(n.loadingScenario.fail(a.data),n.loadingScenario=null);var o=n.loggingService.newScenario(n.constants.scenarios.extensibility.connectors.viewConnectorsErrorEvent);o.fail(a.data),o=null,a.data.hasOwnProperty("nonPIIInfo")&&delete a.data.nonPIIInfo,n.loggingService.error("Received error from connectors "+JSON.stringify(a.data))}else if("ListeningForToken"===a.action){n.loadingScenario&&n.loadingScenario.mark("ListeningForTokenReceived");var r={eventName:"AuthenticateUsingToken",authToken:n.accessToken,ssToken:n.skypeToken,teamId:n.team.objectId},l=JSON.stringify(r);n.frame.contentWindow.postMessage(l,i)}else if("ListeningForTeamsConnectors"===a.action){if(n.enableConnectorApps&&n.getApps){n.loadingScenario&&n.loadingScenario.mark("ListeningForTeamsConnectorsReceived");var p=n.appsService.getInstalledAppsForTeam(n.channel.parentTeamId,void 0,{category:teamspace.services.AppsServiceCategoryFilter.Connectors});n.$q.all([n.getApps,p]).then(function(e){if(e[0]&&e[1]){for(var t=e[0],a=e[1],s={},o=0;o<a.length;o++)s[a[o].appDefinition.id.toLowerCase()]=a[o];for(var r=n.channelMembershipPropertiesService.isAdmin(n.channel.objectId)||n.teamSettingsService.canAddApp(n.team.objectId),l=[],p=[],c=[],o=0;o<t.length;o++){var d=t[o],g=s[d.id];if(!g||!teamspace.services.AppsServiceUtils.isAppDeprecated(g)){var u=d.connectors[0].connectorId;n.appsService.isSideloadedApp(d)?l.push(u):g&&teamspace.services.AppsServiceUtils.isAppInstalled(g)?g.appDefinition&&g.appDefinition.tenantId?l.push(u):p.push(u):r&&c.push(u)}}var h={eventName:"SetTeamsConnectors",sideloadedConnectors:l,installedConnectors:p,featuredConnectors:c},m=JSON.stringify(h);if(n.frame.contentWindow.postMessage(m,i),!n.settingsService.valueAsBoolean(n.constants.settings.names.disablePostInstallConnectorConfig)&&n.connectorId){var v={eventName:"InstallAppComplete",connector:n.connectorId,success:!0},f=JSON.stringify(v);n.frame.contentWindow.postMessage(f,i),n.connectorId=null}}})}}else"FirstTimeLoadCompleted"===a.action?n.AddTabOnCloseEventHandler(i):"InstallAppForConnector"===a.action?n.enableConnectorApps&&n.installAppForConnector(a.connector).then(function(e){var t={eventName:"InstallAppComplete",connector:a.connector,success:e,name:a.name},s=JSON.stringify(t);n.frame.contentWindow.postMessage(s,i)}):"AllowWindowOpen"===a.action?n.enableConnectorApps&&n.allowWindowOpen(a.url).then(function(e){var t={eventName:"WindowOpenAllowed",url:a.url,success:e},s=JSON.stringify(t);n.frame.contentWindow.postMessage(s,i)}):"Connector.Add"===a.action?n.configure(a,i):"Connector.Show"===a.action?n.manage(a,i):"Connector.Close"===a.action?n.configurationDialog&&n.configurationDialog.close():(n.loadingScenario&&(n.loadingScenario.stop(),n.loadingScenario=null),n.isDesktopApp&&n.frame.contentWindow.postMessage(t.data,i))}})},e.prototype.AddTabOnCloseEventHandler=function(t){var n=this,i=this.$element.find(e.dialogCloseElementClass);i.length>0&&$(i).keydown(function(e){e.keyCode===n.constants.keyCodes.tab&&(e.stopPropagation(),n.frame.contentWindow.postMessage({eventName:"TabKeyDownOnCloseButton"},t))})},e.prototype.initConnectorsSiteUrl=function(){var e=this.constants.connectors.management,t=this.gccH?e.siteUrlSSOGccH:e.siteUrlSSO,n=this.authenticationService.getLoggedInUser(),i=this.team.siteInfo.groupId+"@"+n.profile.tid,a=this.constants.connectors.management.defaultParameterValues.client,s=this.channel.objectId.toString(),o=this.channel.displayName.substring(0,this.constants.connectors.management.constraints.maxChannelNameLength),r=this.localizationService.getLocale(),l=this.$location.host(),p=this.constants.connectors.management.defaultParameterValues.environment,c=this.constants.connectors.management.defaultParameterValues.format,d=this.settingsService.getActiveTheme(),g="";g=this.utilityService.appendToQueryString(g,e.parameters.groupMailboxSmtp,this.utilityService.encodeUriComponentIncludingApostrophe(i)),g=this.utilityService.appendToQueryString(g,e.parameters.client,this.utilityService.encodeUriComponentIncludingApostrophe(a)),g=this.utilityService.appendToQueryString(g,e.parameters.thread,this.utilityService.encodeUriComponentIncludingApostrophe(s)),g=this.utilityService.appendToQueryString(g,e.parameters.hostname,this.utilityService.encodeUriComponentIncludingApostrophe(l)),g=this.utilityService.appendToQueryString(g,e.parameters.culture,this.utilityService.encodeUriComponentIncludingApostrophe(r)),g=this.utilityService.appendToQueryString(g,e.parameters.upn,this.utilityService.encodeUriComponentIncludingApostrophe(n.profile.upn)),g=this.utilityService.appendToQueryString(g,e.parameters.environment,this.utilityService.encodeUriComponentIncludingApostrophe(p));try{g=this.utilityService.appendToQueryString(g,e.parameters.channelName,this.utilityService.encodeUriComponentIncludingApostrophe(o))}catch(e){this.loggingService.warn("initConnectorsSiteUrl: Unable to encode Channel Name: "+o+", skipping...")}g=this.utilityService.appendToQueryString(g,e.parameters.chatServiceHost,this.utilityService.getHostNameFromUrl(this.chatServiceHost)),g=this.utilityService.appendToQueryString(g,e.parameters.iframe,this.constants.connectors.management.defaultParameterValues.iframe),g=this.utilityService.appendToQueryString(g,e.parameters.theme,this.utilityService.encodeUriComponentIncludingApostrophe(d)),g=this.utilityService.appendToQueryString(g,e.parameters.ssTokenType,this.utilityService.encodeUriComponentIncludingApostrophe(this.constants.connectors.management.defaultParameterValues.ssTokenType)),this.settingsService.valueAsBoolean(this.constants.settings.names.useCardsForConnectors)&&(g=this.utilityService.appendToQueryString(g,e.parameters.format,c)),this.enableConnectorApps&&(g=this.utilityService.appendToQueryString(g,e.parameters.isDesktopClient,this.isDesktopApp?"true":"false"),g=this.utilityService.appendToQueryString(g,e.parameters.enableConnectorApps,"true")),this.url=this.utilityService.combineUriComponents(t,g)},e.prototype.installAppForConnector=function(e){var t=this;return this.getApps.then(function(n){for(var i=0;i<n.length;i++){var a=function(i){if(n[i].connectors[0].connectorId===e){var a=t.$q.defer(),s={appID:n[i].id,intent:teamspace.components.AddAppDialogIntent.Team,teamId:t.channel.parentTeamId,channelId:t.channel.objectId,autoNavigationOnDone:!1,skipInstalledSuccess:!0,source:"connectors-manager-dialog"},o={entryPoint:teamspace.components.AddAppDialogEntryPoint.ConnectorManagementDialog,appId:n[i].id,teamId:t.channel.parentTeamId,onBackButtonClicked:function(){t.dialogService.openLazyDialog(t.constants.lazyDialogs.connectorsManager,t.constants.lazyModules.extensibilityDialogs,t.$scope.ngDialogData)}};return t.dialogService.close(t.constants.lazyDialogs.connectorsManager),t.appDetailsDialogService.open(t.constants.lazyDialogs.addAppNew,t.constants.lazyModules.extensibilityDialogs,Object.assign(s,o),function(e){a.resolve(e&&e.installSucceeded),t.appDetailsDialogService.registerCloseCallback(t.constants.lazyDialogs.addAppNew,null)}),{value:a.promise.then(function(e){return e&&(t.getApps=t.appsService.getTeamAppDefinitions(t.channel.parentTeamId,void 0,"connectors-manager-dialog",{category:teamspace.services.AppsServiceCategoryFilter.Connectors},!0)),e})}}}(i);if("object"==typeof a)return a.value}})},e.prototype.configure=function(e,t){var n=this;if(this.enableInlineConnectorConfiguration)return e.connectorId||this.loggingService.error("Connectors: ConnectorId not present in Connector.Add event."),this.getAppDefinitionWithConnectorId(e.connectorId).then(function(i){if(i){var s={action:a.ConnectorDialogOperationType.AddConnectorInstance,appDefinition:i,webhookUrl:e.webhookUrl,userObjectId:e.userObjectId,appType:e.appType,targetOrigin:t};n.bindCallbacks(s),n.connectorId=e.connectorId,n.targetOrigin=t,n.dialogService.openLazyDialog(n.constants.lazyDialogs.connectorInstanceConfigurationDialog,n.constants.lazyModules.extensibilityDialogs,s).then(function(e){n.configurationDialog=e})}else n.loggingService.error("Connectors: AppDefinition not found for configuration. ConnectorId:"+e.connectorId)})},e.prototype.manage=function(e,t){var n=this;if(this.enableInlineConnectorConfiguration)return this.getAppDefinitionWithConnectorId(e.connectorId).then(function(i){if(i){var s={action:a.ConnectorDialogOperationType.ManageConnectorInstance,appDefinition:i,webhookUrl:e.webhookUrl,contentUrl:e.contentUrl,entityId:e.entityId,configName:e.configName,userObjectId:e.userObjectId,appType:e.appType,targetOrigin:t,displayWebhookB2Message:!!e.displayWebhookB2Message};n.bindCallbacks(s),n.connectorId=e.connectorId,n.targetOrigin=t,n.dialogService.openLazyDialog(n.constants.lazyDialogs.connectorInstanceConfigurationDialog,n.constants.lazyModules.extensibilityDialogs,s).then(function(e){n.configurationDialog=e})}else n.loggingService.error("Connectors: AppDefinition not found for managing. ConnectorId:"+e.connectorId)})},e.prototype.bindCallbacks=function(e){e.onSave=this.onSave.bind(this),e.onCancel=this.onCancel.bind(this),e.onFailure=this.onFailure.bind(this),e.onRemove=this.onRemove.bind(this),e.postCloseCallback=this.onClose.bind(this)},e.prototype.onSave=function(e){var t={action:"Connector.SaveSuccess",configName:e.configName,entityId:e.entityId,contentUrl:e.contentUrl,webhookUrl:e.webhookUrl};this.postMessage(t,e.targetOrigin),this.loggingService.newScenario(this.constants.scenarios.extensibility.connectors.viewConnectorsSaveEvent).stop()},e.prototype.onRemove=function(e){var t={action:"Connector.Delete",connectorId:e.appDefinition.connectors[0].connectorId};this.postMessage(t,e.targetOrigin)},e.prototype.onFailure=function(e){var t={action:"Connector.SaveFailure",reason:e.errorMessage};this.postMessage(t,e.targetOrigin),this.loggingService.newScenario(this.constants.scenarios.extensibility.connectors.viewConnectorsSaveEvent).fail({error:e.errorMessage,error1:e.errorMessage})},e.prototype.onCancel=function(e){var t={action:"Connector.Cancel",connectorId:e.appDefinition.connectors[0].connectorId};this.postMessage(t,e.targetOrigin),this.configurationDialog.close()},e.prototype.onClose=function(){var e={action:"Connector.Cancel",connectorId:this.connectorId};this.postMessage(e,this.targetOrigin)},e.prototype.postMessage=function(e,t){var n=JSON.stringify(e);this.frame.contentWindow.postMessage(n,t)},e.prototype.getAppDefinitionWithConnectorId=function(e){var t=this;return this.getApps.then(function(t){return _.find(t,function(t){return t.connectors[0].connectorId===e})}).catch(function(e){return t.loggingService.error("Connectors: getAppDefinitionWithConnectorId failed. Error:"+e),null})},e.prototype.allowWindowOpen=function(e){return e.length<"https:".length||"https:"!==e.substr(0,6).toLowerCase()?(this.loggingService.warn("Connectors: Attempted to allow a non-https url to open"),this.$q.resolve(!1)):(this.isDesktopApp&&this.$window.electronSafeIpc&&this.$window.electronSafeIpc.send(this.constants.events.desktopApp.allowWindowOpenUrl,e),this.$timeout(function(){return!0}))},e.prototype.isGccH=function(){return this.utilityService.getUserCloudDomain()===this.constants.cloudDomains.gccHighCloud},e.dialogCloseElementClass=".ngdialog-close",e}();t.ConnectorsManagerDialogController=s,angular.module("teamspace.connectorsManagerDialog",[]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put("components/extensibility/connectors-manager-dialog/connectors-manager-dialog.html",i),t.register(e.lazyDialogs.connectorsManager,{template:"components/extensibility/connectors-manager-dialog/connectors-manager-dialog.html",className:"ts-modal-dialog custom-width ts-connectors-manager-dialog",closeByEscape:!0,closeByDocument:!0,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"modalDialog-title"})}]).controller("ConnectorsManagerDialogController",s)},2656:function(e,t){e.exports='<div class="ts-connectors-manager" ng-controller="ConnectorsManagerDialogController as cmdc" acc-role="dialog">\n  <modal-dialog dialog-title="{{::cmdc.dialogTitle}}" add-close-icon="true" suppress-default-button="true" track-panel-type="{{$root.trackConstants.panelType.connectorsManagerDialog}}">\n    <div ng-if="cmdc.isClarificationShown" class="connectors-clarification">\n      <img class="connectors-clarification-example" ng-src="[[staticsPath]]/hashed/connectors-clarification-example-827843c.svg" alt="{{$root.resources.strings.extensibility_clarification_image_alternative|translate}}">\n    </div>\n\n    <div ng-if="cmdc.isOffline" class="offline-content">\n      <ng-include src="\'svg/illustrations/illustration-dog-with-cord.html\'"></ng-include>\n      <div role="alert">\n        <div class="app-font-title2-bold offline-error-message">\n          {{($root.resources.strings.extensibility_offline_error_message|translate)}}\n        </div>\n        <div class="app-font-base-regular offline-retry-message">\n          {{($root.resources.strings.extensibility_offline_retry_message|translate)}}\n        </div>\n      </div>\n    </div>\n\n    <div ng-if="!cmdc.isOffline" class="connectors-iframe-container">\n      <iframe class="connectors-iframe" id="connectorsTileFrame" aria-live="assertive" frameborder="0" border="0" seamless>\n      </iframe>\n    </div>\n\n  </modal-dialog>\n</div>\n'},2657:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2658),a=function(){function e(e,t,n,i,a,s,o){var r=this;this.$scope=e,this.$translate=t,this.resources=n,this.constants=i,this.$window=a,this.appsDevicePermissionService=s,this.analyticsService=o,a.desktopSettings.devicePermissionsEnabledV2||e.closeThisDialog(),this.appId=e.ngDialogData.appId,this.deviceType=e.ngDialogData.deviceType,this.guid=e.ngDialogData.guid,this.appName=e.ngDialogData.appName,this.initializeDialog(),this.logTelemetryForDevicePermissionDialog(),this.footerButtons=[{text:t.instant(n.strings.extension_devicePermissionConsentDeny),func:function(){return r.deny()},disabled:!1,secondaryStyle:!0,outcome:teamspace.components.PanelActionOutcome.submit,type:teamspace.components.PanelModuleType.button,name:teamspace.components.PanelModuleName.denyDevicePermissionButton,summary:"Deny permission to the device",scenarioType:teamspace.components.PanelActionScenarioType.appMgmt,tid:"devicePermission-Deny"},{text:t.instant(n.strings.extension_devicePermissionConsentAllow),func:function(){return r.allow()},disabled:!1,outcome:teamspace.components.PanelActionOutcome.closeDialog,type:teamspace.components.PanelModuleType.button,name:teamspace.components.PanelModuleName.allowDevicePermissionButton,summary:"Allow permission to the device",scenarioType:teamspace.components.PanelActionScenarioType.appMgmt,tid:"devicePermission-Allow"}]}return e.$inject=["$scope","$translate","resources","constants","$window","appsDevicePermissionService","analyticsService"],e.prototype.allow=function(){this.appsDevicePermissionService.setAppPermission(this.appId,this.deviceType,!0),this.logTelemetryForDevicePermissionConsent(!0),this.$scope.closeThisDialog(),this.sendPermissionToElectron(!0)},e.prototype.deny=function(){this.appsDevicePermissionService.setAppPermission(this.appId,this.deviceType,!1),this.logTelemetryForDevicePermissionConsent(!1),this.$scope.closeThisDialog(),this.sendPermissionToElectron(!1)},e.prototype.logTelemetryForDevicePermissionConsent=function(e){var t={action:{gesture:teamspace.components.PanelActionGesture.click},module:{type:teamspace.components.PanelModuleType.devicePermission,name:teamspace.components.PanelModuleName[teamspace.components.PanelModuleName.devicePermissionConsentDialog],summary:"Get device permission consent"},app:{id:this.appId,name:this.appName,scenarioCapability:teamspace.components.PanelAppScenarioCapability.tabs},dataBag:{deviceType:this.deviceType,consentForDevicePermission:e}};this.analyticsService.onPanelAction(this.$scope,t)},e.prototype.logTelemetryForDevicePermissionDialog=function(){var e={panel:{type:teamspace.PanelType.devicePermissionConsent},app:{id:this.appId,name:this.appName,scenarioCapability:teamspace.components.PanelAppScenarioCapability.tabs}};this.analyticsService.onPanelView(this.$scope,e)},e.prototype.sendPermissionToElectron=function(e){if(this.$window.electronSafeIpc)if(this.$window.desktopSettings.enableMWDevicePermissionsV2){var t={payload:{guid:this.guid,permission:e,message:this.constants.events.desktopApp.hasDevicePermissionsCallback}};this.$window.electronSafeIpc.send(this.constants.events.desktopApp.hasDevicePermissionsCallback,t)}else this.$window.electronSafeIpc.send(this.constants.events.desktopApp.hasDevicePermissionsCallback,{guid:this.guid,permission:e})},e.prototype.initializeDialog=function(){switch(this.deviceType){case this.constants.deviceTypeForAppPermission.media:this.initializeContents(this.$translate.instant(this.resources.strings.extension_devicePermissionDeviceConsentTitle,{appName:this.appName}),this.$translate.instant(this.resources.strings.extension_devicePermissionDeviceConsentText,{appName:this.appName}),"svg/icons-video.html");break;case this.constants.deviceTypeForAppPermission.geolocation:this.initializeContents(this.$translate.instant(this.resources.strings.extension_devicePermissionLocationConsentTitle,{appName:this.appName}),this.$translate.instant(this.resources.strings.extension_devicePermissionLocationConsentText,{appName:this.appName}),"svg/icons-location.html");break;case this.constants.deviceTypeForAppPermission.notifications:this.initializeContents(this.$translate.instant(this.resources.strings.extension_devicePermissionNotificationsConsentTitle,{appName:this.appName}),this.$translate.instant(this.resources.strings.extension_devicePermissionNotificationsConsentText,{appName:this.appName}),"svg/icons-bell.html");break;case this.constants.deviceTypeForAppPermission.openExternal:this.initializeContents(this.$translate.instant(this.resources.strings.extension_devicePermissionExternalLinkConsentTitle,{appName:this.appName}),this.$translate.instant(this.resources.strings.extension_devicePermissionExternalLinkConsentText,{appName:this.appName}),"svg/icons-open-outside.html");break;case this.constants.deviceTypeForAppPermission.midi:this.initializeContents(this.$translate.instant(this.resources.strings.extension_devicePermissionMIDIConsentTitle,{appName:this.appName}),this.$translate.instant(this.resources.strings.extension_devicePermissionMIDIConsentText,{appName:this.appName}),"svg/icons-audio.html");break;default:this.$scope.closeThisDialog()}},e.prototype.initializeContents=function(e,t,n){this.consentTitle=e,this.consentText=t,this.iconSrc=n},e}();t.DevicePermissionController=a,angular.module("teamspace.devicePermission",["teamspace.utilityService"]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put("components/extensibility/device-permission-dialog/device-permission-dialog.html",i),t.register(e.lazyDialogs.devicePermission,{template:"components/extensibility/device-permission-dialog/device-permission-dialog.html",className:"ts-modal-dialog device-permission-dialog",closeByEscape:!0,closeByDocument:!0,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"modalDialog-title"})}]).controller("DevicePermissionController",a)},2658:function(e,t){e.exports='<div class="device-permission" ng-controller="DevicePermissionController as ctrl" acc-role="dialog">\n  <modal-dialog add-close-icon="false" suppress-default-button="true" skip-auto-focus="false" footer-buttons="ctrl.footerButtons" right-align-buttons="true" data-tid="devicePermissionDialog">\n      <section class="title-container" id="modalDialog-title">\n        <div class="text-container">\n          <span ng-bind="::ctrl.consentTitle"></span>\n        </div>\n      </section>\n      <section class="dialog-content">\n        <div class="dialog-text">\n          <div class="badge-icon">\n              <ng-include src="ctrl.iconSrc"></ng-include>\n          </div>\n          <div class="permission-text">\n            <span ng-bind="::ctrl.consentText" title="{{::ctrl.consentText}}"></span>\n          </div>\n        </div>\n        <div class="dialog-manage" translate-once="{{::$root.resources.strings.extension_devicePermissionConsentManage}}"></div>\n      </section>\n  </modal-dialog>\n</div>'},2659:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2660),s=function(){function e(e,t,n,a,s,o,r,l){var p=this;if(this.$scope=e,this.$translate=t,this.resources=n,this.constants=a,this.appsDevicePermissionService=s,this.analyticsService=o,this.loggingService=r,this.headerButtons=null,this.contextClass="stand-alone",this.showRefreshHelpText=!1,this.showCloseIcon=!0,this.loading=!0,this.currentPermissionTypes=[],this.scenario=teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.changeDevicePermission.toString(),teamspace.components.PanelActionScenario,this.loggingService),this.scenarioType=teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,this.loggingService),this.moduleType=teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.devicePermission.toString(),teamspace.components.PanelModuleType,this.loggingService),this.moduleName=teamspace.components.PanelModuleName[teamspace.components.PanelModuleName.devicePermissionSettingsDialog],this.resourceStrings={media:{label:this.resources.strings.extension_devicePermissionSettingsMedia,subtext:this.resources.strings.extension_devicePermissionSettingsOnlyWhenAppIsInUseSubtext},geolocation:{label:this.resources.strings.extension_devicePermissionSettingsLocation,subtext:this.resources.strings.extension_devicePermissionSettingsOnlyWhenAppIsInUseSubtext},notifications:{label:this.resources.strings.extension_devicePermissionSettingsNotifications,subtext:this.resources.strings.extension_devicePermissionSettingsAlwaysSubtext},midi:{label:this.resources.strings.extension_devicePermissionSettingsMIDI,subtext:this.resources.strings.extension_devicePermissionSettingsOnlyWhenAppIsInUseSubtext},openExternal:{label:this.resources.strings.extension_devicePermissionSettingsExternalLinks,subtext:""}},this.permissionsChangedCallback=e.ngDialogData.permissionsChangedCallback,this.dialogContext=e.ngDialogData.dialogContext||"optionSettings",this.telemetryContext=e.ngDialogData.telemetryContext,this.isBrowser=!l.isElectron(),this.learnMoreUrl=a.devicePermissions.learnMoreUrl,"optionSettings"===this.dialogContext&&this.initializeOptionSettingsDisplayContext(),e.ngDialogData.appDefinition){this.appDefinition=e.ngDialogData.appDefinition,this.appPermission={appId:this.appDefinition.id,name:this.appDefinition.name,icon:this.appDefinition.largeImageUrl,accentColor:this.appDefinition.accentColor},this.isWhiteListedApp=s.isWhiteListedApp(this.appDefinition);var c=r.newScenario(a.scenarios.extensibility.apps.devicePermissions.getAppDevicePermissions),d=this.appDefinition.id;this.currentPermissionTypes=s.getDeviceKeys(this.isBrowser).filter(function(e){return s.isDeviceRequired(p.appDefinition,e)}),this.initializeDisplayList(),c.appendEventData({appId:d}),s.getAppPermissions(d).then(function(e){c.stop({appId:d,permissions:JSON.stringify(e)}),p.originalAppPermissions=i({},e),p.setAppPermissionModel(e),p.loading=!1}).catch(function(e){c.fail({appId:d,errorInfo1:e})})}e.$on("$destroy",function(){p.isBrowser&&p.permissionsChangedCallback&&p.permissionChangesRequireReload()&&(p.logTelemetryForPermissionChangeCallback(),p.permissionsChangedCallback())})}return e.$inject=["$scope","$translate","resources","constants","appsDevicePermissionService","analyticsService","loggingService","desktopUtilityService"],e.prototype.initializeOptionSettingsDisplayContext=function(){var e=this;this.contextClass="option-settings",this.showRefreshHelpText=!0,this.showCloseIcon=!1,this.headerButtons=[{text:this.$translate.instant(this.resources.strings.settings_back_to_settings_label),func:function(){e.$scope.closeThisDialog()},isFocusDefault:!1,icon:"svg/icons-chevron-left-small.html",tid:"back-to-settings"}]},e.prototype.permissionChangesRequireReload=function(){var e=this;if(this.isWhiteListedApp&&this.appPermission){var t=this.currentPermissionTypes.some(function(t){return(null==e.originalAppPermissions||null==e.originalAppPermissions[t])&&!1===e.appPermission[t]}),n=this.originalAppPermissions&&this.currentPermissionTypes.some(function(t){return null!=e.originalAppPermissions[t]&&e.originalAppPermissions[t]!==e.appPermission[t]});return t||n}return this.currentPermissionTypes.some(function(t){return Boolean(e.appPermission&&e.appPermission[t])!==Boolean(e.originalAppPermissions&&e.originalAppPermissions[t])})},Object.defineProperty(e.prototype,"showBrowserHelpText",{get:function(){var e=this;return!!this.isBrowser&&this.currentPermissionTypes.some(function(t){return e.getDisplayedPermissionValue(t)})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showEnabledByDefaultText",{get:function(){var e=this;return!(!this.isBrowser||!this.isWhiteListedApp)&&this.currentPermissionTypes.some(function(t){return null==e.appPermission[t]})},enumerable:!0,configurable:!0}),e.prototype.getDisplayedPermissionValue=function(e){return this.appPermission&&null!=this.appPermission[e]?this.appPermission[e]:this.isWhiteListedApp},e.prototype.changePermission=function(e,t){this.appPermission[e]=t,this.logTelemetryForPermissionChange(e,t),this.appsDevicePermissionService.setAppPermission(this.appDefinition.id,e,t)},e.prototype.setAppPermissionModel=function(e){var t=this;this.currentPermissionTypes.forEach(function(n){t.appPermission[n]=e&&e[n]})},e.prototype.initializeDisplayList=function(){var e=this,t=[];this.currentPermissionTypes.forEach(function(n){t.push({deviceType:n,deviceName:e.$translate.instant(e.resourceStrings[n].label),permissionText:e.$translate.instant(e.resourceStrings[n].subtext),iconSrc:e.constants.permissionIconSrcMap[n]})}),this.appPermissionDisplayList=t},e.prototype.logTelemetryForPermissionChange=function(e,t){var n=i(i({},this.telemetryContext),{action:{gesture:teamspace.components.PanelActionGesture.click,scenario:this.scenario,scenarioType:this.scenarioType,outcome:t?teamspace.components.PanelActionOutcome.checked:teamspace.components.PanelActionOutcome.unchecked},module:{type:this.moduleType,typeNew:this.moduleType,name:this.moduleName,nameNew:this.moduleName,summary:"Change device permissions for an app"},dataBag:{deviceType:e,consentForGlobalPermission:t}});this.analyticsService.onPanelAction(this.$scope,n)},e.prototype.logTelemetryForPermissionChangeCallback=function(){var e=i(i({},this.telemetryContext),{action:{gesture:teamspace.components.PanelActionGesture.submit,outcome:teamspace.components.PanelActionOutcome.closeDialog},module:{type:this.moduleType,name:teamspace.components.PanelModuleName[teamspace.components.PanelModuleName.devicePermissionSettingsDialog],summary:"Callback on app device permission change"},dataBag:{permissions:this.appPermission&&JSON.stringify(this.appPermission)}});this.analyticsService.onPanelAction(this.$scope,e)},e}();t.DevicePermissionSettingsController=s,angular.module("teamspace.devicePermissionDialogSettings",["teamspace.utilityService"]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put("components/extensibility/device-permission-dialog/device-permission-dialog-settings.html",a),t.register(e.lazyDialogs.devicePermissionDialogSettings,{template:"components/extensibility/device-permission-dialog/device-permission-dialog-settings.html",className:"ts-modal-dialog device-permission-dialog-settings",closeByEscape:!0,closeByDocument:!0,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"modalDialog-title",controller:"DevicePermissionSettingsController",controllerAs:"ctrl"})}]).controller("DevicePermissionSettingsController",s)},2660:function(e,t){e.exports='<div class="device-permission-dialog-settings" acc-role="dialog">\n    <modal-dialog add-close-icon="ctrl.showCloseIcon" suppress-default-button="true" skip-auto-focus="true" right-align-buttons="true" header-buttons="ctrl.headerButtons" track-panel-type="{{::$root.trackConstants.panelType.devicePermissionSettingPerApp}}" data-tid="devicePermissionDialogSettings">\n      <div class="{{ctrl.contextClass}}">\n        <section class="title-container">\n          <div class="apps-name" title="{{ctrl.appPermission.name}}">\n            <div class="apps-icon" ng-style="{ \'background\': ctrl.appPermission.accentColor }">\n              <ng-include src="ctrl.appPermission.icon" role="presentation" ng-if="::ctrl.utilityService.useNgIncludeForIcon(ctrl.appPermission.icon)"></ng-include>\n              <img ng-src="{{::ctrl.appPermission.icon}}" role="presentation" ng-if="::!ctrl.utilityService.useNgIncludeForIcon(ctrl.appPermission.icon)"/>\n            </div>\n            <h1 class="apps-display-name" dir="auto">{{ctrl.appPermission.name}}</h1>\n          </div>\n        </section>\n        <section ng-if="!ctrl.loading" class="app-container">\n          <div ng-if="ctrl.showEnabledByDefaultText" class="default-permissions-helptext">\n            <span translate-once="{{::$root.resources.strings.extension_devicePermissionSettingsPermissionsEnabledByDefault}}"></span>\n            <span>\n              &nbsp;\n              <a href="{{::ctrl.learnMoreUrl}}" target="_blank">\n                {{::$root.resources.strings.extension_devicePermissionSettingsLearnMoreText|translate}}\n              </a>\n            </span>\n          </div>\n          <div aria-live="polite">\n            <div ng-if="ctrl.showBrowserHelpText" class="browser-helptext">\n              <span translate-once="{{::$root.resources.strings.extension_devicePermissionSettingsEnsurePermissionsInBrowser}}"></span>\n            </div>\n          </div>\n          <div>\n            <div class="permission" ng-repeat="permission in ctrl.appPermissionDisplayList track by permission.deviceType">\n              <div class="permission-item" data-tid="{{::permission.deviceType}}">\n                <div class="permission-item-info">\n                  <div class="permission-icon">\n                    <ng-include class="icon" role="presentation" src="permission.iconSrc"></ng-include>\n                  </div>\n                  <div class="permission-texts">\n                    <div class="device-text">{{permission.deviceName}}</div>\n                    <div class="permission-text">{{permission.permissionText}}</div>\n                  </div>\n                </div>\n                <div class="device-permission-button" data-tid="{{::permission.deviceType}}-toggle">\n                  <toggle-switch set-focus-on-init="$index === 0" is-checked="ctrl.getDisplayedPermissionValue(permission.deviceType)" on-toggle="ctrl.changePermission(permission.deviceType, isChecked)" aria-label="{{permission.deviceName}}">\n                  </toggle-switch>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div ng-if="ctrl.showRefreshHelpText" class="refresh-helptext">\n            <span ng-bind-html="::$root.resources.strings.extension_devicePermissionSettingsPermissionUpdatesNote|translate"></span>\n          </div>\n        </section>\n      </div>\n    </modal-dialog>\n</div>'},2661:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2662),s=function(){function e(e,t,n,i,a){this.$translate=e,this.resources=t,this.$scope=n,this.analyticsService=i,this.loggingService=a,this.footerButtons=[],this.panelType=teamspace.shared.AttributeHelper.tryGetEnum(teamspace.PanelType.refreshAppPermissionsDialog.toString(),teamspace.PanelType,this.loggingService),this.refreshScenario=teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.reloadAfterDevicePermissionsChange.toString(),teamspace.components.PanelActionScenario,this.loggingService),this.skipRefreshScenario=teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.skipReloadAfterDevicePermissionChange.toString(),teamspace.components.PanelActionScenario,this.loggingService),this.scenarioType=teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,this.loggingService),this.moduleType=teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.refreshAppPermissions.toString(),teamspace.components.PanelModuleType,this.loggingService),this.moduleName=teamspace.components.PanelModuleName[teamspace.components.PanelModuleName.refreshAppPermissionsDialog],this.refreshFunc=n.ngDialogData.refreshFunc,this.telemetryContext=n.ngDialogData.telemetryContext;var s={text:e.instant(t.strings.extension_devicePermissionRefreshDialogRefreshLater),func:this.skipRefresh.bind(this),secondaryStyle:!0,tid:"skipRefresh",disabled:!1},o={text:e.instant(t.strings.extension_devicePermissionRefreshDialogRefreshNow),func:this.refreshApp.bind(this),secondaryStyle:!1,tid:"refresh",disabled:!1};this.footerButtons=[s,o]}return e.$inject=["$translate","resources","$scope","analyticsService","loggingService"],e.prototype.close=function(){this.$scope.closeThisDialog()},e.prototype.skipRefresh=function(){var e=i(i({},this.telemetryContext),{action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.components.PanelActionOutcome.closeDialog,scenario:this.skipRefreshScenario,scenarioType:this.scenarioType},panel:{type:this.panelType,typeNew:this.panelType},module:{type:this.moduleType,typeNew:this.moduleType,name:this.moduleName,nameNew:this.moduleName,summary:"Skip reload after permissions change"}});this.analyticsService.onPanelAction(this.$scope,e),this.close()},e.prototype.refreshApp=function(){var e=i(i({},this.telemetryContext),{action:{gesture:teamspace.components.PanelActionGesture.submit,outcome:teamspace.components.PanelActionOutcome.submit,scenario:this.refreshScenario,scenarioType:this.scenarioType},panel:{type:this.panelType,typeNew:this.panelType},module:{type:this.moduleType,typeNew:this.moduleType,name:this.moduleName,nameNew:this.moduleName,summary:"Reload page after permissions change"}});this.analyticsService.onPanelAction(this.$scope,e),this.close(),this.refreshFunc&&this.refreshFunc()},e}();t.RefreshAppPermissionsDialogController=s,angular.module("teamspace.refreshAppPermissionsDialog",[]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put("components/extensibility/refresh-app-permissions-dialog/refresh-app-permissions-dialog.html",a),t.register(e.lazyDialogs.refreshAppPermissionsDialog,{template:"components/extensibility/refresh-app-permissions-dialog/refresh-app-permissions-dialog.html",className:"ts-modal-dialog refresh-app-permissions-dialog",closeByEscape:!0,closeByDocument:!0,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"modalDialog-title",controller:"RefreshAppPermissionsDialogController",controllerAs:"ctrl"})}]).controller("RefreshAppPermissionsDialogController",s)},2662:function(e,t){e.exports='<div class="refresh-app-permissions-dialog" acc-role="dialog">\n  <modal-dialog dialog-title="{{::$root.resources.strings.extension_devicePermissionRefreshDialogTitle | translate}}" suppress-default-button="true" skip-auto-focus="false" right-align-buttons="true" footer-buttons="ctrl.footerButtons" track-panel-type="{{::$root.trackConstants.panelType.refreshAppPermissionsDialog}}" data-tid="refreshAppPermissionsDialog">\n    <div class="refresh-helptext">\n      <span translate-once="{{::$root.resources.strings.extension_devicePermissionRefreshDialogText}}"></span>\n    </div>\n  </modal-dialog>\n</div>\n'},2663:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2664),a=function(){function e(e,t,n,i,a){this.$translate=n,this.resources=i,this.utilityService=a,this.enableContextlessAppInstallation=t.valueAsBoolean(e.settings.names.enableContextlessAppInstallation)}return e.$inject=["constants","settingsService","$translate","resources","utilityService"],e.prototype.getTranslatedAppNameAriaLabel=function(e,t){return"team"===t?this.utilityService.decodeHtml(this.$translate.instant(this.resources.strings.extensibility_app_channel_incontext_store_add_app_title,{appName:e.name})):this.utilityService.decodeHtml(this.$translate.instant(this.resources.strings.extensibility_app_chat_incontext_store_add_app_title,{appName:e.name}))},e}();t.InContextAppStoreAppGridController=a,angular.module("teamspace.inContextAppStoreAppGrid",[]).directive("inContextAppStoreAppGrid",[function(){return{restrict:"E",scope:{apps:"<",headerMessage:"<",onAppTileClick:"&",storeScope:"<",isInstallingAppId:"<"},templateUrl:"components/extensibility/incontext-store-dialog/in-context-app-store-app-grid.html"}}]).run(["$templateCache",function(e){e.put("components/extensibility/incontext-store-dialog/in-context-app-store-app-grid.html",i)}]).controller("InContextAppStoreAppGridController",a)},2664:function(e,t){e.exports='<div ng-if="apps.length > 0" ng-controller="InContextAppStoreAppGridController as gridCtrl">\n  <label class="app-store-dialog-grid-title" ng-bind="headerMessage"></label>\n  <ul aria-label="{{headerMessage}}" acc-role="listgrid-horizontal-and-vertical" role="listbox" class="app-store-dialog-app-grid" data-tid="tabs-gallery-installed-apps" ng-if="apps.length > 0">\n    <li ng-repeat="app in apps track by app.id" ng-click="onAppTileClick({appVM: app})" data-tid="tabs-gallery-app-{{::app.name}}" acc-role="listgrid-item" role="option" aria-label="{{::!app.isPreConsented\n          ? app.name\n          : gridCtrl.getTranslatedAppNameAriaLabel(app, storeScope)}}" track-click-silent="true">\n      <div class="app-icon-container">\n        <div class="app-icon" title="{{::!app.showAddIconOnHover\n              ? app.description\n              : gridCtrl.getTranslatedAppNameAriaLabel(app, storeScope)}}" ng-style="{ \'background\': app.accentColor }">\n          <ng-include src="app.icon" ng-if="::app.useNgIncludeForIcon"></ng-include>\n          <img role="img" alt="{{::($root.resources.strings.extensibility_app_icon_alt|translate:{appName:app.name})}}" aria-label="{{::($root.resources.strings.extensibility_app_icon_alt|translate:{appName:app.name})}}" ng-src="{{::app.icon}}" ng-if="::!app.useNgIncludeForIcon"/>\n          <div class="app-icon-mask" ng-if="!gridCtrl.enableContextlessAppInstallation || !app.isPreConsented"></div>\n          <div class="add-app-icon-mask" ng-if="gridCtrl.enableContextlessAppInstallation && app.showAddIconOnHover">\n            <ng-include src="\'svg/icons-add.html\'" class="add-app-icon"></ng-include>\n          </div>\n        </div>\n        <div class="app-install-loading-mask" ng-if="gridCtrl.enableContextlessAppInstallation && app.id === isInstallingAppId">\n          <busy-animation size="large" class="app-install-loading-indicator"></busy-animation>\n        </div>\n      </div>\n      <div ng-bind="::app.name" dir="auto" title="{{::app.name}}" id="tabs-gallery-name-{{::app.id}}" class="app-name"></div>\n    </li>\n  </ul>\n</div>\n'},2665:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n(2666),s=n(2667),o=n(2668),r=n(2669),l=n(2670),p=n(2671),c=teamspace.services.AppsServiceCategoryFilter,d=teamspace.components.TelemetryHelper,g=teamspace.components.PanelActionGesture,u=teamspace.components.PanelActionOutcome,h=teamspace.components.PanelActionScenario,m=teamspace.components.PanelActionScenarioType,v=teamspace.components.PanelModuleName,f=teamspace.components.PanelModuleType,b=teamspace.components.SubWorkLoad,y=teamspace.components.WorkLoad;!function(e){e.Alphabet="alphabet",e.Recent="recent"}(i=t.SortingMethod||(t.SortingMethod={}));var S=function(){function e(e,t,n,a,l,c,d,g,u,h,m,v,f,b,y,S,A,D,C,I,T,P,x,w,k,M,$,E){var F=this;this.$scope=e,this.constants=t,this.ariaLiveService=n,this.utilityService=a,this.navigationService=l,this.loggingService=c,this.analyticsService=d,this.extensionTabService=u,this.$q=h,this.appsService=b,this.dialogService=y,this.settingsService=P,this.capabilities=[],this.installedApps=[],this.notInstalledApps=[],this.suggestedApps=[],this.meetingOptimizedApps=[],this.sdkGalleryCallerContext=null,this.filteredInstalledApps=[],this.filteredNotInstalledApps=[],this.filteredSuggestedApps=[],this.filteredMeetingOptimizedApps=[],this.enableSortMeetingOptimizedAppsByRecency=!1,this.selectedCategories=[],this.showSortingDropdown=!1,this.sortMethod=i.Recent,this.logSearchActionTelemetryData=_.debounce(function(){var e={action:{outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.search.toString(),teamspace.components.PanelActionOutcome,F.loggingService),gesture:teamspace.components.PanelActionGesture.keypress,scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.search.toString(),teamspace.components.PanelActionScenarioType,F.loggingService)},module:F.getTelemetryModuleInfo()};F.analyticsService.getAnalyticsPanelActionEventData(e).then(function(e){return F.analyticsService.sendPanelAction(e)}).catch(function(e){F.logger.error("failed to log available apps action "+e)})},500),this.logger=c.newLogger("InContextAppStoreDialogController"),this.enableInstallChatAppsFromStore=P.valueAsBoolean(t.settings.names.enableInstallChatAppsFromStore),this.enableAppsInstalledByCurrentUser=P.valueAsBoolean(t.settings.names.enableAppsInstalledByCurrentUser),this.enableSilentInstallForPreConsentedApps=P.valueAsBoolean(t.settings.names.enableSilentInstallForPreConsentedApps),this.enableSilentInstallForAlreadyConsentedApps=P.valueAsBoolean(t.settings.names.enableSilentInstallForAlreadyConsentedApps),this.appSortingRule=P.valueFor(t.settings.names.appSortingRule),this.isAppDiscoveryEnabled=b.isAppsDiscoveryEnabled(),this.enableAppsMRU=P.valueAsBoolean(t.settings.names.enableAppsMRU),this.enableSortMeetingOptimizedAppsByRecency=P.valueAsBoolean(t.settings.names.enableSortMeetingOptimizedAppsByRecency),this.enableAppMgmtForParentTeamMembersOnSharedChannel=P.valueAsBoolean(t.settings.names.enableAppMgmtForParentTeamMembersOnSharedChannel),this.stringsHelper=new p.InContextAppStoreDialogStringsHelper(t,v,f),this.appStoreActionsHandler=new o.AppStoreActionsHandler(h,m,this.logger,t,A,b,x,y,T,l,k,M,S,P.valueAsBoolean(t.settings.names.enableSideloadedAppsInGroupChat),P.valueAsBoolean(t.settings.names.enableContextlessAppInstallation),E),this.appStoreContextHelper=new s.AppStoreContextHelper(h,t,b,D,C,I,T,g,P,c),this.sdkGalleryCallerContext=e.ngDialogData.sdkGalleryCallerContext,P.valueAsBoolean(t.settings.names.enableSDKAddAppEntityAPI)&&(this.isSDKCaller=!!this.sdkGalleryCallerContext),this.isSDKCaller&&(this.sdkGalleryCallerCaptionMessage=this.stringsHelper.getSDKGalleryCallerDialogCaption(),this.selectedCategories=this.sdkGalleryCallerContext.categories?this.sdkGalleryCallerContext.categories:[]);var B=D.getConversation(e.ngDialogData.threadId);this.isChat=null===B||void 0===B?void 0:B.isChat(),this.isMeeting=(null===B||void 0===B?void 0:B.isMeetingConversation())||(null===B||void 0===B?void 0:B.isChannelConversation())&&this.isChannelMeeting(e.ngDialogData.messageId),this.storeContext=this.appStoreContextHelper.getAppStoreContext(e.ngDialogData.threadId,this.isMeeting),this.enableAppMgmtForParentTeamMembersOnSharedChannel&&this.storeContext.isSharedChannel&&(this.isHostTeamMember=$.isHostTeamMember(e.ngDialogData.threadId)),this.showManageApps=this.shouldShowManageApps(),this.showMoreApps=this.shouldShowMoreApps(),this.capabilities=new r.AppStoreCapabilityHelper(v,f,t).getCapabilities(this.storeContext);var N=e.ngDialogData.selectedCapability&&this.capabilities.find(function(t){return t.value===e.ngDialogData.selectedCapability});N?this.selectCapabilityFilter(N):this.selectCapabilityFilter(this.capabilities[0]),this.updateDialogTitle(),this.enableAppsMRU&&(this.getAppMruRank=w.getRanker()),this.appStoreContextHelper.registerForAppEntitlementChanges(e,this.storeContext,function(){return F.initialiseAppsList()}),this.enableSilentInstallForAlreadyConsentedApps&&this.populateAppIdsInstalledByCurrentUserInAnyContexts(),this.setSortingToggleAriaLabel()}return e.$inject=["$scope","constants","ariaLiveService","utilityService","navigationService","loggingService","analyticsService","tabService","extensionTabService","$q","$rootScope","$translate","resources","appsService","dialogService","appDetailsDialogService","extensionDefinitionService","conversationsService","teamMembershipPropertiesService","teamSettingsService","channelService","settingsService","eventingService","mruServiceV2","uiOrchestrator","routeUtilityService","channelAppsService","inContextStoreService"],e.prototype.isChannelMeeting=function(e){return!!e&&"0"!==e},e.prototype.containsInAppFields=function(e,t){return e.nameLowerCase.contains(t)||e.description&&e.description.toLocaleLowerCase().contains(t)},e.prototype.filterBySearch=function(){var e=this,t=this.searchString.toLowerCase();this.filteredInstalledApps=_.filter(this.installedApps,function(n){return e.containsInAppFields(n,t)}),this.filteredNotInstalledApps=_.filter(this.notInstalledApps,function(n){return e.containsInAppFields(n,t)}),this.filteredSuggestedApps=_.filter(this.suggestedApps,function(n){return e.containsInAppFields(n,t)}).slice(0,14),this.isMeeting&&(this.filteredMeetingOptimizedApps=_.filter(this.meetingOptimizedApps,function(n){return e.containsInAppFields(n,t)})),this.announceSearchResultsChanged(this.filteredInstalledApps.length+this.filteredNotInstalledApps.length+this.filteredSuggestedApps.length+this.filteredMeetingOptimizedApps.length),this.logSearchActionTelemetryData()},e.prototype.setSortingToggleAriaLabel=function(){this.sortingButtonAriaLabel=this.stringsHelper.getSortingToggleAriaLabel(this.sortMethod,this.showSortingDropdown)},e.prototype.clearSearch=function(){this.clearSearchString(),this.filterBySearch(),this.focusSearchInput()},e.prototype.gotoManageApps=function(){this.appStoreActionsHandler.gotoManageApps(this.storeContext.scope,this.storeContext.threadId),this.closeDialog()},e.prototype.gotoAppGallery=function(){var e=teamspace.components.AddAppDialogEntryPoint.InContextGalleryDialogMoreAppsFromChannel;this.storeContext.filterContext===teamspace.middletier.ConfigurableTabContext.PrivateChatTab?e=teamspace.components.AddAppDialogEntryPoint.InContextGalleryDialogMoreAppsFromGroupChat:this.storeContext.filterContext===teamspace.middletier.ConfigurableTabContext.MeetingDetailsTab&&(e=teamspace.components.AddAppDialogEntryPoint.InContextGalleryDialogMoreAppsFromMeeting);var t={addAppDialogEntryPoint:e,intent:this.storeContext.scope===this.constants.extensibility.groupChatContextName?teamspace.components.AddAppDialogIntent.GroupChat:teamspace.components.AddAppDialogIntent.Team,category:this.selectedCapability.value,threadId:this.storeContext.threadId,autoNavigationOnDone:!0,skipInstalledSuccess:!1,filterByPersonal:!1,storeLaunchFromChat:this.storeContext.scope===this.constants.extensibility.groupChatContextName,preselectTeam:this.storeContext.scope===this.constants.extensibility.teamContextName&&this.storeContext.teamId,preselectChat:this.storeContext.scope===this.constants.extensibility.groupChatContextName&&this.storeContext.threadId};this.navigationService.navigateToAppsView(t),this.closeDialog(),this.logTelemetryForGotoAppGallery()},e.prototype.selectCapabilityFilter=function(e){var t=this;this.clearSearchString(),this.selectedCapability=e,this.initialiseAppsList().then(function(){t.updateDialogStrings(),t.logTelemetryForInContextDialogOpen()})},e.prototype.onMeetingOptimizedItemClick=function(e){this.isInstallingAppId||(e.isNotInstalledInCurrentScope&&!e.isPreConsented?this.onNotInstalledItemClick(e):this.onInstalledItemClick(e))},e.prototype.onSuggestedItemClick=function(e){this.isInstallingAppId||(this.installedApps.find(function(t){return t.id===e.id})?this.onInstalledItemClick(e):this.onNotInstalledItemClick(e))},e.prototype.onNotInstalledItemClick=function(e){var t,n=this;if(!this.isInstallingAppId)if(this.enableSilentInstallForAlreadyConsentedApps&&!e.requiresRSCPermissions&&null!==(t=this.appIdsInstalledByCurrentUserInAnyContexts)&&void 0!==t&&t.has(e.id))this.silentlyInstallApp(e,this.constants.scenarios.extensibility.apps.inContextAppStoreDialog.alreadyConsentedInstall,!0);else{this.logTelemetryForNotInstalledAppTileClick(e,!1);var i=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.inContextAppStoreDialog.installDialogView);this.appStoreActionsHandler.executeAppInstallAction(this.storeContext,e.id,this.selectedCapability.value,this.$scope.ngDialogData.messageId,e.isNotInstalledInCurrentScope,this.sdkGalleryCallerContext).then(function(){n.appStoreActionsHandler.executePostInstallAction(n.storeContext,n.$scope.ngDialogData.messageId,e,n.selectedCapability.value,n.sdkGalleryCallerContext,n.$scope.ngDialogData.correlationId,n.$scope.ngDialogData.entryPoint),i.stop()}).catch(function(){i.cancel()}),this.closeDialog()}},e.prototype.onInstalledItemClick=function(e){this.isInstallingAppId||(e.isPreConsented&&this.enableSilentInstallForPreConsentedApps?this.silentlyInstallApp(e,this.constants.scenarios.extensibility.apps.inContextAppStoreDialog.preConsentedInstall,!1):this.enableAppsInstalledByCurrentUser&&e.isNotInstalledInCurrentScope?this.onNotInstalledItemClick(e):(this.logTelemetryForInstalledAppTileClick(e),this.appStoreActionsHandler.executePostInstallAction(this.storeContext,this.$scope.ngDialogData.messageId,e,this.selectedCapability.value,this.sdkGalleryCallerContext,this.$scope.ngDialogData.correlationId,this.$scope.ngDialogData.entryPoint),this.closeDialog()))},e.prototype.toggleSortingDropdown=function(){var e=this;this.showSortingDropdown=!this.showSortingDropdown,this.setSortingToggleAriaLabel(),this.$scope.$$postDigest(function(){if(e.showSortingDropdown){var t=angular.element(".tab-gallery-sorting-method-btn");t&&t.length&&t[0].focus()}})},e.prototype.focusSortingToggle=function(){var e=angular.element(".tab-gallery-sorting-method-main-btn");e&&(e.focus(),this.setSortingToggleAriaLabel())},e.prototype.getTelemetryModuleInfo=function(){return{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.addPlatformTab.toString(),teamspace.components.PanelModuleName,this.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.button.toString(),teamspace.components.PanelModuleType,this.loggingService)}},e.prototype.sortByRecency=function(){this.sortMethod=i.Recent,this.initialiseAppsList(),this.showSortingDropdown=!1,this.focusSortingToggle()},e.prototype.sortByAlphabet=function(){this.sortMethod=i.Alphabet,this.initialiseAppsList(),this.showSortingDropdown=!1,this.focusSortingToggle()},e.prototype.onSortingToggleKeyboard=function(e){e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation();var t=angular.element(".tab-gallery-sorting-method-btn");if(t){var n=_.findIndex(t,function(e){return e===document.activeElement});if(-1!==n)if(e.keyCode===this.constants.keyCodes.up)t[i=n-1<0?t.length-1:n-1].focus();else if(e.keyCode===this.constants.keyCodes.down){var i=n+1>=t.length?0:n+1;t[i].focus()}else e.keyCode===this.constants.keyCodes.escape&&(this.showSortingDropdown=!1,this.focusSortingToggle())}},e.prototype.shouldShowManageApps=function(){var e;return this.isAppDiscoveryEnabled&&(this.storeContext.scope!=this.constants.extensibility.groupChatContextName||this.enableInstallChatAppsFromStore)&&!(this.enableAppMgmtForParentTeamMembersOnSharedChannel&&(null===(e=this.storeContext)||void 0===e?void 0:e.isSharedChannel)&&!this.isHostTeamMember)},e.prototype.shouldShowMoreApps=function(){return this.isAppDiscoveryEnabled&&!this.isSDKCaller},e.prototype.initialiseAppsList=function(){var e=this,t=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.inContextAppStoreDialog.view);return this.isLoading=!0,this.$q.all([this.getAppStoreData(),this.extensionTabService.hasTabManagementPermission(this.$scope.ngDialogData.threadId,this.isMeeting)]).then(function(n){var i=n[0];if(n[1]){e.isLoading=!1;var a=i.installedApps,s=i.notInstalledApps,o=i.suggestedApps,r=i.meetingApps,p=i.appRankMap,c=new l.AppStoreViewModelAdapter(e.utilityService,p);e.installedApps=e.filterToAppCategories(a.map(function(e){return c.convertAppDefinitionToInContextStoreViewModel(e)})),e.notInstalledApps=e.filterToAppCategories(s.map(function(e){return c.convertAppDefinitionToInContextStoreViewModel(e)})),e.suggestedApps=e.filterToAppCategories(o.map(function(e){return c.convertAppDefinitionToInContextStoreViewModel(e)})),e.meetingOptimizedApps=r.map(function(e){return c.convertAppDefinitionToInContextStoreViewModel(e)}),e.sortViewModels(),e.filteredInstalledApps=e.installedApps,e.filteredNotInstalledApps=e.notInstalledApps,e.filteredSuggestedApps=e.suggestedApps.slice(0,14),e.filteredMeetingOptimizedApps=e.sortMeetingOptimizedAppsByRecency(e.meetingOptimizedApps),t.stop()}else{e.openV3ErrorDialog(e.constants.extensibility.apps.errorCodes.noPermissionToManageTabInMeeting);var d="User doesn't have tab management permissions";e.logger.warn("Initialization cancelled: {0}",d),t.cancel({errorInfo:d,errorInfo1:d})}}).catch(function(n){e.openV3ErrorDialog(e.constants.extensibility.apps.errorCodes.tabManagementPermissionsApiFailure),e.logger.error("Initialization failed: {0}",n),t.fail({errorInfo:n,errorInfo1:n})}).finally(function(){e.isLoading=!1})},e.prototype.filterToAppCategories=function(e){var t=this;if(this.selectedCategories&&this.selectedCategories.length>0){var n=this.settingsService.valueAsBoolean(this.constants.settings.names.allowSideloadedAppsSDKAddAppEntityAPI),i=e.filter(function(e){return t.selectedCategories.filter(function(t){return e.categories.includes(t)}).length>0||n&&e.isSideloaded}),a=this.settingsService.valueFor(this.constants.settings.names.sdkAddAppEntityAPIAppsReady);return a.length>0?i.filter(function(e){return a.includes(e.id)}):i}return e},e.prototype.openV3ErrorDialog=function(e){this.closeDialog(),this.dialogService.openLazyDialog(this.constants.lazyDialogs.addAppNewError,this.constants.lazyModules.extensibilityDialogs,{errorType:e})},e.prototype.sortViewModels=function(){var e=this;this.getAppMruRank&&this.sortMethod===i.Recent?this.installedApps=_.sortBy(this.installedApps,[function(t){return e.getAppMruRank(t.id)},function(e){return e.name.toLowerCase()}]):this.installedApps=_.sortBy(this.installedApps,"nameLowerCase"),this.notInstalledApps=this.shouldSortAppsByInstall()?_.sortBy(this.notInstalledApps,["installRank","nameLowerCase"]):_.sortBy(this.notInstalledApps,"nameLowerCase")},e.prototype.sortMeetingOptimizedAppsByRecency=function(e){var t=this;return this.enableSortMeetingOptimizedAppsByRecency&&this.getAppMruRank?_.sortBy(e,[function(e){return t.getAppMruRank(e.id)}]):e},e.prototype.getAppStoreData=function(){return this.appStoreContextHelper.getAppStoreData(this.storeContext,{category:this.selectedCapability.value},this.shouldSortAppsByInstall())},e.prototype.shouldSortAppsByInstall=function(){return this.appSortingRule===this.constants.extensibility.apps.appRanking.appSortingRuleInstall},e.prototype.announceSearchResultsChanged=function(e){var t=this.stringsHelper.getSearchResultsAriaString(this.selectedCapability.value,e);this.ariaLiveService.update(t)},e.prototype.closeDialog=function(){this.$scope.closeThisDialog()},e.prototype.clearSearchString=function(){this.searchString=""},e.prototype.focusSearchInput=function(){$(".app-store-dialog-search input").focus()},e.prototype.updateDialogStrings=function(){this.updateEmptyStateMessage(),this.updateInstalledAppsHeaderMessage(),this.updateNotInstalledHeaderMessage(),this.updateSuggestedHeaderMessage(),this.updateMeetingOptimizedAppsHeaderMessage()},e.prototype.updateDialogTitle=function(){this.isSDKCaller?this.dialogTitle=this.stringsHelper.getSDKGalleryCallerDialogTitle():this.dialogTitle=this.stringsHelper.getDialogTitle(this.selectedCapability.value)},e.prototype.updateEmptyStateMessage=function(){this.emptyStateMessage=this.stringsHelper.getEmptyStateMessage(this.selectedCapability.value)},e.prototype.updateInstalledAppsHeaderMessage=function(){this.installedAppsHeaderMessage=this.stringsHelper.getInstalledHeaderMessage(this.selectedCapability.value,this.storeContext)},e.prototype.updateNotInstalledHeaderMessage=function(){this.notInstalledAppsHeaderMessage=this.stringsHelper.getNotInstalledHeaderMessage(this.selectedCapability.value,this.filteredInstalledApps.length)},e.prototype.updateSuggestedHeaderMessage=function(){this.suggestedAppsHeaderMessage=this.stringsHelper.getSuggestedHeaderMessage()},e.prototype.updateMeetingOptimizedAppsHeaderMessage=function(){this.meetingOptimizedAppsHeaderMessage=this.stringsHelper.getMeetingsOptimizedHeaderMessage(this.selectedCapability.value,this.filteredMeetingOptimizedApps.length)},e.prototype.logTelemetryForInContextDialogOpen=function(){var e=this;_.defer(function(){var t=[];if(e.enableAppsInstalledByCurrentUser){var n=_.filter(e.installedApps,function(e){return e.isNotInstalledInCurrentScope});t=_.map(n,function(e){return e.id})}var i=[];e.installedApps.forEach(function(e){(null===e||void 0===e?void 0:e.isPreConsented)&&i.push(e.id)}),e.meetingOptimizedApps.forEach(function(e){(null===e||void 0===e?void 0:e.isPreConsented)&&i.push(e.id)});var a={actionGesture:g.click,actionOutcome:u.nav,actionScenario:h.navInContextAppStoreDialog,actionScenarioType:e.getScenarioTypeForCurrentCapability(),moduleName:v.inContextAppStoreDialog,moduleType:f.inContextAppStoreDialog,moduleSummary:"in-context app store dialog navigation",dataBag:{appCount:e.installedApps.length,surfacedAppCount:t.length,preconsentedAppsCount:i.length,preconsentedAppIds:i.join(","),sdkLaunchFromAppId:e.sdkGalleryCallerContext?e.sdkGalleryCallerContext.callerAppId:void 0}};d.logTelemetry(a,e.loggingService,e.analyticsService)})},e.prototype.logTelemetryForGotoAppGallery=function(){var e=this;_.defer(function(){var t={actionGesture:g.click,actionOutcome:u.nav,actionScenario:h.moreApps,actionScenarioType:e.getScenarioTypeForCurrentCapability(),moduleName:v.inContextAppStoreDialog,moduleType:f.inContextAppStoreDialog,moduleSummary:"in-context app store goto app gallery",dataBag:{InstalledAndSuggestedAppsCount:e.installedApps.length,sdkLaunchFromAppId:e.sdkGalleryCallerContext?e.sdkGalleryCallerContext.callerAppId:void 0}};d.logTelemetry(t,e.loggingService,e.analyticsService)})},e.prototype.logTelemetryForInstalledAppTileClick=function(e){var t=this;_.defer(function(){var n={actionGesture:g.click,actionOutcome:u.nav,actionScenario:h.configureApp,actionScenarioType:t.getScenarioTypeForCurrentCapability(),actionSubWorkLoad:b.tabNavigation,actionWorkLoad:y.channelContent,moduleName:v.inContextAppStoreDialog,moduleNameNew:t.getModuleNameNewForallTabs(e),moduleType:f.inContextAppStoreDialog,moduleTypeNew:f.tab,moduleSummary:"in-context app store configure app",app:{name:t.isChat?"chat":"teams",id:e.id},dataBag:{definitionId:e.id,definitionName:e.isSideloaded||e.isTenantApp?"<redacted_sideloaded>":e.name,sdkLaunchFromAppId:t.sdkGalleryCallerContext?t.sdkGalleryCallerContext.callerAppId:void 0}};d.logTelemetry(n,t.loggingService,t.analyticsService)})},e.prototype.getModuleNameNewForallTabs=function(e){var t=null;switch(e.nameLowerCase){case"wiki":t=v.wikiTab;break;case"onenote":t=v.onenoteTab;break;case"excel":t=v.excelTab;break;case"powerpoint":t=v.powerpointTab;break;case"word":t=v.wordTab;break;default:t=v.customTab}return t},e.prototype.logTelemetryForNotInstalledAppTileClick=function(e,t){var n=this;_.defer(function(){var i={actionGesture:g.click,actionOutcome:u.nav,actionScenario:t?h.addAlreadyConsentedApp:h.addApp,actionScenarioType:n.getScenarioTypeForCurrentCapability(),moduleName:v.inContextAppStoreDialog,moduleType:f.inContextAppStoreDialog,moduleSummary:"in-context app store add app",app:{id:e.id},dataBag:{definitionId:e.id,definitionName:e.isSideloaded||e.isTenantApp?"<redacted_sideloaded>":e.name,isSurfacedApp:!!e.isNotInstalledInCurrentScope,isPreConsentedApp:e.isPreConsented,sdkLaunchFromAppId:n.sdkGalleryCallerContext?n.sdkGalleryCallerContext.callerAppId:void 0}};d.logTelemetry(i,n.loggingService,n.analyticsService)})},e.prototype.getScenarioTypeForCurrentCapability=function(){switch(this.selectedCapability.value){case c.Tabs:return m.tabs;case c.Bots:return m.bots;case c.Connectors:return m.connectors;case c.InputExtensions:return m.inputExtensions}},e.prototype.populateAppIdsInstalledByCurrentUserInAnyContexts=function(){var e=this,t=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.inContextAppStoreDialog.getAlreadyInstalledAppsForUser);t.mark("Starting to fetch apps."),this.appsService.getAppsInstalledByCurrentUserFromAllContexts().then(function(n){t.mark("Got all user instaled apps."),e.appIdsInstalledByCurrentUserInAnyContexts=new Set(n)}).catch(function(e){t.fail({error:e,error1:e})})},e.prototype.silentlyInstallApp=function(e,t,n){var i=this;this.isInstallingAppId=e.id,this.logTelemetryForNotInstalledAppTileClick(e,n);var a=this.loggingService.newScenario(t);this.appStoreActionsHandler.executeSilentAppInstallAction(this.storeContext,e.id).then(function(){i.closeDialog(),i.appStoreActionsHandler.executePostInstallAction(i.storeContext,i.$scope.ngDialogData.messageId,e,i.selectedCapability.value,i.sdkGalleryCallerContext,i.$scope.ngDialogData.correlationId,i.$scope.ngDialogData.entryPoint),a.stop()}).catch(function(e){var t;i.closeDialog(),i.openV3ErrorDialog(null===(t=null===e||void 0===e?void 0:e.data)||void 0===t?void 0:t.errorCode),a.fail({errorInfo:e,errorInfo1:e})})},e}();t.InContextAppStoreDialogController=S,angular.module("teamspace.incontextAppStoreDialog",[]).run(["constants","dialogService","$templateCache",function(e,t,n){var i="components/extensibility/in-context-store-dialog/in-context-app-store-dialog.html";n.put(i,a),t.register(e.lazyDialogs.inContextAppStore,{template:i,className:"ts-modal-dialog in-context-app-store-dialog",closeByEscape:!0,closeByDocument:!0,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"modalDialog-title"})}]).controller("InContextAppStoreDialogController",S)},2666:function(e,t){e.exports='<div class="in-context-app-store-dialog-container" ng-controller="InContextAppStoreDialogController as dialogCtrl" acc-role="dialog">\n  <modal-dialog dialog-title="{{::dialogCtrl.dialogTitle}}" add-close-icon="true" dialog-busy="dialogCtrl.isLoading" suppress-default-button="true" suppress-default-footer="true" data-tid="inContextAppStoreDialog" track-panel-type="{{::$root.trackConstants.panelType.inContextAppStoreDialog}}" skip-auto-focus="true" aria-label="{{::dialogCtrl.dialogTitle}}">\n\n    <div class="capability-caption">\n      <div class="caption-message">\n        <span ng-if="::!dialogCtrl.isSDKCaller" ng-bind="::dialogCtrl.selectedCapability.caption"></span>\n        <span ng-if="::dialogCtrl.isSDKCaller" ng-bind="::dialogCtrl.sdkGalleryCallerCaptionMessage"></span>\n        <a ng-click="dialogCtrl.gotoAppGallery()" ng-if="::dialogCtrl.showMoreApps" href="javascript:void(0)" track-click-silent="true">\n          {{::$root.resources.strings.in_context_app_store_dialog_goto_app_gallery | translate}}\n        </a>\n      </div>\n\n      \x3c!-- Search --\x3e\n      <div class="app-store-dialog-search">\n        <input sanitized ng-model="dialogCtrl.searchString" placeholder="{{::$root.resources.strings.search_placeholderText | translate}}" autocapitalize="off" aria-label="{{::$root.resources.strings.search_placeholderText | translate}}" autocorrect="off" autocomplete="off" maxlength="750" tabindex="0" ng-change="dialogCtrl.filterBySearch()">\n        <ng-include class="search-box-icon" ng-if="!dialogCtrl.searchString" src="\'svg/icons-search.html\'"></ng-include>\n        <button class="search-box-icon ts-btn app-icons-fill-hover app-icons-fill-focus" ng-if="dialogCtrl.searchString" ng-click="dialogCtrl.clearSearch()" aria-label="{{ ::$root.resources.strings.search_filterClearText | translate}}">\n          <ng-include class="icon" src="\'svg/icons-close.html\'" role="presentation"></ng-include>\n        </button>\n      </div>\n    </div>\n\n    <div class="app-store-dialog-scroll-parent">\n      <div class="app-store-dialog-scroll-container" simple-scrollbar>\n        <div class="app-store-dialog-scroll-content">\n          \x3c!-- This extra div is needed since simple-scrollbar uses the first child only for height calculations --\x3e\n\n          \x3c!-- Loading Indicator --\x3e\n          <div class="app-store-dialog-spinner">\n            <busy-animation ng-if="dialogCtrl.isLoading" size="large"></busy-animation>\n          </div>\n\n          \x3c!-- Meeting Optimized Apps --\x3e\n          <in-context-app-store-app-grid apps="dialogCtrl.filteredMeetingOptimizedApps" on-app-tile-click="dialogCtrl.onMeetingOptimizedItemClick(appVM)" header-message="dialogCtrl.meetingOptimizedAppsHeaderMessage" is-installing-app-id="dialogCtrl.isInstallingAppId" data-tid="meeting-optimized-apps"></in-context-app-store-app-grid>\n\n          <div class="sorting-toggle" ng-if="dialogCtrl.enableAppsMRU && !dialogCtrl.isLoading">\n            <button class="toggle-main-button tab-gallery-sorting-method-main-btn" id="tab-gallery-sorting" data-tid="tab-gallery-sorting" aria-label="{{dialogCtrl.sortingButtonAriaLabel}}" ng-click="dialogCtrl.toggleSortingDropdown()">\n              {{(dialogCtrl.sortMethod == \'recent\' ?\n                $root.resources.strings.in_context_app_store_dialog_sort_method_recent\n                : $root.resources.strings.in_context_app_store_dialog_sort_method_alphabet) |translate}}\n              <ng-include src="\'svg/icons-chevron-down-small.html\'"></ng-include>\n            </button>\n            <div class="sorting-dropdown" ng-if="dialogCtrl.showSortingDropdown" ng-keydown="dialogCtrl.onSortingToggleKeyboard($event)">\n                <button class="toggle-list-button tab-gallery-sorting-method-btn" aria-label="{{::$root.resources.strings.in_context_app_store_dialog_sort_method_recent|translate}}" id="tab-gallery-sort-recency" data-tid="tab-gallery-sort-recency" ng-click="dialogCtrl.sortByRecency()">\n                  {{::$root.resources.strings.in_context_app_store_dialog_sort_method_recent|translate}}\n                  <ng-include src="\'svg/icons-accept.html\'" ng-if="dialogCtrl.sortMethod == \'recent\'"></ng-include>\n                </button>\n                <button class="toggle-list-button tab-gallery-sorting-method-btn" aria-label="{{::$root.resources.strings.in_context_app_store_dialog_sort_method_alphabet|translate}}" id="tab-gallery-sort-alphabet" data-tid="tab-gallery-sort-alphabet" ng-click="dialogCtrl.sortByAlphabet()">\n                  {{::$root.resources.strings.in_context_app_store_dialog_sort_method_alphabet|translate}}\n                  <ng-include src="\'svg/icons-accept.html\'" ng-if="dialogCtrl.sortMethod == \'alphabet\'"></ng-include>\n                </button>\n            </div>\n          </div>\n\n          \x3c!-- Installed Apps --\x3e\n          <in-context-app-store-app-grid apps="dialogCtrl.filteredInstalledApps" header-message="dialogCtrl.installedAppsHeaderMessage" on-app-tile-click="dialogCtrl.onInstalledItemClick(appVM)" store-scope="dialogCtrl.storeContext.scope" is-installing-app-id="dialogCtrl.isInstallingAppId" data-tid="installed-apps"></in-context-app-store-app-grid>\n\n          \x3c!-- Suggested Apps --\x3e\n          <in-context-app-store-app-grid apps="dialogCtrl.filteredSuggestedApps" header-message="dialogCtrl.suggestedAppsHeaderMessage" on-app-tile-click="dialogCtrl.onSuggestedItemClick(appVM)" data-tid="suggested-apps"></in-context-app-store-app-grid>\n\n          \x3c!-- Not Installed Apps --\x3e\n          <in-context-app-store-app-grid apps="dialogCtrl.filteredNotInstalledApps" header-message="dialogCtrl.notInstalledAppsHeaderMessage" on-app-tile-click="dialogCtrl.onNotInstalledItemClick(appVM)" data-tid="not-installed-apps"></in-context-app-store-app-grid>\n\n          <div ng-if="dialogCtrl.searchString && dialogCtrl.filteredInstalledApps.length === 0 && dialogCtrl.filteredNotInstalledApps.length === 0 && dialogCtrl.filteredSuggestedApps.length == 0" translate-with-html-params translate-id="extension_tabsGallery_noSearchResults" translate-values=\'{"searchString": "{{dialogCtrl.searchString}}"}\'></div>\n\n          <div ng-if="!dialogCtrl.isLoading && !dialogCtrl.searchString && dialogCtrl.filteredInstalledApps.length === 0 && dialogCtrl.filteredNotInstalledApps.length === 0 && dialogCtrl.filteredSuggestedApps.length == 0" class="app-store-dialog-empty-message" ng-bind="::dialogCtrl.emptyStateMessage"></div>\n        </div>\n        \x3c!-- simple scroll bar adds classes the containing element like not-at-bottom and not-at-top --\x3e\n        \x3c!-- the two divs below provide the styling for the divider line at the top and bottom of the scrolled content --\x3e\n        <div class="more-indicator-top"></div>\n        <div class="more-indicator-bottom"></div>\n      </div>\n    </div>\n\n    \x3c!-- dialog custom footer --\x3e\n    <div class="app-store-dialog-footer">\n      <button class="ts-sym ts-btn app-icons-fill-hover app-icons-fill-focus" ng-click="dialogCtrl.gotoManageApps()" ng-if="::dialogCtrl.showManageApps" track-gesture="{{::$root.trackConstants.trackGesture.click}}" track-scenario="{{::$root.trackConstants.trackScenario.manageApps}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.appSettings}}" track-outcome="{{::$root.trackConstants.trackOutcome.nav}}" track-name="{{::$root.trackConstants.trackModuleName.navInContextAppStoreDialog}}" track-type="{{::$root.trackConstants.trackType.navInContextAppStoreDialog}}" track-summary="in-context app store manage apps">\n        <ng-include class="icon" src="\'svg/icons-settings.html\'"></ng-include>\n        <span class="tabs-gallery-ftr-button-text" ng-bind="::$root.resources.strings.in_context_app_store_dialog_goto_manage_apps | translate"></span>\n      </button>\n    </div>\n  </modal-dialog>\n</div>\n'},2667:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)},a=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var i=Array(e),a=0,t=0;t<n;t++)for(var s=arguments[t],o=0,r=s.length;o<r;o++,a++)i[a]=s[o];return i};Object.defineProperty(t,"__esModule",{value:!0});var s=teamspace.services.AppsServiceEvents,o=teamspace.services.AppsServiceCategoryFilter,r=teamspace.middletier.ConfigurableTabContext,l=function(){function e(e,t,n,i,a,s,o,r,l,p){var c;this.$q=e,this.constants=t,this.appsService=n,this.conversationsService=i,this.teamMembershipPropertiesService=a,this.teamSettingsService=s,this.channelService=o,this.tabService=r,this.loggingService=p,this.enableSideloadedAppsInGroupChat=l.valueAsBoolean(t.settings.names.enableSideloadedAppsInGroupChat),this.enableAppsInstalledByCurrentUser=l.valueAsBoolean(t.settings.names.enableAppsInstalledByCurrentUser),this.enablePrivateChannelDisabledScopesFilter=l.valueAsBoolean(t.settings.names.enablePrivateChannelDisabledScopesFilter),this.privateChannelAuthorizedApps=l.valueFor(t.settings.names.privateChannelAuthorizedApps),this.enableSilentInstallForPreConsentedApps=l.valueAsBoolean(t.settings.names.enableSilentInstallForPreConsentedApps),this.enableAppsGalleryInMeetingChat=l.valueAsBoolean(t.settings.names.enableAppsGalleryinMeetingChat),this.enableTabFilteringByContext=l.valueAsBoolean(t.settings.names.enableTabFilteringByContext),this.enableGalleryTabSuggestions=l.valueAsBoolean(t.settings.names.enableGalleryTabSuggestions),this.enableAppsOnSharedChannel=l.valueAsBoolean(t.settings.names.enableAppsOnSharedChannel),this.enableContextlessAppInstallation=l.valueAsBoolean(t.settings.names.enableContextlessAppInstallation),this.galleryTabSuggestions=this.enableGalleryTabSuggestions?(null===(c=l.valueFor(t.settings.names.galleryTabSuggestions))||void 0===c?void 0:c.map(function(e){return e.id}))||[]:[]}return e.prototype.isAuthorizedInPrivateChannel=function(e){if(this.enablePrivateChannelDisabledScopesFilter){if(!e.disabledScopes||e.disabledScopes&&!e.disabledScopes.includes("PrivateChannel"))return!0}else if(this.privateChannelAuthorizedApps.includes(e.id.toLowerCase()))return!0;return!1},e.prototype.getUnfilteredInstalledApps=function(e,t){if(this.enableSilentInstallForPreConsentedApps){if(e.isMeeting)return this.appsService.getInstalledAppsForGroupChat(e.threadId,t);if(e.isSharedChannel){var n=e.threadId,i=e.teamId;return this.appsService.getInstalledAppsForTeam(i,n,t,"app-store-context-helper::getAppStoreData")}return this.appsService.getInstalledAppsForUser(t)}return this.$q.resolve([])},e.prototype.getAppStoreData=function(e,t,n){var s=this,o=this.getInstalledApps(e,t),r=this.getAppDefinitions(e,t),l=n?this.appsService.getAppStoreRankMap():this.$q.resolve({}),p=this.enableAppsInstalledByCurrentUser?this.appsService.getAppsInstalledByCurrentUserFromAllContexts():this.$q.resolve([]),c=this.getUnfilteredInstalledApps(e,t);return this.$q.all([o,r,l,p,c]).then(function(n){var o,r,l=n[0],p=n[1],c=n[2],d=n[3],g=n[4],u=new Map,h=[],m=[];_.forEach(l,function(n){var i,a,o;if(n&&n.appDefinition){var r=s.showAsInstalled(n,t.category,e),l=s.showAsPreConsented(n,t.category,e);if(r||l){r?h.push(n):m.push(n);var p=n.appDefinition;p.installedBy=null===(i=n.appEntitlement)||void 0===i?void 0:i.installedBy,s.enableSilentInstallForPreConsentedApps&&(null===(a=n.appEntitlement)||void 0===a?void 0:a.state)&&(p.state=n.appEntitlement.state),u.set(null===(o=p.id)||void 0===o?void 0:o.toLowerCase(),p)}}});var v=Array.from(u.values()),f=[],b=[];if(_.forEach(p,function(n){var i;n.state&&n.state==s.constants.extensibility.apps.appStates.installedAndDeprecated||!s.isValidInCurrentScope(n,t.category,e)||u.has(null===(i=n.id)||void 0===i?void 0:i.toLowerCase())||(n.state===s.constants.extensibility.apps.appStates.preConsented&&(n.state=void 0),s.galleryTabSuggestions&&s.galleryTabSuggestions.length>0&&s.galleryTabSuggestions.includes(n.id)?b.push(n):f.push(n))}),s.enableAppsInstalledByCurrentUser&&(!s.enableAppsOnSharedChannel||!e.isSharedChannel)){var y=s.applyAppsInstalledByUserFromAllContexts(v,f,d),S=y.installedApps,A=y.notInstalledApps;v=S,f=A}if(s.enableSilentInstallForPreConsentedApps&&!s.enableContextlessAppInstallation){var D=_.filter(g,function(e){return e.appEntitlement&&e.appEntitlement.state===s.constants.extensibility.apps.appStates.preConsented});_.forEach(v,function(e,t){var n=_.find(D,function(t){return t&&t.appEntitlement&&t.appEntitlement.id&&e&&e.id&&t.appEntitlement.id.toLowerCase()===e.id.toLowerCase()});n&&e.isNotInstalledInCurrentScope&&e.state!==s.constants.extensibility.apps.appStates.installedAndHidden&&(v[t]=i(i({},n.appDefinition),{state:n.appEntitlement.state}))}),_.forEach(D,function(e){_.some(v,function(t){return t&&t.id&&e&&e.appEntitlement&&e.appEntitlement.id&&t.id.toLowerCase()===e.appEntitlement.id.toLowerCase()})||v.push(i(i({},e.appDefinition),{state:e.appEntitlement.state}))}),f=_.differenceWith(f,v,function(e,t){return e.id.toLowerCase()===t.id.toLowerCase()})}var C=[];if(s.enableAppsGalleryInMeetingChat&&e.isMeeting){var I=[],T=[];I=(o=_.partition(v,function(e){return s.isMeetingOptimized(e)}))[0],v=o[1],T=(r=_.partition(f,function(e){return s.isMeetingOptimized(e)}))[0],f=r[1],T.forEach(function(e){null==e.isNotInstalledInCurrentScope&&(e.isNotInstalledInCurrentScope=!0)}),C=a(I,T)}return{installedApps:v,notInstalledApps:f,suggestedApps:b,meetingApps:C,appRankMap:c||{}}})},e.prototype.applyAppsInstalledByUserFromAllContexts=function(e,t,n){return e=_.concat(e,_.filter(t,function(e){if(n.includes(e.id))return e.isNotInstalledInCurrentScope=!0,!0})),t=_.filter(t,function(e){return!n.includes(e.id)}),{installedApps:e,notInstalledApps:t}},e.prototype.isMeetingOptimized=function(e){if(!_.isEmpty(e.galleryTabs))for(var t=0,n=e.galleryTabs;t<n.length;t++){var i=n[t];if(!_.isEmpty(i.meetingSurfaces)||_.some(i.context,function(e){return r[e]===r.MeetingSidePanel||r[e]===r.MeetingStage}))return!0}return!1},e.prototype.isValidScope=function(e,t,n){switch(t){case o.Tabs:return e.galleryTabs&&e.galleryTabs.some(function(e){return e.scopes&&e.scopes.some(function(e){return e.toLowerCase()===n.toLowerCase()})});case o.Bots:return e.bots&&e.bots.some(function(e){return e.scopes&&e.scopes.some(function(e){return e.toLowerCase()===n.toLowerCase()})});case o.Connectors:return e.connectors&&e.connectors.some(function(e){return e.scopes&&e.scopes.some(function(e){return e.toLowerCase()===n.toLowerCase()})});case o.InputExtensions:return e.inputExtensions&&e.inputExtensions.some(function(e){return e.scopes&&e.scopes.some(function(e){return e.toLowerCase()===n.toLowerCase()})});default:throw"AppServiceWrapper::isValidScope unknown capability"}},e.prototype.isValidContext=function(e,t,n){return t!==o.Tabs||"All"===n||e.galleryTabs&&e.galleryTabs.some(function(e){return!e.context||e.context.includes(n)})},e.prototype.showAsInstalled=function(e,t,n){return teamspace.services.AppsServiceUtils.isAppInstalled(e)&&this.isValidInCurrentScope(e.appDefinition,t,n)},e.prototype.showAsPreConsented=function(e,t,n){return teamspace.services.AppsServiceUtils.isAppPreConsented(e)&&this.isValidInCurrentScope(e.appDefinition,t,n)},e.prototype.isValidInCurrentScope=function(e,t,n){var i=n.isPrivateChannel,a=n.isSharedChannel;return this.isValidScope(e,t,n.scope)&&(!(i||a&&!this.enableAppsOnSharedChannel)||this.isAuthorizedInPrivateChannel(e))&&(!this.enableTabFilteringByContext||this.isValidContext(e,t,n.filterContext))},e.prototype.getAppStoreContext=function(e,t){var n=this.conversationsService.getConversation(e);if(n&&n.isChannelConversation()){var i=this.channelService.getChannelByObjectId(e);return{scope:this.constants.extensibility.teamContextName,threadId:n.id,teamId:teamspace.services.ChannelAppsServiceUtils.getTeamId(i,this.enableAppsOnSharedChannel,this.loggingService)||n.getTeamId(),isPrivateChannel:!(!i||i.channelType!==teamspace.services.ChannelType.Private),isSharedChannel:!(!i||i.channelType!==teamspace.services.ChannelType.Shared),filterContext:this.tabService.getCurrentContext(t),isMeeting:t}}if(this.enableSideloadedAppsInGroupChat)return{scope:this.constants.extensibility.groupChatContextName,threadId:n.id,filterContext:this.tabService.getCurrentContext(t),isMeeting:t};if(n)return{scope:this.constants.extensibility.oneOnOneContextName,threadId:n.id,filterContext:this.tabService.getCurrentContext(t),isMeeting:t};throw"AppServiceWrapper::getAppStoreContext sope unsupported"},e.prototype.getInstalledApps=function(e,t){var n=this,i=e.scope,a=e.threadId,s=e.teamId;switch(i){case this.constants.extensibility.teamContextName:var o=this.teamMembershipPropertiesService.isAdmin(s)||this.teamSettingsService.canAddApp(s);return this.appsService.getInstalledAppsForTeam(s,a,t,"app-store-context-helper::getInstalledApps").then(function(e){return!o&&n.enableContextlessAppInstallation&&(e=_.filter(e,function(e){return e.appEntitlement&&e.appEntitlement.state!==n.constants.extensibility.apps.appStates.preConsented})),e});case this.constants.extensibility.groupChatContextName:return this.appsService.getInstalledAppsForGroupChat(a,t);case this.constants.extensibility.oneOnOneContextName:return this.appsService.getInstalledAppsForUser(t);default:throw"AppServiceWrapper::getInstalledApps invalid scope"}},e.prototype.getAppDefinitions=function(e,t){var n=e.scope,i=e.threadId,a=e.teamId;switch(n){case this.constants.extensibility.teamContextName:return this.teamMembershipPropertiesService.isAdmin(a)||this.teamSettingsService.canAddApp(a)?this.appsService.getTeamAppDefinitions(a,i,"in-context-app-store-dialog",t,!0):this.$q.resolve([]);case this.constants.extensibility.groupChatContextName:return this.appsService.getGroupChatAppDefinitions(i,"in-context-app-store-dialog",t);default:return this.appsService.getUserAppDefinitions("in-context-app-store-dialog",t,!0)}},e.prototype.registerForAppEntitlementChanges=function(e,t,n){var i,a,o=t.scope,r=t.threadId,l=t.teamId;switch(o){case this.constants.extensibility.teamContextName:a=l,i=s.TeamDefinitionsChanged;break;case this.constants.extensibility.groupChatContextName:a=r,i=s.GroupChatDefinitionsChanged;break;case this.constants.extensibility.oneOnOneContextName:i=s.UserDefinitionsChanged;break;default:throw"registerForAppEntitlementChanges: invalid scope"}this.appsService.safeSubscribe(e,n,i,a)},e}();t.AppStoreContextHelper=l},2668:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=teamspace.services.AppsServiceCategoryFilter,a=function(){function e(e,t,n,i,a,s,o,r,l,p,c,d,g,u,h,m){this.$q=e,this.$rootScope=t,this.logger=n,this.constants=i,this.extensionDefinitionService=a,this.appsService=s,this.eventingService=o,this.dialogService=r,this.channelService=l,this.navigationService=p,this.uiOrchestrator=c,this.routeUtilityService=d,this.appDetailsDialogService=g,this.enableSideloadedAppsInGroupChat=u,this.enableContextlessAppInstall=h,this.appStoreDialogHelper=new teamspace.components.InContextAppStoreDialogHelper(i,r,m)}return e.prototype.executePostInstallAction=function(e,t,n,a,s,o,r){switch(a){case i.Tabs:this.openTabConfigurationDialog(e.threadId,n.id,e.scope,e.teamId,s,t,o,r,n.isPreConsented);break;case i.Bots:this.atMentionBot(n.name,n.botId,e,t);break;case i.InputExtensions:this.launchInputExtension(n.id,t);break;case i.Connectors:this.openConnectorConfigurationDialog(n.connectorId);break;default:throw"executePostInstallAction : invalid capability"}},e.prototype.executeSilentAppInstallAction=function(e,t){var n,i=this,a=e.scope,s=e.threadId,o=e.teamId,r=[];a===this.constants.extensibility.groupChatContextName?(n=this.logger.service.newScenario(this.constants.scenarios.extensibility.apps.inContextAppStoreDialog.preConsentedInstallGroupChat)).eventData.appId=t:a===this.constants.extensibility.teamContextName&&((n=this.logger.service.newScenario(this.constants.scenarios.extensibility.apps.inContextAppStoreDialog.preConsentedInstallTeam)).eventData.appId=t);var l={appIdList:[t]},p=this.enableContextlessAppInstall?this.$q.resolve():this.appsService.getInstalledAppsForUser(l).then(function(e){if(!_.find(e,function(e){return e.isAppInstalled()&&e.appEntitlement.isInstalledPersonally}))return i.appsService.getUserAppDefinition(t,"in-context-app-store-dialog").then(function(e){if(teamspace.services.AppsServiceUtils.isPersonalAppDefinition(e,!0))return i.appsService.createUserAppEntitlement(e,"in-context-app-store-dialog")})});switch(r.push(p),a){case this.constants.extensibility.groupChatContextName:var c=this.appsService.getGroupChatAppDefinition(s,t,"in-context-app-store-dialog").then(function(e){return i.appsService.createGroupChatAppEntitlement(s,e,"in-context-app-store-dialog").then(function(e){return null===n||void 0===n||n.stop(),e})}).catch(function(e){throw null===n||void 0===n||n.fail({error:"Silent installation in GroupChat Scope failed: "+JSON.stringify(teamspace.services.AppsServiceUtils.getSafeError(e))+" for appId "+t}),e});return r.push(c),Promise.all(r);case this.constants.extensibility.teamContextName:var d=this.appsService.getTeamAppDefinition(o,s,t,"in-context-app-store-dialog").then(function(e){return i.appsService.createTeamAppEntitlement(o,e,s,"in-context-app-store-dialog").then(function(e){return null===n||void 0===n||n.stop(),e})}).catch(function(e){throw null===n||void 0===n||n.fail({error:"Silent installation in Team Scope failed: "+JSON.stringify(teamspace.services.AppsServiceUtils.getSafeError(e))+" for appId "+t}),e});return r.push(d),Promise.all(r);default:return Promise.all(r)}},e.prototype.executeAppInstallAction=function(e,t,n,i,a,s){var o,r=this,l=e.scope,p=e.threadId,c=e.teamId,d=this.$q.defer(),g=this.logger.service.newScenario(this.constants.scenarios.extensibility.tabs.gallery.openInstallAppDialog),u=l===this.constants.extensibility.groupChatContextName&&this.enableSideloadedAppsInGroupChat&&p?teamspace.components.AddAppDialogInstallOptionFlag.GroupChat:teamspace.components.AddAppDialogInstallOptionFlag.Team,h=l===this.constants.extensibility.groupChatContextName&&this.enableSideloadedAppsInGroupChat&&p?teamspace.components.AddAppDialogIntent.GroupChat:p?teamspace.components.AddAppDialogIntent.Team:teamspace.components.AddAppDialogIntent.User,m=l===this.constants.extensibility.teamContextName&&c?c:void 0,v=l===this.constants.extensibility.teamContextName&&p?p:void 0,f=l===this.constants.extensibility.groupChatContextName&&this.enableSideloadedAppsInGroupChat?p:void 0,b=function(){r.appStoreDialogHelper.openDialog(m||f,n,i,s,null,null,null,!0)},y={appID:t,installOptionFlags:u,intent:h,teamId:m,channelId:v,chatId:f,skipInstalledSuccess:!0,source:this.constants.extensibility.contextualStoreDialog,onBackButtonClicked:b,isSurfacedApp:a};return o=l===this.constants.extensibility.groupChatContextName&&this.enableSideloadedAppsInGroupChat&&p?{entryPoint:teamspace.components.AddAppDialogEntryPoint.InContextGalleryDialogFromGroupChat,appId:t,chatId:f,onBackButtonClicked:b}:{entryPoint:teamspace.components.AddAppDialogEntryPoint.InContextGalleryDialogFromChannel,appId:t,channelId:v,teamId:m,onBackButtonClicked:b},this.appDetailsDialogService.open(this.constants.lazyDialogs.addAppNew,this.constants.lazyModules.extensibilityDialogs,Object.assign(y,o),function(e){var t=!1;if(e&&"object"==typeof e)"installSucceeded"in e&&(t=e.installSucceeded),"upgradeSucceeded"in e&&(t=e.upgradeSucceeded);else{r.logger.info("Focusing back to addNewTabBtn");var n=document.getElementById("add-tab-button-v2");null===n||void 0===n||n.focus()}t?d.resolve():d.reject(),r.appDetailsDialogService.registerCloseCallback(r.constants.lazyDialogs.addAppNew,null)}),g.stop(),d.promise},e.prototype.gotoManageApps=function(e,t){switch(e){case this.constants.extensibility.groupChatContextName:this.navigationService.navigateToManageAppsInChat(t,"in-context-app-store-dialog");break;case this.constants.extensibility.teamContextName:var n=this.channelService.getCurrentTeamAndChannel();this.navigationService.navigateToManageAppsInTeam(n.team,"in-context-app-store-dialog");break;default:throw"AppStoreActionsHandler::gotoManageApps invalid scope"}},e.prototype.openTabConfigurationDialog=function(e,t,n,i,a,s,o,r,l){var p=this,c=this.logger.service.newScenario(this.constants.scenarios.extensibility.tabs.gallery.openTabConfigurationDialog);this.extensionDefinitionService.getExtensionDefinition(t).then(function(t){var d=new teamspace.services.ExtensionInstanceViewModel(t,p.constants);p.dialogService.openLazyDialog(p.constants.lazyDialogs.tabInstanceConfiguration,p.constants.lazyModules.extensibilityTabs,{tabDefinition:t,tabInstance:d,threadId:e,operationType:a?teamspace.components.DialogTabMenuOperationType.ConfigureAppEntity:teamspace.components.DialogTabMenuOperationType.AddTabSettings,backToTabGallery:!0,scope:n,teamId:i,sdkCallerContext:a,messageId:s,correlationId:o,entryPoint:r,isPreconsentedApp:l}),c.stop()}).catch(function(e){c.fail({errorInfo:e,errorInfo1:e})})},e.prototype.atMentionBot=function(e,t,n,i){var a=this,s=function(){var s={botProfile:{memberCount:0,accountEnabled:!0,displayName:e,mri:a.constants.bots.keyPrefix+t,type:a.constants.atMentions.type.bot},messageId:n.scope===a.constants.extensibility.teamContextName?i:void 0,type:a.constants.atMentions.type.bot};a.eventingService.$emit(a.constants.events.bots.insertBotAtMention,s)};n.scope===this.constants.extensibility.teamContextName?(this.navigationService.navigateToChannel(n.threadId,"in-context-app-store-dialog"),this.executeOnEditorSync(n.threadId,function(){s()},i)):this.routeUtilityService.getRootRouteParams().middlePane===this.constants.messages.panes.conversations?s():(this.navigationService.navigateToChat(n.threadId,"in-context-app-store-dialog"),this.executeOnEditorSyncForChat(n.threadId,function(){s()}))},e.prototype.openConnectorConfigurationDialog=function(e){var t=this.channelService.getCurrentTeamAndChannel();this.dialogService.openLazyDialog(this.constants.lazyDialogs.connectorsManager,this.constants.lazyModules.extensibilityDialogs,{team:t.team,channel:t.channel,connectorId:e})},e.prototype.launchInputExtension=function(e,t){var n={appId:e,messageId:t,type:this.constants.events.funStuff.type.inputExtension};this.eventingService.$emit(this.constants.events.app.installed,n)},e.prototype.executeOnEditorSync=function(e,t,n){var i=this,a=this.$rootScope.$on(this.constants.events.messages.focusInEditor,function(s,o){var r=o&&o.replyChainId;if(n&&n==r||!r&&!n){var l=i.routeUtilityService.getRootRouteParams();(!e||l&&l.threadId===e)&&i.uiOrchestrator.nextFrame(teamspace.services.UiOrchestratorPriority.Low,function(){t()}),a&&a()}})},e.prototype.executeOnEditorSyncForChat=function(e,t){var n=this,i=this.$rootScope.$on(this.constants.events.messages.focusInEditor,function(){var a=n.routeUtilityService.getRootRouteParams();(!e||a&&a.peopleSlug===e)&&n.uiOrchestrator.nextFrame(teamspace.services.UiOrchestratorPriority.Low,function(){t()}),i&&i()})},e}();t.AppStoreActionsHandler=a},2669:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,n){this.$translate=e,this.resources=t,this.constants=n}return e.prototype.getCapabilities=function(e){switch(e.scope){case this.constants.extensibility.teamContextName:case this.constants.extensibility.groupChatContextName:return[this.getTabsCapability(e),this.getBotsCapability()];case this.constants.extensibility.oneOnOneContextName:return[this.getTabsCapability(e)]}},e.prototype.getTabsCapability=function(e){var t=this.resources.strings.in_context_app_store_dialog_caption_message_tabs_chats;return e.isMeeting?t=this.resources.strings.in_context_app_store_dialog_caption_message_tabs_meetings:e.scope===this.constants.extensibility.teamContextName&&(t=e.isPrivateChannel?this.resources.strings.in_context_app_store_dialog_caption_message_tabs_private_channel:e.isSharedChannel?this.resources.strings.in_context_app_store_dialog_caption_message_tabs_shared_channel:this.resources.strings.in_context_app_store_dialog_caption_message_tabs_channel),{value:teamspace.services.AppsServiceCategoryFilter.Tabs,text:this.$translate.instant(this.resources.strings.extensibility_apps_gallery_tabs_option),title:this.$translate.instant(this.resources.strings.extensibility_apps_gallery_title_tabs_option),caption:this.$translate.instant(t)}},e.prototype.getBotsCapability=function(){return{value:teamspace.services.AppsServiceCategoryFilter.Bots,text:this.$translate.instant(this.resources.strings.extensibility_apps_gallery_bots_option),title:this.$translate.instant(this.resources.strings.extensibility_apps_gallery_title_bots_option),caption:this.$translate.instant(this.resources.strings.in_context_app_store_dialog_caption_message_bots)}},e}();t.AppStoreCapabilityHelper=i},2670:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=[teamspace.Constants.Instance.extensibility.apps.appStates.preConsented,teamspace.Constants.Instance.extensibility.apps.appStates.installed,teamspace.Constants.Instance.extensibility.apps.appStates.installedAndFavorited,teamspace.Constants.Instance.extensibility.apps.appStates.installedAndPermanent,teamspace.Constants.Instance.extensibility.apps.appStates.adminPreInstalled],a=function(){function e(e,t){this.utilityService=e,this.appRankMap=t}return e.prototype.convertAppDefinitionToInContextStoreViewModel=function(e){var t,n;return{id:e.id,name:e.name,nameLowerCase:e.name.toLowerCase(),description:e.shortDescription,icon:e.largeImageUrl,useNgIncludeForIcon:this.utilityService.useNgIncludeForIcon(e.largeImageUrl),accentColor:e.accentColor,installRank:this.getInstallRank(e),isSideloaded:!!e.externalId&&!e.tenantId,isTenantApp:!!e.externalId&&!!e.tenantId,categories:e.categories?e.categories:[],botId:this.getBotId(e),inputExtensionId:this.getInputExtensionId(e),connectorId:this.getConnectorId(e),isNotInstalledInCurrentScope:e.isNotInstalledInCurrentScope,isPreConsented:e.state===teamspace.Constants.Instance.extensibility.apps.appStates.preConsented,requiresRSCPermissions:!!(null===(n=null===(t=e.webApplicationInfo)||void 0===t?void 0:t.applicationPermissions)||void 0===n?void 0:n.length),showAddIconOnHover:i.includes(e.state)}},e.prototype.getInstallRank=function(e){return this.appRankMap[e.id]?this.appRankMap[e.id].installRank:0},e.prototype.getBotId=function(e){return e.bots&&e.bots.length>0?e.bots[0].id:void 0},e.prototype.getInputExtensionId=function(e){return e.inputExtensions&&e.inputExtensions.length>0?e.inputExtensions[0].botId:void 0},e.prototype.getConnectorId=function(e){return e.connectors&&e.connectors.length>0?e.connectors[0].connectorId:void 0},e}();t.AppStoreViewModelAdapter=a},2671:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=teamspace.services.AppsServiceCategoryFilter,a=function(){function e(e,t,n){this.constants=e,this.$translate=t,this.resources=n,this.MF_SELECTOR_VALUE_CHAT="chats",this.MF_SELECTOR_VALUE_CHANNEL="channel",this.MF_SELECTOR_VALUE_PRIVATE_CHANNEL="private_channel",this.MF_SELECTOR_VALUE_SHARED_CHANNEL="shared_channel",this.MF_SELECTOR_VALUE_TABS="tabs",this.MF_SELECTOR_VALUE_BOTS="bots"}return e.prototype.getSortingToggleAriaLabel=function(e,t){return("recent"==e?this.$translate.instant(this.resources.strings.in_context_app_store_dialog_sort_method_recent):this.$translate.instant(this.resources.strings.in_context_app_store_dialog_sort_method_alphabet))+" "+(t?this.$translate.instant(this.resources.strings.in_context_app_store_dialog_sort_method_expanded):this.$translate.instant(this.resources.strings.in_context_app_store_dialog_sort_method_collapsed))},e.prototype.getDialogTitle=function(e){var t=this.getResourceParams(e);return this.$translate.instant(this.resources.strings.in_context_app_store_dialog_title_mf,t,this.constants.translation.interpolationIds.messageformat)},e.prototype.getSDKGalleryCallerDialogTitle=function(){return this.$translate.instant(this.resources.strings.in_context_app_store_dialog_title_sdk_caller)},e.prototype.getSDKGalleryCallerDialogCaption=function(){return this.$translate.instant(this.resources.strings.in_context_app_store_dialog_caption_message_sdk_caller)},e.prototype.getEmptyStateMessage=function(e){var t=this.getResourceParams(e);return this.$translate.instant(this.resources.strings.in_context_app_store_dialog_empty_state_message_mf,t,this.constants.translation.interpolationIds.messageformat)},e.prototype.getInstalledHeaderMessage=function(e,t){var n;switch(e){case i.Tabs:n=this.resources.strings.in_context_app_store_dialog_installed_apps_heading_tabs_mf;break;case i.Bots:n=this.resources.strings.in_context_app_store_dialog_installed_apps_heading_bots_mf}var a=this.getResourceParams(e,t);return this.$translate.instant(n,a,this.constants.translation.interpolationIds.messageformat)},e.prototype.getSuggestedHeaderMessage=function(){return this.$translate.instant(this.resources.strings.in_context_app_store_dialog_suggested_apps_heading_tabs_mf)},e.prototype.getNotInstalledHeaderMessage=function(e,t){var n=this.resources.strings.in_context_app_store_dialog_not_installed_apps_heading_mf,i=this.getResourceParams(e,null,t);return this.$translate.instant(n,i,this.constants.translation.interpolationIds.messageformat)},e.prototype.getMeetingsOptimizedHeaderMessage=function(e,t){var n=this.resources.strings.in_context_app_store_dialog_meeting_optimized_apps_heading_tabs_mf,i=this.getResourceParams(e,null,t);return this.$translate.instant(n,i,this.constants.translation.interpolationIds.messageformat)},e.prototype.getSearchResultsAriaString=function(e,t){var n;switch(e){case i.Tabs:n=this.resources.strings.in_context_app_store_dialog_search_result_update_tabs_mf;break;case i.Bots:n=this.resources.strings.in_context_app_store_dialog_search_result_update_bots_mf}var a=this.getResourceParams(e,null,t);return this.$translate.instant(n,a,this.constants.translation.interpolationIds.messageformat)},e.prototype.getResourceParams=function(e,t,n){var a={};switch(e){case i.Tabs:a.capability=this.MF_SELECTOR_VALUE_TABS;break;case i.Bots:a.capability=this.MF_SELECTOR_VALUE_BOTS}return t&&(t.scope===this.constants.extensibility.teamContextName?t.isPrivateChannel?a.context=this.MF_SELECTOR_VALUE_PRIVATE_CHANNEL:t.isSharedChannel?a.context=this.MF_SELECTOR_VALUE_SHARED_CHANNEL:a.context=this.MF_SELECTOR_VALUE_CHANNEL:a.context=this.MF_SELECTOR_VALUE_CHAT),void 0!==n&&(a.count=n),a},e}();t.InContextAppStoreDialogStringsHelper=a},2672:function(e,t,n){"use strict";"user strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2673),a=function(){function e(e,t,n,i,a,s,o){var r=this;this.$scope=n,this.$state=i,this.constants=a,this.tooltipService=s,this.utilityService=o,this.errorMessage=n.ngDialogData.errorMessage,this.errorDetails=n.ngDialogData.errorDetails,this.footerButtons=[{icon:"svg/icons-discover-apps.html",text:e.instant(t.strings.extensibility_go_to_store),func:function(){return r.openAppStore()},tid:"manifestErrorDialog-openStore"}]}return e.$inject=["$translate","resources","$scope","$state","constants","tooltipService","utilityService"],e.prototype.onCopyErrorDetailsClick=function(e){var t={};t[teamspace.services.UtilityServiceStatics.ClipboardFormats.Text]=this.errorDetails,this.utilityService.copyMultipleFormatsToClipboard(t);var n=angular.element(document.querySelector(".manifest-error-dialog-link-text"));n&&this.tooltipService.showLinkCopiedTooltip(e,this.$scope,n,n,12)},e.prototype.openAppStore=function(){var e={intent:teamspace.components.AddAppDialogIntent.Ambiguous,category:teamspace.services.AppsServiceCategoryFilter.All,autoNavigationOnDone:!0,skipInstalledSuccess:!1,storeLaunchFromChat:!1};this.$state.go(this.constants.states.appApps,e),this.$scope.closeThisDialog()},e}();t.ManifestErrorDialogController=a,angular.module("teamspace.manifestErrorDialog",["teamspace.dialogService","teamspace.utilityService","teamspace.tooltipService","teamspace.constants"]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put(e.files.templates.manifestErrorDialog,i),t.register(e.lazyDialogs.manifestError,{template:e.files.templates.manifestErrorDialog,className:"ts-modal-dialog custom-width manifest-error-dialog new-dialog",showClose:!1,isPersistent:!0})}]).controller("ManifestErrorDialogController",a)},2673:function(e,t){e.exports='<div class="manifest-error-dialog-container" ng-controller="ManifestErrorDialogController as medc" aria-modal="true" acc-role="dialog">\n  <modal-dialog footer-buttons="medc.footerButtons" center-align-buttons="true" add-close-icon="true" suppress-default-button="true" skip-auto-focus="true" class="manifest-error-dialog">\n    <div class="manifest-error-dialog-content">\n      <div class="manifest-error-dialog-image">\n        <ng-include src="\'svg/surprised-woman.html\'"></ng-include>\n      </div>\n      <div class="app-font-title2-bold manifest-error-dialog-message" ng-bind-html="medc.errorMessage">\n      </div>\n      <div class="manifest-error-dialog-helper-message" translate-once="extensibility_manifest_error_message">For more information, please visit aka.ms/teamsdocs\n      </div>\n      <a ng-click="medc.onCopyErrorDetailsClick($event)" ng-if="medc.errorDetails" rel="noopener noreferrer" class="manifest-error-dialog-link" tabindex="0">\n        <div class="manifest-error-dialog-link-text" translate-once="extension_addAppDialogManifestParsingCopyClipboardLabel">Copy Error Details to Clipboard\n        </div>\n      </a>\n    </div>\n  </modal-dialog>\n</div>'},2674:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){function a(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function r(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?n(e.value):a(e.value).then(o,r)}l((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,s&&(o=2&n[0]?s.return:n[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,s=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],s=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,s,o,r,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2675),o=n(2676),r=function(){function e(e,t,n,i,a,s,o,r,l,p,c,d,g,u,h,m,v){var f=this;this.$injector=e,this.$ocLazyLoad=t,this.$q=n,this.$scope=i,this.$translate=a,this.constants=s,this.dialogService=o,this.appDetailsDialogService=r,this.resources=l,this.localizationService=p,this.utilityService=c,this.settingsService=d,this.loggingService=g,this.analyticsService=u,this.tooltipService=h,this.$sce=m,this.htmlSanitizer=v,this.buttonText="",this.planDisplayUnitText="",this.appCapabilities=[],this.strSaasTermsList=[],this.planToTermMap=new Map,this.activePlanTerms=[],this.subscriptionPlansDialogTitle="",this.isCheckoutClicked=!1,this.shouldPreLoadCheckout=!1,this.allPlansCheckoutData=[],this.subscriptionPlansDialogData=i.ngDialogData,this.trackingId=c.generateUUID(),this.loadMonetizationService().then(function(){var e;if(f.subscriptionPlansDialogData.billingRegion)f.populateDialogData();else{var t=null===(e=p.getLocale())||void 0===e?void 0:e.split("-")[0];f.monetizationService.getBillingRegion().then(function(e){var n;e&&(f.subscriptionPlansDialogData.billingRegion=e,f.subscriptionPlansDialogData.billingRegion.language=null!==t&&void 0!==t?t:s.monetization.fallbackLanguage,f.subscriptionPlansDialogData.billingRegion.culture=null!==(n=p.getLocale())&&void 0!==n?n:s.monetization.fallbackLocale),f.subscriptionPlansDialogData.billingRegion?f.populateDialogData():(o.close(s.lazyDialogs.subscriptionPlansDialog),o.openLazyDialog(s.lazyDialogs.countrySelectorDialog,s.lazyModules.extensibilityDialogs,f.subscriptionPlansDialogData))})}})}return e.$inject=["$injector","$ocLazyLoad","$q","$scope","$translate","constants","dialogService","appDetailsDialogService","resources","localizationService","utilityService","settingsService","loggingService","analyticsService","tooltipService","$sce","htmlSanitizer"],e.prototype.loadMonetizationService=function(){var e=this;return this.monetizationService?this.$q.resolve():this.$ocLazyLoad.load("extensibility-services").then(function(){return e.monetizationService=e.$injector.get("monetizationService"),e.$q.resolve()})},e.prototype.populateDialogData=function(){var e=this;this.subscriptionPlansDialogData.sessionId=this.utilityService.generateUUID(),this.showManageSubscriptions=!this.settingsService.valueAsBoolean(this.constants.settings.names.showManageSubscriptionInAppInstallDialog),this.settingsService.valueAsBoolean(this.constants.settings.names.enablePreLoadingCheckout)&&this.monetizationService.getUserBillingInfo().then(function(t){t&&t.isUserBootstrapped&&(e.shouldPreLoadCheckout=!0,e.buildAllPlansSubscriptionPlansDialogData())}),this.monetizationService.isPlaceOrderDisabled().then(function(t){e.isPlaceOrderDisabled=t,e.subscriptionPlansDialogData&&e.subscriptionPlansDialogData.appdefinition&&e.subscriptionPlansDialogData.appdefinition.subscriptionOffer&&e.subscriptionPlansDialogData.appdefinition.subscriptionOffer.offerId?(e.monetizationService.startCommerceAccountBootstrapping(e.subscriptionPlansDialogData.billingRegion.country),e.updateButtonText(),e.loadOffer(),e.showManageSubscriptions&&(e.showPlaceOrderLoadingSpinner=!0,e.loadAssets()),e.subscriptionPlansDialogTitle=e.$translate.instant(e.resources.strings.extension_subscriptionPlansDialog_title),e.logoImageUrl=e.subscriptionPlansDialogData.appdefinition.largeImageUrl):e.failedToLoadPlans=!0,e.subscriptionPlansDialogData&&e.subscriptionPlansDialogData.appdefinition.name&&e.subscriptionPlansDialogData.billingRegion.countryName&&(e.plansNotFoundSubTitle=e.$translate.instant(e.resources.strings.extension_subscriptionPlansDialog_notfound_subtitle,{appname:e.subscriptionPlansDialogData.appdefinition.name,countryName:e.subscriptionPlansDialogData.billingRegion.countryName})),e.tooltipId=e.utilityService.generateUUID(),e.tooltipText=e.$translate.instant(e.resources.strings.extension_subscriptionPlansDialog_privatePlanTooltipMessage)})},e.prototype.loadOffer=function(){var e=this,t=this.loggingService.newScenario(this.constants.scenarios.extensibility.monetization.perf.openPlansDialog),n=this.subscriptionPlansDialogData.offer;if(n&&this.subscriptionPlansDialogData.billingRegion.country===this.constants.monetization.defaultOfferCountry)return this.initializeViewModel(n),void t.stop();try{return this.monetizationService.getOffer(this.subscriptionPlansDialogData.appdefinition.subscriptionOffer.offerId).then(function(n){n&&0!=n.plans.length?(e.initializeViewModel(n),t.stop()):(e.failedToLoadPlans=!0,e.initializeViewModel(n),t.fail({reason:"empty plans from getOffer"}))}).catch(function(n){e.failedToLoadPlans=!0,e.loggingService.error("Failed to load subscription plans for offer Id "+e.subscriptionPlansDialogData.appdefinition.subscriptionOffer.offerId+". Error: "+n),t.fail({error:n})})}catch(e){this.failedToLoadPlans=!0,this.loggingService.error("Failed to load subscription plans for offer Id "+this.subscriptionPlansDialogData.appdefinition.subscriptionOffer.offerId+". Error: "+e),t.fail({error:e})}},e.prototype.loadAssets=function(){var e=this,t=this.loggingService.newScenario(this.constants.scenarios.extensibility.monetization.perf.enableCheckoutButton);this.isPlaceOrderDisabled?(this.shouldPreLoadCheckout=!1,t.stop()):this.monetizationService.getActiveSubscriptions(this.subscriptionPlansDialogData.appdefinition.subscriptionOffer.offerId).then(function(n){(n&&n[0]||e.subscriptionPlansDialogData.appdefinition||e.showPlaceOrderLoadingSpinner)&&(e.showPlaceOrderLoadingSpinner=!1,e.activeSubscription=n?n[0]:null,e.hasActiveSubscription=e.settingsService.valueAsBoolean(e.constants.settings.names.enableManageSubscriptions)&&!!n&&!!n[0],e.hasActiveSubscription&&(e.shouldPreLoadCheckout=!1),t.stop()),n.forEach(function(t){e.activePlanTerms.push(t.saasBigCatalogId+"_"+t.planSkuId+"_"+t.planTermId)})})},e.prototype.logBiTelemetryForViewManageSubscriptionMessage=function(){this.logPlansDialogTelemetry(teamspace.components.PanelActionScenario.manageSubscriptionMessageViewed.toString(),teamspace.components.PanelActionGesture.auto)},e.prototype.navigateToManageSubscriptionsPage=function(){this.logPlansDialogTelemetry(teamspace.components.PanelActionScenario.manageSubscriptionsClicked.toString(),teamspace.components.PanelActionGesture.click),this.settingsService.valueAsBoolean(this.constants.settings.names.manageSubscriptionsInAdminCenter)&&this.activeSubscription.managePurchaseUrl?window.open(this.activeSubscription.managePurchaseUrl,"_blank"):this.openManageSubscriptionDialog()},e.prototype.openManageSubscriptionDialog=function(){return i(this,void 0,void 0,function(){var e;return a(this,function(t){return this.activeSubscription&&this.activeSubscription.assetId&&(event.preventDefault(),this.close(),e={appdefinition:this.subscriptionPlansDialogData.appdefinition,addAppDialogData:this.subscriptionPlansDialogData.addAppDialogData,sourceDialog:this.constants.lazyDialogs.subscriptionPlansDialog,assetId:this.activeSubscription.assetId},this.dialogService.openLazyDialog(this.constants.lazyDialogs.manageSubscriptionDialog,this.constants.lazyModules.extensibilityDialogs,e)),[2]})})},e.prototype.initializeViewModel=function(e){var t=this,n={productName:e?e.saasProductName:"",purchaseUrl:e?e.monetPurchaseUrl:"",plans:[]};this.isShowPublicPlansEnabled=!0,this.hasPublicPlans=!1,e&&e.plans&&(e.plans.forEach(function(i){var a={title:i.title,description:i.description,isPrivate:i.isPrivate};i.isPrivate?t.isShowPublicPlansEnabled=!1:t.hasPublicPlans=!0,i.terms.forEach(function(n){"P1M"===n.termUnits?(a.monthlyPrice=t.formatPrice(i,n.listPrice.toFixed(2)),a.monthlyId=t.utilityService.generateUUID(),a.monthlyTermId=e.saasBigCatalogId+"_"+i.bigCatSkuId+"_"+n.bigCatTermId,t.addPlanToMap(a.monthlyId,e,i,n),n.freeTrialDurationDays>0&&(a.freeTrailMonthlyLabel=t.getFreeTrailLabel(n.freeTrialDurationDays))):"P1Y"===n.termUnits&&(a.yearlyPrice=t.formatPrice(i,n.listPrice.toFixed(2)),a.yearlyId=t.utilityService.generateUUID(),a.yearlyTermId=e.saasBigCatalogId+"_"+i.bigCatSkuId+"_"+n.bigCatTermId,t.addPlanToMap(a.yearlyId,e,i,n),n.freeTrialDurationDays>0&&(a.freeTrailYearlyLabel=t.getFreeTrailLabel(n.freeTrialDurationDays)))}),n.plans.push(a)}),this.selectedPlanId=this.planToTermMap.keys().next().value),this.shouldPreLoadCheckout&&this.buildAllPlansSubscriptionPlansDialogData(),this.subscriptionPlanViewModel=n},e.prototype.buildAllPlansSubscriptionPlansDialogData=function(){var e=this;if(!(this.allPlansCheckoutData.length>0)){var t=this.settingsService.valueFor(this.constants.settings.names.monetizationConstants),n=[],i=t.preLoadAllPlans?this.planToTermMap.keys.length:t.maxNumberOfPlansToPreLoad;this.planToTermMap.forEach(function(a,s){if(n.length<i){var o={planId:s,plan:{selectedPlan:a,subscriptionPlansDialogData:e.subscriptionPlansDialogData,checkoutStartTime:Date.now(),trackingId:e.trackingId}};("Monthly"==a.billingCycle&&t.preLoadMonthlyPlans||"Annually"==a.billingCycle&&t.preLoadYearlyPlans)&&n.push(o)}}),this.allPlansCheckoutData=n}},e.prototype.choosePurchaseUrl=function(){var e=this;this.enablePurchaseBlend=this.settingsService.valueAsBoolean(this.constants.settings.names.enablePurchaseBlend),this.enablePurchaseBlend?this.shouldPreLoadCheckout&&this.allPlansCheckoutData.some(function(t){return t.planId===e.selectedPlanId})?(this.checkoutClickStartTime=Date.now(),this.logCheckoutClicked(),this.isCheckoutClicked=!0):this.buy():this.redirectToUrl(this.subscriptionPlanViewModel.purchaseUrl)},e.prototype.getFreeTrailLabel=function(e){var t="";return t=1==e?this.$translate.instant(this.resources.strings.extension_subscriptionPlansDialog_label_freeTrialDay_singular):this.$translate.instant(this.resources.strings.extension_subscriptionPlansDialog_label_freeTrialDays_plural),e+" "+t+" "+this.$translate.instant(this.resources.strings.extension_subscriptionPlansDialog_label_freeTrial)},e.prototype.addPlanToMap=function(e,t,n,i){var a={productId:t.saasBigCatalogId,availabilityId:n.bigCatAvailabilityId,skuId:n.bigCatSkuId,minimumQuantity:n.minQuantity,availabilityTermId:i.bigCatTermId,billingCycle:"P1M"==i.termUnits?"Monthly":"Annually",isThirdPartySaaSAppPurchase:!0,formattedPrice:this.formatPrice(n,(i.listPrice*n.minQuantity).toFixed(2)),listPrice:i.listPrice,trialDays:i.freeTrialDurationDays,isPrivate:n.isPrivate,isQuantifiable:n.isQuantifiable};a.isQuantifiable&&(this.planDisplayUnitText=this.$translate.instant(this.resources.strings.extension_subscriptionPlansDialog_perUserLabel)),this.planToTermMap.set(e,a)},e.prototype.getListingPrice=function(e,t){try{return e.terms.find(function(e){return e.termUnits===t}).listPrice.toFixed(2)}catch(e){return 0}},e.prototype.redirectToUrl=function(e){window.open(e,"_blank")},Object.defineProperty(e.prototype,"navCtx",{get:function(){return"subscription-plans-dialog"},enumerable:!0,configurable:!0}),e.prototype.showPlans=function(){this.isCheckoutClicked=!1},e.prototype.back=function(){this.logPlansDialogTelemetry(teamspace.components.PanelActionScenario.monetNavBackAction.toString(),teamspace.components.PanelActionGesture.click),this.close(),this.appDetailsDialogService.open(this.constants.lazyDialogs.addAppNew,this.constants.lazyModules.extensibilityDialogs,this.subscriptionPlansDialogData.addAppDialogData)},e.prototype.cancel=function(){this.logPlansDialogTelemetry(teamspace.components.PanelActionScenario.cancelMonetPlans.toString(),teamspace.components.PanelActionGesture.click),this.close()},e.prototype.close=function(){this.dialogService.close(this.constants.lazyDialogs.subscriptionPlansDialog)},e.prototype.buy=function(){this.close();var e={selectedPlan:this.planToTermMap.get(this.selectedPlanId),subscriptionPlansDialogData:this.subscriptionPlansDialogData,checkoutStartTime:Date.now(),trackingId:this.trackingId};this.dialogService.openLazyDialog(this.constants.lazyDialogs.subscriptionPlanPurchaseDialog,this.constants.lazyModules.extensibilityDialogs,e),this.logCheckoutClicked()},e.prototype.logCheckoutClicked=function(){this.logPlansDialogTelemetry(teamspace.components.PanelActionScenario.checkoutClicked.toString(),teamspace.components.PanelActionGesture.click),this.loggingService.newScenario(this.constants.scenarios.extensibility.monetization.action.clickCheckOut).stop()},e.prototype.getPlanDetails=function(){var e=this.planToTermMap.get(this.selectedPlanId);return this.subscriptionPlansDialogData.appdefinition.name+"|"+e.productId+"|"+e.availabilityId+"|"+e.availabilityTermId+"|"+e.billingCycle+"|"+e.skuId+"|"+e.formattedPrice+"|"+this.subscriptionPlansDialogData.sessionId},e.prototype.formatPrice=function(e,t){return t>=0?this.localizationService.formatNumber(t,{style:"currency",currency:e.currencyCode}):""},e.prototype.updateButtonText=function(){this.buttonText=1==this.appCapabilities.length?this.appCapabilities[0].description:this.$translate.instant(this.resources.strings.extension_teamOrChannelPicker_setUpGeneralString)},e.prototype.onKeyboard=function(e){var t=e.keyCode;return t===this.constants.keyCodes.escape?(e.preventDefault(),void e.stopPropagation()):t===this.constants.keyCodes.tab?(event.stopPropagation(),void event.preventDefault()):void 0},e.prototype.showPublicPlans=function(){this.hasPublicPlans&&(this.isShowPublicPlansEnabled=!0)},e.prototype.trustAsHtml=function(e){var t=this.htmlSanitizer.sanitizeHtml(e);return t=t.replace(new RegExp("<a ","gi"),'<a target="_blank" '),this.$sce.trustAsHtml(t)},e.prototype.showInfoTooltip=function(e,t){if(t){var n={template:o,trigger:"manual",container:"body",placement:"top",content:this.tooltipText,autoClose:!0,scope:this.$scope},i={sourceElement:angular.element(e.currentTarget),tooltipType:teamspace.services.TooltipType.Popover,options:n,tooltipId:this.tooltipId};this.tooltipService.showTooltip(i)}else this.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,this.tooltipId)},e.prototype.logPlansDialogTelemetry=function(e,t){var n=this,i={action:{gesture:t,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.nav.toString(),teamspace.components.PanelActionOutcome,this.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(e,teamspace.components.PanelActionScenario,this.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.nav.toString(),teamspace.components.PanelActionScenarioType,this.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.monetPlans.toString(),teamspace.components.PanelModuleName,this.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.monetDialog.toString(),teamspace.components.PanelModuleType,this.loggingService),summary:this.subscriptionPlansDialogData.appdefinition.name},app:{id:this.subscriptionPlansDialogData.appdefinition.id},dataBag:{dialog:"monetPlans"}};this.analyticsService.getAnalyticsPanelActionEventData(i).then(function(e){return n.analyticsService.sendPanelAction(e)}).catch(function(e){n.loggingService.error("failed to log action "+e)})},e.prototype.setFocusOnTab=function(t){if(t&&t.target){var n=t.target.parentElement;n.className.contains(e.ToggleTabFocusClassName)||(n.className=n.className.concat(" ",e.ToggleTabFocusClassName),t.target.setAttribute("tabindex","0"))}},e.prototype.removeFocus=function(t){if(t&&t.target){var n=t.target.parentElement;n.className=n.className.replace(e.ToggleTabFocusClassName,"")}},e.ToggleTabFocusClassName="tab-focus",e}();t.SubscriptionPlansController=r,angular.module("teamspace.subscriptionPlansDialog",[]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put("components/extensibility/subscription-plans-dialog/subscription-plans-dialog.html",s),t.register(e.lazyDialogs.subscriptionPlansDialog,{template:"components/extensibility/subscription-plans-dialog/subscription-plans-dialog.html",className:"ts-modal-dialog custom-width subscription-plans-dialog",closeByEscape:!1,closeByDocument:!1,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"spc-dialog-title"})}]).controller("SubscriptionPlansController",r)},2675:function(e,t){e.exports='<div class="subscription-plans-dialog-modal-container" ng-controller="SubscriptionPlansController as spdc" aria-modal="true" acc-role="dialog">\n    <modal-dialog add-close-icon="false" suppress-default-footer="true" data-tid="subscriptionPlansDialog" aria-label="{{spdc.subscriptionPlansDialogTitle}}" track-panel-type="{{$root.trackConstants.panelType.monetPlans}}">\n\n    <section class="loading-spinner-container" ng-if="!spdc.subscriptionPlanViewModel && !spdc.failedToLoadPlans">\n      <div class="loading-spinner" ng-class="{\'hide-spinner\': spdc.subscriptionPlanViewModel}">\n        <busy-animation size="medium">\n        </busy-animation>\n        <span>{{::$root.resources.strings.extension_subscriptionPlansDialog_loading_spinner_label|translate}}</span>\n      </div>\n    </section>\n\n    <div class="ts-subscription-plans-dialog-header" ng-if="spdc.subscriptionPlanViewModel && spdc.subscriptionPlansDialogTitle && !spdc.failedToLoadPlans" ng-show="!spdc.isCheckoutClicked">\n      <img role="img" alt="{{($root.resources.strings.extensibility_app_icon_alt|translate:{appName:spdc.strName})}}" aria-label="{{($root.resources.strings.extensibility_app_icon_alt|translate:{appName:spdc.strName})}}" ng-src="{{spdc.logoImageUrl}}" class="subscription-plans-dialog-logo-img"/>\n      <h1 class="ts-subscription-plans-dialog-header-title">\n        {{spdc.subscriptionPlansDialogTitle}}\n      </h1>\n    </div>\n\n    <subscription-plan-purchase-directive ng-repeat="planCheckoutData in spdc.allPlansCheckoutData" subscription-plan-purchase-dialog-data="planCheckoutData.plan" class="ts-subscription-plans-purchase-dialog-container" ng-if="spdc.shouldPreLoadCheckout" ng-show="planCheckoutData.planId==spdc.selectedPlanId && spdc.isCheckoutClicked" id="{{planCheckoutData.planId}}" is-checkout-clicked="spdc.isCheckoutClicked" checkout-click-start-time="spdc.checkoutClickStartTime" show-plans="spdc.showPlans()" close-checkout="spdc.close()">\n    </subscription-plan-purchase-directive>\n\n    <section class="ts-subscription-plans-dialog-container" ng-if="spdc.subscriptionPlanViewModel && !spdc.failedToLoadPlans" ng-show="!spdc.isCheckoutClicked">\n      <div ng-if="spdc.subscriptionPlanViewModel.plans.length > 0">\n        <div class="ts-subscription-plans-dialog-scrollbar-wrapper">\n          <div class="app-font-base-regular subscription-plans-prevent-order" ng-if="spdc.isPlaceOrderDisabled">\n            {{::$root.resources.strings.extension_subscriptionPlansDialog_preventOrderLabel|translate}}\n          </div>\n\n          <div simple-scrollbar>\n            <div class="ts-subscription-plans-dialog-scrolling-plate">\n              <div>\n                <table class="subscription-plans-table" id="subscriptionPlansDialogTable" acc-role="table-keyboard" aria-describedby="subscriptionPlansDialogTable" aria-label="{{spdc.subscriptionPlansDialogTitle}}">\n                  <thead>\n                    <tr>\n                      <th class="app-font-base-regular">\n                        <span ng-if="spdc.subscriptionPlanViewModel.plans.length == 1">\n                          {{::$root.resources.strings.extension_subscriptionPlansDialog_tableHeader_plan|translate}}\n                        </span>\n                        <span ng-if="spdc.subscriptionPlanViewModel.plans.length > 1">\n                          {{::$root.resources.strings.extension_subscriptionPlansDialog_tableHeader_plans|translate}}\n                        </span>\n                      </th>\n                      <th class="app-font-base-regular">\n                        {{::$root.resources.strings.extension_subscriptionPlansDialog_tableHeader_price|translate}}\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    <tr ng-repeat="subscriptionPlan in spdc.subscriptionPlanViewModel.plans" ng-if="subscriptionPlan.isPrivate">\n                      <td class="ts-subscription-plans-dialog-plan-description">\n                        <div class="app-font-base-bold ts-subscription-plans-title">{{subscriptionPlan.title}}</div>\n                        <div class="private-offer-plan-info icons-special-effect app-icons-fill-hover" ng-if="subscriptionPlan.isPrivate" ng-click="spdc.showInfoTooltip($event, true)" ng-focus="spdc.showInfoTooltip($event, true)" ng-blur="spdc.showInfoTooltip($event, false)" ng-mouseenter="spdc.showInfoTooltip($event, true)" ng-mouseleave="spdc.showInfoTooltip($event, false)">\n                          <ng-include src="\'svg/icons-special-effect.html\'"></ng-include>\n                        </div>\n                        <p ng-bind-html="spdc.trustAsHtml(subscriptionPlan.description)"></p>\n                      </td>\n\n                      <td>\n                        <div class="radio" ng-if="subscriptionPlan.monthlyPrice" id="{{\'radioBtnDivMonthly-\' + subscriptionPlan.monthlyId}}">\n                          <label><input type="radio" id="{{\'radioBtnMonthly-\' + subscriptionPlan.monthlyId}}" name="price" ng-click="spdc.removeFocus($event)" ng-if="!spdc.isPlaceOrderDisabled" ng-value="subscriptionPlan.monthlyId" ng-model="spdc.selectedPlanId" ng-focus="spdc.setFocusOnTab($event)" ng-blur="spdc.removeFocus($event)">\n                            <div>\n                              <span><span class="app-font-base-bold">{{subscriptionPlan.monthlyPrice}}</span>\n                                {{spdc.planDisplayUnitText}}{{::$root.resources.strings.extension_subscriptionPlansDialog_label_month|translate}}</span>\n                              <div class="subscription-plans-dialog-badge-blue" ng-if="subscriptionPlan.freeTrailMonthlyLabel && spdc.activePlanTerms.indexOf(subscriptionPlan.monthlyTermId) == -1 && !spdc.showPlaceOrderLoadingSpinner">\n                                {{subscriptionPlan.freeTrailMonthlyLabel}}\n                              </div>\n                              <div class="subscription-plans-dialog-badge-green" ng-if="spdc.activePlanTerms.indexOf(subscriptionPlan.monthlyTermId) != -1 && !spdc.showPlaceOrderLoadingSpinner">\n                                {{::$root.resources.strings.extension_subscriptionPlansDialog_label_active_subscription|translate}}\n                              </div>\n                            </div>\n                          </label>\n                        </div>\n\n                        <div class="radio" ng-if="subscriptionPlan.yearlyPrice" id="{{\'radioBtnDivYearly-\' + subscriptionPlan.yearlyId}}">\n                          <label><input type="radio" id="{{\'radioBtnYearly-\' + subscriptionPlan.yearlyId}}" name="price" ng-click="spdc.removeFocus($event)" ng-if="!spdc.isPlaceOrderDisabled" ng-value="subscriptionPlan.yearlyId" ng-model="spdc.selectedPlanId" ng-focus="spdc.setFocusOnTab($event)" ng-blur="spdc.removeFocus($event)">\n                            <div>\n                              <span>\n                                <span class="app-font-base-bold">{{subscriptionPlan.yearlyPrice}} </span>\n                                {{spdc.planDisplayUnitText}}{{::$root.resources.strings.extension_subscriptionPlansDialog_label_year|translate}}\n                              </span>\n                              <div class="subscription-plans-dialog-badge-blue" ng-if="subscriptionPlan.freeTrailYearlyLabel && spdc.activePlanTerms.indexOf(subscriptionPlan.yearlyTermId) == -1 && !spdc.showPlaceOrderLoadingSpinner">\n                                {{subscriptionPlan.freeTrailYearlyLabel}}\n                              </div>\n                              <div class="subscription-plans-dialog-badge-green" ng-if="spdc.activePlanTerms.indexOf(subscriptionPlan.yearlyTermId) != -1 && !spdc.showPlaceOrderLoadingSpinner">\n                                {{::$root.resources.strings.extension_subscriptionPlansDialog_label_active_subscription|translate}}\n                              </div>\n                            </div>\n                          </label>\n                        </div>\n                      </td>\n                    </tr>\n                    <tr ng-repeat="subscriptionPlan in spdc.subscriptionPlanViewModel.plans" ng-if="!subscriptionPlan.isPrivate && spdc.isShowPublicPlansEnabled">\n                      <td class="ts-subscription-plans-dialog-plan-description">\n                        <div class="app-font-base-bold ts-subscription-plans-title">{{subscriptionPlan.title}}</div>\n                        <p ng-bind-html="spdc.trustAsHtml(subscriptionPlan.description)"></p>\n                      </td>\n\n                      <td>\n                        <div class="radio" ng-if="subscriptionPlan.monthlyPrice" id="{{\'radioBtnDivMonthly-\' + subscriptionPlan.monthlyId}}">\n                          <label><input type="radio" id="{{\'radioBtnMonthly-\' + subscriptionPlan.monthlyId}}" name="price" ng-click="spdc.removeFocus($event)" ng-if="!spdc.isPlaceOrderDisabled" ng-value="subscriptionPlan.monthlyId" ng-model="spdc.selectedPlanId" ng-focus="spdc.setFocusOnTab($event)" ng-blur="spdc.removeFocus($event)">\n                            <div>\n                              <span><span class="app-font-base-bold">{{subscriptionPlan.monthlyPrice}}</span>\n                                {{spdc.planDisplayUnitText}}{{::$root.resources.strings.extension_subscriptionPlansDialog_label_month|translate}}</span>\n                              <div class="subscription-plans-dialog-badge-blue" ng-if="subscriptionPlan.freeTrailMonthlyLabel && spdc.activePlanTerms.indexOf(subscriptionPlan.monthlyTermId) == -1 && !spdc.showPlaceOrderLoadingSpinner">\n                                {{subscriptionPlan.freeTrailMonthlyLabel}}\n                              </div>\n                              <div class="subscription-plans-dialog-badge-green" ng-if="spdc.activePlanTerms.indexOf(subscriptionPlan.monthlyTermId) != -1 && !spdc.showPlaceOrderLoadingSpinner">\n                                {{::$root.resources.strings.extension_subscriptionPlansDialog_label_active_subscription|translate}}\n                              </div>\n                            </div>\n                          </label>\n                        </div>\n\n                        <div class="radio" ng-if="subscriptionPlan.yearlyPrice" id="{{\'radioBtnDivYearly-\' + subscriptionPlan.yearlyId}}">\n                          <label><input type="radio" id="{{\'radioBtnYearly-\' + subscriptionPlan.yearlyId}}" name="price" ng-click="spdc.removeFocus($event)" ng-if="!spdc.isPlaceOrderDisabled" ng-value="subscriptionPlan.yearlyId" ng-model="spdc.selectedPlanId" ng-focus="spdc.setFocusOnTab($event)" ng-blur="spdc.removeFocus($event)">\n                            <div>\n                              <span>\n                                <span class="app-font-base-bold">{{subscriptionPlan.yearlyPrice}} </span>\n                                {{spdc.planDisplayUnitText}}{{::$root.resources.strings.extension_subscriptionPlansDialog_label_year|translate}}\n                              </span>\n                              <div class="subscription-plans-dialog-badge-blue" ng-if="subscriptionPlan.freeTrailYearlyLabel && spdc.activePlanTerms.indexOf(subscriptionPlan.yearlyTermId) == -1 && !spdc.showPlaceOrderLoadingSpinner">\n                                {{subscriptionPlan.freeTrailYearlyLabel}}\n                              </div>\n                              <div class="subscription-plans-dialog-badge-green" ng-if="spdc.activePlanTerms.indexOf(subscriptionPlan.yearlyTermId) != -1 && !spdc.showPlaceOrderLoadingSpinner">\n                                {{::$root.resources.strings.extension_subscriptionPlansDialog_label_active_subscription|translate}}\n                              </div>\n                            </div>\n                          </label>\n                        </div>\n                      </td>\n                    </tr>\n                  </tbody>\n                </table>\n                <button class="show-all-plans-button" aria-label="{{::$root.resources.strings.extension_subscriptionPlansDialog_showPublicPlansText|translate}}" alt="{{::$root.resources.strings.extension_subscriptionPlansDialog_showPublicPlansText|translate}}" ng-if="!spdc.isShowPublicPlansEnabled && spdc.hasPublicPlans" ng-click="spdc.showPublicPlans()">\n                {{::$root.resources.strings.extension_subscriptionPlansDialog_showPublicPlansText|translate}}\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="manage-subscription-banner" ng-if="spdc.hasActiveSubscription">\n        <span>{{::$root.resources.strings.extension_subscriptionPlansDialog_banner_manage_subscription|translate}}&nbsp;<button ng-click="spdc.navigateToManageSubscriptionsPage()" ng-init="spdc.logBiTelemetryForViewManageSubscriptionMessage()" class="subscription-plans-dialog-manage-link">{{::$root.resources.strings.extension_addAppDialogV3_banner_manage_subscriptions|translate}}</button></span>\n      </div>\n    </section>\n\n    <section class="ts-subscription-plans-dialog-container" ng-if="spdc.subscriptionPlanViewModel && spdc.subscriptionPlanViewModel.plans.length == 0 && spdc.failedToLoadPlans">\n      <div>\n        <div class="purchase-confirmation-dialog-container">\n          <div>\n            <img role="img" aria-label="{{::$root.resources.strings.extension_subscriptionNoPlansAvailableDialog_image_background|translate}}" alt="{{::$root.resources.strings.extension_subscriptionNoPlansAvailableDialog_image_background|translate}}" ng-src="[[staticsPath]]/hashed/dialogs/subscriptionsNotAvailableDialog-ce26b7e.svg" class="purchase-confirmation-dialog-img"/>\n          </div>\n          <div class="app-font-title2-bold">\n            {{::$root.resources.strings.extension_subscriptionPlansDialog_notfound_title|translate}}\n          </div>\n          <br/>\n          <div>{{spdc.plansNotFoundSubTitle}}</div>\n          <br/>\n          <button class="ts-btn ts-btn-fluent ts-btn-fluent-primary" ng-click="spdc.back()" role="button" id="btnNavigateBackNoPlans">\n            {{::$root.resources.strings.extension_subscriptionPlansDialog_notfound_back|translate}}\n          </button>\n        </div>\n      </div>\n    </section>\n\n    <section class="ts-subscription-plans-dialog-container" ng-if="!spdc.subscriptionPlanViewModel && spdc.failedToLoadPlans">\n      <div class="purchase-confirmation-dialog-container">\n        <div>\n          <img role="img" aria-label="{{::$root.resources.strings.extension_subscriptionNoPlansAvailableDialog_image_background|translate}}" alt="{{::$root.resources.strings.extension_subscriptionNoPlansAvailableDialog_image_background|translate}}" ng-src="[[staticsPath]]/hashed/dialogs/errorSomethingwentWrong-5197321.svg" class="purchase-confirmation-dialog-img"/>\n        </div>\n        <div class="app-font-title2-bold">\n          {{::$root.resources.strings.extension_subscriptionPlansDialog_error_title|translate}}\n        </div>\n        <br/>\n        <div>{{::$root.resources.strings.extension_subscriptionPlansDialog_error_subtitle|translate}}</div>\n        <br/>\n        <button class="ts-btn ts-btn-fluent ts-btn-fluent-primary" ng-click="spdc.back()" role="button" id="btnNavigateBackError">\n          {{::$root.resources.strings.extension_subscriptionPlansDialog_notfound_back|translate}}\n        </button>\n      </div>\n    </section>\n\n    <section class="subscription-plans-dialog-modal-footer" ng-if="spdc.subscriptionPlanViewModel && spdc.subscriptionPlanViewModel.plans.length > 0" ng-show="!spdc.isCheckoutClicked">\n      <button class="back-button" ng-click="spdc.back()" aria-label="{{::$root.resources.strings.extension_addAppDialog_back|translate}}" role="button" id="btnNavigateBack">\n        <ng-include src="\'svg/icons-chevron-left.html\'"></ng-include>\n        {{::$root.resources.strings.extension_addAppDialog_back|translate}}\n      </button>\n\n      <button class="ts-btn ts-btn-fluent ts-btn-fluent-secondary subscription-plans-dialog-cancel-button" ng-click="spdc.cancel()" ng-if="!spdc.isPlaceOrderDisabled" aria-label="{{::$root.resources.strings.icons_cancel_arialabel|translate}}" role="button" id="btnCancel">\n        {{::$root.resources.strings.icons_cancel_arialabel|translate}}\n      </button>\n\n      <button ng-if="!spdc.isPlaceOrderDisabled && spdc.showPlaceOrderLoadingSpinner && spdc.showManageSubscriptions" class="ts-btn ts-btn-fluent ts-btn-fluent-secondary pull-right subscription-plans-dialog-loading-button" ng-disabled="spdc.showPlaceOrderLoadingSpinner">\n        <busy-animation size="small">\n        </busy-animation>\n        <span>{{::$root.resources.strings.extension_subscriptionPlansDialog_button_buy_loading|translate}}</span>\n      </button>\n\n      <button class="ts-btn ts-btn-fluent ts-btn-fluent-primary pull-right subscription-plans-dialog-checkout-button" ng-if="!spdc.isPlaceOrderDisabled && !spdc.showPlaceOrderLoadingSpinner" ng-disabled="spdc.hasActiveSubscription" ng-click="spdc.choosePurchaseUrl()" aria-label="{{::$root.resources.strings.extension_subscriptionPlansDialog_button_buy|translate}}" role="button" id="btnCheckout">\n        {{::$root.resources.strings.extension_subscriptionPlansDialog_button_buy|translate}}\n      </button>\n    </section>\n  </modal-dialog>\n</div>'},2676:function(e,t){e.exports='<div class="tooltip-container private-offer-plan-tooltip">\n  <div class="content-container">\n    <span class="tooltip-content" ng-bind-html="content"></span>\n    <div class="tooltip-arrow-down"></div>\n  </div>\n</div>\n'},2677:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2678),a=function(){function e(e,t,n){this.constants=t,this.dialogService=n,this.subscriptionPlanPurchaseDialogData=e.ngDialogData}return e.$inject=["$scope","constants","dialogService"],Object.defineProperty(e.prototype,"navCtx",{get:function(){return"subscription-plan-purchase-dialog"},enumerable:!0,configurable:!0}),e.prototype.close=function(){this.dialogService.close(this.constants.lazyDialogs.subscriptionPlanPurchaseDialog)},e.prototype.back=function(){this.close(),this.dialogService.openLazyDialog(this.constants.lazyDialogs.subscriptionPlansDialog,this.constants.lazyModules.extensibilityDialogs,this.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData)},e.prototype.onKeyboard=function(e){var t=e.keyCode;return t===this.constants.keyCodes.escape?(e.preventDefault(),void e.stopPropagation()):t===this.constants.keyCodes.tab?(event.stopPropagation(),void event.preventDefault()):void 0},e}();t.SubscriptionPlanPurchaseController=a,angular.module("teamspace.subscriptionPlanPurchaseDialog",[]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put("components/extensibility/subscription-plan-purchase-dialog/subscription-plan-purchase-dialog.html",i),t.register(e.lazyDialogs.subscriptionPlanPurchaseDialog,{template:"components/extensibility/subscription-plan-purchase-dialog/subscription-plan-purchase-dialog.html",className:"ts-modal-dialog custom-width subscription-plans-purchase-dialog",closeByEscape:!1,closeByDocument:!1,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"sppc-dialog-title"})}]).controller("SubscriptionPlanPurchaseController",a)},2678:function(e,t){e.exports='<div class="subscription-plans-purchase-dialog-modal-container" ng-controller="SubscriptionPlanPurchaseController as sppdc" aria-modal="true" aria-label="{{sppdc.description}}" aria-describedby="{{sppdc.description}}" acc-role="dialog">\n  <modal-dialog add-close-icon="false" suppress-default-footer="true" data-tid="subscriptionPlanPurchaseDialog" track-panel-type="{{$root.trackConstants.panelType.monetCheckout}}">\n\n    <subscription-plan-purchase-directive subscription-plan-purchase-dialog-data="sppdc.subscriptionPlanPurchaseDialogData" class="ts-subscription-plans-purchase-dialog-container" ng-if="sppdc.subscriptionPlanPurchaseDialogData" show-plans="sppdc.back()" close-checkout="sppdc.close()">\n    </subscription-plan-purchase-directive>\n\n  </modal-dialog>\n</div>'},2679:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){function a(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function r(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?n(e.value):a(e.value).then(o,r)}l((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,s&&(o=2&n[0]?s.return:n[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,s=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],s=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,s,o,r,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2680),o=function(){function e(e,t,n,i,a,s,o,r,l,p){this.$injector=e,this.$window=t,this.$scope=n,this.constants=i,this.settingsService=o,this.loggingService=r,this.analyticsService=l,this.dialogService=p;var c=o.valueFor(i.settings.names.monetizationConstants);this.purchaseConfirmationDialogData=n.ngDialogData;var d=this.purchaseConfirmationDialogData.receipt;this.subtitle=a.instant(s.strings.extension_purchaseConfirmationDialog_subheader,{appName:this.purchaseConfirmationDialogData.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData.appdefinition.name}),this.description=a.instant(s.strings.extension_purchaseConfirmationDialog_Description,{appName:this.purchaseConfirmationDialogData.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData.appdefinition.name}),this.showSpinner=!0,this.retryDelay=c.monetServiceExponentialBackoffDelayInSeconds,this.retryLimit=c.monetServiceExponentialBackoffLimit,this.scenario=r.newScenario(i.scenarios.extensibility.monetization.perf.displayConfigureNowButton),this.manageSubscriptionUrl=c.manageSubscriptionsUrl,d&&d.lineItems&&d.lineItems.length>0&&d.lineItems[0].assetId&&(this.receipt=d.lineItems[0],this.assetId=d.lineItems[0].assetId,this.getSetupUrlWithTokenAndBackoffLimits(this.assetId)),o.valueAsBoolean(i.settings.names.manageSubscriptionsInAdminCenter)?this.footerLink=a.instant(s.strings.extension_purchaseConfirmationDialog_ProductsLink):this.footerLink=a.instant(s.strings.extension_purchaseConfirmationDialog_ManageLink)}return e.$inject=["$injector","$window","$scope","constants","$translate","resources","settingsService","loggingService","analyticsService","dialogService"],e.prototype.logBiTelemetryForViewManageSubscriptionMessage=function(){this.logConfirmationDialogTelemetry(teamspace.components.PanelActionScenario.manageSubscriptionMessageViewed.toString(),teamspace.components.PanelActionGesture.auto)},e.prototype.configureNow=function(){this.configureNowUrl&&(this.logConfirmationDialogTelemetry(teamspace.components.PanelActionScenario.configurePurchaseClicked.toString(),teamspace.components.PanelActionGesture.click),this.$window.open(this.configureNowUrl,"_blank"))},e.prototype.navigateToManageSubscriptionsPage=function(){this.logConfirmationDialogTelemetry(teamspace.components.PanelActionScenario.manageSubscriptionsClicked.toString(),teamspace.components.PanelActionGesture.click),this.settingsService.valueAsBoolean(this.constants.settings.names.manageSubscriptionsInAdminCenter)&&this.manageSubscriptionUrl?window.open(this.manageSubscriptionUrl,"_blank"):this.openManageSubscriptionDialog()},e.prototype.openManageSubscriptionDialog=function(){return i(this,void 0,void 0,function(){var e;return a(this,function(t){return this.assetId&&(event.preventDefault(),this.dialogService.close(this.constants.lazyDialogs.purchaseConfirmationDialog),e={appdefinition:this.purchaseConfirmationDialogData.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData.appdefinition,addAppDialogData:this.purchaseConfirmationDialogData.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData.addAppDialogData,sourceDialog:this.constants.lazyDialogs.purchaseConfirmationDialog,assetId:this.assetId},this.dialogService.openLazyDialog(this.constants.lazyDialogs.manageSubscriptionDialog,this.constants.lazyModules.extensibilityDialogs,e)),[2]})})},e.prototype.getSetupUrlWithToken=function(e){return i(this,void 0,void 0,function(){var t,n;return a(this,function(i){switch(i.label){case 0:return t=this.$injector.get("monetizationService"),[4,t.getSaaSState(e)];case 1:if(!(n=i.sent())||!n.setupUrlWithToken)throw new Error("Failed to fetch configure now Url.");return[2,n.setupUrlWithToken]}})})},e.prototype.getSetupUrlWithTokenAndBackoffLimits=function(e,t){return void 0===t&&(t=0),i(this,void 0,void 0,function(){var n,i,s,o=this;return a(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.getSetupUrlWithToken(e)];case 1:return(n=a.sent())?(this.showSpinner=!1,this.failedToFetchToken=!1,this.configureNowUrl=n,this.$scope.$apply(),this.scenario.stop()):this.scenario.fail({reason:"getSetupUrlWithToken returns empty setupUrl"}),[3,3];case 2:return i=a.sent(),s="Monetization : puchase-confirmation-dialog - Failed to fetch setup url with token for assetId - "+e+" after retrying "+t+" times.",t<this.retryLimit?(this.loggingService.info(s),setTimeout(function(){o.getSetupUrlWithTokenAndBackoffLimits(e,t+1)},1e3*this.retryDelay)):(this.loggingService.info(s),this.failedToFetchToken=!0,this.showSpinner=!1,this.$scope.$apply(),this.scenario.fail({reason:s})),[3,3];case 3:return[2]}})})},Object.defineProperty(e.prototype,"navCtx",{get:function(){return"purchase-confirmation-dialog"},enumerable:!0,configurable:!0}),e.prototype.onKeyboard=function(e){var t=e.keyCode;return t===this.constants.keyCodes.escape?(e.preventDefault(),void e.stopPropagation()):t===this.constants.keyCodes.tab?(event.stopPropagation(),void event.preventDefault()):void 0},e.prototype.logConfirmationDialogTelemetry=function(e,t){var n=this,i={action:{gesture:t,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.nav.toString(),teamspace.components.PanelActionOutcome,this.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(e,teamspace.components.PanelActionScenario,this.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.nav.toString(),teamspace.components.PanelActionScenarioType,this.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.monetConfirmation.toString(),teamspace.components.PanelModuleName,this.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.monetDialog.toString(),teamspace.components.PanelModuleType,this.loggingService),summary:this.purchaseConfirmationDialogData.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData.appdefinition.name},app:{id:this.purchaseConfirmationDialogData.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData.appdefinition.id}};this.analyticsService.getAnalyticsPanelActionEventData(i).then(function(e){return n.analyticsService.sendPanelAction(e)}).catch(function(e){n.loggingService.error("failed to log action "+e)})},e}();t.PurchaseConfirmationController=o,angular.module("teamspace.purchaseConfirmationDialog",[]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put("components/extensibility/purchase-confirmation-dialog/purchase-confirmation-dialog.html",s),t.register(e.lazyDialogs.purchaseConfirmationDialog,{template:"components/extensibility/purchase-confirmation-dialog/purchase-confirmation-dialog.html",className:"ts-modal-dialog custom-width subscription-plans-dialog",closeByEscape:!1,closeByDocument:!1,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"pcc-dialog-title"})}]).controller("PurchaseConfirmationController",o)},2680:function(e,t){e.exports='<div class="subscription-plans-dialog-modal-container" ng-controller="PurchaseConfirmationController as pcdc" aria-modal="true" aria-label="{{pcdc.description}}" aria-describedby="{{pcdc.description}}" acc-role="dialog">\n  <modal-dialog add-close-icon="!pcdc.showSpinner" suppress-default-footer="true" data-tid="purchaseConfirmationDialog">\n    <section>\n      <div ng-if="pcdc.strErrorMessage" class="ts-team-or-channel-picker-error-message app-font-caption-regular">\n        {{pcdc.strErrorMessage}}\n      </div>\n      <div class="purchase-confirmation-dialog-container">\n        <div>\n          <img role="img" aria-label="{{::$root.resources.strings.extension_purchaseConfirmationDialog_image_background|translate}}" alt="{{::$root.resources.strings.extension_purchaseConfirmationDialog_image_background|translate}}" ng-src="[[staticsPath]]/hashed/dialogs/purchaseConfirmationDialog-d9cf8a2.svg" class="purchase-confirmation-dialog-img"/>\n        </div>\n        <div class="app-font-title2-bold">\n          {{::$root.resources.strings.extension_purchaseConfirmationDialog_header|translate}}</div>\n        <br/>\n        <div ng-if="!pcdc.failedToFetchToken">{{pcdc.subtitle}}</div>\n        <div id="purchase-confirmation-dialog-spinner" ng-if="pcdc.failedToFetchToken">\n          <p>{{::$root.resources.strings.extension_purchaseConfirmationDialog_subheader_fallback|translate}} &nbsp;\n            <a ng-click="pcdc.navigateToManageSubscriptionsPage()" ng-init="pcdc.logBiTelemetryForViewManageSubscriptionMessage()" class="subscription-plans-dialog-manage-link">\n              {{pcdc.footerLink}}\n            </a>\n          </p>\n        </div>\n        <br/>\n\n        <button ng-if="pcdc.showSpinner && !pcdc.failedToFetchToken" class="ts-btn ts-btn-fluent ts-btn-fluent-secondary purchase-confirmation-dialog-loading-button" ng-disabled="pcdc.showSpinner && !pcdc.failedToFetchToken">\n          <busy-animation size="small" context="purchase-confirmation-dialog">\n          </busy-animation>\n          <span>{{::$root.resources.strings.extension_purchaseConfirmationDialog_loading_button_configure|translate}}</span>\n        </button>\n\n        <button class="ts-btn ts-btn-fluent ts-btn-fluent-primary" ng-if="!pcdc.showSpinner && !pcdc.failedToFetchToken" ng-click="pcdc.configureNow()" aria-label="{{::$root.resources.strings.extension_purchaseConfirmationDialog_button_configure|translate}}">\n          {{::$root.resources.strings.extension_purchaseConfirmationDialog_button_configure|translate}}\n        </button>\n\n        <div class="app-font-caption-regular purchase-confirmation-dialog-footer">\n          <span ng-if="!pcdc.showSpinner && !pcdc.failedToFetchToken">\n            {{::$root.resources.strings.extension_purchaseConfirmationDialog_footer|translate}}\n          </span><br/>\n          <span ng-if="!pcdc.showSpinner && !pcdc.failedToFetchToken">\n            <a ng-click="pcdc.navigateToManageSubscriptionsPage()" ng-init="pcdc.logBiTelemetryForViewManageSubscriptionMessage()" class="subscription-plans-dialog-manage-link">\n              {{pcdc.footerLink}}\n            </a>\n          </span>\n        </div>\n      </div>\n    </section>\n  </modal-dialog>\n</div>'},2681:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2682),s=n(55),o=n(123),r=teamspace.middletier.ConfigurableTabContext,l={team:"team",groupchat:"groupchat",meetings:"meetings"},p=function(){function e(e,t,n,i,a,s,o,r,l,p,c,d,g,u,h,m,v,f,b,y,S,A,D,C,I,T,P,x,_){var w=this;if(this.$q=e,this.$rootScope=t,this.$scope=n,this.$translate=i,this.analyticsService=a,this.appsExtensionDefinitionService=s,this.appsService=o,this.templatedAppsService=r,this.channelService=l,this.constants=p,this.conversationsService=c,this.conversationsStore=d,this.dialogService=g,this.eventingService=u,this.extensionDefinitionService=h,this.extensionManifestService=m,this.inputExtensionService=v,this.loggingService=f,this.navigationService=b,this.resources=y,this.routeUtilityService=S,this.settingsService=A,this.uiOrchestrator=D,this.teamMembershipPropertiesService=C,this.teamSettingsService=I,this.utilityService=T,this.userAppsDispatcher=P,this.mruServiceV2=x,this.$timeout=_,this.enableAppsInstalledByCurrentUser=!1,this.enableRSCPermissions=!1,this.enableContainerApps=!1,this.enableTrustedSideloading=!1,this.enablePartnerAppCatalogBrowse=!1,this.enablePartnerAppsBrowseInstallDialogUIFix=!1,this.installToPersonalHappened=!1,this.strName="",this.largeImageUrl="",this.strAccentColor="",this.title="",this.subTitle="",this.buttonText="",this.inputPrompt="",this.appCapabilities=[],this.hasMoreCapabilities=!1,this.isAppInstalledToTeamScope=!1,this.isAppInstalledToMeetingScope=!1,this.isAppInstalledToChatScope=!1,this.isSideloadedApp=!1,this.showRSCPermissionDisableError=!1,this.shouldShowDropdown=!1,this.isInstalling=!1,this.emptySelection=!0,this.closeDropdown=function(){w.$scope.$apply(function(){return w.shouldShowDropdown=!1})},this.logger=f.newLogger("team-or-channel-picker"),this.teamPickerDialogData=n.ngDialogData,this.dontCreateConversationOnBotInstallation=A.valueAsBoolean(p.settings.names.dontCreateConversationOnBotInstallation),this.enableAppsInstalledByCurrentUser=A.valueAsBoolean(p.settings.names.enableAppsInstalledByCurrentUser),this.enableRSCPermissions=A.valueAsBoolean(p.settings.names.enableRSCPermissions),this.enableContainerApps=A.valueAsBoolean(p.settings.names.enableContainerApps),this.enableTrustedSideloading=A.valueAsBoolean(p.settings.names.enableTrustedSideloading),this.enablePartnerAppCatalogBrowse=A.valueAsBoolean(p.settings.names.enablePartnerAppCatalogBrowse),this.enablePartnerAppsBrowseInstallDialogUIFix=A.valueAsBoolean(p.settings.names.enablePartnerAppsBrowseInstallDialogUIFix),this.appInstallScope=this.teamPickerDialogData.pickerType,this.isSideloadedApp=this.teamPickerDialogData.isSideloadApp,this.enableAppsMRU=A.valueAsBoolean(p.settings.names.enableAppsMRU),this.enableDefaultFieldsInAppDefinition=A.valueAsBoolean(p.settings.names.enableDefaultFieldsInAppDefinition),this.enablePostInstallTabNavWithTeamId=A.valueAsBoolean(p.settings.names.enablePostInstallTabNavWithTeamId),this.entrypoint=this.teamPickerDialogData.addAppDialogData.entryPoint,this.updateButtonText(),this.isSideloadedApp){var k=this.teamPickerDialogData.addAppDialogData,M=this.teamPickerDialogData.addAppDialogData;this.preselectTeamId=this.teamPickerDialogData.teamId,this.emptySelection=!1,this.enableTrustedSideloading&&k&&k.templateInstanceId?this.handleSideloadFlow(void 0,k.appId,k.templateInstanceId,k.environment):this.enablePartnerAppCatalogBrowse&&M&&M.isPartnerApp?this.handleSideloadFlow(void 0,M.templatedAppId,M.appId,M.environment):this.handleSideloadFlow(this.teamPickerDialogData.manifestZipFile)}else this.populateDetails(this.teamPickerDialogData)}return e.$inject=["$q","$rootScope","$scope","$translate","analyticsService","appsExtensionDefinitionService","appsService","templatedAppsService","channelService","constants","conversationsService","conversationsStore","dialogService","eventingService","extensionDefinitionService","extensionManifestService","inputExtensionService","loggingService","navigationService","resources","routeUtilityService","settingsService","uiOrchestrator","teamMembershipPropertiesService","teamSettingsService","utilityService","userAppsDispatcher","mruServiceV2","$timeout"],Object.defineProperty(e.prototype,"navCtx",{get:function(){return"team-or-channel-picker"},enumerable:!0,configurable:!0}),e.prototype.handleSideloadFlow=function(e,t,n,i){var a=this;if(e||t&&n){var s=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.teamOrChannelPicker.sideloadFlow);(this.enableTrustedSideloading||this.enablePartnerAppCatalogBrowse)&&t&&n?(s.appendEventData({isTemplateInstanceApp:!0,templatedAppId:t,templateInstanceId:n,environment:i}),this.templatedAppsService.getTemplatedInstanceAppDefinition(t,n,"team-or-channel-picker",i).then(function(e){a.appDefinition=e,a.populateDialogFromAppDefinition(e),s.stop()}).catch(function(e){var t=JSON.stringify(e);a.logger.error("get templated instance app definition failed "+t),s.fail({error:t,error2:t})})):this.extensionManifestService.extractAppDefinition(e,!0).then(function(e){a.appDefinition=e,a.preselectTeamId&&a.populateAppCapabilities(),a.populateDialogFromAppDefinition(e),s.stop()}).catch(function(e){a.logger.error("extract app definition failed "+e),s.fail({error:e,error1:e})})}else this.logger.error("Neither manifestZipFile provided nor appDefinition")},e.prototype.populateDetails=function(e){var t=this;this.preselectTeamId=e.teamId,this.preselectChatId=e.chatId,e.addAppDialogData.entryPoint===teamspace.components.AddAppDialogEntryPoint.Store&&e.addAppDialogData.postInstallCbForWorkflows&&(this.postInstallCbForWorkflows=e.addAppDialogData.postInstallCbForWorkflows),this.appsService.getUserAppDefinition(e.appId,"team-or-channel-picker").then(function(e){t.appDefinition=e,t.populateDialogFromAppDefinition(e)})},e.prototype.openSchemaErrorDialog=function(e){var t,n=this.$translate.instant(this.resources.strings.extension_addAppDialogErrorMessage);(e&&e.errorCode||"")===this.constants.extensibility.apps.errorCodes.unableToParseTeamsAppManifest&&(n=this.$translate.instant(this.resources.strings.extension_addAppDialogManifestParsingErrorMessage),t=e.message),this.dialogService.close(this.constants.lazyDialogs.teamOrChannelPicker),this.dialogService.openLazyDialog(this.constants.lazyDialogs.manifestError,this.constants.lazyModules.extensibilityDialogs,{errorMessage:n,errorDetails:t})},e.prototype.openV3ErrorDialog=function(e){this.dialogService.close(this.constants.lazyDialogs.teamOrChannelPicker),this.dialogService.openLazyDialog(this.constants.lazyDialogs.addAppNewError,this.constants.lazyModules.extensibilityDialogs,{errorType:e,operation:"install",appName:this.appDefinition.name,isMeeting:this.isMeeting,isGroupChat:this.isGroupChat})},e.prototype.openV3NotificationDialog=function(e){this.dialogService.close(this.constants.lazyDialogs.teamOrChannelPicker),this.dialogService.openLazyDialog(this.constants.lazyDialogs.addAppNewError,this.constants.lazyModules.extensibilityDialogs,{errorType:"no-error",operation:e,appName:this.appDefinition.name})},e.prototype.onItemSelected=function(e){var t=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.teamOrChannelPicker.itemselectedFromDropDown);if(!e)return this.selectedTeamAndChannel=null,this.selectedChat=null,this.strErrorMessage=null,this.emptySelection=!0,t.mark("no item selected from drop down"),void t.stop();this.emptySelection=!1,this.populateAppCapabilities(),e.type===teamspace.components.SelectorItemType.Channel&&this.appInstallScope===teamspace.components.AppInstallScope.Team?(t.mark("team and channel selected from drop down"),this.selectedTeamAndChannel=e,this.evaluateDisabledCapabilitiesWarning(),this.isAppInstalledToTeam()):e.type!==teamspace.components.SelectorItemType.Chat||this.appInstallScope!==teamspace.components.AppInstallScope.GroupChat&&this.appInstallScope!==teamspace.components.AppInstallScope.Meeting||(t.mark("chat selected from drop down"),this.selectedChat=e,this.isAppInstalledToChat()),t.stop()},e.prototype.evaluateDisabledCapabilitiesWarning=function(){var e,t,n;this.showDisabledCapabilitiesWarning=!1,this.showRSCPermissionDisableError=!1,this.strErrorMessage=null,this.appDefinition.galleryTabs&&this.appDefinition.galleryTabs.length>0&&!this.isAddingTabEnabled()&&(this.removeAppCapability(teamspace.components.CapabilityType.Tab),this.showDisabledCapabilitiesWarning=!0),this.appDefinition.connectors&&this.appDefinition.connectors.length>0&&!this.isAddingConnectorEnabled()&&(this.removeAppCapability(teamspace.components.CapabilityType.Connector),this.showDisabledCapabilitiesWarning=!0),this.enableRSCPermissions&&(_.isEmpty(null===(e=this.appDefinition.webApplicationInfo)||void 0===e?void 0:e.applicationPermissions)&&_.isEmpty(null===(n=null===(t=this.appDefinition.authorization)||void 0===t?void 0:t.permissions)||void 0===n?void 0:n.resourceSpecific)||this.teamMembershipPropertiesService.isAdmin(this.selectedTeamAndChannel.teamId)||(this.showRSCPermissionDisableError=!0,this.strErrorMessage=this.$translate.instant(this.resources.strings.extension_addAppDialog_Permission_RSC_Error_Is_Team_Member,{appName:this.appDefinition.name})))},e.prototype.removeAppCapability=function(e){this.appCapabilities=this.appCapabilities.filter(function(t){return t.type!==e}),this.updateButtonText()},e.prototype.isAddingTabEnabled=function(){return this.teamMembershipPropertiesService.isAdmin(this.selectedTeamAndChannel.teamId)||this.teamSettingsService.canAddTab(this.selectedTeamAndChannel.teamId)},e.prototype.isAddingConnectorEnabled=function(){return this.teamMembershipPropertiesService.isAdmin(this.selectedTeamAndChannel.teamId)||this.teamSettingsService.canAddConnector(this.selectedTeamAndChannel.teamId)},e.prototype.installApp=function(){this.isInstalling=!0;var e=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.teamOrChannelPicker.menuItemNoSpecificCapability);this.appInstallScope===teamspace.components.AppInstallScope.Team?(this.updateMru(this.appDefinition.id),e.mark("No specific capability selected for team"),this.isSideloadedApp?this.processTeamSideloadInstall():this.processTeamInstall()):this.appInstallScope===teamspace.components.AppInstallScope.GroupChat||this.appInstallScope===teamspace.components.AppInstallScope.Meeting?(this.updateMru(this.appDefinition.id),e.mark("No specific capability selected for chat"),this.isSideloadedApp?this.processChatSideloadInstall():this.processChatInstall()):(this.logger.error("should not reach here: app scope not present"),e.fail()),e.stop()},e.prototype.processTeamInstall=function(e){var t=this;if(this.selectedTeamAndChannel){var n,i=this.$q.resolve(!1);this.enableAppsInstalledByCurrentUser&&(n=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.teamOrChannelPicker.autoInstallToPersonal),i=o.ensureAppIsInstalledForPersonal({$q:this.$q,$timeout:this.$timeout,appsService:this.appsService,settingsService:this.settingsService,constants:this.constants,conversationsService:this.conversationsService,conversationsStore:this.conversationsStore,inputExtensionService:this.inputExtensionService,logger:this.logger,userAppsDispatcher:this.userAppsDispatcher,loggingService:this.loggingService,utilityService:this.utilityService},this.appDefinition,this.enableContainerApps,!1,this.dontCreateConversationOnBotInstallation)),i.then(function(i){t.installToPersonalHappened=i,n&&n.stop(),t.isAppInstalledToTeamScope?t.navigateToTheSelectedCapability(e||t.appCapabilities[0]):t.installAppForTeam(e)}).catch(function(e){t.logger.error("install for team failed "+e),n&&n.fail({error:e,error1:e}),e&&e.data&&e.data.errorCode?t.openV3ErrorDialog(e.data.errorCode):t.openV3ErrorDialog("something-wrong")})}else this.logger.error("team or channel not selected")},e.prototype.processTeamSideloadInstall=function(e){var t=this;if(this.selectedTeamAndChannel){var n,i=this.$q.resolve(!1);this.enableAppsInstalledByCurrentUser&&(n=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.teamOrChannelPicker.autoInstallToPersonal),i=(this.enableTrustedSideloading||this.enablePartnerAppCatalogBrowse)&&this.appDefinition&&this.appDefinition.templatedAppId?o.ensureAppIsSideloadedForPersonal({$q:this.$q,appsService:this.appsService,templatedAppsService:this.templatedAppsService,extensionManifestService:this.extensionManifestService,logger:this.logger,userAppsDispatcher:this.userAppsDispatcher},this.appDefinition,this.teamPickerDialogData.manifestZipFile,this.enableContainerApps,this.appDefinition.templatedAppId).then(function(e){return!!e}):o.ensureAppIsSideloadedForPersonal({$q:this.$q,appsService:this.appsService,templatedAppsService:this.templatedAppsService,extensionManifestService:this.extensionManifestService,logger:this.logger,userAppsDispatcher:this.userAppsDispatcher},this.appDefinition,this.teamPickerDialogData.manifestZipFile,this.enableContainerApps).then(function(e){return!!e})),i.then(function(e){return t.installToPersonalHappened=e,n&&n.stop(),t.sideloadAppForTeamScope()}).then(function(n){if(!n)return t.$q.reject("no sideloaded app");t.appDefinition=n.appDefinition,t.navigateToTheSelectedCapability(e||t.appCapabilities[0])}).catch(function(e){t.logger.error("sideload for team failed "+(e?e.errorCode:"")),n&&n.fail({error:e,error1:e})})}else this.logger.error("team or channel not selected")},e.prototype.processChatSideloadInstall=function(e){var t=this;if(this.selectedChat){var n,i=this.$q.resolve(!1);this.enableAppsInstalledByCurrentUser&&(n=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.teamOrChannelPicker.autoInstallToPersonal),i=(this.enableTrustedSideloading||this.enablePartnerAppCatalogBrowse)&&this.appDefinition&&this.appDefinition.templatedAppId?o.ensureAppIsSideloadedForPersonal({$q:this.$q,appsService:this.appsService,templatedAppsService:this.templatedAppsService,extensionManifestService:this.extensionManifestService,logger:this.logger,userAppsDispatcher:this.userAppsDispatcher},this.appDefinition,this.teamPickerDialogData.manifestZipFile,this.enableContainerApps,this.appDefinition.templatedAppId).then(function(e){return!!e}):o.ensureAppIsSideloadedForPersonal({$q:this.$q,appsService:this.appsService,templatedAppsService:this.templatedAppsService,extensionManifestService:this.extensionManifestService,logger:this.logger,userAppsDispatcher:this.userAppsDispatcher},this.appDefinition,this.teamPickerDialogData.manifestZipFile,this.enableContainerApps).then(function(e){return!!e})),i.then(function(e){return t.installToPersonalHappened=e,n&&n.stop(),t.sideloadAppForChatScope()}).then(function(n){n&&(t.appDefinition=n.appDefinition,t.navigateToTheSelectedCapability(e||t.appCapabilities[0]))}).catch(function(e){t.logger.error("sideload for chat failed "+e),n&&n.fail({error:e,error1:e})})}else this.logger.error("chat not selected")},Object.defineProperty(e.prototype,"isMeeting",{get:function(){return this.appInstallScope===teamspace.components.AppInstallScope.Meeting},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isGroupChat",{get:function(){return this.appInstallScope===teamspace.components.AppInstallScope.GroupChat},enumerable:!0,configurable:!0}),e.prototype.sideloadAppForTeamScope=function(){var e=this;return((this.enableTrustedSideloading||this.enablePartnerAppCatalogBrowse)&&this.appDefinition&&this.appDefinition.templatedAppId?o.sideloadAppToTeam({$q:this.$q,appsService:this.appsService,templatedAppsService:this.templatedAppsService,extensionManifestService:this.extensionManifestService},this.appDefinition,this.teamPickerDialogData.manifestZipFile,this.selectedTeamAndChannel.teamId,this.appDefinition.templatedAppId,this.enablePartnerAppsBrowseInstallDialogUIFix,this.selectedTeamAndChannel.channelId):o.sideloadAppToTeam({$q:this.$q,appsService:this.appsService,extensionManifestService:this.extensionManifestService},this.appDefinition,this.teamPickerDialogData.manifestZipFile,this.selectedTeamAndChannel.teamId,void 0,void 0,this.selectedTeamAndChannel.channelId)).catch(function(t){var n=t&&t.errorCode||"";e.logger.error("sideload for team failed "+t.errorCode),n===e.constants.extensibility.apps.errorCodes.appSideloadingForbidden?e.strErrorMessage=e.$translate.instant(e.resources.strings.extension_appSideloadingForbiddenErrorMessage):n===e.constants.extensibility.apps.errorCodes.noPermissionToInstallApp?e.strErrorMessage=e.$translate.instant(e.resources.strings.extension_addAppDialogTeamDisabled):n===e.constants.extensibility.apps.errorCodes.grantOfResourceSpecificPermissionsFailed?e.strErrorMessage=e.$translate.instant(e.resources.strings.extension_grantOfResourceSpecificPermissionsFailed):n===e.constants.extensibility.apps.errorCodes.resourceSpecificPermissionsMismatch?e.strErrorMessage=e.$translate.instant(e.resources.strings.extension_resourceSpecificPermissionsMismatch):n===e.constants.extensibility.apps.errorCodes.userNotAuthorizedToRevokeResourceSpecificPermissions?e.strErrorMessage=e.$translate.instant(e.resources.strings.extension_userNotAuthorizedToRevokeResourceSpecificPermissions):n===e.constants.extensibility.apps.errorCodes.webApplicationInfoIdModificationNotAllowedForAppSideloadedInTeam?e.strErrorMessage=e.$translate.instant(e.resources.strings.extension_webApplicationInfoIdModificationNotAllowedForAppSideloadedInTeam):n===e.constants.extensibility.apps.errorCodes.webApplicationInfoIdConflictOnSideloadingIntoTeam?e.strErrorMessage=e.$translate.instant(e.resources.strings.extension_webApplicationInfoIdConflictOnSideloadingIntoTeam):n===e.constants.extensibility.apps.errorCodes.webApplicationInfoIdOfSideloadedAppMustBeInTheSameTenantAsUser?e.strErrorMessage=e.$translate.instant(e.resources.strings.extension_webApplicationInfoIdOfSideloadedAppMustBeInTheSameTenantAsUser):n===e.constants.extensibility.apps.errorCodes.invalidGrantResourceSpecificPermissionsRequest?e.strErrorMessage=e.$translate.instant(e.resources.strings.extension_invalidGrantResourceSpecificPermissionsRequest):n===e.constants.extensibility.apps.errorCodes.invalidResourceSpecificPermission?e.strErrorMessage=e.$translate.instant(e.resources.strings.extension_invalidResourceSpecificPermission):n===e.constants.extensibility.apps.errorCodes.userNotAuthorizedToModifyResourceSpecificPermissions||n===e.constants.extensibility.apps.errorCodes.RscPermissionsWriteFailed?e.strErrorMessage=e.$translate.instant(e.resources.strings.extension_addAppDialog_Permission_RSC_Error_Upgrade_App_Team,{appName:e.appDefinition.name}):n===e.constants.extensibility.apps.errorCodes.userNotAuthorizedToGrantResourceSpecificPermissions||n===e.constants.extensibility.apps.errorCodes.appInstalledButRscGrantFailed?e.strErrorMessage=e.$translate.instant(e.resources.strings.extension_addAppDialog_Permission_RSC_Error_Add_App_Team,{appName:e.appDefinition.name}):n===e.constants.extensibility.apps.errorCodes.invalidBotIdForAppSideloadingInTeam?e.strErrorMessage=e.$translate.instant(e.resources.strings.extensibility_sideloaded_app_bot_failure,{appName:e.appDefinition.name}):n?e.openV3ErrorDialog(n):e.openSchemaErrorDialog(t)})},e.prototype.sideloadAppForChatScope=function(){var e=this;return((this.enableTrustedSideloading||this.enablePartnerAppCatalogBrowse)&&this.appDefinition&&this.appDefinition.templatedAppId?o.sideloadAppToChat({$q:this.$q,appsService:this.appsService,templatedAppsService:this.templatedAppsService,extensionManifestService:this.extensionManifestService},this.appDefinition,this.teamPickerDialogData.manifestZipFile,this.selectedChat.id,this.appDefinition.templatedAppId,this.enablePartnerAppsBrowseInstallDialogUIFix):o.sideloadAppToChat({$q:this.$q,appsService:this.appsService,extensionManifestService:this.extensionManifestService},this.appDefinition,this.teamPickerDialogData.manifestZipFile,this.selectedChat.id)).catch(function(t){e.logger.error("sideload for chat failed "+(t?t.errorCode:"")),t&&t.errorCode===e.constants.extensibility.apps.errorCodes.appSideloadingForbidden?e.strErrorMessage=e.$translate.instant(e.resources.strings.extension_appSideloadingForbiddenErrorMessage):t&&t.errorCode===e.constants.extensibility.apps.errorCodes.invalidBotIdForAppSideloadingInChat?e.strErrorMessage=e.$translate.instant(e.resources.strings.extensibility_sideloaded_app_bot_failure,{appName:e.appDefinition.name}):t&&t.data&&t.data.errorCode===e.constants.extensibility.apps.errorCodes.noPermissionToUninstallApp&&e.isMeeting?e.strErrorMessage=e.$translate.instant(e.resources.strings.extension_noPermissionToManageAppInMeetingErrorMessage):t&&t.errorCode===e.constants.extensibility.apps.errorCodes.userNotAuthorizedToGrantResourceSpecificPermissions?e.strErrorMessage=e.$translate.instant(e.resources.strings.extension_addAppDialog_Permission_RSC_Error_Add_App_Chat,{appName:e.appDefinition.name}):e.openSchemaErrorDialog(t)})},e.prototype.processChatInstall=function(e){var t=this;if(this.selectedChat){var n,i=this.$q.resolve(!1);this.enableAppsInstalledByCurrentUser&&(n=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.teamOrChannelPicker.autoInstallToPersonal),i=o.ensureAppIsInstalledForPersonal({$q:this.$q,$timeout:this.$timeout,appsService:this.appsService,settingsService:this.settingsService,constants:this.constants,conversationsService:this.conversationsService,conversationsStore:this.conversationsStore,inputExtensionService:this.inputExtensionService,logger:this.logger,userAppsDispatcher:this.userAppsDispatcher,loggingService:this.loggingService,utilityService:this.utilityService},this.appDefinition,this.enableContainerApps,!1,this.dontCreateConversationOnBotInstallation)),i.then(function(i){t.installToPersonalHappened=i,n&&n.stop(),t.appInstallScope===teamspace.components.AppInstallScope.GroupChat&&!t.isAppInstalledToChatScope||t.appInstallScope===teamspace.components.AppInstallScope.Meeting&&!t.isAppInstalledToMeetingScope?t.installAppForChat(e):t.navigateToTheSelectedCapability(e||t.appCapabilities[0])}).catch(function(e){t.logger.error("install for chat failed "+e),n&&n.fail({error:e,error1:e}),e&&e.data&&e.data.errorCode?t.openV3ErrorDialog(e.data.errorCode):t.openV3ErrorDialog("something-wrong")})}},e.prototype.isAppInstalledToTeam=function(){var e=this;this.appsService.getInstalledAppForTeam(this.selectedTeamAndChannel.teamId,this.selectedTeamAndChannel.channelId,this.teamPickerDialogData.appId,"team-or-channel-Picker::isAppInstalledToTeam").then(function(t){t&&teamspace.services.AppsServiceUtils.isAppInstalled(t)?e.isAppInstalledToTeamScope=!0:e.isAppInstalledToTeamScope=!1})},e.prototype.isAppInstalledToChat=function(){var e=this;this.appsService.getInstalledAppForGroupChat(this.selectedChat.id,this.teamPickerDialogData.appId).then(function(t){t&&teamspace.services.AppsServiceUtils.isAppInstalled(t)&&e.appInstallScope===teamspace.components.AppInstallScope.GroupChat?e.isAppInstalledToChatScope=!0:t&&teamspace.services.AppsServiceUtils.isAppInstalled(t)&&e.appInstallScope===teamspace.components.AppInstallScope.Meeting?e.isAppInstalledToMeetingScope=!0:(e.isAppInstalledToChatScope=!1,e.isAppInstalledToMeetingScope=!1)})},e.prototype.installAppForTeam=function(e){var t=this;return this.appsService.createTeamAppEntitlement(this.selectedTeamAndChannel.teamId,this.appDefinition,this.selectedTeamAndChannel.channelId).then(function(){t.logTelemetryForInstall(t.appDefinition),t.navigateToTheSelectedCapability(e||t.appCapabilities[0])}).catch(function(e){t.logger.error("install for team failed "+e),e&&e.data&&e.data.errorCode?t.openV3ErrorDialog(e.data.errorCode):t.openV3ErrorDialog("something-wrong")})},e.prototype.installAppForChat=function(e){var t=this;return this.appsService.createGroupChatAppEntitlement(this.selectedChat.id,this.appDefinition).then(function(){t.logTelemetryForInstall(t.appDefinition),t.navigateToTheSelectedCapability(e||t.appCapabilities[0])}).catch(function(e){t.logger.error("install for chat failed "+e),e&&e.data&&e.data.errorCode?t.openV3ErrorDialog(e.data.errorCode):t.openV3ErrorDialog("something-wrong")})},e.prototype.navigateToTheSelectedCapability=function(e){if(this.postInstallCbForWorkflows)return this.postInstallCbForWorkflows();var t=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.teamOrChannelPicker.navigateToTheCapability);switch(e.type){case teamspace.components.CapabilityType.Tab:this.appInstallScope===teamspace.components.AppInstallScope.GroupChat||this.appInstallScope===teamspace.components.AppInstallScope.Meeting?(t.mark("navigate to chat Tab"),this.navigateToChatTab()):(t.mark("navigate to team Tab"),this.navigateToTeamTab());break;case teamspace.components.CapabilityType.Bot:t.mark("navigate to bot"),this.navigateToBot();break;case teamspace.components.CapabilityType.Connector:t.mark("navigate to connector"),this.navigateToTeamConnector();break;default:this.logger.error("should not reach here: no capability type selected")}t.stop()},e.prototype.back=function(){this.dialogService.close(this.constants.lazyDialogs.teamOrChannelPicker),this.entrypoint!=teamspace.components.AddAppDialogEntryPoint.PersonalAppActionMenu&&this.dialogService.openLazyDialog(this.constants.lazyDialogs.addAppNew,this.constants.lazyModules.extensibilityDialogs,this.teamPickerDialogData.addAppDialogData)},e.prototype.hasTeamScope=function(e){return!!(e&&e.length>0)&&_.every(e,function(e){return!!(e.scopes&&e.scopes.length>0)&&_.some(e.scopes,function(e){return"team"===e.toLowerCase()})})},e.prototype.hasGroupChatScope=function(e){return!!(e&&e.length>0)&&_.every(e,function(e){return!!(e.scopes&&e.scopes.length>0)&&_.some(e.scopes,function(e){return"groupchat"===e.toLowerCase()})})},e.prototype.supportsPrivateChatContext=function(e){return s.hasScopeWithNoContextTab("groupchat",e)||s.hasScopeWithContextTab("groupchat",r.PrivateChatTab,e)},e.prototype.supportsTeamContext=function(e){return s.hasScopeWithNoContextTab("team",e)||s.hasScopeWithContextTab("team",r.ChannelTab,e)},e.prototype.createAppCapability=function(e,t,n){return{type:e,icon:t,description:n}},e.prototype.populateDialogFromAppDefinition=function(e){this.largeImageUrl=e.largeImageUrl,this.largeImageUrlUseNgInclude=this.utilityService.useNgIncludeForIcon(e.largeImageUrl),this.strName=e.name,this.strAccentColor=e.accentColor,this.appInstallScope===teamspace.components.AppInstallScope.Team?(this.title=this.$translate.instant(this.resources.strings.extension_teamOrChannelPicker_title,{appName:e.name}),this.subTitle=this.$translate.instant(this.resources.strings.extension_teamOrChannelPicker_subTitle,{appName:e.name}),this.inputPrompt=this.$translate.instant(this.resources.strings.extension_teamOrChannelPicker_teamPrompt)):this.appInstallScope===teamspace.components.AppInstallScope.GroupChat?(this.title=this.$translate.instant(this.resources.strings.extension_chatPicker_title,{appName:e.name}),this.subTitle="",this.inputPrompt=this.$translate.instant(this.resources.strings.extension_teamOrChannelPicker_chatPrompt)):(this.title=this.$translate.instant(this.resources.strings.extension_meetingPicker_title,{appName:e.name}),this.subTitle="",this.inputPrompt=this.$translate.instant(this.resources.strings.extension_teamOrChannelPicker_meetingPrompt))},e.prototype.prioritizeAppCapability=function(e,t){return this.enableDefaultFieldsInAppDefinition&&t&&this.appDefinition.defaultGroupCapability&&this.appDefinition.defaultGroupCapability[e]&&this.appDefinition.defaultGroupCapability[e].toString().toLowerCase()===t.toString().toLowerCase()},e.prototype.populateAppCapabilities=function(){var e=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.teamOrChannelPicker.populateAppCapabilities);if(this.appDefinition){if(this.appCapabilities=[],this.appInstallScope===teamspace.components.AppInstallScope.Team&&(this.hasTeamScope(this.appDefinition.galleryTabs)&&this.supportsTeamContext(this.appDefinition.galleryTabs)||this.hasTeamScope(this.appDefinition.staticTabs)&&this.supportsTeamContext(this.appDefinition.staticTabs))){e.mark("Add team tab capability");var t=this.createAppCapability(teamspace.components.CapabilityType.Tab,"svg/icons-tab-badge.html",this.$translate.instant(this.resources.strings.extension_teamOrChannelPicker_setUpTabString));this.prioritizeAppCapability(l.team,"Tab")?this.appCapabilities.unshift(t):this.appCapabilities.push(t)}if(this.appInstallScope===teamspace.components.AppInstallScope.GroupChat&&this.hasGroupChatScope(this.appDefinition.galleryTabs)&&this.supportsPrivateChatContext(this.appDefinition.galleryTabs)||this.hasGroupChatScope(this.appDefinition.staticTabs)){e.mark("Add chat tab capability");n=this.createAppCapability(teamspace.components.CapabilityType.Tab,"svg/icons-tab-badge.html",this.$translate.instant(this.resources.strings.extension_teamOrChannelPicker_setUpTabString));this.prioritizeAppCapability(l.groupchat,"Tab")?this.appCapabilities.unshift(n):this.appCapabilities.push(n)}if(this.appInstallScope===teamspace.components.AppInstallScope.Meeting&&this.hasGroupChatScope(this.appDefinition.galleryTabs)){e.mark("Add meeting tab capability");var n=this.createAppCapability(teamspace.components.CapabilityType.Tab,"svg/icons-tab-badge.html",this.$translate.instant(this.resources.strings.extension_teamOrChannelPicker_setUpTabString));this.prioritizeAppCapability(l.meetings,"Tab")?this.appCapabilities.unshift(n):this.appCapabilities.push(n)}if(this.appInstallScope===teamspace.components.AppInstallScope.Team&&this.appDefinition.bots&&this.appDefinition.bots.length>0&&this.hasTeamScope(this.appDefinition.bots)){e.mark("Add team bot capability");var i=this.createAppCapability(teamspace.components.CapabilityType.Bot,"svg/icons-bot.html",this.$translate.instant(this.resources.strings.extension_teamOrChannelPicker_setUpBotString));this.prioritizeAppCapability(l.team,"Bot")?this.appCapabilities.unshift(i):this.appCapabilities.push(i)}if((this.appInstallScope===teamspace.components.AppInstallScope.GroupChat||this.appInstallScope===teamspace.components.AppInstallScope.Meeting)&&this.hasGroupChatScope(this.appDefinition.bots)){var a=void 0;this.appInstallScope===teamspace.components.AppInstallScope.GroupChat?(e.mark("Add chat bot capability"),a=l.groupchat):(e.mark("Add meeting bot capability"),a=l.meetings);var s=this.createAppCapability(teamspace.components.CapabilityType.Bot,"svg/icons-bot.html",this.$translate.instant(this.resources.strings.extension_teamOrChannelPicker_setUpBotString));this.prioritizeAppCapability(a,"Bot")?this.appCapabilities.unshift(s):this.appCapabilities.push(s)}if(this.appInstallScope===teamspace.components.AppInstallScope.Team&&this.appDefinition.connectors&&this.appDefinition.connectors.length>0&&this.hasTeamScope(this.appDefinition.connectors)){e.mark("Add team connector capability");var o=this.createAppCapability(teamspace.components.CapabilityType.Connector,"svg/icons-connector-badge.html",this.$translate.instant(this.resources.strings.extension_teamOrChannelPicker_setUpConnectorString));this.prioritizeAppCapability(l.team,"Connector")?this.appCapabilities.unshift(o):this.appCapabilities.push(o)}if(this.entrypoint===teamspace.components.AddAppDialogEntryPoint.PersonalAppActionMenuConnector){var r=this.appCapabilities.filter(function(e){return e.type===teamspace.components.CapabilityType.Connector});r.length>0&&(this.appCapabilities=r)}this.updateButtonText()}else this.logger.error("should not reach here: no appdefinition present");e.stop()},e.prototype.updateButtonText=function(){this.buttonText=1==this.appCapabilities.length?this.appCapabilities[0].description:this.$translate.instant(this.resources.strings.extension_teamOrChannelPicker_setUpGeneralString)},e.prototype.updateMru=function(e){this.enableAppsMRU&&this.mruServiceV2.recordUsage(e)},e.prototype.processClickedItem=function(e){this.isInstalling=!0;var t=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.teamOrChannelPicker.menuItemSpecificCapability);this.appInstallScope===teamspace.components.AppInstallScope.Team?(t.mark("Specific capability selected for team"),this.isSideloadedApp?this.processTeamSideloadInstall(e):this.processTeamInstall(e)):this.appInstallScope===teamspace.components.AppInstallScope.GroupChat||this.appInstallScope===teamspace.components.AppInstallScope.Meeting?(t.mark("Specific capability selected for group chat"),this.isSideloadedApp?this.processChatSideloadInstall(e):this.processChatInstall(e)):(this.logger.error("should not reach here: app scope not present"),t.fail()),t.stop()},e.prototype.navigateToTeamTab=function(){var e=this,t=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.appInstalledDialog.navigation);try{this.dialogService.close(this.constants.lazyDialogs.teamOrChannelPicker),this.navigationService.navigateToChannel(this.selectedTeamAndChannel.channelId,this.navCtx);var n=this.enablePostInstallTabNavWithTeamId?this.selectedTeamAndChannel.teamId:void 0;this.extensionDefinitionService.getExtensionDefinition(this.appDefinition.id,n).then(function(t){var n=new teamspace.services.ExtensionInstanceViewModel(t,e.constants),i=e.appDefinition.galleryTabs&&e.appDefinition.galleryTabs.filter(function(e){return e.scopes.filter(function(e){return"team"==e.toLowerCase()})}),a=e.appDefinition.staticTabs&&e.appDefinition.staticTabs.filter(function(e){return e.scopes.filter(function(e){return"team"==e.toLowerCase()})});if(i&&i.length>0)e.dialogService.openLazyDialog(e.constants.lazyDialogs.tabInstanceConfiguration,e.constants.lazyModules.extensibilityTabs,{tabDefinition:t,tabInstance:n,threadId:e.selectedTeamAndChannel.channelId,operationType:teamspace.components.DialogTabMenuOperationType.AddTabSettings});else if(a&&a.length>0){var s=a[0].entityId;e.navigateToGeneralChannelTab(s)}}).catch(function(n){t.fail(i(i({},e.getScenarioEventData()),{error2:"Navigation to a team's channel to add a tab failed. "+n}))}),t.stop(this.getScenarioEventData()),this.logTelemetryForNavigation(teamspace.components.PanelActionScenario.navTab,this.appDefinition,this.selectedTeamAndChannel.teamId,this.selectedTeamAndChannel.channelId)}catch(e){t.fail(i(i({},this.getScenarioEventData()),{error2:"Navigation to a team's channel to add a tab failed. "+e}))}},e.prototype.navigateToGeneralChannelTab=function(e){return this.navigationService.navigateDirectPromise(this.constants.states.appConversation,{middlePane:e,notify:!1,reload:!1,slug:this.selectedTeamAndChannel.teamId,groupName:"unknown",threadId:this.selectedTeamAndChannel.teamId,messageId:void 0,ctx:this.constants.navigation.context.channel,navCtx:this.navCtx},{location:"replace"})},e.prototype.navigateToBot=function(){var e,t=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.appInstalledDialog.navigation);try{this.dialogService.close(this.constants.lazyDialogs.teamOrChannelPicker);var n={botProfile:{memberCount:0,accountEnabled:!0,displayName:this.appDefinition.name,mri:this.constants.bots.keyPrefix+this.appDefinition.bots[0].id,type:this.constants.atMentions.type.bot},messageId:void 0,type:this.constants.atMentions.type.bot},a=this.appDefinition.bots[0].isNotificationOnly;if(this.appInstallScope===teamspace.components.AppInstallScope.GroupChat||this.appInstallScope===teamspace.components.AppInstallScope.Meeting){var s={appId:this.appDefinition.id,displayName:this.appDefinition.name,capability:teamspace.services.commanding.PlatformAppCapability.Bot};(null===(e=this.appDefinition.bots)||void 0===e?void 0:e.length)&&(s.botId=this.appDefinition.bots[0].id),this.navigationService.navigateToChat(this.selectedChat.id,this.navCtx,void 0,void 0,{platformAppInstalled:s}),a?this.openV3NotificationDialog("add-notification-only-bot"):this.executeOnEditorSyncForChat(this.selectedChat.id,n)}else this.navigationService.navigateToChannel(this.selectedTeamAndChannel.channelId,this.navCtx),a?this.openV3NotificationDialog("add-notification-only-bot"):this.executeOnEditorSync(this.selectedTeamAndChannel.channelId,n,void 0);t.stop(this.getScenarioEventData()),this.logTelemetryForNavigation(teamspace.components.PanelActionScenario.navBot,this.appDefinition,this.selectedTeamAndChannel?this.selectedTeamAndChannel.teamId:null,this.selectedTeamAndChannel?this.selectedTeamAndChannel.channelId:null,this.selectedChat?this.selectedChat.id:null)}catch(e){t.fail(i(i({},this.getScenarioEventData()),{error:"Navigation  to add a bot failed. "+e,error1:"Navigation  to add a bot failed. "+e}))}},e.prototype.executeOnEditorSync=function(e,t,n){var i=this;this.eventingService.$once(this.$rootScope,this.constants.events.messages.focusInEditor,function(a,s){var o=s&&s.replyChainId;if(n&&n==o||!o&&!n){var r=i.routeUtilityService.getRootRouteParams();(!e||r&&r.threadId===e)&&i.uiOrchestrator.nextFrame(teamspace.services.UiOrchestratorPriority.Low,function(){i.eventingService.$emit(i.constants.events.app.installed,t)})}})},e.prototype.executeOnEditorSyncForChat=function(e,t){var n=this;this.eventingService.$once(this.$rootScope,this.constants.events.messages.focusInEditor,function(){var i=n.routeUtilityService.getRootRouteParams();(!e||i&&i.peopleSlug===e)&&n.uiOrchestrator.nextFrame(teamspace.services.UiOrchestratorPriority.Low,function(){n.eventingService.$emit(n.constants.events.app.installed,t)})})},e.prototype.navigateToChatTab=function(){var t=this,n=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.appInstalledDialog.navigation);this.dialogService.close(this.constants.lazyDialogs.teamOrChannelPicker),this.navigationService.navigateToChat(this.selectedChat.id,this.navCtx).then(function(){return t.$timeout(e.loadtimeout)}).then(function(){return t.appsService.getInstalledAppForGroupChat(t.selectedChat.id,t.appDefinition.id)}).then(function(e){var i=new teamspace.services.ExtensionDefinitionViewModel(t.appsExtensionDefinitionService.createTabExtensionDefinition(e.appDefinition),t.settingsService),a=new teamspace.services.ExtensionInstanceViewModel(i,t.constants);t.dialogService.openLazyDialog(t.constants.lazyDialogs.tabInstanceConfiguration,t.constants.lazyModules.extensibilityTabs,{tabDefinition:i,tabInstance:a,threadId:t.selectedChat.id,operationType:teamspace.components.DialogTabMenuOperationType.AddTabSettings}),n.stop(t.getScenarioEventData())}).catch(function(e){return n.fail(i(i({},t.getScenarioEventData()),{error:"Navigation to a chat to add a tab failed. "+e,error1:"Navigation to a chat to add a tab failed. "+e}))}),this.logTelemetryForNavigation(teamspace.components.PanelActionScenario.navTab,this.appDefinition,this.selectedChat.id)},e.prototype.navigateToTeamConnector=function(){var e=this,t=this.loggingService.newScenario(this.constants.scenarios.extensibility.apps.appInstalledDialog.navigation);try{this.dialogService.close(this.constants.lazyDialogs.teamOrChannelPicker),this.navigationService.navigateToChannel(this.selectedTeamAndChannel.channelId,this.navCtx),this.channelService.getChannelById(this.selectedTeamAndChannel.channelId).then(function(t){e.channelService.getTeamById(e.selectedTeamAndChannel.teamId).then(function(n){e.dialogService.openLazyDialog(e.constants.lazyDialogs.connectorsManager,e.constants.lazyModules.extensibilityDialogs,{team:n,channel:t,connectorId:e.appDefinition.connectors[0].connectorId})})}),t.stop(this.getScenarioEventData()),this.logTelemetryForNavigation(teamspace.components.PanelActionScenario.navConnector,this.appDefinition,this.selectedTeamAndChannel.teamId,this.selectedTeamAndChannel.channelId)}catch(e){t.fail(i(i({},this.getScenarioEventData()),{error:"Navigation to a team's channel to add a connector failed. "+e,error1:"Navigation to a team's channel to add a connector failed. "+e}))}},e.prototype.getScenarioEventData=function(){return this.appDefinition?{appId:this.appDefinition.id,externalId:this.appDefinition.externalId,tenantId:this.appDefinition.tenantId}:null},e.prototype.logTelemetryForNavigation=function(e,t,n,a,s){var o={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.nav.toString(),teamspace.components.PanelActionOutcome,this.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(e.toString(),teamspace.components.PanelActionScenario,this.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.nav.toString(),teamspace.components.PanelActionScenarioType,this.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.navigationButton.toString(),teamspace.components.PanelModuleName,this.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.nav.toString(),teamspace.components.PanelModuleType,this.loggingService),summary:"Post app installation navigation"},app:i({},this.getAppInformationForTelemetry(t,n,a,s)),dataBag:{teamId:n,channelId:a,chatId:s}};this.sendPanelAction(o)},e.prototype.logTelemetryForInstall=function(e){var t=this;_.defer(function(){var n=[];t.appInstallScope===teamspace.components.AppInstallScope.Team&&n.push(teamspace.components.PanelAppScope.team),t.appInstallScope===teamspace.components.AppInstallScope.GroupChat&&n.push(teamspace.components.PanelAppScope.group),t.installToPersonalHappened&&n.push(teamspace.components.PanelAppScope.personal);var a={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.submit.toString(),teamspace.components.PanelActionOutcome,t.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.addAppDialog.toString(),teamspace.components.PanelActionScenario,t.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,t.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.addAppButton.toString(),teamspace.components.PanelModuleName,t.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.button.toString(),teamspace.components.PanelModuleType,t.loggingService),summary:"Consent to add an app"},app:i(i({},t.getAppInformationForTelemetry(e)),{scenarioCapability:teamspace.components.PanelAppScenarioCapability.na,scope:_.sum(n)})};t.appInstallScope===teamspace.components.AppInstallScope.Team&&(a.team={id:t.selectedTeamAndChannel.teamId}),t.sendPanelAction(a)})},e.prototype.getAppInformationForTelemetry=function(e,t,n,i){var a=teamspace.components.AppAnalyticsHelper.getAppAnalyticsData({appDefinition:e});return a.teamId=t,a.channelId=n,a.chatId=i,a.source=teamspace.shared.AttributeHelper.tryGetEnum(this.teamPickerDialogData.addAppDialogData.entryPoint.toString(),teamspace.components.AddAppDialogEntryPoint,this.loggingService),this.teamPickerDialogData.addAppDialogData.entryPoint===teamspace.components.AddAppDialogEntryPoint.DeepLink&&(a.deepLinkSource=this.teamPickerDialogData.addAppDialogData.deepLinkSource),a},e.prototype.sendPanelAction=function(e){var t=this;e.app&&e.app.botId&&(e.bot?e.bot.id=e.app.botId:e.bot={id:e.app.botId}),this.analyticsService.getAnalyticsPanelActionEventData(e).then(function(e){return t.analyticsService.sendPanelAction(e)}).catch(function(e){t.logger.error("failed to log app action "+e)})},e.prototype.onKeyboard=function(e){var t=e.keyCode;if(t!==this.constants.keyCodes.escape){if(t===this.constants.keyCodes.tab)return event.stopPropagation(),void event.preventDefault();t!==this.constants.keyCodes.up?t!==this.constants.keyCodes.down||s.focusNextInTheList(".ts-tcpc-set-up-button-dropdown",".ts-tcpc-menu-item-button"):s.focusPreviousInTheList(".ts-tcpc-set-up-button-dropdown",".ts-tcpc-menu-item-button")}else{e.preventDefault(),e.stopPropagation(),this.toggleDropdown();var n=angular.element(document).find(".setup-button-arrow");n&&n.length&&n[0].focus()}},e.prototype.toggleDropdown=function(e){e&&e.stopPropagation&&e.stopPropagation(),this.shouldShowDropdown=!this.shouldShowDropdown,this.shouldShowDropdown?(angular.element(document).one("click",this.closeDropdown),!e||e.detail&&1!==e.detail||s.focusNthInTheList(".ts-tcpc-set-up-button-dropdown",".ts-tcpc-menu-item-button")):angular.element(document).off("click",this.closeDropdown)},e.loadtimeout=250,e}();t.TeamOrChannelPickerController=p,angular.module("teamspace.teamOrChannelPicker",[]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put("components/extensibility/team-or-channel-picker/team-or-channel-picker.html",a),t.register(e.lazyDialogs.teamOrChannelPicker,{template:"components/extensibility/team-or-channel-picker/team-or-channel-picker.html",className:"ts-modal-dialog custom-width ts-team-or-channel-picker",closeByEscape:!0,closeByDocument:!0,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"tcpc-dialog-title"})}]).controller("TeamOrChannelPickerController",p)},2682:function(e,t){e.exports='<div class="ts-team-or-channel-picker-container" ng-controller="TeamOrChannelPickerController as tcpc" aria-modal="true" acc-role="dialog">\n  <modal-dialog add-close-icon="true" suppress-default-footer="true" data-tid="teamOrChannelPicker" track-panel-type="{{$root.trackConstants.panelType.teamOrChannelPicker}}">\n    <section class="ts-team-or-channel-picker-main-content">\n      <div class="ts-team-or-channel-picker-description">\n        <div class="image-container">\n          <div class="image" ng-style="{ \'background\': tcpc.strAccentColor }">\n            <ng-include src="tcpc.largeImageUrl" ng-if="tcpc.largeImageUrlUseNgInclude"></ng-include>\n            <img role="img" alt="{{($root.resources.strings.extensibility_app_icon_alt|translate:{appName:tcpc.strName})}}" aria-label="{{($root.resources.strings.extensibility_app_icon_alt|translate:{appName:tcpc.strName})}}" ng-if="!tcpc.largeImageUrlUseNgInclude" ng-src="{{tcpc.largeImageUrl}}"/>\n          </div>\n        </div>\n        <h1 id="tcpc-dialog-title" class="title" ng-bind-html="tcpc.title"></h1>\n        <div class="subtitle" ng-if="tcpc.subTitle" ng-bind-html="tcpc.subTitle"></div>\n      </div>\n      <div class="team-or-chat-search">\n        <label for="tcp-input-id" class="search-box-title app-font-caption-regular" id="tcp-selector-prompt">{{tcpc.inputPrompt}}</label>\n        <chat-and-team-selector data-tid="choose-team-and-channel" is-add-app-dialog-v3="true" input-id="tcp-input-id" app-install-scope="tcpc.appInstallScope" on-item-selected="tcpc.onItemSelected(selectedItem)" preselect-chat="tcpc.preselectChatId" preselect-team="tcpc.preselectTeamId" enable-channel-filter="tcpc.preselectTeamId && tcpc.isSideloadedApp">\n        </chat-and-team-selector>\n      </div>\n      <div ng-if="tcpc.showDisabledCapabilitiesWarning" class="permission-error app-font-caption-regular" translate-once="{{::$root.resources.strings.extension_installed_dialog_tabDisabled}}">\n      </div>\n      <div ng-if="tcpc.strErrorMessage" class="ts-team-or-channel-picker-error-message app-font-caption-regular" ng-bind-html="tcpc.strErrorMessage">\n      </div>\n    </section>\n    <section class="ts-team-or-channel-picker-footer">\n      <button class="back-button" ng-click="tcpc.back()" aria-label="{{::$root.resources.strings.extension_addAppDialog_back|translate}}" track-scenario="{{::$root.trackConstants.trackScenario.addAppDialogV3TeamChatPickerBackButton}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.appMgmt}}" track-outcome="{{::$root.trackConstants.trackOutcome.nav}}">\n        <ng-include src="\'svg/icons-chevron-left.html\'"></ng-include>\n        <span aria-hidden="true">{{::$root.resources.strings.extension_addAppDialog_back|translate}}</span>\n      </button>\n\n      <div class="setup-button">\n        <button type="button" class="ts-btn ts-btn-fluent ts-btn-fluent-primary setup-button-main" ng-disabled="!(tcpc.appCapabilities.length > 0) || tcpc.isInstalling || tcpc.emptySelection || tcpc.showRSCPermissionDisableError" ng-click="tcpc.installApp()" data-tid="team-picker-primary-set-up-button" track-scenario="{{::$root.trackConstants.trackScenario.addAppDialogV3TeamChatSetup}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.appMgmt}}" track-outcome="{{::$root.trackConstants.trackOutcome.submit}}">\n          {{tcpc.buttonText}}\n        </button>\n        <button class="ts-btn ts-btn-fluent ts-btn-fluent-primary setup-button-arrow" ng-if="!(tcpc.appCapabilities.length == 1)" ng-disabled="!(tcpc.appCapabilities.length> 0) || tcpc.isInstalling || tcpc.emptySelection || tcpc.showRSCPermissionDisableError" aria-label="{{::$root.resources.strings.icons_more | translate}}" ng-click="tcpc.toggleDropdown($event)">\n          <svg-include src="\'svg/icons-triangle-down-small.html\'"></svg-include>\n        </button>\n        <div ng-if="tcpc.shouldShowDropdown" ng-keydown="tcpc.onKeyboard($event)" class="ts-tcpc-set-up-button-dropdown">\n          <ul>\n            <li aria-label="{{menuItem.description}}" ng-repeat="menuItem in tcpc.appCapabilities track by $index">\n              <button aria-label="{{menuItem.description}}" class="ts-tcpc-menu-item-button" ng-click="tcpc.processClickedItem(menuItem)" track-scenario="{{::$root.trackConstants.trackScenario.addAppDialogV3TeamChatSetup}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.appMgmt}}" track-outcome="{{::$root.trackConstants.trackOutcome.submit}}">\n                <ng-include src="menuItem.icon"></ng-include>\n                <span aria-hidden="true">{{menuItem.description}}</span>\n              </button>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </section>\n  </modal-dialog>\n</div>'},2683:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2684),a=function(){function e(e,t,n,i,a){var s=this;this.$scope=e,this.tabService=i,this.analyticsService=a,this.tabInstanceId=e.ngDialogData.tabInstanceId,this.threadId=e.ngDialogData.threadId,this.appId=e.ngDialogData.appId,this.removeScenario=e.ngDialogData.saveExtensionInstanceCounter,this.removeFailReason=e.ngDialogData.removeFailReason,this.removeFailReason||(this.removeFailReason=t.instant(n.strings.extension_tabRemoveMessage)),this.footerButtons=[{text:t.instant(n.strings.extension_tabRemoveCancelOption),func:function(){return s.cancel()},disabled:!1,secondaryStyle:!0,summary:"Cancel deleting the tab",tid:"removeTab-Cancel"},{text:t.instant(n.strings.extension_tabRemoveOption),func:function(){return s.remove()},disabled:!1,summary:"Force remove the tab",scenarioType:teamspace.components.PanelActionScenarioType.appMgmt,tid:"removeTab-ForceRemove"}]}return e.$inject=["$scope","$translate","resources","tabService","analyticsService"],e.prototype.cancel=function(){this.removeScenario&&(this.removeScenario.stop(),this.removeScenario=null),this.$scope.closeThisDialog()},e.prototype.remove=function(){var e=this;this.logTelemetryForRemoveTab(),this.tabService.deleteTab(this.threadId,this.tabInstanceId).then(function(){e.removeScenario&&(e.removeScenario.stop(),e.removeScenario=null)}).catch(function(t){e.removeScenario&&(e.removeScenario.fail({errorInfo:t,errorInfo1:t,appId:e.appId,tabId:e.tabInstanceId}),e.removeScenario=null)}),this.$scope.closeThisDialog()},e.prototype.logTelemetryForRemoveTab=function(){var e={action:{gesture:teamspace.components.PanelActionGesture.click},module:{type:teamspace.components.PanelModuleType.tabRemove,name:teamspace.components.PanelModuleName[teamspace.components.PanelModuleName.tabRemoveDialog],summary:"Get tab force remove consent"},app:{id:this.appId,scenarioCapability:teamspace.components.PanelAppScenarioCapability.tabs}};this.analyticsService.onPanelAction(this.$scope,e)},e}();t.TabRemoveController=a,angular.module("teamspace.tabRemove",["teamspace.utilityService"]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put("components/extensibility/tab-remove-dialog/tab-remove-dialog.html",i),t.register(e.lazyDialogs.tabRemove,{template:"components/extensibility/tab-remove-dialog/tab-remove-dialog.html",className:"ts-modal-dialog tab-remove-dialog",closeByEscape:!0,closeByDocument:!0,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"modalDialog-title"})}]).controller("TabRemoveController",a)},2684:function(e,t){e.exports='<div class="tab-remove" ng-controller="TabRemoveController as ctrl" acc-role="dialog">\n  <modal-dialog add-close-icon="false" suppress-default-button="true" skip-auto-focus="false" footer-buttons="ctrl.footerButtons" right-align-buttons="true" data-tid="tabRemoveDialog">\n      <section class="title-container" id="modalDialog-title">\n        <div class="text-container" translate-once="{{::$root.resources.strings.extension_tabRemoveTitle}}">\n        </div>\n      </section>\n      <section class="dialog-content">\n        <div class="dialog-manage" ng-bind="ctrl.removeFailReason"></div>\n      </section>\n  </modal-dialog>\n</div>'},2685:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){function a(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function r(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){e.done?n(e.value):a(e.value).then(o,r)}l((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,s&&(o=2&n[0]?s.return:n[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,s=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(e){n=[6,e],s=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,s,o,r,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2686),o=n(2687),r=function(){function e(e,t,n,i,a,s,o,r,l,p){this.$injector=e,this.$scope=t,this.constants=n,this.dialogService=i,this.appDetailsDialogService=a,this.localizationService=s,this.tooltipService=l,this.subscriptionPlansDialogData=t.ngDialogData,this.loadCountries(),this.infoTooltipText=o.instant(r.strings.extension_countrySelectorDialog_info_message),this.infoTooltipId=p.generateUUID()}return e.$inject=["$injector","$scope","constants","dialogService","appDetailsDialogService","localizationService","$translate","resources","tooltipService","utilityService"],e.prototype.loadCountries=function(){return i(this,void 0,void 0,function(){var e,t,n;return a(this,function(i){switch(i.label){case 0:e=this.$injector.get("monetizationService"),i.label=1;case 1:return i.trys.push([1,3,,4]),t=this,[4,e.getSupportedBillingRegions()];case 2:return t.sortedCountries=i.sent(),this.sortedCountries&&0!=this.sortedCountries.length||this.addDefaultCountry(),[3,4];case 3:return n=i.sent(),this.strErrorMessage=n,this.addDefaultCountry(),[3,4];case 4:return this.defaultBasedOnLocale(),this.$scope.$apply(),[2]}})})},e.prototype.addDefaultCountry=function(){var e={countryName:"United States",countryCode:"US"};this.sortedCountries=new Array(e)},e.prototype.defaultBasedOnLocale=function(){var e,t=(null!==(e=this.localizationService.getCountryCode())&&void 0!==e?e:"").toUpperCase(),n=this.sortedCountries.find(function(e){return e.countryCode==t});n&&(this.selectedCountry=n.countryCode)},e.prototype.continue=function(){var e;return i(this,void 0,void 0,function(){var t,n,i=this;return a(this,function(a){switch(a.label){case 0:return t=this.$injector.get("monetizationService"),n={country:this.selectedCountry,culture:this.localizationService.getLocale(),language:null===(e=this.localizationService.getLocale())||void 0===e?void 0:e.split("-")[0],countryName:this.sortedCountries.find(function(e){return e.countryCode==i.selectedCountry}).countryName},[4,t.setBillingRegion(n)];case 1:return a.sent(),this.subscriptionPlansDialogData.billingRegion=n,this.subscriptionPlansDialogData.sourceDialog=this.constants.lazyDialogs.countrySelectorDialog,this.dialogService.close(this.constants.lazyDialogs.subscriptionPlansDialog),this.dialogService.openLazyDialog(this.constants.lazyDialogs.subscriptionPlansDialog,this.constants.lazyModules.extensibilityDialogs,this.subscriptionPlansDialogData),[2]}})})},e.prototype.close=function(){this.dialogService.close(this.constants.lazyDialogs.subscriptionPlansDialog),this.appDetailsDialogService.open(this.constants.lazyDialogs.addAppNew,this.constants.lazyModules.extensibilityDialogs,this.subscriptionPlansDialogData.addAppDialogData)},Object.defineProperty(e.prototype,"navCtx",{get:function(){return"country-selector-dialog"},enumerable:!0,configurable:!0}),e.prototype.onKeyboard=function(e){var t=e.keyCode;return t===this.constants.keyCodes.escape?(e.preventDefault(),void e.stopPropagation()):t===this.constants.keyCodes.tab?(e.stopPropagation(),void e.preventDefault()):void 0},e.prototype.showInfoTooltip=function(e,t){if(t){var n={templateUrl:"components/extensibility/country-selector-dialog/country-selector-dialog-info-tooltip.html",trigger:"manual",container:"body",placement:"right",autoClose:!0,scope:this.$scope,content:this.infoTooltipText},i={sourceElement:angular.element(e.currentTarget),tooltipType:teamspace.services.TooltipType.Popover,options:n,tooltipId:this.infoTooltipId};this.tooltipService.showTooltip(i)}else this.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,this.infoTooltipId)},e}();t.CountrySelectorController=r,angular.module("teamspace.countrySelectorDialog",[]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put("components/extensibility/country-selector-dialog/country-selector-dialog.html",s),n.put("components/extensibility/country-selector-dialog/country-selector-dialog-info-tooltip.html",o),t.register(e.lazyDialogs.countrySelectorDialog,{template:"components/extensibility/country-selector-dialog/country-selector-dialog.html",className:"ts-modal-dialog custom-width country-selector-dialog",closeByEscape:!0,closeByDocument:!0,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"csc-dialog-title"})}]).controller("CountrySelectorController",r)},2686:function(e,t){e.exports='<div class="country-selector-dialog-modal-container" ng-controller="CountrySelectorController as csc" aria-modal="true" aria-label="{{::$root.resources.strings.extension_countrySelectorDialog_title|translate}}" aria-describedby="countrySelectionWarningDescription" acc-role="dialog">\n  <modal-dialog dialog-title="{{::$root.resources.strings.extension_countrySelectorDialog_title|translate}}" add-close-icon="false" suppress-default-footer="true" data-tid="countrySelectorDialog" track-panel-type="{{$root.trackConstants.panelType.monetCountrySelector}}">\n    <section>\n      <div ng-if="csc.strErrorMessage" class="ts-team-or-channel-picker-error-message app-font-caption-regular">\n        {{csc.strErrorMessage}}\n      </div>\n      <div class="country-selector-dialog-container">\n        <div class="drop-down-area">\n          <div class="country-section">\n            <h5 class="section-info" id="countrySelectionWarningDescription">{{::$root.resources.strings.extension_countrySelectorDialog_subtitle|translate}}\n            </h5>\n            <div class="section-info-icon icons-info app-icons-fill-hover" ng-click="csc.showInfoTooltip($event, true)" ng-focus="csc.showInfoTooltip($event, true)" ng-blur="csc.showInfoTooltip($event, false)" ng-mouseenter="csc.showInfoTooltip($event, true)" ng-mouseleave="csc.showInfoTooltip($event, false)">\n              <ng-include src="\'svg/icons-info.html\'"></ng-include>\n            </div>\n            <dropdown-select class="country-selector-dialog-options" ds-text-field="countryName" ds-value-field="countryCode" ds-options="::csc.sortedCountries" ds-selected-value="csc.selectedCountry" ds-highlight-selected-option="true" ds-labelledby-id="country-selector-dialog-options" ds-parent-container-selector=".country-selector-dialog-modal-container" ds-max-viewable-items="3">\n            </dropdown-select>\n          </div>\n        </div>\n      </div>\n    </section>\n    <section class="country-selector-dialog-modal-footer">\n      <button class="ts-btn ts-btn-fluent ts-btn-fluent-secondary country-selector-dialog-cancel-button" ng-click="csc.close()">\n        {{::$root.resources.strings.icons_cancel_arialabel|translate}}\n      </button>\n      <button class="ts-btn ts-btn-fluent ts-btn-fluent-primary pull-right" ng-disabled="!csc.selectedCountry" ng-click="csc.continue()" track-default="openSubscriptionPlansDialogFromCountrySelector" track-data="{appId:\'{{csc.subscriptionPlansDialogData.appdefinition.id}}\', countrySelected: \'\'{{csc.selectedCountry}}\'}" track-summary="Continue - Country Selector Dialog">\n        {{::$root.resources.strings.extension_countrySelectorDialog_continue|translate}}\n      </button>\n    </section>\n  </modal-dialog>\n</div>'},2687:function(e,t){e.exports='<div class="tooltip-container csc-tooltip-right">\n  <div class="content-container">\n    <div class="tooltip-arrow-left"></div>\n    <span class="tooltip-content" ng-bind-html="content">\n    </span>\n  </div>\n</div>\n'},2688:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(33),o=n(2689);!function(e){e.Verbose="verbose",e.Info="info",e.Warning="warning",e.Error="error"}(a||(a={}));var r=function(e){function t(t,n,i,s,o,r,l,p,c,d,g,u,h,m,v,f,b,y){var S,A,D,C=e.call(this,d,g,t,p,c,u,l,n,o,h,b,f,s,m,v)||this;C.constants=n,C.dialogService=i,C.loggingService=o,C.eventingService=r,C.utilityService=b,C.analyticsService=y;var I=s.valueFor(n.settings.names.monetizationConstants);C.manageSubscriptionDialogData=t.ngDialogData,C.manageSubscriptionDetails={assetId:C.manageSubscriptionDialogData.assetId,showBackButton:!1,showCancelButton:!0,minimumlogLevel:a.Error,enableAnalytics:!1},C.definitionId=I.monetizationSpaAppId;var T=I.manageSubscriptionPage+C.manageSubscriptionDialogData.assetId,P=I.endpointUri+I.purchaseSubscriptionPage+T;return P=b.appendQueryStringToUrl(P,I.sourceQueryString,null===(S=C.manageSubscriptionDialogData)||void 0===S?void 0:S.sourceDialog),P=b.appendQueryStringToUrl(P,I.appIdQueryString,null===(D=null===(A=C.manageSubscriptionDialogData)||void 0===A?void 0:A.appdefinition)||void 0===D?void 0:D.id),C.beginLoad(P),C}return i(t,e),t.$inject=["$scope","constants","dialogService","settingsService","loggingService","eventingService","$window","$element","$interval","$q","$sce","$timeout","extensionTabService","htmlSanitizer","navigationService","sdkHelperService","utilityService","analyticsService"],Object.defineProperty(t.prototype,"navCtx",{get:function(){return"manage-subscription-dialog"},enumerable:!0,configurable:!0}),t.prototype.createMessageHandler=function(t){var n=e.prototype.createMessageHandler.call(this,t);return n.addMessageHandler(this.constants.SdkMessageTypes.monetization.initialize,this.handleInitializeMonetization.bind(this)),n.addMessageHandler(this.constants.SdkMessageTypes.monetization.onCancel,this.handleClose.bind(this)),n.addMessageHandler(this.constants.SdkMessageTypes.monetization.onError,this.handleError.bind(this)),n.addMessageHandler(this.constants.SdkMessageTypes.monetization.analytics,this.handleAnalytics.bind(this)),n},t.prototype.handleInitializeMonetization=function(e){return JSON.stringify(this.manageSubscriptionDetails)},t.prototype.handleClose=function(e){this.logManageSubscriptionDialogTelemetry(teamspace.components.PanelActionScenario.cancelMonetManageSubscription.toString(),teamspace.components.PanelActionGesture.click),this.close()},t.prototype.handleError=function(e){if(e&&e.data){var t=JSON.stringify(e.data);this.loggingService.error("Error occured in subscription management page : ",t)}},t.prototype.handleAnalytics=function(e){e&&e.data&&this.loggingService.info(JSON.stringify(e.data))},t.prototype.close=function(){this.dialogService.close(this.constants.lazyDialogs.manageSubscriptionDialog)},t.prototype.logBiTelemetryForViewSubscriptionDetails=function(){this.logManageSubscriptionDialogTelemetry(teamspace.components.PanelActionScenario.subscriptionDetailsViewed.toString(),teamspace.components.PanelActionGesture.auto)},t.prototype.back=function(){this.logManageSubscriptionDialogTelemetry(teamspace.components.PanelActionScenario.monetNavBackAction.toString(),teamspace.components.PanelActionGesture.click),this.close(),this.dialogService.openLazyDialog(this.constants.lazyDialogs.addAppNew,this.constants.lazyModules.extensibilityDialogs,this.manageSubscriptionDialogData.addAppDialogData)},t.prototype.onKeyboard=function(e){var t=e.keyCode;return t===this.constants.keyCodes.escape?(e.preventDefault(),void e.stopPropagation()):t===this.constants.keyCodes.tab?(event.stopPropagation(),void event.preventDefault()):void 0},t.prototype.onContentLoaded=function(t,n){e.prototype.onContentLoaded.call(this,t,n),this.logBiTelemetryForViewSubscriptionDetails()},t.prototype.logManageSubscriptionDialogTelemetry=function(e,t){var n=this,i={action:{gesture:t,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.nav.toString(),teamspace.components.PanelActionOutcome,this.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(e,teamspace.components.PanelActionScenario,this.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.nav.toString(),teamspace.components.PanelActionScenarioType,this.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.monetManageSubscription.toString(),teamspace.components.PanelModuleName,this.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.monetDialog.toString(),teamspace.components.PanelModuleType,this.loggingService)},app:{id:this.manageSubscriptionDialogData.appdefinition.id},dataBag:{assetId:this.manageSubscriptionDialogData.assetId,source:this.manageSubscriptionDialogData.sourceDialog}};this.analyticsService.getAnalyticsPanelActionEventData(i).then(function(e){return n.analyticsService.sendPanelAction(e)}).catch(function(e){n.loggingService.error("failed to log action "+e)})},t}(s.ExtensionFrameBase);t.ManageSubscriptionController=r,angular.module("teamspace.manageSubscriptionDialog",[]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put("components/extensibility/manage-subscription-dialog/manage-subscription-dialog.html",o),t.register(e.lazyDialogs.manageSubscriptionDialog,{template:"components/extensibility/manage-subscription-dialog/manage-subscription-dialog.html",className:"ts-modal-dialog custom-width subscription-plans-purchase-dialog",closeByEscape:!0,closeByDocument:!0,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"mspc-dialog-title"})}]).controller("ManageSubscriptionController",r)},2689:function(e,t){e.exports='<div class="subscription-plans-purchase-dialog-modal-container" ng-controller="ManageSubscriptionController as msdc" aria-modal="true" acc-role="dialog">\n  <modal-dialog add-close-icon="false" suppress-default-footer="true" data-tid="manageSubscriptionDialog" track-panel-type="{{$root.trackConstants.panelType.monetCheckout}}">\n    <section class="ts-manage-subscription-dialog-container">\n\n      <div ng-if="msdc.strErrorMessage" class="ts-team-or-channel-picker-error-message app-font-caption-regular">\n        {{msdc.strErrorMessage}}\n      </div>\n\n      <div class="extension-tab">\n        <embedded-page-container class="extension-tab-container" url="{{msdc.frameSrc}}" enable-message-passing="true" definition-id="{{::msdc.definitionId}}" on-content-loaded="msdc.onContentLoaded(isSuccessful, frameInfo)" on-message-received="msdc.onMessageReceived(source, data, origin)">\n        </embedded-page-container>\n      </div>\n    </section>\n  </modal-dialog>\n</div>'},2690:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s,o=n(33),r=n(2691);!function(e){e.Verbose="verbose",e.Info="info",e.Warning="warning",e.Error="error"}(s||(s={}));var l="ME",p=function(e){function t(t,n,i,a,o,r,p,c,d,g,u,h,m,v,f,b,y,S,A,D,C,I){var T=e.call(this,u,h,n,d,g,m,c,i,r,v,S,y,o,f,b)||this;T.$injector=t,T.constants=i,T.dialogService=a,T.loggingService=r,T.eventingService=p,T.utilityService=S,T.analyticsService=A,T.isFRE=!1,T.perfLoggingEventName=i.scenarios.extensibility.monetization.perf.openCheckoutDialog,T.scenario=r.newScenario(T.perfLoggingEventName),T.checkoutErrors=r.newScenario(i.scenarios.extensibility.monetization.checkoutDialogErrors);var P=o.valueFor(i.settings.names.monetizationConstants);return n&&n.$parent&&n.$parent.planCheckoutData&&n.$parent.planCheckoutData.plan?T.subscriptionPlanPurchaseDialogData=n.$parent.planCheckoutData.plan:T.subscriptionPlanPurchaseDialogData=n.$parent.ngDialogData,T.enableTestTraffic=o.valueAsBoolean(i.settings.names.enableTestTraffic),T.isIWBootStrapped=o.valueAsBoolean(i.settings.names.enableCommerceAccountBootstrapping),T.isCheckoutPreloaded=o.valueAsBoolean(i.settings.names.enablePreLoadingCheckout),T.subscriptionPlanPurchaseDialogData&&T.subscriptionPlanPurchaseDialogData.selectedPlan&&T.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData&&I.getCurrentTenantName().then(function(e){T.purchaseDetails={purchaseExperience:{trackingId:T.subscriptionPlanPurchaseDialogData.trackingId,locale:T.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData.billingRegion.culture,language:T.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData.billingRegion.language,market:T.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData.billingRegion.country,userType:l,isTestTraffic:T.enableTestTraffic,parentWindowUrl:window.location.href,productInfo:{availabilityId:T.subscriptionPlanPurchaseDialogData.selectedPlan.availabilityId,productId:T.subscriptionPlanPurchaseDialogData.selectedPlan.productId,quantity:T.subscriptionPlanPurchaseDialogData.selectedPlan.minimumQuantity,skuId:T.subscriptionPlanPurchaseDialogData.selectedPlan.skuId,isQuantifiable:T.subscriptionPlanPurchaseDialogData.selectedPlan.isQuantifiable,additionalData:{availabilityTermId:T.subscriptionPlanPurchaseDialogData.selectedPlan.availabilityTermId,billingCycle:T.subscriptionPlanPurchaseDialogData.selectedPlan.billingCycle,isThirdPartySaaSAppPurchase:T.subscriptionPlanPurchaseDialogData.selectedPlan.isThirdPartySaaSAppPurchase}},companyName:e},showBackButton:!0,showCancelButton:!0,minimumlogLevel:s.Info,enableAnalytics:!0,title:D.instant(C.strings.extension_subscriptionPlansPurchaseDialog_Header)}}),T.definitionId=P.monetizationSpaAppId,T.beginLoad(P.endpointUri+P.purchaseSubscriptionPage),T.subscriptionPlanPurchaseDialogData.selectedPlan&&T.subscriptionPlanPurchaseDialogData.selectedPlan.trialDays>0?T.description=D.instant(C.strings.extension_subscriptionPlansPurchaseDialog_Description_Trial,{appName:T.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData.appdefinition.name,quantity:T.subscriptionPlanPurchaseDialogData.selectedPlan.minimumQuantity,price:T.subscriptionPlanPurchaseDialogData.selectedPlan.formattedPrice,trialDays:T.subscriptionPlanPurchaseDialogData.selectedPlan.trialDays}):T.description=D.instant(C.strings.extension_subscriptionPlansPurchaseDialog_Description,{appName:T.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData.appdefinition.name,quantity:T.subscriptionPlanPurchaseDialogData.selectedPlan.minimumQuantity,price:T.subscriptionPlanPurchaseDialogData.selectedPlan.formattedPrice}),T}return i(t,e),t.$inject=["$injector","$scope","constants","dialogService","settingsService","loggingService","eventingService","$window","$element","$interval","$q","$sce","$timeout","extensionTabService","htmlSanitizer","navigationService","sdkHelperService","utilityService","analyticsService","$translate","resources","tenantService"],Object.defineProperty(t.prototype,"navCtx",{get:function(){return"subscription-plan-purchase-directive"},enumerable:!0,configurable:!0}),t.prototype.createMessageHandler=function(t){var n=e.prototype.createMessageHandler.call(this,t);return n.addMessageHandler(this.constants.SdkMessageTypes.monetization.initialize,this.handleInitializeMonetization.bind(this)),n.addMessageHandler(this.constants.SdkMessageTypes.monetization.onPlaceOrder,this.handlePurchaseResponse.bind(this)),n.addMessageHandler(this.constants.SdkMessageTypes.monetization.onBack,this.handleBack.bind(this)),n.addMessageHandler(this.constants.SdkMessageTypes.monetization.onCancel,this.handleClose.bind(this)),n.addMessageHandler(this.constants.SdkMessageTypes.monetization.onError,this.handleError.bind(this)),n.addMessageHandler(this.constants.SdkMessageTypes.monetization.analytics,this.handleAnalytics.bind(this)),n},t.prototype.handleInitializeMonetization=function(e){return JSON.stringify(this.purchaseDetails)},t.prototype.handlePurchaseResponse=function(e){var t=this;if(e&&e.data&&e.data.args){var n={receipt:e.data.args.receiptData,subscriptionPlanPurchaseDialogData:this.subscriptionPlanPurchaseDialogData};this.close(),this.dialogService.openLazyDialog(this.constants.lazyDialogs.purchaseConfirmationDialog,this.constants.lazyModules.extensibilityDialogs,n);var i=this.$injector.get("monetizationService");_.defer(function(){i.sendUserBiTelemetryForMonetizationDialogs(teamspace.PanelType[teamspace.PanelType.monetConfirmation],t.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData.appdefinition.id)})}return!0},t.prototype.handleBack=function(e){this.logCheckoutDialogTelemetry(teamspace.components.PanelActionScenario.monetNavBackAction.toString()),this.back(),this.checkoutErrors.stop()},t.prototype.handleClose=function(e){this.logCheckoutDialogTelemetry(teamspace.components.PanelActionScenario.cancelMonetCheckout.toString()),this.close(),this.checkoutErrors.stop()},t.prototype.handleError=function(e){if(e&&e.data&&e.data.args){var t=e.data.args;if(t.logData&&t.logData.level===s.Error){var n=JSON.stringify(t.logData);this.loggingService.event(this.constants.scenarios.extensibility.monetization.checkoutDialogErrors,a({},t.logData)),this.checkoutErrors.appendEventData({errorMsg:n})}}},t.prototype.handleAnalytics=function(e){if(e&&e.data&&e.data.args){var t=e.data.args,n=t.analyticsData,i=t.statusChangeData;this.isFREReadyToPurchaseLoaded(i)&&(this.isFRE=!0,this.perfLoggingEventName!==this.constants.scenarios.extensibility.monetization.perf.openCheckoutDialog&&this.perfLoggingEventName!==this.constants.scenarios.extensibility.monetization.perf.updateProfileSave||this.logPBActionEvents()),n&&n.eventName&&("ClickedQuantityUpdateButton"===n.eventName&&"Click"===n.type?(this.perfLoggingEventName=this.constants.scenarios.extensibility.monetization.perf.updateQuantity,this.scenario=this.loggingService.newScenario(this.perfLoggingEventName)):this.perfLoggingEventName!==this.constants.scenarios.extensibility.monetization.perf.updateQuantity&&this.perfLoggingEventName!==this.constants.scenarios.extensibility.monetization.perf.changePaymentSelector||!String(n.message).includes("Source: 'ReadyToPurchase' emitted status: 'Loaded'")?this.perfLoggingEventName===this.constants.scenarios.extensibility.monetization.perf.addProfileSave&&String(n.message).includes("Source: 'ReadyToPurchase' emitted status: 'Loaded'")?(this.logPBActionEvents(),this.shouldReloadPlansDialog=!0):"ClickedAddProfile"===n.eventName&&"Click"===n.type?(this.perfLoggingEventName=this.constants.scenarios.extensibility.monetization.perf.addBillingProfile,this.scenario=this.loggingService.newScenario(this.perfLoggingEventName)):this.perfLoggingEventName===this.constants.scenarios.extensibility.monetization.perf.addBillingProfile&&String(n.message).includes("Source: 'AddProfile' emitted status: 'Loaded'")?this.logPBActionEvents():"ClickedAddProfileSave"===n.eventName&&"Click"===n.type?(this.perfLoggingEventName=this.constants.scenarios.extensibility.monetization.perf.addProfileSave,this.scenario=this.loggingService.newScenario(this.perfLoggingEventName)):"ClickedEditProfile"===n.eventName&&"Click"===n.type?(this.perfLoggingEventName=this.constants.scenarios.extensibility.monetization.perf.editBillingProfile,this.scenario=this.loggingService.newScenario(this.perfLoggingEventName)):this.perfLoggingEventName===this.constants.scenarios.extensibility.monetization.perf.editBillingProfile&&String(n.message).includes("Source: 'EditProfile' emitted status: 'Loaded'")?this.logPBActionEvents():"ClickedReplaceWithNewPaymentMethod"===n.eventName&&"Click"===n.type?(this.perfLoggingEventName=this.constants.scenarios.extensibility.monetization.perf.newPaymentMethod,this.scenario=this.loggingService.newScenario(this.perfLoggingEventName)):this.perfLoggingEventName===this.constants.scenarios.extensibility.monetization.perf.newPaymentMethod&&String(n.message).includes("Source: 'AddPayment' emitted status: 'Loaded'")?this.logPBActionEvents():"ClickedUpdateProfileSave"===n.eventName&&"Click"===n.type?(this.perfLoggingEventName=this.constants.scenarios.extensibility.monetization.perf.updateProfileSave,this.scenario=this.loggingService.newScenario(this.perfLoggingEventName)):"ClickedAddPaymentSave"===n.eventName&&"Click"===n.type?(this.perfLoggingEventName=this.constants.scenarios.extensibility.monetization.perf.addPaymentSave,this.scenario=this.loggingService.newScenario(this.perfLoggingEventName)):"ButtonEnabled"===n.eventName&&String(n.message).includes("wizard button enabled for component: ReadyToPurchase")&&this.perfLoggingEventName===this.constants.scenarios.extensibility.monetization.perf.updateProfileSave?(this.logPBActionEvents(),this.shouldReloadPlansDialog=!0):"ButtonEnabled"===n.eventName&&String(n.message).includes("wizard button enabled for component: ReadyToPurchase")&&this.perfLoggingEventName===this.constants.scenarios.extensibility.monetization.perf.addPaymentSave?(this.logPBActionEvents(),this.shouldReloadPlansDialog=!0):"ButtonEnabled"===n.eventName&&String(n.message).includes("wizard button enabled for component: ReadyToPurchase")&&this.perfLoggingEventName===this.constants.scenarios.extensibility.monetization.perf.openCheckoutDialog?this.logPBActionEvents():"ClickedPaymentSelectorChange"===n.eventName&&"Click"===n.type?(this.perfLoggingEventName=this.constants.scenarios.extensibility.monetization.perf.changePaymentSelector,this.scenario=this.loggingService.newScenario(this.perfLoggingEventName)):"ClickedWizardMoveNext"===n.eventName&&"Click"===n.type?(this.perfLoggingEventName=this.constants.scenarios.extensibility.monetization.perf.placeOrder,this.scenario=this.loggingService.newScenario(this.perfLoggingEventName),this.logCheckoutDialogTelemetry(teamspace.components.PanelActionScenario.placeOrderClicked.toString())):this.perfLoggingEventName===this.constants.scenarios.extensibility.monetization.perf.placeOrder&&String(n.message).includes("Source: 'ReadyToPurchase' emitted status: 'Success'")?this.logPBActionEvents():"ClickedWizardMoveCancel"===n.eventName&&"Click"===n.type?this.logCancelActionEvents(this.constants.scenarios.extensibility.monetization.action.cancelSubscriptionPurchaseForm):"ClickedAddProfileCancel"===n.eventName&&"Click"===n.type?this.logCancelActionEvents(this.constants.scenarios.extensibility.monetization.action.cancelAddProfileForm):"ClickedUpdateProfileCancel"===n.eventName&&"Click"===n.type?this.logCancelActionEvents(this.constants.scenarios.extensibility.monetization.action.cancelUpdateProfileForm):"ClickedAddPaymentCancel"===n.eventName&&"Click"===n.type&&this.logCancelActionEvents(this.constants.scenarios.extensibility.monetization.action.cancelAddPaymentForm):this.logPBActionEvents())}},t.prototype.isFREReadyToPurchaseLoaded=function(e){return e&&"Loaded"===e.status&&"ReadyToPurchase"===e.context.source&&e.isFRE},t.prototype.logPBActionEvents=function(){this.scenario.appendEventData({isFRE:this.isFRE}),this.scenario.stop(),this.scenario=null,this.perfLoggingEventName=""},t.prototype.logCancelActionEvents=function(e){this.scenario&&(this.scenario.cancel(),this.scenario=null),this.perfLoggingEventName=e,this.scenario=this.loggingService.newScenario(this.perfLoggingEventName),this.logPBActionEvents()},t.prototype.close=function(){this.closeCheckout()},t.prototype.back=function(){this.shouldReloadPlansDialog?(this.close(),this.dialogService.openLazyDialog(this.constants.lazyDialogs.subscriptionPlansDialog,this.constants.lazyModules.extensibilityDialogs,this.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData)):this.showPlans()},t.prototype.onKeyboard=function(e){var t=e.keyCode;return t===this.constants.keyCodes.escape?(e.preventDefault(),void e.stopPropagation()):t===this.constants.keyCodes.tab?(event.stopPropagation(),void event.preventDefault()):void 0},t.prototype.logCheckoutDialogTelemetry=function(e){var t=this,n={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionOutcome.nav.toString(),teamspace.components.PanelActionOutcome,this.loggingService),scenario:teamspace.shared.AttributeHelper.tryGetEnum(e,teamspace.components.PanelActionScenario,this.loggingService),scenarioType:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.nav.toString(),teamspace.components.PanelActionScenarioType,this.loggingService)},module:{name:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleName.monetCheckout.toString(),teamspace.components.PanelModuleName,this.loggingService),type:teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.monetDialog.toString(),teamspace.components.PanelModuleType,this.loggingService),summary:this.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData.appdefinition.name},app:{id:this.subscriptionPlanPurchaseDialogData.subscriptionPlansDialogData.appdefinition.id}};this.analyticsService.getAnalyticsPanelActionEventData(n).then(function(e){return t.analyticsService.sendPanelAction(e)}).catch(function(e){t.loggingService.error("failed to log action "+e)})},t}(o.ExtensionFrameBase);t.SubscriptionPlanPurchaseDirective=p,angular.module("teamspace.subscriptionPlanPurchaseDirective",[]).directive("subscriptionPlanPurchaseDirective",function(){return{restrict:"E",scope:{isCheckoutClicked:"=",planCheckoutData:"=",subscriptionPlanPurchaseDialogData:"=",showPlans:"&",closeCheckout:"&",checkoutClickStartTime:"="},bindToController:{isCheckoutClicked:"=",planCheckoutData:"=",subscriptionPlanPurchaseDialogData:"=",showPlans:"&",closeCheckout:"&",checkoutClickStartTime:"="},templateUrl:"components/extensibility/subscription-plan-purchase-directive/subscription-plan-purchase-directive.html",controller:p,controllerAs:"sppd"}}).run(["$templateCache",function(e){e.put("components/extensibility/subscription-plan-purchase-directive/subscription-plan-purchase-directive.html",r)}])},2691:function(e,t){e.exports='<div class="subscription-plans-purchase-dialog-modal-container" aria-modal="true" aria-label="{{sppd.description}}" aria-describedby="{{sppd.description}}" acc-role="dialog">\n  <section class="ts-subscription-plans-purchase-dialog-container">\n\n    <div ng-if="sppd.strErrorMessage" class="ts-team-or-channel-picker-error-message app-font-caption-regular">\n      {{sppd.strErrorMessage}}\n    </div>\n\n    <div class="extension-tab">\n      <embedded-page-container class="extension-tab-container" url="{{sppd.frameSrc}}" enable-message-passing="true" definition-id="{{::sppd.definitionId}}" on-content-loaded="sppd.onContentLoaded(isSuccessful, frameInfo)" on-message-received="sppd.onMessageReceived(source, data, origin)">\n      </embedded-page-container>\n    </div>\n  </section>\n</div>'},2692:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2693),a=teamspace.services.commanding,s=500,o=function(){function e(e,t,n,i,a,o,r,l,p){var c=this;this.$q=e,this.dialogService=a,this.tenantAppsService=p,this.dialogData=t.ngDialogData,this.isFileSelected=!1,this.logger=o.newLogger("FilePickerDialogController"),this.enableNorthstarDetailsDialog=l.valueAsBoolean(r.settings.names.enableNorthstarAppDetailsDialog);var d,g=n(function(){var e=$("#app-upload-button");$(e).trigger("click"),c.isFilePickerOpen=!0,i.addEventListener("focus",c.eventListener)});this.eventListener=function(){i.removeEventListener("focus",c.eventListener),d=n(function(){c.logger.info("focus back from file picker: isFileSelected "+c.isFileSelected),c.isFileSelected||!0!==c.isFilePickerOpen||c.closeDialog()},s)},t.$on("$destroy",function(){i.removeEventListener("focus",c.eventListener),g&&(n.cancel(g),g=null),d&&(n.cancel(d),d=null)})}return e.$inject=["$q","$scope","$timeout","$window","dialogService","loggingService","constants","settingsService","tenantAppsService"],e.prototype.beforeChange=function(e){this.isFileSelected=!!e},e.prototype.handleUpload=function(e){var t=this;if(e){var n=null,i=document.querySelector(".file-picker-dialog");this.enableNorthstarDetailsDialog&&(n=i.style.zIndex,i.style.zIndex="-1");var s,o=this.$q.reject();switch(this.dialogData.customAppType){case a.CustomAppType.staging:o=this.tenantAppsService.uploadTenantStagingApp(e);break;case a.CustomAppType.sideload:o=this.tenantAppsService.uploadCustomApp(e,this.dialogData.appDetailsLaunchOptions,this.dialogData.dialogId);break;case a.CustomAppType.tenant:o=this.tenantAppsService.uploadTenantApp(e)}o.then(function(){s=t.dialogData.postConfirmCallback}).finally(function(){t.enableNorthstarDetailsDialog&&(document.querySelector(".file-picker-dialog").style.zIndex=n),t.closeDialog(s)})}},e.prototype.closeDialog=function(e){var t;this.isFilePickerOpen=!1,e?e():this.dialogService.close(null===(t=this.dialogData)||void 0===t?void 0:t.ngDialogId)},e}();t.FilePickerDialogController=o,angular.module("teamspace.filePickerDialog",["teamspace.dialogService","teamspace.tenantAppsService","teamspace.constants"]).run(["$templateCache","dialogService","constants",function(e,t,n){e.put("components/extensibility/file-picker-dialog/file-picker-dialog.html",i),t.register(n.dialogs.filePickerDialog,{template:"components/extensibility/file-picker-dialog/file-picker-dialog.html",className:"ts-modal-dialog file-picker-dialog",closeByEscape:!1,closeByDocument:!1,showClose:!1})}]).controller("FilePickerDialogController",o)},2693:function(e,t){e.exports='<div class="ts-file-picker-dialog-container" ng-controller="FilePickerDialogController as fpdc" aria-modal="true" acc-role="dialog">\n  <modal-dialog suppress-default-button="true" suppress-default-footer="true" data-tid="filePickerDialog" id="file-picker-modal" track-panel-type="{{::$root.trackConstants.panelType.filePickerDialog}}">\n    <busy-animation class="loading-spinner" size="medium"></busy-animation>\n    <button class="file-picker-button ts-btn" id="app-upload-button" ngf-select="fpdc.handleUpload($file)" ngf-before-model-change="fpdc.beforeChange($file)" ngf-pattern="\'.zip\'" ngf-accept="\'.zip\'" data-tid="fpdc-app-upload-button" acc-role="button" role="button">\n    </button>\n  </modal-dialog>\n</div>'},2694:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2695),o=n(30),r=function(e){function t(t,n,i,s,r,l,p,c,d,g,u,h,m,v,f,b,y,S,A,D,C,I,T,P,x,_,w,k,M,$,E,F,B,N,O,L,U){var z=e.call(this,h,m,v,f,b,y,S,A,D,C,I,T,P,x,_,w,k,B,N,F,O,L)||this;if(z.resources=t,z.$translate=n,z.appsService=i,z.channelService=s,z.routeUtilityService=r,z.teamMembershipPropertiesService=l,z.teamSettingsService=p,z.identityService=c,z.extensionTabHelperService=d,z.dialogService=g,z.appsDevicePermissionService=u,z.$q=h,z.$sce=m,z.$scope=v,z.$element=f,z.$interval=b,z.$timeout=y,z.$window=S,z.constants=A,z.loggingService=D,z.extensionTabService=C,z.utilityService=I,z.sdkHelperService=T,z.settingsService=P,z.uiOrchestrator=x,z.htmlSanitizer=_,z.desktopUtilityService=w,z.navigationService=k,z.analyticsService=M,z.ariaLiveService=$,z.botCardService=E,z.eventingService=F,z.inputExtensionService=B,z.extensionTabLogService=N,z.appStateService=O,z.messagingTelemetryService=L,z.botCardFactory=U,z.isLoaded=!1,z.showConsent=!1,z.doInstall=!1,z.frameSize={},z.headerButtons=[],z.appPermissionSettingsEnabled=!1,z.isBrowser=!z.desktopUtilityService.isElectron(),z.scenario=teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenario.editDevicePermissionFromTaskModule.toString(),teamspace.components.PanelActionScenario,z.loggingService),z.scenarioType=teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelActionScenarioType.appMgmt.toString(),teamspace.components.PanelActionScenarioType,z.loggingService),z.panelType=teamspace.shared.AttributeHelper.tryGetEnum(teamspace.PanelType.taskModule.toString(),teamspace.PanelType,z.loggingService),z.moduleType=teamspace.shared.AttributeHelper.tryGetEnum(teamspace.components.PanelModuleType.taskModule.toString(),teamspace.components.PanelModuleType,z.loggingService),z.moduleName=teamspace.components.PanelModuleName[teamspace.components.PanelModuleName.taskModule],z.updatedContentSize={},z.appPermissionSettingsEnabled=P.valueAsBoolean(A.settings.names.enableIframeDevicePermissionSettings),!v.ngDialogData||!v.ngDialogData.options)throw new Error("Invalid Task Module Dialog input");var G=function(){return{parentMessageId:z.replyChainId||"",messageId:z.messageId||""}};if(C.registerDynamicTabContextProvider(G),v.$on("$destroy",function(){C.unregisterDynamicTabContextProvider(G),z.launchOptions.setTaskFrame&&z.launchOptions.setTaskFrame(null)}),z.adaptiveCardsSdk=null,z.loadAdaptiveCardSdk().then(function(){z._hostConfigOverwrite={actions:{actionAlignment:z.adaptiveCardsSdk.ActionAlignment.Right}},z.setFocusToFirstElement()}),z.launchOptions=v.ngDialogData.options,z.initLayoutSizeMap(),z.setInitialSizeHelper(z.launchOptions.initialTaskInfo?z.launchOptions.initialTaskInfo.width:300,z.launchOptions.initialTaskInfo?z.launchOptions.initialTaskInfo.height:300),z.suppressAppHeaderOnStartup=!0,!z.launchOptions.getContent)throw new Error("getContent callback is missing!");z.setAriaLabel(),z.isLoading=!0;var H=D.newScenario(A.scenarios.extensibility.tabs.taskModule.launchTaskModule);return z.launchOptions.getContent().then(function(e){return z.moduleInput=e,z.isLoading=!1,z.definitionId=e.appId,H.mark(A.scenarios.extensibility.tabs.taskModule.launchTaskModuleStepInit,z.getScenarioEventData()),z.iFrameTitle=n.instant(t.strings.extension_iFrame_TaskModuleTitle,{appName:I.stripHtml(I.escapeHtml(z.launchOptions.appName))}),z.updatedContentSize={type:e.type},z.setContentSize(e),z.overwriteTitleIfNecessary(e),z.suppressAppHeaderOnStartup=!1,z.currentApp={id:e.appId,externalId:e.externalId},z.currentContentSizeFromBot={widthLayout:e.widthLayout,heightLayout:e.heightLayout},z.initializeTeamOrChatId()}).then(function(){switch(z.moduleInput.type){case o.TaskModuleType.ErrorMessage:z.errorMessage=z.moduleInput.message,z.setContentNotAvailableSizeHelper();break;case o.TaskModuleType.AdaptiveCard:z.adaptiveCardViewModel=U.createCard({content:z.moduleInput.adaptiveCard.cardPayload,contentType:A.bots.cards.types.adaptive,appId:z.moduleInput.appId},z.chatId||z.teamId,null),z.isLoaded=!0;break;case o.TaskModuleType.Webview:z.replyChainId=z.moduleInput.replyChainId,z.parentMessageId=z.moduleInput.replyChainId,z.messageId=z.moduleInput.messageId,z.moduleInput.appId&&C.getAppDefinitionFromCurrentContext(z.moduleInput.appId).then(function(e){z.appDefinition=e,e&&(z.appAnalyticsData=teamspace.components.AppAnalyticsHelper.getAppAnalyticsData({appDefinition:z.appDefinition}),z.canEditAppPermissions&&z.addAppPermissionButton()),z.isAppSupportLoadingIndicator=P.valueAsBoolean(A.settings.names.enableShowTabAPI)&&e.showLoadingIndicator}),z.loadWebview(z.moduleInput);break;case o.TaskModuleType.BotPreviewMessage:z.isPreviewScreen=!0,z.adaptiveCardViewModel=U.createCard({content:z.moduleInput.adaptiveCard.cardPayload,contentType:A.bots.cards.types.adaptive,appId:z.moduleInput.appId},z.chatId||z.teamId,null),z.botActivityPreview=z.moduleInput.botActivityPreview,z.showConsentModule();break;default:return h.reject("Invalid task module type")}z.logTelemetryForTaskModuleLaunch(z.moduleInput.type),H.stop(z.getScenarioEventData()),F.$on(v,A.events.jQuery.resize,function(){z.setContentSize(z.currentContentSizeFromBot)})}).catch(function(e){z.setContentNotAvailableSizeHelper(),z.isLoading=!1,z.suppressAppHeaderOnStartup=!1,H.fail(a(a({},z.getScenarioEventData()),{error:"Invalid task module type"}))}),z}return i(t,e),t.$inject=["resources","$translate","appsService","channelService","routeUtilityService","teamMembershipPropertiesService","teamSettingsService","identityService","extensionTabHelperService","dialogService","appsDevicePermissionService","$q","$sce","$scope","$element","$interval","$timeout","$window","constants","loggingService","extensionTabService","utilityService","sdkHelperService","settingsService","uiOrchestrator","htmlSanitizer","desktopUtilityService","navigationService","analyticsService","ariaLiveService","botCardService","eventingService","inputExtensionService","extensionTabLogService","appStateService","messagingTelemetryService","botCardFactory"],t.prototype.loadAdaptiveCardSdk=function(){var e=this;return _.isEmpty(this.adaptiveCardsSdk)?new Promise(function(t,n){e.botCardFactory.loadAdaptiveCardSdk().then(function(n){return e.adaptiveCardsSdk=n,t()}).catch(function(t){return e.loggingService.error("task-module :: Failed to lazy load adaptive cards sdk"),n(t)})}):Promise.resolve()},t.prototype.addAppPermissionButton=function(){this.headerButtons.push({ariaLabel:this.$translate.instant(this.resources.strings.tabs_edit_app_permissions),tid:"edit-app-permissions-button",func:this.editAppDevicePermissions.bind(this),icon:"svg/icons-shield.html",class:"btn btn-default inset-border inset-border-round inset-border-themed app-icons-fill-hover"})},Object.defineProperty(t.prototype,"hostConfigOverwrite",{get:function(){return this._hostConfigOverwrite},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canEditAppPermissions",{get:function(){return this.appPermissionSettingsEnabled&&this.appsDevicePermissionService.appHasDevicePermissionRequirements(this.appDefinition,this.isBrowser)},enumerable:!0,configurable:!0}),t.prototype.editAppDevicePermissions=function(){this.appDefinition&&(this.logTelemetryForEditDevicePermissions(),this.dialogService.open(this.constants.lazyDialogs.devicePermissionDialogSettings,{appDefinition:this.appDefinition,dialogContext:"standAlone",telemetryContext:this.getAppTelemetryContext(),permissionsChangedCallback:this.confirmRefreshAppOnPermissionChanges.bind(this)}))},t.prototype.getAppTelemetryContext=function(){return{app:a(a({},this.appAnalyticsData),{scope:teamspace.components.PanelAppScope.general,scenarioCapability:teamspace.components.PanelAppScenarioCapability.tabs})}},t.prototype.logTelemetryForEditDevicePermissions=function(){var e={action:{gesture:teamspace.components.PanelActionGesture.click,scenario:this.scenario,scenarioType:this.scenarioType,outcome:teamspace.components.PanelActionOutcome.openDialog},panel:{type:this.panelType,typeNew:this.panelType},module:{type:this.moduleType,typeNew:this.moduleType,name:this.moduleName,nameNew:this.moduleName,summary:"Edit app permissions from task module"},app:a(a({},this.appAnalyticsData),{scope:teamspace.components.PanelAppScope.general,scenarioCapability:teamspace.components.PanelAppScenarioCapability.tabs})};this.analyticsService.onPanelAction(this.$scope,e)},t.prototype.confirmRefreshAppOnPermissionChanges=function(){this.dialogService.open(this.constants.lazyDialogs.refreshAppPermissionsDialog,{telemetryContext:this.getAppTelemetryContext(),refreshFunc:this.reloadWebView.bind(this)})},t.prototype.reloadWebView=function(){var e=this;this.moduleInput&&(this.isLoading=!0,this.$timeout(function(){return e.loadWebview(e.moduleInput)},0))},t.prototype.initializeTeamOrChatId=function(){var e=this,t=this.routeUtilityService.getRootRouteParams();return this.extensionTabHelperService.isChatOrMeetingRoute()?t.threadId?this.channelService.resolveTeamAndChannel(t.threadId).then(function(t){t&&t.team&&t.channel?e.chatId=t.channel.objectId:e.chatId=e.extensionTabHelperService.getChatId()}).catch(function(){return e.chatId=e.extensionTabHelperService.getChatId(),e.$q.resolve()}):(this.chatId=this.extensionTabHelperService.getChatId(),this.$q.resolve()):this.extensionTabHelperService.isOneOnOneBotChatRoute()?(this.chatId=this.extensionTabHelperService.getChatId(),this.$q.resolve()):t&&t.threadId?(this.channelId=t.threadId,this.channelService.resolveTeamAndChannel(t.threadId).then(function(t){return t&&t.team&&(e.teamId=t.team.objectId),e.$q.resolve()}).catch(function(){return e.$q.resolve()})):this.$q.resolve()},Object.defineProperty(t.prototype,"isContentNotAvailable",{get:function(){return!(this.adaptiveCardViewModel||this.frameSrc||this.message||this.isLoading)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shouldShowFooter",{get:function(){return!this.isLoading&&(this.shouldShowConsentElement||this.shouldShowJitButtons||!!this.errorMessage)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shouldShowConsentElement",{get:function(){return!!this.adaptiveCardViewModel&&this.showConsent&&!!this.privacyUrl&&!!this.termsOfUseUrl&&this.canInstallApp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shouldShowJitButtons",{get:function(){return!!this.adaptiveCardViewModel&&this.isPreviewScreen},enumerable:!0,configurable:!0}),t.prototype.onAdaptiveCardReady=function(e){this.adaptiveCardCtrl=e},t.prototype.onAdaptiveCardPostProcessingStyling=function(e){var t=e.adaptiveCardElement,n=t.find("button"),i=t.find($(".card-header"));i&&i.remove(),n.length>0&&t.find(n[n.length-1]).addClass("ts-btn-fluent ts-btn-fluent-primary"),t.find('[tabindex="-1"]').each(function(e,t){return!t.classList.contains("ac-dropdown-icon")&&t.setAttribute("tabindex","0")})},t.prototype.onWillAdaptiveCardExecuteAction=function(e,t,n){var i=this;return this.loadAdaptiveCardSdk().then(function(){return t.getJsonTypeName()===i.adaptiveCardsSdk.SubmitAction.JsonTypeName?new Promise(function(e,a){i.setButtonEnabled(n.currentTarget,!1);var s=function(){i.executeActions(t.data,function(t){i.setButtonEnabled(n.currentTarget,!0),e(t)})};i.doInstall&&teamspace.services.AdaptiveCard.isJitAction(t)?i.canInstallApp?i.installApp(n).then(function(){s()}):(i.teamId?i.errorMessage=i.$translate.instant(i.resources.strings.inputExtension_task_module_preview_screen_noprems_team):i.chatId?i.errorMessage=i.$translate.instant(i.resources.strings.inputExtension_task_module_preview_screen_noprems_chat):i.launchOptions.isOpenedFromPowerbar?i.errorMessage=i.$translate.instant(i.resources.strings.inputExtension_task_module_preview_screen_noprems_powerbar):i.errorMessage=i.$translate.instant(i.resources.strings.extension_taskModuleErrorMessage),i.$timeout(function(){i.setButtonEnabled(n.currentTarget,!0)},0,!1),e(!1)):s()}):Promise.resolve(!0)})},t.prototype.onWillAdaptiveCardExecuteActionPreviewCard=function(){return Promise.resolve(!1)},t.prototype.onAdaptiveCardPreInit=function(e){e.cardViewModel&&e.cardViewModel.jitButtonTitle&&this.showConsentModule(e.cardViewModel.jitButtonTitle)},t.prototype.previewScreenExecuteAction=function(e,t){var n=this;this.setButtonEnabled(e.currentTarget,!1),this.logTelemetryForTaskModulePreviewAction(t),"edit"===t||"send"===t&&!this.doInstall?this.sendInvokeToBot(e,t):"send"===t&&this.doInstall&&this.canInstallApp?this.installApp(e).then(function(){n.sendInvokeToBot(e,t)}):(this.errorMessage=this.$translate.instant(this.resources.strings.extension_taskModuleErrorMessage),this.setButtonEnabled(e.currentTarget,!0))},t.prototype.installApp=function(e){var t=this,n=this.loggingService.newScenario(this.constants.scenarios.extensibility.tabs.taskModule.addAppTaskModule),i=function(i){if(t.errorMessage=t.$translate.instant(t.resources.strings.extension_taskModuleErrorMessage),t.extensionTabHelperService.isMeetingChat()&&i&&i.data)switch(i.data.errorCode){case t.constants.extensibility.apps.errorCodes.noPermissionToInstallApp:t.errorMessage=t.$translate.instant(t.resources.strings.extension_noPermissionToManageAppInMeetingErrorMessage);break;case t.constants.extensibility.apps.errorCodes.participantMeetingExpired:t.errorMessage=t.$translate.instant(t.resources.strings.extension_meetingExpiredErrorMessage);break;case t.constants.extensibility.apps.errorCodes.failedToCheckPermissionToManageApp:t.errorMessage=t.$translate.instant(t.resources.strings.extension_meetingDefaultPermissionErrorMessage)}throw t.setButtonEnabled(e.currentTarget,!0),n.fail(t.getScenarioEventData()),i};if(this.teamId)return(a=this.appDefinition.externalId&&!this.appDefinition.tenantId?this.appsService.createTeamAppDefinition(this.teamId,this.appDefinition,this.channelId):this.appsService.createTeamAppEntitlement(this.teamId,this.appDefinition,this.channelId)).then(function(){n.stop(t.getScenarioEventData())}).catch(function(e){i(e)});if(this.chatId){var a=this.appDefinition.externalId&&!this.appDefinition.tenantId?this.appsService.createGroupChatAppDefinition(this.chatId,this.appDefinition):this.appsService.createGroupChatAppEntitlement(this.chatId,this.appDefinition);return a.then(function(){n.stop(t.getScenarioEventData())}).catch(function(e){i(e)})}},t.prototype.setFocusToFirstElement=function(){if(this.isLoaded){var e=angular.element(".ngdialog-close");e.length>0&&(e.focus(),this.ariaLiveService.update(this.launchOptions.appName,!0),this.ariaLiveService.update(this.launchOptions.title,!0))}},t.prototype.setFocusToAdaptiveCard=function(){var e=angular.element(".ac-container");e.length>0&&e.focus()},t.prototype.onFrameSet=function(e){this.launchOptions.setTaskFrame&&this.launchOptions.setTaskFrame(e)},t.prototype.sendInvokeToBot=function(e,t){var n=this;this.launchOptions.onBotPreviewMessageResult(t,this.botActivityPreview).then(function(e){n.restoreBotPreviewMessageContentSize(),n.processResult(e)}).catch(function(e){n.setContentNotAvailableSizeHelper(),e&&(e.errorCode&&(e.errorCode===SkypeX.Services.ChatServiceUtils.BotFailureErrorCode||e.errorCode===SkypeX.Services.ChatServiceUtils.SyncErrorCode_NoAccess)||e.statusCode&&(403===e.statusCode||404===e.statusCode))?n.errorMessage=n.$translate.instant(n.resources.strings.inputExtension_invoke_failure_bots):n.errorMessage=n.$translate.instant(n.resources.strings.inputExtension_invoke_failure_nonbots)}).finally(function(){n.isLoading=!1,n.setButtonEnabled(e.currentTarget,!0)})},t.prototype.createMessageHandler=function(t){var n=e.prototype.createMessageHandler.call(this,t);return n.addMessageHandler(this.constants.SdkMessageTypes.tasks.updateTask,this.handleUpdateTaskInfo.bind(this)),n.addMessageHandler(this.constants.SdkMessageTypes.tasks.completeTask,this.handleSubmitTask.bind(this)),n.addMessageHandler(this.constants.SdkMessageTypes.messageForParent,this.handleMessageForParent.bind(this)),n.addMessageHandler(this.constants.SdkMessageTypes.tasks.submitTask,this.handleSubmitTask.bind(this)),n},t.prototype.handleExecuteDeepLink=function(t,n){var i=this;return e.prototype.handleExecuteDeepLink.call(this,t,n).then(function(e){return e&&e[0]&&i.$scope.closeThisDialog(o.TaskModuleResultType.ExecuteDeepLink),e})},t.prototype.handleMessageForParent=function(e,t){return this.launchOptions.sendMessageToParent?(this.launchOptions.sendMessageToParent(t),this.$q.resolve([!0])):this.$q.resolve([!1,"Operation not supported"])},t.prototype.handleUpdateTaskInfo=function(e,t){if(void 0===t&&(t={}),this.isInFrameContext(e,"task")){var n=t.width,i=t.height;null!=n&&(this.updatedContentSize.widthLayout=n),null!=i&&(this.updatedContentSize.heightLayout=i),this.setContentSize(this.updatedContentSize)}},t.prototype.handleSubmitTask=function(e,t,n){var i=this;if(this.isInFrameContext(e,"task"))return this.extensionTabService.getAppDefinitionFromCurrentContext(this.definitionId).then(function(e){if(i.submitTaskModuleURLScenario=i.loggingService.newScenario(i.constants.scenarios.extensibility.tabs.taskModule.submitTaskModuleURL),n&&n.length>0&&(1!==n.length||!_.isNil(n[0]))){if(!n.includes(i.definitionId)&&!n.includes(e.externalId))return i.submitTaskModuleURLScenario.fail(a(a({},i.getScenarioEventData()),{error:i.$translate.instant(i.resources.strings.extension_taskModuleInvalidAppID)})),[!1,i.$translate.instant(i.resources.strings.extension_taskModuleInvalidAppID)];t?(i.logTelemetryForTaskModuleTaskSubmit(o.TaskModuleType.Webview,"SDK Task Complete"),i.executeActions(t)):i.$scope.closeThisDialog(o.TaskModuleResultType.Done),i.submitTaskModuleURLScenario.stop(i.getScenarioEventData())}else t?(i.logTelemetryForTaskModuleTaskSubmit(o.TaskModuleType.Webview,"SDK Task Complete"),i.executeActions(t)):i.$scope.closeThisDialog(o.TaskModuleResultType.Done),i.submitTaskModuleURLScenario.stop(i.getScenarioEventData())})},t.prototype.processResult=function(e){switch(this.overwriteTitleIfNecessary(e),this.reset(),this.currentApp={id:e.appId,externalId:e.externalId},this.currentContentSizeFromBot={widthLayout:e.widthLayout,heightLayout:e.heightLayout},e.type){case o.TaskModuleResultType.ErrorMessage:this.setContentNotAvailableSizeHelper(),this.errorMessage=e.message;break;case o.TaskModuleResultType.InfoMessage:this.message=e.message;break;case o.TaskModuleResultType.MoreAdaptiveCard:if(!e.adaptiveCard||!e.adaptiveCard.cardPayload){this.loggingService.error("TaskModule result is missing adaptiveCard payload!"),this.$scope.closeThisDialog();break}this.adaptiveCardViewModel=this.botCardFactory.createCard({content:e.adaptiveCard.cardPayload,contentType:this.constants.bots.cards.types.adaptive,appId:this.moduleInput.appId},this.chatId||this.teamId,null),this.setContentSize(e),this.adaptiveCardCtrl&&(this.adaptiveCardCtrl.cardViewModel=this.adaptiveCardViewModel),this.setFocusToAdaptiveCard();break;case o.TaskModuleResultType.BotPreviewMessage:if(!e.adaptiveCard||!e.adaptiveCard.cardPayload){this.loggingService.error("TaskModule result is missing adaptiveCard payload!"),this.$scope.closeThisDialog();break}this.isPreviewScreen=!0,this.adaptiveCardViewModel=this.botCardFactory.createCard({content:e.adaptiveCard.cardPayload,contentType:this.constants.bots.cards.types.adaptive,appId:this.moduleInput.appId},this.chatId||this.teamId,null),this.botActivityPreview=e.botActivityPreview,this.setBotPreviewMessageContentSize(),this.showConsentModule();break;case o.TaskModuleResultType.MoreWebview:this.loadWebview(e);break;case o.TaskModuleResultType.Done:default:this.$scope.closeThisDialog(o.TaskModuleResultType.Done)}},t.prototype.executeActions=function(e,t){var n=this;this.launchOptions.onExecuteAction(e).then(function(e){n.processResult(e)}).catch(function(e){n.setContentNotAvailableSizeHelper(),n.isLoading=!1,n.submitTaskModuleURLScenario&&n.submitTaskModuleURLScenario.fail(a(a({},n.getScenarioEventData()),{error:e})),n.errorMessage=n.$translate.instant(n.resources.strings.extension_taskModuleErrorMessage)}).finally(function(){n.isLoading=!1,t&&t(!1)})},t.prototype.reset=function(){this.adaptiveCardViewModel=void 0,this.message=void 0,this.errorMessage=void 0,this.isLoading=!0,this.frameSrc=void 0,this.showConsent=!1,this.currentJitButtonTitle=void 0,this.isPreviewScreen=!1,this.appDefinition=void 0},t.prototype.onLoadHandler=function(){this.isLoaded=!0;var e=angular.element(".ngdialog-close");e.length>0&&e.on("keydown blur",function(e){if(e.shiftKey&&e.keyCode===this.constants.keyCodes.tab)return!1}.bind(this)),this.setFocusToFirstElement()},t.prototype.loadWebview=function(e){var t=this,n=this.loggingService.newScenario(this.constants.scenarios.extensibility.tabs.taskModule.viewTaskModuleURL);try{this.frameContext="task",this.definitionId=e.appId,this.setContentSize(e),this.isLoading=!0,this.beginLoad(e.webView.url).then(function(e){t.isLoading=!1,n&&n.stop(t.getScenarioEventData())}).catch(function(e){t.setContentNotAvailableSizeHelper(),t.isLoading=!1,n&&n.fail(a(a({},t.getScenarioEventData()),{error:e}))})}catch(e){throw n&&n.fail(a(a({},this.getScenarioEventData()),{error:e})),e}},t.prototype.setContentSize=function(e){var t=$(window).width(),n=$(window).height(),i=function(e){return!!_.find(Object.values(o.TaskModuleLayout),function(t){return t.toLowerCase()===e.toLowerCase()})},a=this.updatedContentSize.widthLayout||e&&e.widthLayout;_.isString(a)&&i(a)?this.width=this.widthMap[a.toLowerCase()]:parseFloat(a)?(this.calculatedWidth=parseFloat(a),.8*t<this.calculatedWidth?this.width="80vw":this.width=this.calculatedWidth+"px"):this.width=this.widthMap[o.TaskModuleLayout.Medium];var s=this.updatedContentSize.heightLayout||e&&e.heightLayout;_.isString(s)&&i(s)?this.height=this.heightMap[s.toLowerCase()]:parseFloat(s)?(this.calculatedHeight=parseFloat(s),.8*n<this.calculatedHeight?this.height="80vh":this.height=this.calculatedHeight+"px"):e&&e.type==o.TaskModuleType.Webview?this.height=this.heightMap[o.TaskModuleLayout.Medium]:this.height="auto",this.frameSize={width:this.width.match(/.+px$/)?+this.width.slice(0,-2):Math.floor(.8*t),height:this.height.match(/.+px$/)?+this.height.slice(0,-2):Math.floor(.8*n)}},t.prototype.setInitialSizeHelper=function(e,t){this.setContentSize({widthLayout:e,heightLayout:t})},t.prototype.setBotPreviewMessageContentSize=function(){this.updatedContentSize.widthLayout=this.frameSize.width,this.updatedContentSize.heightLayout=480,this.previousScreenHeight=this.frameSize.height,this.setContentSize()},t.prototype.restoreBotPreviewMessageContentSize=function(){this.updatedContentSize.widthLayout=this.frameSize.width,this.updatedContentSize.heightLayout=this.previousScreenHeight,this.setContentSize()},t.prototype.setContentNotAvailableSizeHelper=function(){this.setContentSize({widthLayout:o.TaskModuleLayout.Small,heightLayout:o.TaskModuleLayout.Small})},t.prototype.initLayoutSizeMap=function(){this.widthMap={},this.widthMap[o.TaskModuleLayout.Small]="20vw",this.widthMap[o.TaskModuleLayout.Medium]="50vw",this.widthMap[o.TaskModuleLayout.Large]="60vw",this.heightMap={},this.heightMap[o.TaskModuleLayout.Small]="20vh",this.heightMap[o.TaskModuleLayout.Medium]="50vh",this.heightMap[o.TaskModuleLayout.Large]="66vh"},t.prototype.overwriteTitleIfNecessary=function(e){e.title&&(this.launchOptions.title=e.title,this.setAriaLabel())},t.prototype.setAriaLabel=function(){this.ariaLabel=this.$translate.instant(this.resources.strings.task_module_aria_label,{appName:this.launchOptions.appName,title:this.launchOptions.title})},t.prototype.logTelemetryForTaskModuleLaunch=function(e){var t=this.routeUtilityService.getRootRouteParams(),n={panel:{type:teamspace.PanelType.taskModule},app:{id:this.definitionId,appName:this.currentApp.externalId?"<redacted_sideloaded>":this.launchOptions.appName,scope:teamspace.components.PanelAppScope.general,scenarioCapability:teamspace.components.PanelAppScenarioCapability.na},dataBag:{taskModuleType:o.TaskModuleType[e],tabTechStack:t&&t.isAdaptiveCardTab?"json":void 0}};this.analyticsService.onPanelView(this.$scope,n)},t.prototype.logTelemetryForTaskModuleTaskSubmit=function(e,t){var n={panel:{type:teamspace.PanelType.taskModule},app:{id:this.definitionId,appName:this.currentApp.externalId?"<redacted_sideloaded>":this.launchOptions.appName,scope:teamspace.components.PanelAppScope.general,scenarioCapability:teamspace.components.PanelAppScenarioCapability.na},dataBag:{completionType:t,taskModuleType:o.TaskModuleType[e]}};this.analyticsService.onPanelView(this.$scope,n)},t.prototype.logTelemetryForTaskModulePreviewAction=function(e){var t=this;this.$timeout(function(){var n={actionGesture:teamspace.components.PanelActionGesture.click,actionOutcome:teamspace.components.PanelActionOutcome.submit,actionScenario:"send"==e?teamspace.components.PanelActionScenario.messagePreviewSend:teamspace.components.PanelActionScenario.messagePreviewEdit,actionScenarioType:teamspace.components.PanelActionScenarioType.composeMsg,moduleName:teamspace.components.PanelModuleName.inputExtensionMesasageSend,moduleType:teamspace.components.PanelModuleType.inputExtensionMesasageSend,moduleSummary:e,dataBag:{appName:t.currentApp.externalId?"<redacted_sideloaded>":t.launchOptions.appName,externalId:t.currentApp.externalId},app:{id:t.definitionId,appName:t.currentApp.externalId?"<redacted_sideloaded>":t.launchOptions.appName,scope:teamspace.components.PanelAppScope.general,scenarioCapability:teamspace.components.PanelAppScenarioCapability.messaging}};teamspace.components.TelemetryHelper.logTelemetry(n,t.loggingService,t.analyticsService)},0,!1)},t.prototype.getScenarioEventData=function(){var e={};return e.appId=this.definitionId,e.appName=this.launchOptions.appName,e},t.prototype.setButtonEnabled=function(e,t){if(e)if(t){var n=angular.element(e),i=n.find(".ts-card-spinner");this.uiOrchestrator.nextFrame(teamspace.services.UiOrchestratorPriority.High,function(){n.removeAttr("disabled"),i&&i.remove()})}else{var a=angular.element(e),s=angular.copy(this.botCardService.sharedSpinner);this.uiOrchestrator.nextFrame(teamspace.services.UiOrchestratorPriority.High,function(){a.attr("disabled","disabled"),a.hasClass("ac-pushButton")&&a.append(s)})}},t.prototype.showConsentModule=function(e){var t=this;this.launchOptions.isOpenedFromPowerbar||!this.currentApp?(this.showConsent=!1,this.canInstallApp=!1,this.errorMessage=this.$translate.instant(this.resources.strings.inputExtension_task_module_preview_screen_noprems_powerbar)):this.extensionTabService.getInstallAndConsentInfo(this.currentApp.id,this.currentApp.externalId).then(function(n){n.installInfo.doInstall&&(t.appDefinition=n.installInfo.appDefinition,t.canInstallAppInContext()),t.doInstall=n.installInfo.doInstall,n.consentInfo?(t.showConsent=!0,t.currentJitButtonTitle=e||t.$translate.instant(t.resources.strings.inputExtension_task_module_preview_screen_send_button_title),t.privacyUrl=n.consentInfo.privacyUrl,t.termsOfUseUrl=n.consentInfo.termsOfUseUrl):t.showConsent=!1,t.setFocusToFirstElement()})},t.prototype.canInstallAppInContext=function(){var e=this,t=function(){e.canInstallApp?e.errorMessage=void 0:(e.teamId&&(e.errorMessage=e.$translate.instant(e.resources.strings.inputExtension_task_module_preview_screen_noprems_team)),e.chatId&&(e.errorMessage=e.$translate.instant(e.resources.strings.inputExtension_task_module_preview_screen_noprems_chat)))};this.teamId?this.channelService.getTeamById(this.teamId).then(function(n){if(n){var i=n.isArchived&&e.settingsService.valueAsBoolean(e.constants.settings.names.enableTeamArchive),a=e.teamMembershipPropertiesService.isAdmin(e.teamId);e.canInstallApp=!i&&(a||e.teamSettingsService.canAddApp(e.teamId)),t()}}):!this.chatId||SkypeX.Services.SkypeConversationLocal.isLie(this.chatId)?this.errorMessage=this.$translate.instant(this.resources.strings.inputExtension_task_module_preview_screen_chat_lie):(this.canInstallApp=this.settingsService.valueAsBoolean(this.constants.settings.names.enableBotsInGroupChat)&&!this.identityService.isGuestUserType(),t())},t}(n(41).ExtensionTabBaseController);t.TaskModuleController=r,angular.module("teamspace.taskModule",["teamspace.utilityService"]).run(["constants","dialogService","$templateCache",function(e,t,n){n.put("components/extensibility/taskModule/task-module.html",s),t.register(e.lazyDialogs.taskModule,{template:"components/extensibility/taskModule/task-module.html",className:"ts-modal-dialog task-module-dialog",closeByEscape:!0,closeByDocument:!1,ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"modalDialog-title",trapFocus:!1})}]).controller("TaskModuleController",r)},2695:function(e,t){e.exports='<div class="task-module" ng-controller="TaskModuleController as ctrl" data-tid="taskModuleDialog" role="dialog" aria-modal="true" aria-label="{{ctrl.ariaLabel}}">\n  <modal-dialog add-close-icon="true" suppress-default-button="true" suppress-default-footer="true" header-buttons="ctrl.headerButtons">\n    <div class="title-container" ng-if="!ctrl.launchOptions.suppressAppHeader && !ctrl.suppressAppHeaderOnStartup && !ctrl.isLoading">\n      <div ng-class="{\'adaptive-card-title\': !!ctrl.adaptiveCardViewModel,\n                      \'embedded-container-title\': !!ctrl.frameSrc,\n                      \'message-title\': !!ctrl.message,\n                      \'loading-title\': ctrl.isLoading,\n                      \'content-not-available-title\': ctrl.isContentNotAvailable\n                     }">\n        <div class="image-container" ng-style="::{ \'background\': ctrl.launchOptions.appAccentColor }">\n          <ng-include src="ctrl.launchOptions.appImageUrl" ng-if="::ctrl.utilityService.useNgIncludeForIcon(ctrl.launchOptions.appImageUrl)"></ng-include>\n          <img role="img" alt="{{::($root.resources.strings.extensibility_app_icon_alt|translate:{appName:ctrl.launchOptions.appName})}}" aria-label="{{::($root.resources.strings.extensibility_app_icon_alt|translate:{appName:ctrl.launchOptions.appName})}}" ng-src="{{::ctrl.launchOptions.appImageUrl}}" ng-if="::!ctrl.utilityService.useNgIncludeForIcon(ctrl.launchOptions.appImageUrl)"/>\n        </div>\n        <div class="text-container">\n          <span class="app-name" title="{{::ctrl.launchOptions.appName}}">{{::ctrl.launchOptions.appName}}</span>\n          <span ng-if="!!ctrl.launchOptions.title && ctrl.launchOptions.title != \'undefined\' && ctrl.launchOptions.title != \'null\'" class="dialog-title" title="{{ctrl.launchOptions.title}}">{{ctrl.launchOptions.title}}</span>\n        </div>\n      </div>\n    </div>\n\n    <div class="dialog-content" ng-class="{\'center-dialog-content\': ctrl.isLoading}">\n      <div ng-if="ctrl.isLoading" class="loading-container" ng-class="{\'center-loading-spinner\': ctrl.suppressAppHeaderOnStartup}" ng-style="{width: ctrl.width, height: ctrl.height}">\n        <busy-animation size="medium"></busy-animation>\n      </div>\n\n      <div ng-if="!ctrl.isLoading" ng-style="{width: ctrl.width, height: ctrl.height}" class="dialog-height">\n\n        \x3c!-- Adaptive Card --\x3e\n        <div ng-if="ctrl.adaptiveCardViewModel && !ctrl.isPreviewScreen" easy-scrollbar=".scroll-wrapper" class="adaptivecard">\n          <div class="scroll-wrapper" oc-lazy-load="adaptive-card">\n            <adaptive-card card="ctrl.adaptiveCardViewModel" host-config-default="::ctrl.hostConfigOverwrite" host-config-dark="::ctrl.hostConfigOverwrite" host-config-contrast="::ctrl.hostConfigOverwrite" show-card-border="false" on-ready="ctrl.onAdaptiveCardReady($ctrl)" on-post-processing-styling="ctrl.onAdaptiveCardPostProcessingStyling($ctrl)" on-will-execute-action="ctrl.onWillAdaptiveCardExecuteAction($ctrl, $action, $event)" on-pre-init="ctrl.onAdaptiveCardPreInit($ctrl)" popup-container-selector=".task-module">\n            </adaptive-card>\n          </div>\n        </div>\n\n        \x3c!-- Bot Preview Message --\x3e\n        <div ng-if="ctrl.adaptiveCardViewModel && ctrl.isPreviewScreen" easy-scrollbar=".scroll-wrapper" class="adaptivecard preview-screen" data-tid="botMessagePreview">\n          <div class="scroll-wrapper">\n            <div class="preview-screen-title">\n                {{::$root.resources.strings.inputExtension_task_module_preview_screen_title|translate}}\n            </div>\n            <div oc-lazy-load="adaptive-card">\n              <adaptive-card card="ctrl.adaptiveCardViewModel" show-card-border="true" on-will-execute-action="ctrl.onWillAdaptiveCardExecuteActionPreviewCard()" use-default-responsive-card-width="true">\n              </adaptive-card>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Webview Content --\x3e\n        <div ng-if="ctrl.frameSrc" easy-scrollbar=".scroll-wrapper" class="embedded-container">\n          <embedded-page-container class="task-module-container" definition-id="{{ctrl.definitionId}}" url="{{ctrl.frameSrc}}" on-content-loaded="ctrl.onContentLoaded(isSuccessful, frameInfo)" on-reload-requested="ctrl.onReloadRequested()" enable-message-passing="true" on-message-received="ctrl.onMessageReceived(source, data, origin)" iframe-title="{{::ctrl.iFrameTitle}}" page-identifier="{{ctrl.frameContext + \'_\' + ctrl.definitionId}}" state="ctrl.state" frame-size="{{ctrl.frameSize}}">\n          </embedded-page-container>\n        </div>\n\n        \x3c!-- Regular Message Results --\x3e\n        <div ng-if="ctrl.message && !ctrl.isErrorMessage" class="message">\n          <span ng-bind="ctrl.message"></span>\n        </div>\n      </div>\n    </div>\n\n    \x3c!-- Dialog Footer --\x3e\n    <div class="footer-container" ng-if="ctrl.shouldShowFooter" ng-style="{ width: ctrl.width }">\n\n      \x3c!-- Consent Info --\x3e\n      <div class="preview-screen-consent" ng-if="ctrl.shouldShowConsentElement">\n        <span id="ts-add-app-dialog-permissions-header" ng-if="ctrl.teamId" translate-with-html-params translate-id="inputExtension_task_module_preview_screen_consent_message_team" translate-values=\'{\n                "jitButtonTitle": "<strong>{{::ctrl.currentJitButtonTitle}}</strong>",\n                "appName": "<strong>{{::ctrl.launchOptions.appName}}</strong>",\n                "privacyPolicy": "<a ng-href=\\"{{::ctrl.privacyUrl}}\\"\n                    title=\\"{{::ctrl.privacyUrl}}\\"\n                    rel=\\"noopener\n                    noreferrer\\"\n                    target=\\"_blank\\"><span translate-once=\\"{{::$root.resources.strings.inputExtension_task_module_preview_screen_consent_privacy}}\\"></span></a>",\n                "termsOfUse": "<a ng-href=\\"{{::ctrl.termsOfUseUrl}}\\"\n                    title=\\"{{::ctrl.termsOfUseUrl}}\\"\n                    rel=\\"noopener\n                    noreferrer\\"\n                    target=\\"_blank\\"><span translate-once=\\"{{::$root.resources.strings.inputExtension_task_module_preview_screen_consent_termsOfUse}}\\"></span></a>"\n              }\'>\n        </span>\n        <span id="ts-add-app-dialog-permissions-header" ng-if="ctrl.chatId" translate-with-html-params translate-id="inputExtension_task_module_preview_screen_consent_message_chat" translate-values=\'{\n                "jitButtonTitle": "<strong>{{::ctrl.currentJitButtonTitle}}</strong>",\n                "appName": "<strong>{{::ctrl.launchOptions.appName}}</strong>",\n                "privacyPolicy": "<a ng-href=\\"{{::ctrl.privacyUrl}}\\"\n                  title=\\"{{::ctrl.privacyUrl}}\\"\n                  rel=\\"noopener\n                  noreferrer\\"\n                  target=\\"_blank\\"><span translate-once=\\"{{::$root.resources.strings.inputExtension_task_module_preview_screen_consent_privacy}}\\"></span></a>",\n                "termsOfUse": "<a ng-href=\\"{{::ctrl.termsOfUseUrl}}\\"\n                  title=\\"{{::ctrl.termsOfUseUrl}}\\"\n                  rel=\\"noopener\n                  noreferrer\\"\n                  target=\\"_blank\\"><span translate-once=\\"{{::$root.resources.strings.inputExtension_task_module_preview_screen_consent_termsOfUse}}\\"></span></a>"\n              }\'>\n        </span>\n      </div>\n\n      \x3c!-- Error Message --\x3e\n      <div ng-if="!!ctrl.errorMessage" class="error">\n        <ng-include class="error-icon" src="\'svg/icons-error-small.html\'"></ng-include>\n        <span ng-bind="ctrl.errorMessage" class="error-text">\n        </span>\n      </div>\n\n      \x3c!-- JIT Buttons --\x3e\n      <div class="preview-screen-buttons-wrapper" ng-if="ctrl.shouldShowJitButtons">\n        <button class="ts-btn ts-btn-primary preview-screen-button" ng-click="ctrl.previewScreenExecuteAction($event, \'edit\')">\n          {{::$root.resources.strings.inputExtension_task_module_preview_screen_edit_button_title|translate}}\n        </button>\n        <button class="ts-btn ts-btn-primary preview-screen-button" ng-click="ctrl.previewScreenExecuteAction($event, \'send\')" ng-disabled="(ctrl.showConsent && !ctrl.canInstallApp) || ctrl.launchOptions.isOpenedFromPowerbar">\n          {{::$root.resources.strings.inputExtension_task_module_preview_screen_send_button_title|translate}}\n        </button>\n      </div>\n    </div>\n    <div class="hide-div" aria-hidden="true">\n      <textarea class="hide-text" acc-tabbable="false" ng-focus="ctrl.setFocusToFirstElement()">\n      </textarea>\n    </div>\n  </modal-dialog>\n</div>'},31:function(e,t){e.exports=angular}},[2627]);
//# sourceMappingURL=[[staticsPath]]/hashed/lazy-ng1-mod-extensibility-dialogs.min-22c7853.js.map